(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function JC(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var S0={exports:{}},Mc={},T0={exports:{}},G={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xo=Symbol.for("react.element"),YC=Symbol.for("react.portal"),XC=Symbol.for("react.fragment"),ZC=Symbol.for("react.strict_mode"),e1=Symbol.for("react.profiler"),t1=Symbol.for("react.provider"),n1=Symbol.for("react.context"),i1=Symbol.for("react.forward_ref"),r1=Symbol.for("react.suspense"),s1=Symbol.for("react.memo"),o1=Symbol.for("react.lazy"),xp=Symbol.iterator;function a1(t){return t===null||typeof t!="object"?null:(t=xp&&t[xp]||t["@@iterator"],typeof t=="function"?t:null)}var C0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w0=Object.assign,P0={};function is(t,e,n){this.props=t,this.context=e,this.refs=P0,this.updater=n||C0}is.prototype.isReactComponent={};is.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};is.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function E0(){}E0.prototype=is.prototype;function Ch(t,e,n){this.props=t,this.context=e,this.refs=P0,this.updater=n||C0}var wh=Ch.prototype=new E0;wh.constructor=Ch;w0(wh,is.prototype);wh.isPureReactComponent=!0;var Rp=Array.isArray,x0=Object.prototype.hasOwnProperty,Ph={current:null},R0={key:!0,ref:!0,__self:!0,__source:!0};function _0(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)x0.call(e,i)&&!R0.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:xo,type:t,key:s,ref:o,props:r,_owner:Ph.current}}function c1(t,e){return{$$typeof:xo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Eh(t){return typeof t=="object"&&t!==null&&t.$$typeof===xo}function l1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _p=/\/+/g;function vl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?l1(""+t.key):e.toString(36)}function da(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case xo:case YC:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+vl(o,0):i,Rp(r)?(n="",t!=null&&(n=t.replace(_p,"$&/")+"/"),da(r,e,n,"",function(l){return l})):r!=null&&(Eh(r)&&(r=c1(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(_p,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Rp(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+vl(s,a);o+=da(s,e,n,c,r)}else if(c=a1(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+vl(s,a++),o+=da(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Vo(t,e,n){if(t==null)return t;var i=[],r=0;return da(t,i,"","",function(s){return e.call(n,s,r++)}),i}function u1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ze={current:null},ha={transition:null},d1={ReactCurrentDispatcher:Ze,ReactCurrentBatchConfig:ha,ReactCurrentOwner:Ph};function I0(){throw Error("act(...) is not supported in production builds of React.")}G.Children={map:Vo,forEach:function(t,e,n){Vo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Vo(t,function(){e++}),e},toArray:function(t){return Vo(t,function(e){return e})||[]},only:function(t){if(!Eh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};G.Component=is;G.Fragment=XC;G.Profiler=e1;G.PureComponent=Ch;G.StrictMode=ZC;G.Suspense=r1;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d1;G.act=I0;G.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=w0({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Ph.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)x0.call(e,c)&&!R0.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:xo,type:t.type,key:r,ref:s,props:i,_owner:o}};G.createContext=function(t){return t={$$typeof:n1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:t1,_context:t},t.Consumer=t};G.createElement=_0;G.createFactory=function(t){var e=_0.bind(null,t);return e.type=t,e};G.createRef=function(){return{current:null}};G.forwardRef=function(t){return{$$typeof:i1,render:t}};G.isValidElement=Eh;G.lazy=function(t){return{$$typeof:o1,_payload:{_status:-1,_result:t},_init:u1}};G.memo=function(t,e){return{$$typeof:s1,type:t,compare:e===void 0?null:e}};G.startTransition=function(t){var e=ha.transition;ha.transition={};try{t()}finally{ha.transition=e}};G.unstable_act=I0;G.useCallback=function(t,e){return Ze.current.useCallback(t,e)};G.useContext=function(t){return Ze.current.useContext(t)};G.useDebugValue=function(){};G.useDeferredValue=function(t){return Ze.current.useDeferredValue(t)};G.useEffect=function(t,e){return Ze.current.useEffect(t,e)};G.useId=function(){return Ze.current.useId()};G.useImperativeHandle=function(t,e,n){return Ze.current.useImperativeHandle(t,e,n)};G.useInsertionEffect=function(t,e){return Ze.current.useInsertionEffect(t,e)};G.useLayoutEffect=function(t,e){return Ze.current.useLayoutEffect(t,e)};G.useMemo=function(t,e){return Ze.current.useMemo(t,e)};G.useReducer=function(t,e,n){return Ze.current.useReducer(t,e,n)};G.useRef=function(t){return Ze.current.useRef(t)};G.useState=function(t){return Ze.current.useState(t)};G.useSyncExternalStore=function(t,e,n){return Ze.current.useSyncExternalStore(t,e,n)};G.useTransition=function(){return Ze.current.useTransition()};G.version="18.3.1";T0.exports=G;var T=T0.exports;const h1=JC(T);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f1=T,p1=Symbol.for("react.element"),m1=Symbol.for("react.fragment"),g1=Object.prototype.hasOwnProperty,v1=f1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y1={key:!0,ref:!0,__self:!0,__source:!0};function A0(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)g1.call(e,i)&&!y1.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:p1,type:t,key:s,ref:o,props:r,_owner:v1.current}}Mc.Fragment=m1;Mc.jsx=A0;Mc.jsxs=A0;S0.exports=Mc;var A=S0.exports,wu={},D0={exports:{}},St={},O0={exports:{}},M0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,z){var $=U.length;U.push(z);e:for(;0<$;){var ne=$-1>>>1,re=U[ne];if(0<r(re,z))U[ne]=z,U[$]=re,$=ne;else break e}}function n(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var z=U[0],$=U.pop();if($!==z){U[0]=$;e:for(var ne=0,re=U.length,vn=re>>>1;ne<vn;){var wt=2*(ne+1)-1,yn=U[wt],Ot=wt+1,de=U[Ot];if(0>r(yn,$))Ot<re&&0>r(de,yn)?(U[ne]=de,U[Ot]=$,ne=Ot):(U[ne]=yn,U[wt]=$,ne=wt);else if(Ot<re&&0>r(de,$))U[ne]=de,U[Ot]=$,ne=Ot;else break e}}return z}function r(U,z){var $=U.sortIndex-z.sortIndex;return $!==0?$:U.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,f=!1,g=!1,p=!1,S=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(U){for(var z=n(l);z!==null;){if(z.callback===null)i(l);else if(z.startTime<=U)i(l),z.sortIndex=z.expirationTime,e(c,z);else break;z=n(l)}}function k(U){if(p=!1,y(U),!g)if(n(c)!==null)g=!0,Ie(b);else{var z=n(l);z!==null&&J(k,z.startTime-U)}}function b(U,z){g=!1,p&&(p=!1,m(E),E=-1),f=!0;var $=h;try{for(y(z),d=n(c);d!==null&&(!(d.expirationTime>z)||U&&!M());){var ne=d.callback;if(typeof ne=="function"){d.callback=null,h=d.priorityLevel;var re=ne(d.expirationTime<=z);z=t.unstable_now(),typeof re=="function"?d.callback=re:d===n(c)&&i(c),y(z)}else i(c);d=n(c)}if(d!==null)var vn=!0;else{var wt=n(l);wt!==null&&J(k,wt.startTime-z),vn=!1}return vn}finally{d=null,h=$,f=!1}}var w=!1,P=null,E=-1,D=5,I=-1;function M(){return!(t.unstable_now()-I<D)}function V(){if(P!==null){var U=t.unstable_now();I=U;var z=!0;try{z=P(!0,U)}finally{z?H():(w=!1,P=null)}}else w=!1}var H;if(typeof v=="function")H=function(){v(V)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,ut=ee.port2;ee.port1.onmessage=V,H=function(){ut.postMessage(null)}}else H=function(){S(V,0)};function Ie(U){P=U,w||(w=!0,H())}function J(U,z){E=S(function(){U(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,Ie(b))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(U){switch(h){case 1:case 2:case 3:var z=3;break;default:z=h}var $=h;h=z;try{return U()}finally{h=$}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,z){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var $=h;h=U;try{return z()}finally{h=$}},t.unstable_scheduleCallback=function(U,z,$){var ne=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?ne+$:ne):$=ne,U){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=$+re,U={id:u++,callback:z,priorityLevel:U,startTime:$,expirationTime:re,sortIndex:-1},$>ne?(U.sortIndex=$,e(l,U),n(c)===null&&U===n(l)&&(p?(m(E),E=-1):p=!0,J(k,$-ne))):(U.sortIndex=re,e(c,U),g||f||(g=!0,Ie(b))),U},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(U){var z=h;return function(){var $=h;h=z;try{return U.apply(this,arguments)}finally{h=$}}}})(M0);O0.exports=M0;var k1=O0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b1=T,kt=k1;function L(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var N0=new Set,Zs={};function Ji(t,e){zr(t,e),zr(t+"Capture",e)}function zr(t,e){for(Zs[t]=e,t=0;t<e.length;t++)N0.add(e[t])}var Dn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pu=Object.prototype.hasOwnProperty,S1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ip={},Ap={};function T1(t){return Pu.call(Ap,t)?!0:Pu.call(Ip,t)?!1:S1.test(t)?Ap[t]=!0:(Ip[t]=!0,!1)}function C1(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function w1(t,e,n,i){if(e===null||typeof e>"u"||C1(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function et(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var $e={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){$e[t]=new et(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];$e[e]=new et(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){$e[t]=new et(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){$e[t]=new et(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){$e[t]=new et(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){$e[t]=new et(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){$e[t]=new et(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){$e[t]=new et(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){$e[t]=new et(t,5,!1,t.toLowerCase(),null,!1,!1)});var xh=/[\-:]([a-z])/g;function Rh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(xh,Rh);$e[e]=new et(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(xh,Rh);$e[e]=new et(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(xh,Rh);$e[e]=new et(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){$e[t]=new et(t,1,!1,t.toLowerCase(),null,!1,!1)});$e.xlinkHref=new et("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){$e[t]=new et(t,1,!1,t.toLowerCase(),null,!0,!0)});function _h(t,e,n,i){var r=$e.hasOwnProperty(e)?$e[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(w1(e,n,r,i)&&(n=null),i||r===null?T1(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var jn=b1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Bo=Symbol.for("react.element"),cr=Symbol.for("react.portal"),lr=Symbol.for("react.fragment"),Ih=Symbol.for("react.strict_mode"),Eu=Symbol.for("react.profiler"),L0=Symbol.for("react.provider"),U0=Symbol.for("react.context"),Ah=Symbol.for("react.forward_ref"),xu=Symbol.for("react.suspense"),Ru=Symbol.for("react.suspense_list"),Dh=Symbol.for("react.memo"),Kn=Symbol.for("react.lazy"),F0=Symbol.for("react.offscreen"),Dp=Symbol.iterator;function hs(t){return t===null||typeof t!="object"?null:(t=Dp&&t[Dp]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,yl;function Rs(t){if(yl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);yl=e&&e[1]||""}return`
`+yl+t}var kl=!1;function bl(t,e){if(!t||kl)return"";kl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{kl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Rs(t):""}function P1(t){switch(t.tag){case 5:return Rs(t.type);case 16:return Rs("Lazy");case 13:return Rs("Suspense");case 19:return Rs("SuspenseList");case 0:case 2:case 15:return t=bl(t.type,!1),t;case 11:return t=bl(t.type.render,!1),t;case 1:return t=bl(t.type,!0),t;default:return""}}function _u(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case lr:return"Fragment";case cr:return"Portal";case Eu:return"Profiler";case Ih:return"StrictMode";case xu:return"Suspense";case Ru:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case U0:return(t.displayName||"Context")+".Consumer";case L0:return(t._context.displayName||"Context")+".Provider";case Ah:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Dh:return e=t.displayName||null,e!==null?e:_u(t.type)||"Memo";case Kn:e=t._payload,t=t._init;try{return _u(t(e))}catch{}}return null}function E1(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _u(e);case 8:return e===Ih?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function di(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function j0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function x1(t){var e=j0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function zo(t){t._valueTracker||(t._valueTracker=x1(t))}function V0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=j0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Ba(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Iu(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Op(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=di(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function B0(t,e){e=e.checked,e!=null&&_h(t,"checked",e,!1)}function Au(t,e){B0(t,e);var n=di(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Du(t,e.type,n):e.hasOwnProperty("defaultValue")&&Du(t,e.type,di(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Mp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Du(t,e,n){(e!=="number"||Ba(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var _s=Array.isArray;function Rr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+di(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Ou(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(L(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Np(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(L(92));if(_s(n)){if(1<n.length)throw Error(L(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:di(n)}}function z0(t,e){var n=di(e.value),i=di(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Lp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Mu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var $o,W0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for($o=$o||document.createElement("div"),$o.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=$o.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function eo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Us={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},R1=["Webkit","ms","Moz","O"];Object.keys(Us).forEach(function(t){R1.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Us[e]=Us[t]})});function q0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Us.hasOwnProperty(t)&&Us[t]?(""+e).trim():e+"px"}function H0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=q0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var _1=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nu(t,e){if(e){if(_1[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(L(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(L(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(L(61))}if(e.style!=null&&typeof e.style!="object")throw Error(L(62))}}function Lu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Uu=null;function Oh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Fu=null,_r=null,Ir=null;function Up(t){if(t=Io(t)){if(typeof Fu!="function")throw Error(L(280));var e=t.stateNode;e&&(e=jc(e),Fu(t.stateNode,t.type,e))}}function K0(t){_r?Ir?Ir.push(t):Ir=[t]:_r=t}function G0(){if(_r){var t=_r,e=Ir;if(Ir=_r=null,Up(t),e)for(t=0;t<e.length;t++)Up(e[t])}}function Q0(t,e){return t(e)}function J0(){}var Sl=!1;function Y0(t,e,n){if(Sl)return t(e,n);Sl=!0;try{return Q0(t,e,n)}finally{Sl=!1,(_r!==null||Ir!==null)&&(J0(),G0())}}function to(t,e){var n=t.stateNode;if(n===null)return null;var i=jc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var ju=!1;if(Dn)try{var fs={};Object.defineProperty(fs,"passive",{get:function(){ju=!0}}),window.addEventListener("test",fs,fs),window.removeEventListener("test",fs,fs)}catch{ju=!1}function I1(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Fs=!1,za=null,$a=!1,Vu=null,A1={onError:function(t){Fs=!0,za=t}};function D1(t,e,n,i,r,s,o,a,c){Fs=!1,za=null,I1.apply(A1,arguments)}function O1(t,e,n,i,r,s,o,a,c){if(D1.apply(this,arguments),Fs){if(Fs){var l=za;Fs=!1,za=null}else throw Error(L(198));$a||($a=!0,Vu=l)}}function Yi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function X0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Fp(t){if(Yi(t)!==t)throw Error(L(188))}function M1(t){var e=t.alternate;if(!e){if(e=Yi(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Fp(r),t;if(s===i)return Fp(r),e;s=s.sibling}throw Error(L(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(L(189))}}if(n.alternate!==i)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function Z0(t){return t=M1(t),t!==null?ey(t):null}function ey(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=ey(t);if(e!==null)return e;t=t.sibling}return null}var ty=kt.unstable_scheduleCallback,jp=kt.unstable_cancelCallback,N1=kt.unstable_shouldYield,L1=kt.unstable_requestPaint,we=kt.unstable_now,U1=kt.unstable_getCurrentPriorityLevel,Mh=kt.unstable_ImmediatePriority,ny=kt.unstable_UserBlockingPriority,Wa=kt.unstable_NormalPriority,F1=kt.unstable_LowPriority,iy=kt.unstable_IdlePriority,Nc=null,rn=null;function j1(t){if(rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(Nc,t,void 0,(t.current.flags&128)===128)}catch{}}var qt=Math.clz32?Math.clz32:z1,V1=Math.log,B1=Math.LN2;function z1(t){return t>>>=0,t===0?32:31-(V1(t)/B1|0)|0}var Wo=64,qo=4194304;function Is(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function qa(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Is(a):(s&=o,s!==0&&(i=Is(s)))}else o=n&~r,o!==0?i=Is(o):s!==0&&(i=Is(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-qt(e),r=1<<n,i|=t[n],e&=~r;return i}function $1(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function W1(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-qt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=$1(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function Bu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ry(){var t=Wo;return Wo<<=1,!(Wo&4194240)&&(Wo=64),t}function Tl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ro(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qt(e),t[e]=n}function q1(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-qt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Nh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-qt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var te=0;function sy(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var oy,Lh,ay,cy,ly,zu=!1,Ho=[],ti=null,ni=null,ii=null,no=new Map,io=new Map,Qn=[],H1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vp(t,e){switch(t){case"focusin":case"focusout":ti=null;break;case"dragenter":case"dragleave":ni=null;break;case"mouseover":case"mouseout":ii=null;break;case"pointerover":case"pointerout":no.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":io.delete(e.pointerId)}}function ps(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Io(e),e!==null&&Lh(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function K1(t,e,n,i,r){switch(e){case"focusin":return ti=ps(ti,t,e,n,i,r),!0;case"dragenter":return ni=ps(ni,t,e,n,i,r),!0;case"mouseover":return ii=ps(ii,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return no.set(s,ps(no.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,io.set(s,ps(io.get(s)||null,t,e,n,i,r)),!0}return!1}function uy(t){var e=_i(t.target);if(e!==null){var n=Yi(e);if(n!==null){if(e=n.tag,e===13){if(e=X0(n),e!==null){t.blockedOn=e,ly(t.priority,function(){ay(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function fa(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=$u(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Uu=i,n.target.dispatchEvent(i),Uu=null}else return e=Io(n),e!==null&&Lh(e),t.blockedOn=n,!1;e.shift()}return!0}function Bp(t,e,n){fa(t)&&n.delete(e)}function G1(){zu=!1,ti!==null&&fa(ti)&&(ti=null),ni!==null&&fa(ni)&&(ni=null),ii!==null&&fa(ii)&&(ii=null),no.forEach(Bp),io.forEach(Bp)}function ms(t,e){t.blockedOn===e&&(t.blockedOn=null,zu||(zu=!0,kt.unstable_scheduleCallback(kt.unstable_NormalPriority,G1)))}function ro(t){function e(r){return ms(r,t)}if(0<Ho.length){ms(Ho[0],t);for(var n=1;n<Ho.length;n++){var i=Ho[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ti!==null&&ms(ti,t),ni!==null&&ms(ni,t),ii!==null&&ms(ii,t),no.forEach(e),io.forEach(e),n=0;n<Qn.length;n++)i=Qn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Qn.length&&(n=Qn[0],n.blockedOn===null);)uy(n),n.blockedOn===null&&Qn.shift()}var Ar=jn.ReactCurrentBatchConfig,Ha=!0;function Q1(t,e,n,i){var r=te,s=Ar.transition;Ar.transition=null;try{te=1,Uh(t,e,n,i)}finally{te=r,Ar.transition=s}}function J1(t,e,n,i){var r=te,s=Ar.transition;Ar.transition=null;try{te=4,Uh(t,e,n,i)}finally{te=r,Ar.transition=s}}function Uh(t,e,n,i){if(Ha){var r=$u(t,e,n,i);if(r===null)Dl(t,e,i,Ka,n),Vp(t,i);else if(K1(r,t,e,n,i))i.stopPropagation();else if(Vp(t,i),e&4&&-1<H1.indexOf(t)){for(;r!==null;){var s=Io(r);if(s!==null&&oy(s),s=$u(t,e,n,i),s===null&&Dl(t,e,i,Ka,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Dl(t,e,i,null,n)}}var Ka=null;function $u(t,e,n,i){if(Ka=null,t=Oh(i),t=_i(t),t!==null)if(e=Yi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=X0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ka=t,null}function dy(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(U1()){case Mh:return 1;case ny:return 4;case Wa:case F1:return 16;case iy:return 536870912;default:return 16}default:return 16}}var Xn=null,Fh=null,pa=null;function hy(){if(pa)return pa;var t,e=Fh,n=e.length,i,r="value"in Xn?Xn.value:Xn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return pa=r.slice(t,1<i?1-i:void 0)}function ma(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ko(){return!0}function zp(){return!1}function Tt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ko:zp,this.isPropagationStopped=zp,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ko)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ko)},persist:function(){},isPersistent:Ko}),e}var rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jh=Tt(rs),_o=ve({},rs,{view:0,detail:0}),Y1=Tt(_o),Cl,wl,gs,Lc=ve({},_o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==gs&&(gs&&t.type==="mousemove"?(Cl=t.screenX-gs.screenX,wl=t.screenY-gs.screenY):wl=Cl=0,gs=t),Cl)},movementY:function(t){return"movementY"in t?t.movementY:wl}}),$p=Tt(Lc),X1=ve({},Lc,{dataTransfer:0}),Z1=Tt(X1),ew=ve({},_o,{relatedTarget:0}),Pl=Tt(ew),tw=ve({},rs,{animationName:0,elapsedTime:0,pseudoElement:0}),nw=Tt(tw),iw=ve({},rs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),rw=Tt(iw),sw=ve({},rs,{data:0}),Wp=Tt(sw),ow={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=cw[t])?!!e[t]:!1}function Vh(){return lw}var uw=ve({},_o,{key:function(t){if(t.key){var e=ow[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ma(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?aw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vh,charCode:function(t){return t.type==="keypress"?ma(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ma(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),dw=Tt(uw),hw=ve({},Lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qp=Tt(hw),fw=ve({},_o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vh}),pw=Tt(fw),mw=ve({},rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),gw=Tt(mw),vw=ve({},Lc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),yw=Tt(vw),kw=[9,13,27,32],Bh=Dn&&"CompositionEvent"in window,js=null;Dn&&"documentMode"in document&&(js=document.documentMode);var bw=Dn&&"TextEvent"in window&&!js,fy=Dn&&(!Bh||js&&8<js&&11>=js),Hp=String.fromCharCode(32),Kp=!1;function py(t,e){switch(t){case"keyup":return kw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function my(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ur=!1;function Sw(t,e){switch(t){case"compositionend":return my(e);case"keypress":return e.which!==32?null:(Kp=!0,Hp);case"textInput":return t=e.data,t===Hp&&Kp?null:t;default:return null}}function Tw(t,e){if(ur)return t==="compositionend"||!Bh&&py(t,e)?(t=hy(),pa=Fh=Xn=null,ur=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return fy&&e.locale!=="ko"?null:e.data;default:return null}}var Cw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Cw[t.type]:e==="textarea"}function gy(t,e,n,i){K0(i),e=Ga(e,"onChange"),0<e.length&&(n=new jh("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Vs=null,so=null;function ww(t){xy(t,0)}function Uc(t){var e=fr(t);if(V0(e))return t}function Pw(t,e){if(t==="change")return e}var vy=!1;if(Dn){var El;if(Dn){var xl="oninput"in document;if(!xl){var Qp=document.createElement("div");Qp.setAttribute("oninput","return;"),xl=typeof Qp.oninput=="function"}El=xl}else El=!1;vy=El&&(!document.documentMode||9<document.documentMode)}function Jp(){Vs&&(Vs.detachEvent("onpropertychange",yy),so=Vs=null)}function yy(t){if(t.propertyName==="value"&&Uc(so)){var e=[];gy(e,so,t,Oh(t)),Y0(ww,e)}}function Ew(t,e,n){t==="focusin"?(Jp(),Vs=e,so=n,Vs.attachEvent("onpropertychange",yy)):t==="focusout"&&Jp()}function xw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Uc(so)}function Rw(t,e){if(t==="click")return Uc(e)}function _w(t,e){if(t==="input"||t==="change")return Uc(e)}function Iw(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Kt=typeof Object.is=="function"?Object.is:Iw;function oo(t,e){if(Kt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Pu.call(e,r)||!Kt(t[r],e[r]))return!1}return!0}function Yp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Xp(t,e){var n=Yp(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Yp(n)}}function ky(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ky(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function by(){for(var t=window,e=Ba();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ba(t.document)}return e}function zh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Aw(t){var e=by(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ky(n.ownerDocument.documentElement,n)){if(i!==null&&zh(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Xp(n,s);var o=Xp(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Dw=Dn&&"documentMode"in document&&11>=document.documentMode,dr=null,Wu=null,Bs=null,qu=!1;function Zp(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;qu||dr==null||dr!==Ba(i)||(i=dr,"selectionStart"in i&&zh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Bs&&oo(Bs,i)||(Bs=i,i=Ga(Wu,"onSelect"),0<i.length&&(e=new jh("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=dr)))}function Go(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var hr={animationend:Go("Animation","AnimationEnd"),animationiteration:Go("Animation","AnimationIteration"),animationstart:Go("Animation","AnimationStart"),transitionend:Go("Transition","TransitionEnd")},Rl={},Sy={};Dn&&(Sy=document.createElement("div").style,"AnimationEvent"in window||(delete hr.animationend.animation,delete hr.animationiteration.animation,delete hr.animationstart.animation),"TransitionEvent"in window||delete hr.transitionend.transition);function Fc(t){if(Rl[t])return Rl[t];if(!hr[t])return t;var e=hr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Sy)return Rl[t]=e[n];return t}var Ty=Fc("animationend"),Cy=Fc("animationiteration"),wy=Fc("animationstart"),Py=Fc("transitionend"),Ey=new Map,em="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vi(t,e){Ey.set(t,e),Ji(e,[t])}for(var _l=0;_l<em.length;_l++){var Il=em[_l],Ow=Il.toLowerCase(),Mw=Il[0].toUpperCase()+Il.slice(1);vi(Ow,"on"+Mw)}vi(Ty,"onAnimationEnd");vi(Cy,"onAnimationIteration");vi(wy,"onAnimationStart");vi("dblclick","onDoubleClick");vi("focusin","onFocus");vi("focusout","onBlur");vi(Py,"onTransitionEnd");zr("onMouseEnter",["mouseout","mouseover"]);zr("onMouseLeave",["mouseout","mouseover"]);zr("onPointerEnter",["pointerout","pointerover"]);zr("onPointerLeave",["pointerout","pointerover"]);Ji("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ji("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ji("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ji("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ji("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ji("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var As="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nw=new Set("cancel close invalid load scroll toggle".split(" ").concat(As));function tm(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,O1(i,e,void 0,t),t.currentTarget=null}function xy(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;tm(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;tm(r,a,l),s=c}}}if($a)throw t=Vu,$a=!1,Vu=null,t}function ae(t,e){var n=e[Ju];n===void 0&&(n=e[Ju]=new Set);var i=t+"__bubble";n.has(i)||(Ry(e,t,2,!1),n.add(i))}function Al(t,e,n){var i=0;e&&(i|=4),Ry(n,t,i,e)}var Qo="_reactListening"+Math.random().toString(36).slice(2);function ao(t){if(!t[Qo]){t[Qo]=!0,N0.forEach(function(n){n!=="selectionchange"&&(Nw.has(n)||Al(n,!1,t),Al(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Qo]||(e[Qo]=!0,Al("selectionchange",!1,e))}}function Ry(t,e,n,i){switch(dy(e)){case 1:var r=Q1;break;case 4:r=J1;break;default:r=Uh}n=r.bind(null,e,n,t),r=void 0,!ju||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Dl(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=_i(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Y0(function(){var l=s,u=Oh(n),d=[];e:{var h=Ey.get(t);if(h!==void 0){var f=jh,g=t;switch(t){case"keypress":if(ma(n)===0)break e;case"keydown":case"keyup":f=dw;break;case"focusin":g="focus",f=Pl;break;case"focusout":g="blur",f=Pl;break;case"beforeblur":case"afterblur":f=Pl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=$p;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=Z1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=pw;break;case Ty:case Cy:case wy:f=nw;break;case Py:f=gw;break;case"scroll":f=Y1;break;case"wheel":f=yw;break;case"copy":case"cut":case"paste":f=rw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=qp}var p=(e&4)!==0,S=!p&&t==="scroll",m=p?h!==null?h+"Capture":null:h;p=[];for(var v=l,y;v!==null;){y=v;var k=y.stateNode;if(y.tag===5&&k!==null&&(y=k,m!==null&&(k=to(v,m),k!=null&&p.push(co(v,k,y)))),S)break;v=v.return}0<p.length&&(h=new f(h,g,null,n,u),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==Uu&&(g=n.relatedTarget||n.fromElement)&&(_i(g)||g[On]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=n.relatedTarget||n.toElement,f=l,g=g?_i(g):null,g!==null&&(S=Yi(g),g!==S||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=l),f!==g)){if(p=$p,k="onMouseLeave",m="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(p=qp,k="onPointerLeave",m="onPointerEnter",v="pointer"),S=f==null?h:fr(f),y=g==null?h:fr(g),h=new p(k,v+"leave",f,n,u),h.target=S,h.relatedTarget=y,k=null,_i(u)===l&&(p=new p(m,v+"enter",g,n,u),p.target=y,p.relatedTarget=S,k=p),S=k,f&&g)t:{for(p=f,m=g,v=0,y=p;y;y=ir(y))v++;for(y=0,k=m;k;k=ir(k))y++;for(;0<v-y;)p=ir(p),v--;for(;0<y-v;)m=ir(m),y--;for(;v--;){if(p===m||m!==null&&p===m.alternate)break t;p=ir(p),m=ir(m)}p=null}else p=null;f!==null&&nm(d,h,f,p,!1),g!==null&&S!==null&&nm(d,S,g,p,!0)}}e:{if(h=l?fr(l):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var b=Pw;else if(Gp(h))if(vy)b=_w;else{b=xw;var w=Ew}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(b=Rw);if(b&&(b=b(t,l))){gy(d,b,n,u);break e}w&&w(t,h,l),t==="focusout"&&(w=h._wrapperState)&&w.controlled&&h.type==="number"&&Du(h,"number",h.value)}switch(w=l?fr(l):window,t){case"focusin":(Gp(w)||w.contentEditable==="true")&&(dr=w,Wu=l,Bs=null);break;case"focusout":Bs=Wu=dr=null;break;case"mousedown":qu=!0;break;case"contextmenu":case"mouseup":case"dragend":qu=!1,Zp(d,n,u);break;case"selectionchange":if(Dw)break;case"keydown":case"keyup":Zp(d,n,u)}var P;if(Bh)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else ur?py(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(fy&&n.locale!=="ko"&&(ur||E!=="onCompositionStart"?E==="onCompositionEnd"&&ur&&(P=hy()):(Xn=u,Fh="value"in Xn?Xn.value:Xn.textContent,ur=!0)),w=Ga(l,E),0<w.length&&(E=new Wp(E,t,null,n,u),d.push({event:E,listeners:w}),P?E.data=P:(P=my(n),P!==null&&(E.data=P)))),(P=bw?Sw(t,n):Tw(t,n))&&(l=Ga(l,"onBeforeInput"),0<l.length&&(u=new Wp("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=P))}xy(d,e)})}function co(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ga(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=to(t,n),s!=null&&i.unshift(co(t,s,r)),s=to(t,e),s!=null&&i.push(co(t,s,r))),t=t.return}return i}function ir(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function nm(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=to(n,s),c!=null&&o.unshift(co(n,c,a))):r||(c=to(n,s),c!=null&&o.push(co(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Lw=/\r\n?/g,Uw=/\u0000|\uFFFD/g;function im(t){return(typeof t=="string"?t:""+t).replace(Lw,`
`).replace(Uw,"")}function Jo(t,e,n){if(e=im(e),im(t)!==e&&n)throw Error(L(425))}function Qa(){}var Hu=null,Ku=null;function Gu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Qu=typeof setTimeout=="function"?setTimeout:void 0,Fw=typeof clearTimeout=="function"?clearTimeout:void 0,rm=typeof Promise=="function"?Promise:void 0,jw=typeof queueMicrotask=="function"?queueMicrotask:typeof rm<"u"?function(t){return rm.resolve(null).then(t).catch(Vw)}:Qu;function Vw(t){setTimeout(function(){throw t})}function Ol(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),ro(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);ro(e)}function ri(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function sm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ss=Math.random().toString(36).slice(2),tn="__reactFiber$"+ss,lo="__reactProps$"+ss,On="__reactContainer$"+ss,Ju="__reactEvents$"+ss,Bw="__reactListeners$"+ss,zw="__reactHandles$"+ss;function _i(t){var e=t[tn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[On]||n[tn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=sm(t);t!==null;){if(n=t[tn])return n;t=sm(t)}return e}t=n,n=t.parentNode}return null}function Io(t){return t=t[tn]||t[On],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function fr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(L(33))}function jc(t){return t[lo]||null}var Yu=[],pr=-1;function yi(t){return{current:t}}function le(t){0>pr||(t.current=Yu[pr],Yu[pr]=null,pr--)}function oe(t,e){pr++,Yu[pr]=t.current,t.current=e}var hi={},Qe=yi(hi),ot=yi(!1),ji=hi;function $r(t,e){var n=t.type.contextTypes;if(!n)return hi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function at(t){return t=t.childContextTypes,t!=null}function Ja(){le(ot),le(Qe)}function om(t,e,n){if(Qe.current!==hi)throw Error(L(168));oe(Qe,e),oe(ot,n)}function _y(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(L(108,E1(t)||"Unknown",r));return ve({},n,i)}function Ya(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hi,ji=Qe.current,oe(Qe,t),oe(ot,ot.current),!0}function am(t,e,n){var i=t.stateNode;if(!i)throw Error(L(169));n?(t=_y(t,e,ji),i.__reactInternalMemoizedMergedChildContext=t,le(ot),le(Qe),oe(Qe,t)):le(ot),oe(ot,n)}var Sn=null,Vc=!1,Ml=!1;function Iy(t){Sn===null?Sn=[t]:Sn.push(t)}function $w(t){Vc=!0,Iy(t)}function ki(){if(!Ml&&Sn!==null){Ml=!0;var t=0,e=te;try{var n=Sn;for(te=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Sn=null,Vc=!1}catch(r){throw Sn!==null&&(Sn=Sn.slice(t+1)),ty(Mh,ki),r}finally{te=e,Ml=!1}}return null}var mr=[],gr=0,Xa=null,Za=0,xt=[],Rt=0,Vi=null,xn=1,Rn="";function wi(t,e){mr[gr++]=Za,mr[gr++]=Xa,Xa=t,Za=e}function Ay(t,e,n){xt[Rt++]=xn,xt[Rt++]=Rn,xt[Rt++]=Vi,Vi=t;var i=xn;t=Rn;var r=32-qt(i)-1;i&=~(1<<r),n+=1;var s=32-qt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,xn=1<<32-qt(e)+r|n<<r|i,Rn=s+t}else xn=1<<s|n<<r|i,Rn=t}function $h(t){t.return!==null&&(wi(t,1),Ay(t,1,0))}function Wh(t){for(;t===Xa;)Xa=mr[--gr],mr[gr]=null,Za=mr[--gr],mr[gr]=null;for(;t===Vi;)Vi=xt[--Rt],xt[Rt]=null,Rn=xt[--Rt],xt[Rt]=null,xn=xt[--Rt],xt[Rt]=null}var mt=null,ft=null,he=!1,Bt=null;function Dy(t,e){var n=_t(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function cm(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,mt=t,ft=ri(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,mt=t,ft=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Vi!==null?{id:xn,overflow:Rn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_t(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,mt=t,ft=null,!0):!1;default:return!1}}function Xu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Zu(t){if(he){var e=ft;if(e){var n=e;if(!cm(t,e)){if(Xu(t))throw Error(L(418));e=ri(n.nextSibling);var i=mt;e&&cm(t,e)?Dy(i,n):(t.flags=t.flags&-4097|2,he=!1,mt=t)}}else{if(Xu(t))throw Error(L(418));t.flags=t.flags&-4097|2,he=!1,mt=t}}}function lm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;mt=t}function Yo(t){if(t!==mt)return!1;if(!he)return lm(t),he=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Gu(t.type,t.memoizedProps)),e&&(e=ft)){if(Xu(t))throw Oy(),Error(L(418));for(;e;)Dy(t,e),e=ri(e.nextSibling)}if(lm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ft=ri(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ft=null}}else ft=mt?ri(t.stateNode.nextSibling):null;return!0}function Oy(){for(var t=ft;t;)t=ri(t.nextSibling)}function Wr(){ft=mt=null,he=!1}function qh(t){Bt===null?Bt=[t]:Bt.push(t)}var Ww=jn.ReactCurrentBatchConfig;function vs(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(L(309));var i=n.stateNode}if(!i)throw Error(L(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(L(284));if(!n._owner)throw Error(L(290,t))}return t}function Xo(t,e){throw t=Object.prototype.toString.call(e),Error(L(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function um(t){var e=t._init;return e(t._payload)}function My(t){function e(m,v){if(t){var y=m.deletions;y===null?(m.deletions=[v],m.flags|=16):y.push(v)}}function n(m,v){if(!t)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function i(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function r(m,v){return m=ci(m,v),m.index=0,m.sibling=null,m}function s(m,v,y){return m.index=y,t?(y=m.alternate,y!==null?(y=y.index,y<v?(m.flags|=2,v):y):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,v,y,k){return v===null||v.tag!==6?(v=Bl(y,m.mode,k),v.return=m,v):(v=r(v,y),v.return=m,v)}function c(m,v,y,k){var b=y.type;return b===lr?u(m,v,y.props.children,k,y.key):v!==null&&(v.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Kn&&um(b)===v.type)?(k=r(v,y.props),k.ref=vs(m,v,y),k.return=m,k):(k=Ta(y.type,y.key,y.props,null,m.mode,k),k.ref=vs(m,v,y),k.return=m,k)}function l(m,v,y,k){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=zl(y,m.mode,k),v.return=m,v):(v=r(v,y.children||[]),v.return=m,v)}function u(m,v,y,k,b){return v===null||v.tag!==7?(v=Mi(y,m.mode,k,b),v.return=m,v):(v=r(v,y),v.return=m,v)}function d(m,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Bl(""+v,m.mode,y),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Bo:return y=Ta(v.type,v.key,v.props,null,m.mode,y),y.ref=vs(m,null,v),y.return=m,y;case cr:return v=zl(v,m.mode,y),v.return=m,v;case Kn:var k=v._init;return d(m,k(v._payload),y)}if(_s(v)||hs(v))return v=Mi(v,m.mode,y,null),v.return=m,v;Xo(m,v)}return null}function h(m,v,y,k){var b=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return b!==null?null:a(m,v,""+y,k);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Bo:return y.key===b?c(m,v,y,k):null;case cr:return y.key===b?l(m,v,y,k):null;case Kn:return b=y._init,h(m,v,b(y._payload),k)}if(_s(y)||hs(y))return b!==null?null:u(m,v,y,k,null);Xo(m,y)}return null}function f(m,v,y,k,b){if(typeof k=="string"&&k!==""||typeof k=="number")return m=m.get(y)||null,a(v,m,""+k,b);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Bo:return m=m.get(k.key===null?y:k.key)||null,c(v,m,k,b);case cr:return m=m.get(k.key===null?y:k.key)||null,l(v,m,k,b);case Kn:var w=k._init;return f(m,v,y,w(k._payload),b)}if(_s(k)||hs(k))return m=m.get(y)||null,u(v,m,k,b,null);Xo(v,k)}return null}function g(m,v,y,k){for(var b=null,w=null,P=v,E=v=0,D=null;P!==null&&E<y.length;E++){P.index>E?(D=P,P=null):D=P.sibling;var I=h(m,P,y[E],k);if(I===null){P===null&&(P=D);break}t&&P&&I.alternate===null&&e(m,P),v=s(I,v,E),w===null?b=I:w.sibling=I,w=I,P=D}if(E===y.length)return n(m,P),he&&wi(m,E),b;if(P===null){for(;E<y.length;E++)P=d(m,y[E],k),P!==null&&(v=s(P,v,E),w===null?b=P:w.sibling=P,w=P);return he&&wi(m,E),b}for(P=i(m,P);E<y.length;E++)D=f(P,m,E,y[E],k),D!==null&&(t&&D.alternate!==null&&P.delete(D.key===null?E:D.key),v=s(D,v,E),w===null?b=D:w.sibling=D,w=D);return t&&P.forEach(function(M){return e(m,M)}),he&&wi(m,E),b}function p(m,v,y,k){var b=hs(y);if(typeof b!="function")throw Error(L(150));if(y=b.call(y),y==null)throw Error(L(151));for(var w=b=null,P=v,E=v=0,D=null,I=y.next();P!==null&&!I.done;E++,I=y.next()){P.index>E?(D=P,P=null):D=P.sibling;var M=h(m,P,I.value,k);if(M===null){P===null&&(P=D);break}t&&P&&M.alternate===null&&e(m,P),v=s(M,v,E),w===null?b=M:w.sibling=M,w=M,P=D}if(I.done)return n(m,P),he&&wi(m,E),b;if(P===null){for(;!I.done;E++,I=y.next())I=d(m,I.value,k),I!==null&&(v=s(I,v,E),w===null?b=I:w.sibling=I,w=I);return he&&wi(m,E),b}for(P=i(m,P);!I.done;E++,I=y.next())I=f(P,m,E,I.value,k),I!==null&&(t&&I.alternate!==null&&P.delete(I.key===null?E:I.key),v=s(I,v,E),w===null?b=I:w.sibling=I,w=I);return t&&P.forEach(function(V){return e(m,V)}),he&&wi(m,E),b}function S(m,v,y,k){if(typeof y=="object"&&y!==null&&y.type===lr&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Bo:e:{for(var b=y.key,w=v;w!==null;){if(w.key===b){if(b=y.type,b===lr){if(w.tag===7){n(m,w.sibling),v=r(w,y.props.children),v.return=m,m=v;break e}}else if(w.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Kn&&um(b)===w.type){n(m,w.sibling),v=r(w,y.props),v.ref=vs(m,w,y),v.return=m,m=v;break e}n(m,w);break}else e(m,w);w=w.sibling}y.type===lr?(v=Mi(y.props.children,m.mode,k,y.key),v.return=m,m=v):(k=Ta(y.type,y.key,y.props,null,m.mode,k),k.ref=vs(m,v,y),k.return=m,m=k)}return o(m);case cr:e:{for(w=y.key;v!==null;){if(v.key===w)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){n(m,v.sibling),v=r(v,y.children||[]),v.return=m,m=v;break e}else{n(m,v);break}else e(m,v);v=v.sibling}v=zl(y,m.mode,k),v.return=m,m=v}return o(m);case Kn:return w=y._init,S(m,v,w(y._payload),k)}if(_s(y))return g(m,v,y,k);if(hs(y))return p(m,v,y,k);Xo(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(n(m,v.sibling),v=r(v,y),v.return=m,m=v):(n(m,v),v=Bl(y,m.mode,k),v.return=m,m=v),o(m)):n(m,v)}return S}var qr=My(!0),Ny=My(!1),ec=yi(null),tc=null,vr=null,Hh=null;function Kh(){Hh=vr=tc=null}function Gh(t){var e=ec.current;le(ec),t._currentValue=e}function ed(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Dr(t,e){tc=t,Hh=vr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function At(t){var e=t._currentValue;if(Hh!==t)if(t={context:t,memoizedValue:e,next:null},vr===null){if(tc===null)throw Error(L(308));vr=t,tc.dependencies={lanes:0,firstContext:t}}else vr=vr.next=t;return e}var Ii=null;function Qh(t){Ii===null?Ii=[t]:Ii.push(t)}function Ly(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Qh(e)):(n.next=r.next,r.next=n),e.interleaved=n,Mn(t,i)}function Mn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Gn=!1;function Jh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uy(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _n(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function si(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Z&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Mn(t,n)}return r=i.interleaved,r===null?(e.next=e,Qh(i)):(e.next=r.next,r.next=e),i.interleaved=e,Mn(t,n)}function ga(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Nh(t,n)}}function dm(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function nc(t,e,n,i){var r=t.updateQueue;Gn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,f=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,p=a;switch(h=e,f=n,p.tag){case 1:if(g=p.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=p.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=ve({},d,h);break e;case 2:Gn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=f,c=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);zi|=o,t.lanes=o,t.memoizedState=d}}function hm(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(L(191,r));r.call(i)}}}var Ao={},sn=yi(Ao),uo=yi(Ao),ho=yi(Ao);function Ai(t){if(t===Ao)throw Error(L(174));return t}function Yh(t,e){switch(oe(ho,e),oe(uo,t),oe(sn,Ao),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Mu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Mu(e,t)}le(sn),oe(sn,e)}function Hr(){le(sn),le(uo),le(ho)}function Fy(t){Ai(ho.current);var e=Ai(sn.current),n=Mu(e,t.type);e!==n&&(oe(uo,t),oe(sn,n))}function Xh(t){uo.current===t&&(le(sn),le(uo))}var pe=yi(0);function ic(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Nl=[];function Zh(){for(var t=0;t<Nl.length;t++)Nl[t]._workInProgressVersionPrimary=null;Nl.length=0}var va=jn.ReactCurrentDispatcher,Ll=jn.ReactCurrentBatchConfig,Bi=0,ge=null,De=null,Ne=null,rc=!1,zs=!1,fo=0,qw=0;function We(){throw Error(L(321))}function ef(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Kt(t[n],e[n]))return!1;return!0}function tf(t,e,n,i,r,s){if(Bi=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,va.current=t===null||t.memoizedState===null?Qw:Jw,t=n(i,r),zs){s=0;do{if(zs=!1,fo=0,25<=s)throw Error(L(301));s+=1,Ne=De=null,e.updateQueue=null,va.current=Yw,t=n(i,r)}while(zs)}if(va.current=sc,e=De!==null&&De.next!==null,Bi=0,Ne=De=ge=null,rc=!1,e)throw Error(L(300));return t}function nf(){var t=fo!==0;return fo=0,t}function Zt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ne===null?ge.memoizedState=Ne=t:Ne=Ne.next=t,Ne}function Dt(){if(De===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=De.next;var e=Ne===null?ge.memoizedState:Ne.next;if(e!==null)Ne=e,De=t;else{if(t===null)throw Error(L(310));De=t,t={memoizedState:De.memoizedState,baseState:De.baseState,baseQueue:De.baseQueue,queue:De.queue,next:null},Ne===null?ge.memoizedState=Ne=t:Ne=Ne.next=t}return Ne}function po(t,e){return typeof e=="function"?e(t):e}function Ul(t){var e=Dt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var i=De,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Bi&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,ge.lanes|=u,zi|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Kt(i,e.memoizedState)||(rt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ge.lanes|=s,zi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Fl(t){var e=Dt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Kt(s,e.memoizedState)||(rt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function jy(){}function Vy(t,e){var n=ge,i=Dt(),r=e(),s=!Kt(i.memoizedState,r);if(s&&(i.memoizedState=r,rt=!0),i=i.queue,rf($y.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Ne!==null&&Ne.memoizedState.tag&1){if(n.flags|=2048,mo(9,zy.bind(null,n,i,r,e),void 0,null),Fe===null)throw Error(L(349));Bi&30||By(n,e,r)}return r}function By(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zy(t,e,n,i){e.value=n,e.getSnapshot=i,Wy(e)&&qy(t)}function $y(t,e,n){return n(function(){Wy(e)&&qy(t)})}function Wy(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Kt(t,n)}catch{return!0}}function qy(t){var e=Mn(t,1);e!==null&&Ht(e,t,1,-1)}function fm(t){var e=Zt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:t},e.queue=t,t=t.dispatch=Gw.bind(null,ge,t),[e.memoizedState,t]}function mo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Hy(){return Dt().memoizedState}function ya(t,e,n,i){var r=Zt();ge.flags|=t,r.memoizedState=mo(1|e,n,void 0,i===void 0?null:i)}function Bc(t,e,n,i){var r=Dt();i=i===void 0?null:i;var s=void 0;if(De!==null){var o=De.memoizedState;if(s=o.destroy,i!==null&&ef(i,o.deps)){r.memoizedState=mo(e,n,s,i);return}}ge.flags|=t,r.memoizedState=mo(1|e,n,s,i)}function pm(t,e){return ya(8390656,8,t,e)}function rf(t,e){return Bc(2048,8,t,e)}function Ky(t,e){return Bc(4,2,t,e)}function Gy(t,e){return Bc(4,4,t,e)}function Qy(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Jy(t,e,n){return n=n!=null?n.concat([t]):null,Bc(4,4,Qy.bind(null,e,t),n)}function sf(){}function Yy(t,e){var n=Dt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&ef(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Xy(t,e){var n=Dt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&ef(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Zy(t,e,n){return Bi&21?(Kt(n,e)||(n=ry(),ge.lanes|=n,zi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=n)}function Hw(t,e){var n=te;te=n!==0&&4>n?n:4,t(!0);var i=Ll.transition;Ll.transition={};try{t(!1),e()}finally{te=n,Ll.transition=i}}function ek(){return Dt().memoizedState}function Kw(t,e,n){var i=ai(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},tk(t))nk(e,n);else if(n=Ly(t,e,n,i),n!==null){var r=Xe();Ht(n,t,i,r),ik(n,e,i)}}function Gw(t,e,n){var i=ai(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(tk(t))nk(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Kt(a,o)){var c=e.interleaved;c===null?(r.next=r,Qh(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=Ly(t,e,r,i),n!==null&&(r=Xe(),Ht(n,t,i,r),ik(n,e,i))}}function tk(t){var e=t.alternate;return t===ge||e!==null&&e===ge}function nk(t,e){zs=rc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ik(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Nh(t,n)}}var sc={readContext:At,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useInsertionEffect:We,useLayoutEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useMutableSource:We,useSyncExternalStore:We,useId:We,unstable_isNewReconciler:!1},Qw={readContext:At,useCallback:function(t,e){return Zt().memoizedState=[t,e===void 0?null:e],t},useContext:At,useEffect:pm,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ya(4194308,4,Qy.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ya(4194308,4,t,e)},useInsertionEffect:function(t,e){return ya(4,2,t,e)},useMemo:function(t,e){var n=Zt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Zt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Kw.bind(null,ge,t),[i.memoizedState,t]},useRef:function(t){var e=Zt();return t={current:t},e.memoizedState=t},useState:fm,useDebugValue:sf,useDeferredValue:function(t){return Zt().memoizedState=t},useTransition:function(){var t=fm(!1),e=t[0];return t=Hw.bind(null,t[1]),Zt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ge,r=Zt();if(he){if(n===void 0)throw Error(L(407));n=n()}else{if(n=e(),Fe===null)throw Error(L(349));Bi&30||By(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,pm($y.bind(null,i,s,t),[t]),i.flags|=2048,mo(9,zy.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Zt(),e=Fe.identifierPrefix;if(he){var n=Rn,i=xn;n=(i&~(1<<32-qt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=fo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=qw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Jw={readContext:At,useCallback:Yy,useContext:At,useEffect:rf,useImperativeHandle:Jy,useInsertionEffect:Ky,useLayoutEffect:Gy,useMemo:Xy,useReducer:Ul,useRef:Hy,useState:function(){return Ul(po)},useDebugValue:sf,useDeferredValue:function(t){var e=Dt();return Zy(e,De.memoizedState,t)},useTransition:function(){var t=Ul(po)[0],e=Dt().memoizedState;return[t,e]},useMutableSource:jy,useSyncExternalStore:Vy,useId:ek,unstable_isNewReconciler:!1},Yw={readContext:At,useCallback:Yy,useContext:At,useEffect:rf,useImperativeHandle:Jy,useInsertionEffect:Ky,useLayoutEffect:Gy,useMemo:Xy,useReducer:Fl,useRef:Hy,useState:function(){return Fl(po)},useDebugValue:sf,useDeferredValue:function(t){var e=Dt();return De===null?e.memoizedState=t:Zy(e,De.memoizedState,t)},useTransition:function(){var t=Fl(po)[0],e=Dt().memoizedState;return[t,e]},useMutableSource:jy,useSyncExternalStore:Vy,useId:ek,unstable_isNewReconciler:!1};function Ft(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function td(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var zc={isMounted:function(t){return(t=t._reactInternals)?Yi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Xe(),r=ai(t),s=_n(i,r);s.payload=e,n!=null&&(s.callback=n),e=si(t,s,r),e!==null&&(Ht(e,t,r,i),ga(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Xe(),r=ai(t),s=_n(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=si(t,s,r),e!==null&&(Ht(e,t,r,i),ga(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Xe(),i=ai(t),r=_n(n,i);r.tag=2,e!=null&&(r.callback=e),e=si(t,r,i),e!==null&&(Ht(e,t,i,n),ga(e,t,i))}};function mm(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!oo(n,i)||!oo(r,s):!0}function rk(t,e,n){var i=!1,r=hi,s=e.contextType;return typeof s=="object"&&s!==null?s=At(s):(r=at(e)?ji:Qe.current,i=e.contextTypes,s=(i=i!=null)?$r(t,r):hi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=zc,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function gm(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&zc.enqueueReplaceState(e,e.state,null)}function nd(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Jh(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=At(s):(s=at(e)?ji:Qe.current,r.context=$r(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(td(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&zc.enqueueReplaceState(r,r.state,null),nc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Kr(t,e){try{var n="",i=e;do n+=P1(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function jl(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function id(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Xw=typeof WeakMap=="function"?WeakMap:Map;function sk(t,e,n){n=_n(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){ac||(ac=!0,fd=i),id(t,e)},n}function ok(t,e,n){n=_n(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){id(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){id(t,e),typeof i!="function"&&(oi===null?oi=new Set([this]):oi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function vm(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Xw;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=hP.bind(null,t,e,n),e.then(t,t))}function ym(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function km(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_n(-1,1),e.tag=2,si(n,e,1))),n.lanes|=1),t)}var Zw=jn.ReactCurrentOwner,rt=!1;function Je(t,e,n,i){e.child=t===null?Ny(e,null,n,i):qr(e,t.child,n,i)}function bm(t,e,n,i,r){n=n.render;var s=e.ref;return Dr(e,r),i=tf(t,e,n,i,s,r),n=nf(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Nn(t,e,r)):(he&&n&&$h(e),e.flags|=1,Je(t,e,i,r),e.child)}function Sm(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!ff(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ak(t,e,s,i,r)):(t=Ta(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:oo,n(o,i)&&t.ref===e.ref)return Nn(t,e,r)}return e.flags|=1,t=ci(s,i),t.ref=e.ref,t.return=e,e.child=t}function ak(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(oo(s,i)&&t.ref===e.ref)if(rt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,Nn(t,e,r)}return rd(t,e,n,i,r)}function ck(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},oe(kr,dt),dt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,oe(kr,dt),dt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,oe(kr,dt),dt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,oe(kr,dt),dt|=i;return Je(t,e,r,n),e.child}function lk(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function rd(t,e,n,i,r){var s=at(n)?ji:Qe.current;return s=$r(e,s),Dr(e,r),n=tf(t,e,n,i,s,r),i=nf(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Nn(t,e,r)):(he&&i&&$h(e),e.flags|=1,Je(t,e,n,r),e.child)}function Tm(t,e,n,i,r){if(at(n)){var s=!0;Ya(e)}else s=!1;if(Dr(e,r),e.stateNode===null)ka(t,e),rk(e,n,i),nd(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=At(l):(l=at(n)?ji:Qe.current,l=$r(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&gm(e,o,i,l),Gn=!1;var h=e.memoizedState;o.state=h,nc(e,i,o,r),c=e.memoizedState,a!==i||h!==c||ot.current||Gn?(typeof u=="function"&&(td(e,n,u,i),c=e.memoizedState),(a=Gn||mm(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Uy(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Ft(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=At(c):(c=at(n)?ji:Qe.current,c=$r(e,c));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&gm(e,o,i,c),Gn=!1,h=e.memoizedState,o.state=h,nc(e,i,o,r);var g=e.memoizedState;a!==d||h!==g||ot.current||Gn?(typeof f=="function"&&(td(e,n,f,i),g=e.memoizedState),(l=Gn||mm(e,n,l,i,h,g,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return sd(t,e,n,i,s,r)}function sd(t,e,n,i,r,s){lk(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&am(e,n,!1),Nn(t,e,s);i=e.stateNode,Zw.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=qr(e,t.child,null,s),e.child=qr(e,null,a,s)):Je(t,e,a,s),e.memoizedState=i.state,r&&am(e,n,!0),e.child}function uk(t){var e=t.stateNode;e.pendingContext?om(t,e.pendingContext,e.pendingContext!==e.context):e.context&&om(t,e.context,!1),Yh(t,e.containerInfo)}function Cm(t,e,n,i,r){return Wr(),qh(r),e.flags|=256,Je(t,e,n,i),e.child}var od={dehydrated:null,treeContext:null,retryLane:0};function ad(t){return{baseLanes:t,cachePool:null,transitions:null}}function dk(t,e,n){var i=e.pendingProps,r=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),oe(pe,r&1),t===null)return Zu(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=qc(o,i,0,null),t=Mi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=ad(n),e.memoizedState=od,t):of(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return eP(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=ci(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=ci(a,s):(s=Mi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?ad(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=od,i}return s=t.child,t=s.sibling,i=ci(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function of(t,e){return e=qc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Zo(t,e,n,i){return i!==null&&qh(i),qr(e,t.child,null,n),t=of(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function eP(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=jl(Error(L(422))),Zo(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=qc({mode:"visible",children:i.children},r,0,null),s=Mi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&qr(e,t.child,null,o),e.child.memoizedState=ad(o),e.memoizedState=od,s);if(!(e.mode&1))return Zo(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(L(419)),i=jl(s,i,void 0),Zo(t,e,o,i)}if(a=(o&t.childLanes)!==0,rt||a){if(i=Fe,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Mn(t,r),Ht(i,t,r,-1))}return hf(),i=jl(Error(L(421))),Zo(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=fP.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ft=ri(r.nextSibling),mt=e,he=!0,Bt=null,t!==null&&(xt[Rt++]=xn,xt[Rt++]=Rn,xt[Rt++]=Vi,xn=t.id,Rn=t.overflow,Vi=e),e=of(e,i.children),e.flags|=4096,e)}function wm(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),ed(t.return,e,n)}function Vl(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function hk(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Je(t,e,i.children,n),i=pe.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&wm(t,n,e);else if(t.tag===19)wm(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(oe(pe,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&ic(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Vl(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&ic(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Vl(e,!0,n,null,s);break;case"together":Vl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ka(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Nn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=ci(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ci(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function tP(t,e,n){switch(e.tag){case 3:uk(e),Wr();break;case 5:Fy(e);break;case 1:at(e.type)&&Ya(e);break;case 4:Yh(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;oe(ec,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(oe(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?dk(t,e,n):(oe(pe,pe.current&1),t=Nn(t,e,n),t!==null?t.sibling:null);oe(pe,pe.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return hk(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),oe(pe,pe.current),i)break;return null;case 22:case 23:return e.lanes=0,ck(t,e,n)}return Nn(t,e,n)}var fk,cd,pk,mk;fk=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};cd=function(){};pk=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Ai(sn.current);var s=null;switch(n){case"input":r=Iu(t,r),i=Iu(t,i),s=[];break;case"select":r=ve({},r,{value:void 0}),i=ve({},i,{value:void 0}),s=[];break;case"textarea":r=Ou(t,r),i=Ou(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Qa)}Nu(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Zs.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Zs.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ae("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};mk=function(t,e,n,i){n!==i&&(e.flags|=4)};function ys(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function nP(t,e,n){var i=e.pendingProps;switch(Wh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(e),null;case 1:return at(e.type)&&Ja(),qe(e),null;case 3:return i=e.stateNode,Hr(),le(ot),le(Qe),Zh(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Yo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bt!==null&&(gd(Bt),Bt=null))),cd(t,e),qe(e),null;case 5:Xh(e);var r=Ai(ho.current);if(n=e.type,t!==null&&e.stateNode!=null)pk(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(L(166));return qe(e),null}if(t=Ai(sn.current),Yo(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[tn]=e,i[lo]=s,t=(e.mode&1)!==0,n){case"dialog":ae("cancel",i),ae("close",i);break;case"iframe":case"object":case"embed":ae("load",i);break;case"video":case"audio":for(r=0;r<As.length;r++)ae(As[r],i);break;case"source":ae("error",i);break;case"img":case"image":case"link":ae("error",i),ae("load",i);break;case"details":ae("toggle",i);break;case"input":Op(i,s),ae("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ae("invalid",i);break;case"textarea":Np(i,s),ae("invalid",i)}Nu(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Jo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Jo(i.textContent,a,t),r=["children",""+a]):Zs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ae("scroll",i)}switch(n){case"input":zo(i),Mp(i,s,!0);break;case"textarea":zo(i),Lp(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Qa)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[tn]=e,t[lo]=i,fk(t,e,!1,!1),e.stateNode=t;e:{switch(o=Lu(n,i),n){case"dialog":ae("cancel",t),ae("close",t),r=i;break;case"iframe":case"object":case"embed":ae("load",t),r=i;break;case"video":case"audio":for(r=0;r<As.length;r++)ae(As[r],t);r=i;break;case"source":ae("error",t),r=i;break;case"img":case"image":case"link":ae("error",t),ae("load",t),r=i;break;case"details":ae("toggle",t),r=i;break;case"input":Op(t,i),r=Iu(t,i),ae("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ve({},i,{value:void 0}),ae("invalid",t);break;case"textarea":Np(t,i),r=Ou(t,i),ae("invalid",t);break;default:r=i}Nu(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?H0(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&W0(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&eo(t,c):typeof c=="number"&&eo(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Zs.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ae("scroll",t):c!=null&&_h(t,s,c,o))}switch(n){case"input":zo(t),Mp(t,i,!1);break;case"textarea":zo(t),Lp(t);break;case"option":i.value!=null&&t.setAttribute("value",""+di(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Rr(t,!!i.multiple,s,!1):i.defaultValue!=null&&Rr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Qa)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qe(e),null;case 6:if(t&&e.stateNode!=null)mk(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(L(166));if(n=Ai(ho.current),Ai(sn.current),Yo(e)){if(i=e.stateNode,n=e.memoizedProps,i[tn]=e,(s=i.nodeValue!==n)&&(t=mt,t!==null))switch(t.tag){case 3:Jo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Jo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[tn]=e,e.stateNode=i}return qe(e),null;case 13:if(le(pe),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(he&&ft!==null&&e.mode&1&&!(e.flags&128))Oy(),Wr(),e.flags|=98560,s=!1;else if(s=Yo(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(L(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(L(317));s[tn]=e}else Wr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),s=!1}else Bt!==null&&(gd(Bt),Bt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Oe===0&&(Oe=3):hf())),e.updateQueue!==null&&(e.flags|=4),qe(e),null);case 4:return Hr(),cd(t,e),t===null&&ao(e.stateNode.containerInfo),qe(e),null;case 10:return Gh(e.type._context),qe(e),null;case 17:return at(e.type)&&Ja(),qe(e),null;case 19:if(le(pe),s=e.memoizedState,s===null)return qe(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)ys(s,!1);else{if(Oe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ic(t),o!==null){for(e.flags|=128,ys(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return oe(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&we()>Gr&&(e.flags|=128,i=!0,ys(s,!1),e.lanes=4194304)}else{if(!i)if(t=ic(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ys(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return qe(e),null}else 2*we()-s.renderingStartTime>Gr&&n!==1073741824&&(e.flags|=128,i=!0,ys(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=we(),e.sibling=null,n=pe.current,oe(pe,i?n&1|2:n&1),e):(qe(e),null);case 22:case 23:return df(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?dt&1073741824&&(qe(e),e.subtreeFlags&6&&(e.flags|=8192)):qe(e),null;case 24:return null;case 25:return null}throw Error(L(156,e.tag))}function iP(t,e){switch(Wh(e),e.tag){case 1:return at(e.type)&&Ja(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Hr(),le(ot),le(Qe),Zh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Xh(e),null;case 13:if(le(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(L(340));Wr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return le(pe),null;case 4:return Hr(),null;case 10:return Gh(e.type._context),null;case 22:case 23:return df(),null;case 24:return null;default:return null}}var ea=!1,Ke=!1,rP=typeof WeakSet=="function"?WeakSet:Set,B=null;function yr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){be(t,e,i)}else n.current=null}function ld(t,e,n){try{n()}catch(i){be(t,e,i)}}var Pm=!1;function sP(t,e){if(Hu=Ha,t=by(),zh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ku={focusedElem:t,selectionRange:n},Ha=!1,B=e;B!==null;)if(e=B,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,B=t;else for(;B!==null;){e=B;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var p=g.memoizedProps,S=g.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?p:Ft(e.type,p),S);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(L(163))}}catch(k){be(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,B=t;break}B=e.return}return g=Pm,Pm=!1,g}function $s(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&ld(e,n,s)}r=r.next}while(r!==i)}}function $c(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function ud(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gk(t){var e=t.alternate;e!==null&&(t.alternate=null,gk(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[tn],delete e[lo],delete e[Ju],delete e[Bw],delete e[zw])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function vk(t){return t.tag===5||t.tag===3||t.tag===4}function Em(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vk(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function dd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Qa));else if(i!==4&&(t=t.child,t!==null))for(dd(t,e,n),t=t.sibling;t!==null;)dd(t,e,n),t=t.sibling}function hd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(hd(t,e,n),t=t.sibling;t!==null;)hd(t,e,n),t=t.sibling}var je=null,jt=!1;function zn(t,e,n){for(n=n.child;n!==null;)yk(t,e,n),n=n.sibling}function yk(t,e,n){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(Nc,n)}catch{}switch(n.tag){case 5:Ke||yr(n,e);case 6:var i=je,r=jt;je=null,zn(t,e,n),je=i,jt=r,je!==null&&(jt?(t=je,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):je.removeChild(n.stateNode));break;case 18:je!==null&&(jt?(t=je,n=n.stateNode,t.nodeType===8?Ol(t.parentNode,n):t.nodeType===1&&Ol(t,n),ro(t)):Ol(je,n.stateNode));break;case 4:i=je,r=jt,je=n.stateNode.containerInfo,jt=!0,zn(t,e,n),je=i,jt=r;break;case 0:case 11:case 14:case 15:if(!Ke&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&ld(n,e,o),r=r.next}while(r!==i)}zn(t,e,n);break;case 1:if(!Ke&&(yr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){be(n,e,a)}zn(t,e,n);break;case 21:zn(t,e,n);break;case 22:n.mode&1?(Ke=(i=Ke)||n.memoizedState!==null,zn(t,e,n),Ke=i):zn(t,e,n);break;default:zn(t,e,n)}}function xm(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new rP),e.forEach(function(i){var r=pP.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Mt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:je=a.stateNode,jt=!1;break e;case 3:je=a.stateNode.containerInfo,jt=!0;break e;case 4:je=a.stateNode.containerInfo,jt=!0;break e}a=a.return}if(je===null)throw Error(L(160));yk(s,o,r),je=null,jt=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){be(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)kk(e,t),e=e.sibling}function kk(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Mt(e,t),Yt(t),i&4){try{$s(3,t,t.return),$c(3,t)}catch(p){be(t,t.return,p)}try{$s(5,t,t.return)}catch(p){be(t,t.return,p)}}break;case 1:Mt(e,t),Yt(t),i&512&&n!==null&&yr(n,n.return);break;case 5:if(Mt(e,t),Yt(t),i&512&&n!==null&&yr(n,n.return),t.flags&32){var r=t.stateNode;try{eo(r,"")}catch(p){be(t,t.return,p)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&B0(r,s),Lu(a,o);var l=Lu(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?H0(r,d):u==="dangerouslySetInnerHTML"?W0(r,d):u==="children"?eo(r,d):_h(r,u,d,l)}switch(a){case"input":Au(r,s);break;case"textarea":z0(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Rr(r,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Rr(r,!!s.multiple,s.defaultValue,!0):Rr(r,!!s.multiple,s.multiple?[]:"",!1))}r[lo]=s}catch(p){be(t,t.return,p)}}break;case 6:if(Mt(e,t),Yt(t),i&4){if(t.stateNode===null)throw Error(L(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(p){be(t,t.return,p)}}break;case 3:if(Mt(e,t),Yt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{ro(e.containerInfo)}catch(p){be(t,t.return,p)}break;case 4:Mt(e,t),Yt(t);break;case 13:Mt(e,t),Yt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(lf=we())),i&4&&xm(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ke=(l=Ke)||u,Mt(e,t),Ke=l):Mt(e,t),Yt(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(B=t,u=t.child;u!==null;){for(d=B=u;B!==null;){switch(h=B,f=h.child,h.tag){case 0:case 11:case 14:case 15:$s(4,h,h.return);break;case 1:yr(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(p){be(i,n,p)}}break;case 5:yr(h,h.return);break;case 22:if(h.memoizedState!==null){_m(d);continue}}f!==null?(f.return=h,B=f):_m(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=q0("display",o))}catch(p){be(t,t.return,p)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(p){be(t,t.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Mt(e,t),Yt(t),i&4&&xm(t);break;case 21:break;default:Mt(e,t),Yt(t)}}function Yt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(vk(n)){var i=n;break e}n=n.return}throw Error(L(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(eo(r,""),i.flags&=-33);var s=Em(t);hd(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Em(t);dd(t,a,o);break;default:throw Error(L(161))}}catch(c){be(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function oP(t,e,n){B=t,bk(t)}function bk(t,e,n){for(var i=(t.mode&1)!==0;B!==null;){var r=B,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||ea;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Ke;a=ea;var l=Ke;if(ea=o,(Ke=c)&&!l)for(B=r;B!==null;)o=B,c=o.child,o.tag===22&&o.memoizedState!==null?Im(r):c!==null?(c.return=o,B=c):Im(r);for(;s!==null;)B=s,bk(s),s=s.sibling;B=r,ea=a,Ke=l}Rm(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,B=s):Rm(t)}}function Rm(t){for(;B!==null;){var e=B;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||$c(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ke)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ft(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&hm(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}hm(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&ro(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(L(163))}Ke||e.flags&512&&ud(e)}catch(h){be(e,e.return,h)}}if(e===t){B=null;break}if(n=e.sibling,n!==null){n.return=e.return,B=n;break}B=e.return}}function _m(t){for(;B!==null;){var e=B;if(e===t){B=null;break}var n=e.sibling;if(n!==null){n.return=e.return,B=n;break}B=e.return}}function Im(t){for(;B!==null;){var e=B;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{$c(4,e)}catch(c){be(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){be(e,r,c)}}var s=e.return;try{ud(e)}catch(c){be(e,s,c)}break;case 5:var o=e.return;try{ud(e)}catch(c){be(e,o,c)}}}catch(c){be(e,e.return,c)}if(e===t){B=null;break}var a=e.sibling;if(a!==null){a.return=e.return,B=a;break}B=e.return}}var aP=Math.ceil,oc=jn.ReactCurrentDispatcher,af=jn.ReactCurrentOwner,It=jn.ReactCurrentBatchConfig,Z=0,Fe=null,Re=null,ze=0,dt=0,kr=yi(0),Oe=0,go=null,zi=0,Wc=0,cf=0,Ws=null,nt=null,lf=0,Gr=1/0,bn=null,ac=!1,fd=null,oi=null,ta=!1,Zn=null,cc=0,qs=0,pd=null,ba=-1,Sa=0;function Xe(){return Z&6?we():ba!==-1?ba:ba=we()}function ai(t){return t.mode&1?Z&2&&ze!==0?ze&-ze:Ww.transition!==null?(Sa===0&&(Sa=ry()),Sa):(t=te,t!==0||(t=window.event,t=t===void 0?16:dy(t.type)),t):1}function Ht(t,e,n,i){if(50<qs)throw qs=0,pd=null,Error(L(185));Ro(t,n,i),(!(Z&2)||t!==Fe)&&(t===Fe&&(!(Z&2)&&(Wc|=n),Oe===4&&Jn(t,ze)),ct(t,i),n===1&&Z===0&&!(e.mode&1)&&(Gr=we()+500,Vc&&ki()))}function ct(t,e){var n=t.callbackNode;W1(t,e);var i=qa(t,t===Fe?ze:0);if(i===0)n!==null&&jp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&jp(n),e===1)t.tag===0?$w(Am.bind(null,t)):Iy(Am.bind(null,t)),jw(function(){!(Z&6)&&ki()}),n=null;else{switch(sy(i)){case 1:n=Mh;break;case 4:n=ny;break;case 16:n=Wa;break;case 536870912:n=iy;break;default:n=Wa}n=Rk(n,Sk.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Sk(t,e){if(ba=-1,Sa=0,Z&6)throw Error(L(327));var n=t.callbackNode;if(Or()&&t.callbackNode!==n)return null;var i=qa(t,t===Fe?ze:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=lc(t,i);else{e=i;var r=Z;Z|=2;var s=Ck();(Fe!==t||ze!==e)&&(bn=null,Gr=we()+500,Oi(t,e));do try{uP();break}catch(a){Tk(t,a)}while(1);Kh(),oc.current=s,Z=r,Re!==null?e=0:(Fe=null,ze=0,e=Oe)}if(e!==0){if(e===2&&(r=Bu(t),r!==0&&(i=r,e=md(t,r))),e===1)throw n=go,Oi(t,0),Jn(t,i),ct(t,we()),n;if(e===6)Jn(t,i);else{if(r=t.current.alternate,!(i&30)&&!cP(r)&&(e=lc(t,i),e===2&&(s=Bu(t),s!==0&&(i=s,e=md(t,s))),e===1))throw n=go,Oi(t,0),Jn(t,i),ct(t,we()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(L(345));case 2:Pi(t,nt,bn);break;case 3:if(Jn(t,i),(i&130023424)===i&&(e=lf+500-we(),10<e)){if(qa(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Xe(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Qu(Pi.bind(null,t,nt,bn),e);break}Pi(t,nt,bn);break;case 4:if(Jn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-qt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=we()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*aP(i/1960))-i,10<i){t.timeoutHandle=Qu(Pi.bind(null,t,nt,bn),i);break}Pi(t,nt,bn);break;case 5:Pi(t,nt,bn);break;default:throw Error(L(329))}}}return ct(t,we()),t.callbackNode===n?Sk.bind(null,t):null}function md(t,e){var n=Ws;return t.current.memoizedState.isDehydrated&&(Oi(t,e).flags|=256),t=lc(t,e),t!==2&&(e=nt,nt=n,e!==null&&gd(e)),t}function gd(t){nt===null?nt=t:nt.push.apply(nt,t)}function cP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Kt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Jn(t,e){for(e&=~cf,e&=~Wc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-qt(e),i=1<<n;t[n]=-1,e&=~i}}function Am(t){if(Z&6)throw Error(L(327));Or();var e=qa(t,0);if(!(e&1))return ct(t,we()),null;var n=lc(t,e);if(t.tag!==0&&n===2){var i=Bu(t);i!==0&&(e=i,n=md(t,i))}if(n===1)throw n=go,Oi(t,0),Jn(t,e),ct(t,we()),n;if(n===6)throw Error(L(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Pi(t,nt,bn),ct(t,we()),null}function uf(t,e){var n=Z;Z|=1;try{return t(e)}finally{Z=n,Z===0&&(Gr=we()+500,Vc&&ki())}}function $i(t){Zn!==null&&Zn.tag===0&&!(Z&6)&&Or();var e=Z;Z|=1;var n=It.transition,i=te;try{if(It.transition=null,te=1,t)return t()}finally{te=i,It.transition=n,Z=e,!(Z&6)&&ki()}}function df(){dt=kr.current,le(kr)}function Oi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Fw(n)),Re!==null)for(n=Re.return;n!==null;){var i=n;switch(Wh(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Ja();break;case 3:Hr(),le(ot),le(Qe),Zh();break;case 5:Xh(i);break;case 4:Hr();break;case 13:le(pe);break;case 19:le(pe);break;case 10:Gh(i.type._context);break;case 22:case 23:df()}n=n.return}if(Fe=t,Re=t=ci(t.current,null),ze=dt=e,Oe=0,go=null,cf=Wc=zi=0,nt=Ws=null,Ii!==null){for(e=0;e<Ii.length;e++)if(n=Ii[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ii=null}return t}function Tk(t,e){do{var n=Re;try{if(Kh(),va.current=sc,rc){for(var i=ge.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}rc=!1}if(Bi=0,Ne=De=ge=null,zs=!1,fo=0,af.current=null,n===null||n.return===null){Oe=1,go=e,Re=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=ze,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=ym(o);if(f!==null){f.flags&=-257,km(f,o,a,s,e),f.mode&1&&vm(s,l,e),e=f,c=l;var g=e.updateQueue;if(g===null){var p=new Set;p.add(c),e.updateQueue=p}else g.add(c);break e}else{if(!(e&1)){vm(s,l,e),hf();break e}c=Error(L(426))}}else if(he&&a.mode&1){var S=ym(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),km(S,o,a,s,e),qh(Kr(c,a));break e}}s=c=Kr(c,a),Oe!==4&&(Oe=2),Ws===null?Ws=[s]:Ws.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=sk(s,c,e);dm(s,m);break e;case 1:a=c;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(oi===null||!oi.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=ok(s,a,e);dm(s,k);break e}}s=s.return}while(s!==null)}Pk(n)}catch(b){e=b,Re===n&&n!==null&&(Re=n=n.return);continue}break}while(1)}function Ck(){var t=oc.current;return oc.current=sc,t===null?sc:t}function hf(){(Oe===0||Oe===3||Oe===2)&&(Oe=4),Fe===null||!(zi&268435455)&&!(Wc&268435455)||Jn(Fe,ze)}function lc(t,e){var n=Z;Z|=2;var i=Ck();(Fe!==t||ze!==e)&&(bn=null,Oi(t,e));do try{lP();break}catch(r){Tk(t,r)}while(1);if(Kh(),Z=n,oc.current=i,Re!==null)throw Error(L(261));return Fe=null,ze=0,Oe}function lP(){for(;Re!==null;)wk(Re)}function uP(){for(;Re!==null&&!N1();)wk(Re)}function wk(t){var e=xk(t.alternate,t,dt);t.memoizedProps=t.pendingProps,e===null?Pk(t):Re=e,af.current=null}function Pk(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=iP(n,e),n!==null){n.flags&=32767,Re=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Oe=6,Re=null;return}}else if(n=nP(n,e,dt),n!==null){Re=n;return}if(e=e.sibling,e!==null){Re=e;return}Re=e=t}while(e!==null);Oe===0&&(Oe=5)}function Pi(t,e,n){var i=te,r=It.transition;try{It.transition=null,te=1,dP(t,e,n,i)}finally{It.transition=r,te=i}return null}function dP(t,e,n,i){do Or();while(Zn!==null);if(Z&6)throw Error(L(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(L(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(q1(t,s),t===Fe&&(Re=Fe=null,ze=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ta||(ta=!0,Rk(Wa,function(){return Or(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=It.transition,It.transition=null;var o=te;te=1;var a=Z;Z|=4,af.current=null,sP(t,n),kk(n,t),Aw(Ku),Ha=!!Hu,Ku=Hu=null,t.current=n,oP(n),L1(),Z=a,te=o,It.transition=s}else t.current=n;if(ta&&(ta=!1,Zn=t,cc=r),s=t.pendingLanes,s===0&&(oi=null),j1(n.stateNode),ct(t,we()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ac)throw ac=!1,t=fd,fd=null,t;return cc&1&&t.tag!==0&&Or(),s=t.pendingLanes,s&1?t===pd?qs++:(qs=0,pd=t):qs=0,ki(),null}function Or(){if(Zn!==null){var t=sy(cc),e=It.transition,n=te;try{if(It.transition=null,te=16>t?16:t,Zn===null)var i=!1;else{if(t=Zn,Zn=null,cc=0,Z&6)throw Error(L(331));var r=Z;for(Z|=4,B=t.current;B!==null;){var s=B,o=s.child;if(B.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(B=l;B!==null;){var u=B;switch(u.tag){case 0:case 11:case 15:$s(8,u,s)}var d=u.child;if(d!==null)d.return=u,B=d;else for(;B!==null;){u=B;var h=u.sibling,f=u.return;if(gk(u),u===l){B=null;break}if(h!==null){h.return=f,B=h;break}B=f}}}var g=s.alternate;if(g!==null){var p=g.child;if(p!==null){g.child=null;do{var S=p.sibling;p.sibling=null,p=S}while(p!==null)}}B=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,B=o;else e:for(;B!==null;){if(s=B,s.flags&2048)switch(s.tag){case 0:case 11:case 15:$s(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,B=m;break e}B=s.return}}var v=t.current;for(B=v;B!==null;){o=B;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,B=y;else e:for(o=v;B!==null;){if(a=B,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:$c(9,a)}}catch(b){be(a,a.return,b)}if(a===o){B=null;break e}var k=a.sibling;if(k!==null){k.return=a.return,B=k;break e}B=a.return}}if(Z=r,ki(),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(Nc,t)}catch{}i=!0}return i}finally{te=n,It.transition=e}}return!1}function Dm(t,e,n){e=Kr(n,e),e=sk(t,e,1),t=si(t,e,1),e=Xe(),t!==null&&(Ro(t,1,e),ct(t,e))}function be(t,e,n){if(t.tag===3)Dm(t,t,n);else for(;e!==null;){if(e.tag===3){Dm(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(oi===null||!oi.has(i))){t=Kr(n,t),t=ok(e,t,1),e=si(e,t,1),t=Xe(),e!==null&&(Ro(e,1,t),ct(e,t));break}}e=e.return}}function hP(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Xe(),t.pingedLanes|=t.suspendedLanes&n,Fe===t&&(ze&n)===n&&(Oe===4||Oe===3&&(ze&130023424)===ze&&500>we()-lf?Oi(t,0):cf|=n),ct(t,e)}function Ek(t,e){e===0&&(t.mode&1?(e=qo,qo<<=1,!(qo&130023424)&&(qo=4194304)):e=1);var n=Xe();t=Mn(t,e),t!==null&&(Ro(t,e,n),ct(t,n))}function fP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Ek(t,n)}function pP(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(L(314))}i!==null&&i.delete(e),Ek(t,n)}var xk;xk=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ot.current)rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return rt=!1,tP(t,e,n);rt=!!(t.flags&131072)}else rt=!1,he&&e.flags&1048576&&Ay(e,Za,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;ka(t,e),t=e.pendingProps;var r=$r(e,Qe.current);Dr(e,n),r=tf(null,e,i,t,r,n);var s=nf();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,at(i)?(s=!0,Ya(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Jh(e),r.updater=zc,e.stateNode=r,r._reactInternals=e,nd(e,i,t,n),e=sd(null,e,i,!0,s,n)):(e.tag=0,he&&s&&$h(e),Je(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(ka(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=gP(i),t=Ft(i,t),r){case 0:e=rd(null,e,i,t,n);break e;case 1:e=Tm(null,e,i,t,n);break e;case 11:e=bm(null,e,i,t,n);break e;case 14:e=Sm(null,e,i,Ft(i.type,t),n);break e}throw Error(L(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),rd(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),Tm(t,e,i,r,n);case 3:e:{if(uk(e),t===null)throw Error(L(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Uy(t,e),nc(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Kr(Error(L(423)),e),e=Cm(t,e,i,n,r);break e}else if(i!==r){r=Kr(Error(L(424)),e),e=Cm(t,e,i,n,r);break e}else for(ft=ri(e.stateNode.containerInfo.firstChild),mt=e,he=!0,Bt=null,n=Ny(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Wr(),i===r){e=Nn(t,e,n);break e}Je(t,e,i,n)}e=e.child}return e;case 5:return Fy(e),t===null&&Zu(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Gu(i,r)?o=null:s!==null&&Gu(i,s)&&(e.flags|=32),lk(t,e),Je(t,e,o,n),e.child;case 6:return t===null&&Zu(e),null;case 13:return dk(t,e,n);case 4:return Yh(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=qr(e,null,i,n):Je(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),bm(t,e,i,r,n);case 7:return Je(t,e,e.pendingProps,n),e.child;case 8:return Je(t,e,e.pendingProps.children,n),e.child;case 12:return Je(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,oe(ec,i._currentValue),i._currentValue=o,s!==null)if(Kt(s.value,o)){if(s.children===r.children&&!ot.current){e=Nn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=_n(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),ed(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(L(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),ed(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Je(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Dr(e,n),r=At(r),i=i(r),e.flags|=1,Je(t,e,i,n),e.child;case 14:return i=e.type,r=Ft(i,e.pendingProps),r=Ft(i.type,r),Sm(t,e,i,r,n);case 15:return ak(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),ka(t,e),e.tag=1,at(i)?(t=!0,Ya(e)):t=!1,Dr(e,n),rk(e,i,r),nd(e,i,r,n),sd(null,e,i,!0,t,n);case 19:return hk(t,e,n);case 22:return ck(t,e,n)}throw Error(L(156,e.tag))};function Rk(t,e){return ty(t,e)}function mP(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _t(t,e,n,i){return new mP(t,e,n,i)}function ff(t){return t=t.prototype,!(!t||!t.isReactComponent)}function gP(t){if(typeof t=="function")return ff(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ah)return 11;if(t===Dh)return 14}return 2}function ci(t,e){var n=t.alternate;return n===null?(n=_t(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ta(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")ff(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case lr:return Mi(n.children,r,s,e);case Ih:o=8,r|=8;break;case Eu:return t=_t(12,n,e,r|2),t.elementType=Eu,t.lanes=s,t;case xu:return t=_t(13,n,e,r),t.elementType=xu,t.lanes=s,t;case Ru:return t=_t(19,n,e,r),t.elementType=Ru,t.lanes=s,t;case F0:return qc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case L0:o=10;break e;case U0:o=9;break e;case Ah:o=11;break e;case Dh:o=14;break e;case Kn:o=16,i=null;break e}throw Error(L(130,t==null?t:typeof t,""))}return e=_t(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Mi(t,e,n,i){return t=_t(7,t,i,e),t.lanes=n,t}function qc(t,e,n,i){return t=_t(22,t,i,e),t.elementType=F0,t.lanes=n,t.stateNode={isHidden:!1},t}function Bl(t,e,n){return t=_t(6,t,null,e),t.lanes=n,t}function zl(t,e,n){return e=_t(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function vP(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Tl(0),this.expirationTimes=Tl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tl(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function pf(t,e,n,i,r,s,o,a,c){return t=new vP(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=_t(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jh(s),t}function yP(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cr,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function _k(t){if(!t)return hi;t=t._reactInternals;e:{if(Yi(t)!==t||t.tag!==1)throw Error(L(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(at(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(L(171))}if(t.tag===1){var n=t.type;if(at(n))return _y(t,n,e)}return e}function Ik(t,e,n,i,r,s,o,a,c){return t=pf(n,i,!0,t,r,s,o,a,c),t.context=_k(null),n=t.current,i=Xe(),r=ai(n),s=_n(i,r),s.callback=e??null,si(n,s,r),t.current.lanes=r,Ro(t,r,i),ct(t,i),t}function Hc(t,e,n,i){var r=e.current,s=Xe(),o=ai(r);return n=_k(n),e.context===null?e.context=n:e.pendingContext=n,e=_n(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=si(r,e,o),t!==null&&(Ht(t,r,o,s),ga(t,r,o)),o}function uc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Om(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function mf(t,e){Om(t,e),(t=t.alternate)&&Om(t,e)}function kP(){return null}var Ak=typeof reportError=="function"?reportError:function(t){console.error(t)};function gf(t){this._internalRoot=t}Kc.prototype.render=gf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(L(409));Hc(t,e,null,null)};Kc.prototype.unmount=gf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$i(function(){Hc(null,t,null,null)}),e[On]=null}};function Kc(t){this._internalRoot=t}Kc.prototype.unstable_scheduleHydration=function(t){if(t){var e=cy();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Qn.length&&e!==0&&e<Qn[n].priority;n++);Qn.splice(n,0,t),n===0&&uy(t)}};function vf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Mm(){}function bP(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=uc(o);s.call(l)}}var o=Ik(e,i,t,0,null,!1,!1,"",Mm);return t._reactRootContainer=o,t[On]=o.current,ao(t.nodeType===8?t.parentNode:t),$i(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=uc(c);a.call(l)}}var c=pf(t,0,!1,null,null,!1,!1,"",Mm);return t._reactRootContainer=c,t[On]=c.current,ao(t.nodeType===8?t.parentNode:t),$i(function(){Hc(e,c,n,i)}),c}function Qc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=uc(o);a.call(c)}}Hc(e,o,t,r)}else o=bP(n,e,t,r,i);return uc(o)}oy=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Is(e.pendingLanes);n!==0&&(Nh(e,n|1),ct(e,we()),!(Z&6)&&(Gr=we()+500,ki()))}break;case 13:$i(function(){var i=Mn(t,1);if(i!==null){var r=Xe();Ht(i,t,1,r)}}),mf(t,1)}};Lh=function(t){if(t.tag===13){var e=Mn(t,134217728);if(e!==null){var n=Xe();Ht(e,t,134217728,n)}mf(t,134217728)}};ay=function(t){if(t.tag===13){var e=ai(t),n=Mn(t,e);if(n!==null){var i=Xe();Ht(n,t,e,i)}mf(t,e)}};cy=function(){return te};ly=function(t,e){var n=te;try{return te=t,e()}finally{te=n}};Fu=function(t,e,n){switch(e){case"input":if(Au(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=jc(i);if(!r)throw Error(L(90));V0(i),Au(i,r)}}}break;case"textarea":z0(t,n);break;case"select":e=n.value,e!=null&&Rr(t,!!n.multiple,e,!1)}};Q0=uf;J0=$i;var SP={usingClientEntryPoint:!1,Events:[Io,fr,jc,K0,G0,uf]},ks={findFiberByHostInstance:_i,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},TP={bundleType:ks.bundleType,version:ks.version,rendererPackageName:ks.rendererPackageName,rendererConfig:ks.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Z0(t),t===null?null:t.stateNode},findFiberByHostInstance:ks.findFiberByHostInstance||kP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var na=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!na.isDisabled&&na.supportsFiber)try{Nc=na.inject(TP),rn=na}catch{}}St.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SP;St.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vf(e))throw Error(L(200));return yP(t,e,null,n)};St.createRoot=function(t,e){if(!vf(t))throw Error(L(299));var n=!1,i="",r=Ak;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=pf(t,1,!1,null,null,n,!1,i,r),t[On]=e.current,ao(t.nodeType===8?t.parentNode:t),new gf(e)};St.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):(t=Object.keys(t).join(","),Error(L(268,t)));return t=Z0(e),t=t===null?null:t.stateNode,t};St.flushSync=function(t){return $i(t)};St.hydrate=function(t,e,n){if(!Gc(e))throw Error(L(200));return Qc(null,t,e,!0,n)};St.hydrateRoot=function(t,e,n){if(!vf(t))throw Error(L(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Ak;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ik(e,null,t,1,n??null,r,!1,s,o),t[On]=e.current,ao(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Kc(e)};St.render=function(t,e,n){if(!Gc(e))throw Error(L(200));return Qc(null,t,e,!1,n)};St.unmountComponentAtNode=function(t){if(!Gc(t))throw Error(L(40));return t._reactRootContainer?($i(function(){Qc(null,null,t,!1,function(){t._reactRootContainer=null,t[On]=null})}),!0):!1};St.unstable_batchedUpdates=uf;St.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Gc(n))throw Error(L(200));if(t==null||t._reactInternals===void 0)throw Error(L(38));return Qc(t,e,n,!1,i)};St.version="18.3.1-next-f1338f8080-20240426";function Dk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dk)}catch(t){console.error(t)}}Dk(),D0.exports=St;var CP=D0.exports,Nm=CP;wu.createRoot=Nm.createRoot,wu.hydrateRoot=Nm.hydrateRoot;const Ok=T.createContext({});function wP(t){const e=T.useRef(null);return e.current===null&&(e.current=t()),e.current}const yf=T.createContext(null),Mk=T.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function PP(t=!0){const e=T.useContext(yf);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,s=T.useId();T.useEffect(()=>{t&&r(s)},[t]);const o=T.useCallback(()=>t&&i&&i(s),[s,i,t]);return!n&&i?[!1,o]:[!0]}const kf=typeof window<"u",EP=kf?T.useLayoutEffect:T.useEffect,gt=t=>t;let Nk=gt;function bf(t){let e;return()=>(e===void 0&&(e=t()),e)}const Qr=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i},In=t=>t*1e3,An=t=>t/1e3,xP={skipAnimations:!1,useManualTiming:!1};function RP(t){let e=new Set,n=new Set,i=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(l){s.has(l)&&(c.schedule(l),t()),l(o)}const c={schedule:(l,u=!1,d=!1)=>{const f=d&&i?e:n;return u&&s.add(l),f.has(l)||f.add(l),l},cancel:l=>{n.delete(l),s.delete(l)},process:l=>{if(o=l,i){r=!0;return}i=!0,[e,n]=[n,e],e.forEach(a),e.clear(),i=!1,r&&(r=!1,c.process(l))}};return c}const ia=["read","resolveKeyframes","update","preRender","render","postRender"],_P=40;function Lk(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,o=ia.reduce((m,v)=>(m[v]=RP(s),m),{}),{read:a,resolveKeyframes:c,update:l,preRender:u,render:d,postRender:h}=o,f=()=>{const m=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(m-r.timestamp,_P),1),r.timestamp=m,r.isProcessing=!0,a.process(r),c.process(r),l.process(r),u.process(r),d.process(r),h.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(f))},g=()=>{n=!0,i=!0,r.isProcessing||t(f)};return{schedule:ia.reduce((m,v)=>{const y=o[v];return m[v]=(k,b=!1,w=!1)=>(n||g(),y.schedule(k,b,w)),m},{}),cancel:m=>{for(let v=0;v<ia.length;v++)o[ia[v]].cancel(m)},state:r,steps:o}}const{schedule:ue,cancel:fi,state:Ve,steps:$l}=Lk(typeof requestAnimationFrame<"u"?requestAnimationFrame:gt,!0),Uk=T.createContext({strict:!1}),Lm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Jr={};for(const t in Lm)Jr[t]={isEnabled:e=>Lm[t].some(n=>!!e[n])};function IP(t){for(const e in t)Jr[e]={...Jr[e],...t[e]}}const AP=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function dc(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||AP.has(t)}let Fk=t=>!dc(t);function DP(t){t&&(Fk=e=>e.startsWith("on")?!dc(e):t(e))}try{DP(require("@emotion/is-prop-valid").default)}catch{}function OP(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(Fk(r)||n===!0&&dc(r)||!e&&!dc(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}function MP(t){if(typeof Proxy>"u")return t;const e=new Map,n=(...i)=>t(...i);return new Proxy(n,{get:(i,r)=>r==="create"?t:(e.has(r)||e.set(r,t(r)),e.get(r))})}const Jc=T.createContext({});function vo(t){return typeof t=="string"||Array.isArray(t)}function Yc(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Sf=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Tf=["initial",...Sf];function Xc(t){return Yc(t.animate)||Tf.some(e=>vo(t[e]))}function jk(t){return!!(Xc(t)||t.variants)}function NP(t,e){if(Xc(t)){const{initial:n,animate:i}=t;return{initial:n===!1||vo(n)?n:void 0,animate:vo(i)?i:void 0}}return t.inherit!==!1?e:{}}function LP(t){const{initial:e,animate:n}=NP(t,T.useContext(Jc));return T.useMemo(()=>({initial:e,animate:n}),[Um(e),Um(n)])}function Um(t){return Array.isArray(t)?t.join(" "):t}const UP=Symbol.for("motionComponentSymbol");function br(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function FP(t,e,n){return T.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):br(n)&&(n.current=i))},[e])}const Cf=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),jP="framerAppearId",Vk="data-"+Cf(jP),{schedule:wf,cancel:KL}=Lk(queueMicrotask,!1),Bk=T.createContext({});function VP(t,e,n,i,r){var s,o;const{visualElement:a}=T.useContext(Jc),c=T.useContext(Uk),l=T.useContext(yf),u=T.useContext(Mk).reducedMotion,d=T.useRef(null);i=i||c.renderer,!d.current&&i&&(d.current=i(t,{visualState:e,parent:a,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:u}));const h=d.current,f=T.useContext(Bk);h&&!h.projection&&r&&(h.type==="html"||h.type==="svg")&&BP(d.current,n,r,f);const g=T.useRef(!1);T.useInsertionEffect(()=>{h&&g.current&&h.update(n,l)});const p=n[Vk],S=T.useRef(!!p&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,p))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,p)));return EP(()=>{h&&(g.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),wf.render(h.render),S.current&&h.animationState&&h.animationState.animateChanges())}),T.useEffect(()=>{h&&(!S.current&&h.animationState&&h.animationState.animateChanges(),S.current&&(queueMicrotask(()=>{var m;(m=window.MotionHandoffMarkAsComplete)===null||m===void 0||m.call(window,p)}),S.current=!1))}),h}function BP(t,e,n,i){const{layoutId:r,layout:s,drag:o,dragConstraints:a,layoutScroll:c,layoutRoot:l}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:zk(t.parent)),t.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!o||a&&br(a),visualElement:t,animationType:typeof s=="string"?s:"both",initialPromotionConfig:i,layoutScroll:c,layoutRoot:l})}function zk(t){if(t)return t.options.allowProjection!==!1?t.projection:zk(t.parent)}function zP({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:i,Component:r}){var s,o;t&&IP(t);function a(l,u){let d;const h={...T.useContext(Mk),...l,layoutId:$P(l)},{isStatic:f}=h,g=LP(l),p=i(l,f);if(!f&&kf){WP();const S=qP(h);d=S.MeasureLayout,g.visualElement=VP(r,p,h,e,S.ProjectionNode)}return A.jsxs(Jc.Provider,{value:g,children:[d&&g.visualElement?A.jsx(d,{visualElement:g.visualElement,...h}):null,n(r,l,FP(p,g.visualElement,u),p,f,g.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(s=r.displayName)!==null&&s!==void 0?s:r.name)!==null&&o!==void 0?o:""})`}`;const c=T.forwardRef(a);return c[UP]=r,c}function $P({layoutId:t}){const e=T.useContext(Ok).id;return e&&t!==void 0?e+"-"+t:t}function WP(t,e){T.useContext(Uk).strict}function qP(t){const{drag:e,layout:n}=Jr;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const HP=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Pf(t){return typeof t!="string"||t.includes("-")?!1:!!(HP.indexOf(t)>-1||/[A-Z]/u.test(t))}function Fm(t){const e=[{},{}];return t==null||t.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function Ef(t,e,n,i){if(typeof e=="function"){const[r,s]=Fm(i);e=e(n!==void 0?n:t.custom,r,s)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,s]=Fm(i);e=e(n!==void 0?n:t.custom,r,s)}return e}const vd=t=>Array.isArray(t),KP=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),GP=t=>vd(t)?t[t.length-1]||0:t,Ge=t=>!!(t&&t.getVelocity);function Ca(t){const e=Ge(t)?t.get():t;return KP(e)?e.toValue():e}function QP({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:n},i,r,s){const o={latestValues:JP(i,r,s,t),renderState:e()};return n&&(o.onMount=a=>n({props:i,current:a,...o}),o.onUpdate=a=>n(a)),o}const $k=t=>(e,n)=>{const i=T.useContext(Jc),r=T.useContext(yf),s=()=>QP(t,e,i,r);return n?s():wP(s)};function JP(t,e,n,i){const r={},s=i(t,{});for(const h in s)r[h]=Ca(s[h]);let{initial:o,animate:a}=t;const c=Xc(t),l=jk(t);e&&l&&!c&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!Yc(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const g=Ef(t,h[f]);if(g){const{transitionEnd:p,transition:S,...m}=g;for(const v in m){let y=m[v];if(Array.isArray(y)){const k=u?y.length-1:0;y=y[k]}y!==null&&(r[v]=y)}for(const v in p)r[v]=p[v]}}}return r}const os=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Xi=new Set(os),Wk=t=>e=>typeof e=="string"&&e.startsWith(t),qk=Wk("--"),YP=Wk("var(--"),xf=t=>YP(t)?XP.test(t.split("/*")[0].trim()):!1,XP=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Hk=(t,e)=>e&&typeof t=="number"?e.transform(t):t,Ln=(t,e,n)=>n>e?e:n<t?t:n,as={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},yo={...as,transform:t=>Ln(0,1,t)},ra={...as,default:1},Do=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),qn=Do("deg"),on=Do("%"),W=Do("px"),ZP=Do("vh"),eE=Do("vw"),jm={...on,parse:t=>on.parse(t)/100,transform:t=>on.transform(t*100)},tE={borderWidth:W,borderTopWidth:W,borderRightWidth:W,borderBottomWidth:W,borderLeftWidth:W,borderRadius:W,radius:W,borderTopLeftRadius:W,borderTopRightRadius:W,borderBottomRightRadius:W,borderBottomLeftRadius:W,width:W,maxWidth:W,height:W,maxHeight:W,top:W,right:W,bottom:W,left:W,padding:W,paddingTop:W,paddingRight:W,paddingBottom:W,paddingLeft:W,margin:W,marginTop:W,marginRight:W,marginBottom:W,marginLeft:W,backgroundPositionX:W,backgroundPositionY:W},nE={rotate:qn,rotateX:qn,rotateY:qn,rotateZ:qn,scale:ra,scaleX:ra,scaleY:ra,scaleZ:ra,skew:qn,skewX:qn,skewY:qn,distance:W,translateX:W,translateY:W,translateZ:W,x:W,y:W,z:W,perspective:W,transformPerspective:W,opacity:yo,originX:jm,originY:jm,originZ:W},Vm={...as,transform:Math.round},Rf={...tE,...nE,zIndex:Vm,size:W,fillOpacity:yo,strokeOpacity:yo,numOctaves:Vm},iE={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},rE=os.length;function sE(t,e,n){let i="",r=!0;for(let s=0;s<rE;s++){const o=os[s],a=t[o];if(a===void 0)continue;let c=!0;if(typeof a=="number"?c=a===(o.startsWith("scale")?1:0):c=parseFloat(a)===0,!c||n){const l=Hk(a,Rf[o]);if(!c){r=!1;const u=iE[o]||o;i+=`${u}(${l}) `}n&&(e[o]=l)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function _f(t,e,n){const{style:i,vars:r,transformOrigin:s}=t;let o=!1,a=!1;for(const c in e){const l=e[c];if(Xi.has(c)){o=!0;continue}else if(qk(c)){r[c]=l;continue}else{const u=Hk(l,Rf[c]);c.startsWith("origin")?(a=!0,s[c]=u):i[c]=u}}if(e.transform||(o||n?i.transform=sE(e,t.transform,n):i.transform&&(i.transform="none")),a){const{originX:c="50%",originY:l="50%",originZ:u=0}=s;i.transformOrigin=`${c} ${l} ${u}`}}const oE={offset:"stroke-dashoffset",array:"stroke-dasharray"},aE={offset:"strokeDashoffset",array:"strokeDasharray"};function cE(t,e,n=1,i=0,r=!0){t.pathLength=1;const s=r?oE:aE;t[s.offset]=W.transform(-i);const o=W.transform(e),a=W.transform(n);t[s.array]=`${o} ${a}`}function Bm(t,e,n){return typeof t=="string"?t:W.transform(e+n*t)}function lE(t,e,n){const i=Bm(e,t.x,t.width),r=Bm(n,t.y,t.height);return`${i} ${r}`}function If(t,{attrX:e,attrY:n,attrScale:i,originX:r,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:c=0,...l},u,d){if(_f(t,l,d),u){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:f,dimensions:g}=t;h.transform&&(g&&(f.transform=h.transform),delete h.transform),g&&(r!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=lE(g,r!==void 0?r:.5,s!==void 0?s:.5)),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),i!==void 0&&(h.scale=i),o!==void 0&&cE(h,o,a,c,!1)}const Af=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Kk=()=>({...Af(),attrs:{}}),Df=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Gk(t,{style:e,vars:n},i,r){Object.assign(t.style,e,r&&r.getProjectionStyles(i));for(const s in n)t.style.setProperty(s,n[s])}const Qk=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Jk(t,e,n,i){Gk(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(Qk.has(r)?r:Cf(r),e.attrs[r])}const hc={};function uE(t){Object.assign(hc,t)}function Yk(t,{layout:e,layoutId:n}){return Xi.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!hc[t]||t==="opacity")}function Of(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(Ge(r[o])||e.style&&Ge(e.style[o])||Yk(o,t)||((i=n==null?void 0:n.getValue(o))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}function Xk(t,e,n){const i=Of(t,e,n);for(const r in t)if(Ge(t[r])||Ge(e[r])){const s=os.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[s]=t[r]}return i}function dE(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const zm=["x","y","width","height","cx","cy","r"],hE={useVisualState:$k({scrapeMotionValuesFromProps:Xk,createRenderState:Kk,onUpdate:({props:t,prevProps:e,current:n,renderState:i,latestValues:r})=>{if(!n)return;let s=!!t.drag;if(!s){for(const a in r)if(Xi.has(a)){s=!0;break}}if(!s)return;let o=!e;if(e)for(let a=0;a<zm.length;a++){const c=zm[a];t[c]!==e[c]&&(o=!0)}o&&ue.read(()=>{dE(n,i),ue.render(()=>{If(i,r,Df(n.tagName),t.transformTemplate),Jk(n,i)})})}})},fE={useVisualState:$k({scrapeMotionValuesFromProps:Of,createRenderState:Af})};function Zk(t,e,n){for(const i in e)!Ge(e[i])&&!Yk(i,n)&&(t[i]=e[i])}function pE({transformTemplate:t},e){return T.useMemo(()=>{const n=Af();return _f(n,e,t),Object.assign({},n.vars,n.style)},[e])}function mE(t,e){const n=t.style||{},i={};return Zk(i,n,t),Object.assign(i,pE(t,e)),i}function gE(t,e){const n={},i=mE(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}function vE(t,e,n,i){const r=T.useMemo(()=>{const s=Kk();return If(s,e,Df(i),t.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(t.style){const s={};Zk(s,t.style,t),r.style={...s,...r.style}}return r}function yE(t=!1){return(n,i,r,{latestValues:s},o)=>{const c=(Pf(n)?vE:gE)(i,s,o,n),l=OP(i,typeof n=="string",t),u=n!==T.Fragment?{...l,...c,ref:r}:{},{children:d}=i,h=T.useMemo(()=>Ge(d)?d.get():d,[d]);return T.createElement(n,{...u,children:h})}}function kE(t,e){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...Pf(i)?hE:fE,preloadedFeatures:t,useRender:yE(r),createVisualElement:e,Component:i};return zP(o)}}function eb(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Zc(t,e,n){const i=t.getProps();return Ef(i,e,n!==void 0?n:i.custom,t)}const bE=bf(()=>window.ScrollTimeline!==void 0);class SE{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=n}attachTimeline(e,n){const i=this.animations.map(r=>{if(bE()&&r.attachTimeline)return r.attachTimeline(e);if(typeof n=="function")return n(r)});return()=>{i.forEach((r,s)=>{r&&r(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class TE extends SE{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}function Mf(t,e){return t?t[e]||t.default||t:void 0}const yd=2e4;function tb(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<yd;)e+=n,i=t.next(e);return e>=yd?1/0:e}function Nf(t){return typeof t=="function"}function $m(t,e){t.timeline=e,t.onfinish=null}const Lf=t=>Array.isArray(t)&&typeof t[0]=="number",CE={linearEasing:void 0};function wE(t,e){const n=bf(t);return()=>{var i;return(i=CE[e])!==null&&i!==void 0?i:n()}}const fc=wE(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),nb=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let s=0;s<r;s++)i+=t(Qr(0,r-1,s))+", ";return`linear(${i.substring(0,i.length-2)})`};function ib(t){return!!(typeof t=="function"&&fc()||!t||typeof t=="string"&&(t in kd||fc())||Lf(t)||Array.isArray(t)&&t.every(ib))}const Ds=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,kd={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ds([0,.65,.55,1]),circOut:Ds([.55,0,1,.45]),backIn:Ds([.31,.01,.66,-.59]),backOut:Ds([.33,1.53,.69,.99])};function rb(t,e){if(t)return typeof t=="function"&&fc()?nb(t,e):Lf(t)?Ds(t):Array.isArray(t)?t.map(n=>rb(n,e)||kd.easeOut):kd[t]}const Lt={x:!1,y:!1};function sb(){return Lt.x||Lt.y}function PE(t,e,n){var i;if(t instanceof Element)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(i=n==null?void 0:n[t])!==null&&i!==void 0?i:r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}function ob(t,e){const n=PE(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function Wm(t){return e=>{e.pointerType==="touch"||sb()||t(e)}}function EE(t,e,n={}){const[i,r,s]=ob(t,n),o=Wm(a=>{const{target:c}=a,l=e(a);if(typeof l!="function"||!c)return;const u=Wm(d=>{l(d),c.removeEventListener("pointerleave",u)});c.addEventListener("pointerleave",u,r)});return i.forEach(a=>{a.addEventListener("pointerenter",o,r)}),s}const ab=(t,e)=>e?t===e?!0:ab(t,e.parentElement):!1,Uf=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,xE=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function RE(t){return xE.has(t.tagName)||t.tabIndex!==-1}const Os=new WeakSet;function qm(t){return e=>{e.key==="Enter"&&t(e)}}function Wl(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const _E=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=qm(()=>{if(Os.has(n))return;Wl(n,"down");const r=qm(()=>{Wl(n,"up")}),s=()=>Wl(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",s,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function Hm(t){return Uf(t)&&!sb()}function IE(t,e,n={}){const[i,r,s]=ob(t,n),o=a=>{const c=a.currentTarget;if(!Hm(a)||Os.has(c))return;Os.add(c);const l=e(a),u=(f,g)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),!(!Hm(f)||!Os.has(c))&&(Os.delete(c),typeof l=="function"&&l(f,{success:g}))},d=f=>{u(f,n.useGlobalTarget||ab(c,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",d,r),window.addEventListener("pointercancel",h,r)};return i.forEach(a=>{!RE(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",l=>_E(l,r),r)}),s}function AE(t){return t==="x"||t==="y"?Lt[t]?null:(Lt[t]=!0,()=>{Lt[t]=!1}):Lt.x||Lt.y?null:(Lt.x=Lt.y=!0,()=>{Lt.x=Lt.y=!1})}const cb=new Set(["width","height","top","left","right","bottom",...os]);let wa;function DE(){wa=void 0}const an={now:()=>(wa===void 0&&an.set(Ve.isProcessing||xP.useManualTiming?Ve.timestamp:performance.now()),wa),set:t=>{wa=t,queueMicrotask(DE)}};function Ff(t,e){t.indexOf(e)===-1&&t.push(e)}function jf(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Vf{constructor(){this.subscriptions=[]}add(e){return Ff(this.subscriptions,e),()=>jf(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let s=0;s<r;s++){const o=this.subscriptions[s];o&&o(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function lb(t,e){return e?t*(1e3/e):0}const Km=30,OE=t=>!isNaN(parseFloat(t));class ME{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const s=an.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=an.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=OE(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Vf);const i=this.events[e].add(n);return e==="change"?()=>{i(),ue.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=an.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Km)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Km);return lb(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ko(t,e){return new ME(t,e)}function NE(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,ko(n))}function LE(t,e){const n=Zc(t,e);let{transitionEnd:i={},transition:r={},...s}=n||{};s={...s,...i};for(const o in s){const a=GP(s[o]);NE(t,o,a)}}function UE(t){return!!(Ge(t)&&t.add)}function bd(t,e){const n=t.getValue("willChange");if(UE(n))return n.add(e)}function ub(t){return t.props[Vk]}const db=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,FE=1e-7,jE=12;function VE(t,e,n,i,r){let s,o,a=0;do o=e+(n-e)/2,s=db(o,i,r)-t,s>0?n=o:e=o;while(Math.abs(s)>FE&&++a<jE);return o}function Oo(t,e,n,i){if(t===e&&n===i)return gt;const r=s=>VE(s,0,1,t,n);return s=>s===0||s===1?s:db(r(s),e,i)}const hb=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,fb=t=>e=>1-t(1-e),pb=Oo(.33,1.53,.69,.99),Bf=fb(pb),mb=hb(Bf),gb=t=>(t*=2)<1?.5*Bf(t):.5*(2-Math.pow(2,-10*(t-1))),zf=t=>1-Math.sin(Math.acos(t)),vb=fb(zf),yb=hb(zf),kb=t=>/^0[^.\s]+$/u.test(t);function BE(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||kb(t):!0}const Hs=t=>Math.round(t*1e5)/1e5,$f=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function zE(t){return t==null}const $E=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Wf=(t,e)=>n=>!!(typeof n=="string"&&$E.test(n)&&n.startsWith(t)||e&&!zE(n)&&Object.prototype.hasOwnProperty.call(n,e)),bb=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,s,o,a]=i.match($f);return{[t]:parseFloat(r),[e]:parseFloat(s),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},WE=t=>Ln(0,255,t),ql={...as,transform:t=>Math.round(WE(t))},Di={test:Wf("rgb","red"),parse:bb("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+ql.transform(t)+", "+ql.transform(e)+", "+ql.transform(n)+", "+Hs(yo.transform(i))+")"};function qE(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Sd={test:Wf("#"),parse:qE,transform:Di.transform},Sr={test:Wf("hsl","hue"),parse:bb("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+on.transform(Hs(e))+", "+on.transform(Hs(n))+", "+Hs(yo.transform(i))+")"},He={test:t=>Di.test(t)||Sd.test(t)||Sr.test(t),parse:t=>Di.test(t)?Di.parse(t):Sr.test(t)?Sr.parse(t):Sd.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Di.transform(t):Sr.transform(t)},HE=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function KE(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match($f))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(HE))===null||n===void 0?void 0:n.length)||0)>0}const Sb="number",Tb="color",GE="var",QE="var(",Gm="${}",JE=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function bo(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let s=0;const a=e.replace(JE,c=>(He.test(c)?(i.color.push(s),r.push(Tb),n.push(He.parse(c))):c.startsWith(QE)?(i.var.push(s),r.push(GE),n.push(c)):(i.number.push(s),r.push(Sb),n.push(parseFloat(c))),++s,Gm)).split(Gm);return{values:n,split:a,indexes:i,types:r}}function Cb(t){return bo(t).values}function wb(t){const{split:e,types:n}=bo(t),i=e.length;return r=>{let s="";for(let o=0;o<i;o++)if(s+=e[o],r[o]!==void 0){const a=n[o];a===Sb?s+=Hs(r[o]):a===Tb?s+=He.transform(r[o]):s+=r[o]}return s}}const YE=t=>typeof t=="number"?0:t;function XE(t){const e=Cb(t);return wb(t)(e.map(YE))}const pi={test:KE,parse:Cb,createTransformer:wb,getAnimatableNone:XE},ZE=new Set(["brightness","contrast","saturate","opacity"]);function ex(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match($f)||[];if(!i)return t;const r=n.replace(i,"");let s=ZE.has(e)?1:0;return i!==n&&(s*=100),e+"("+s+r+")"}const tx=/\b([a-z-]*)\(.*?\)/gu,Td={...pi,getAnimatableNone:t=>{const e=t.match(tx);return e?e.map(ex).join(" "):t}},nx={...Rf,color:He,backgroundColor:He,outlineColor:He,fill:He,stroke:He,borderColor:He,borderTopColor:He,borderRightColor:He,borderBottomColor:He,borderLeftColor:He,filter:Td,WebkitFilter:Td},qf=t=>nx[t];function Pb(t,e){let n=qf(t);return n!==Td&&(n=pi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const ix=new Set(["auto","none","0"]);function rx(t,e,n){let i=0,r;for(;i<t.length&&!r;){const s=t[i];typeof s=="string"&&!ix.has(s)&&bo(s).values.length&&(r=t[i]),i++}if(r&&n)for(const s of e)t[s]=Pb(n,r)}const Qm=t=>t===as||t===W,Jm=(t,e)=>parseFloat(t.split(", ")[e]),Ym=(t,e)=>(n,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return Jm(r[1],e);{const s=i.match(/^matrix\((.+)\)$/u);return s?Jm(s[1],t):0}},sx=new Set(["x","y","z"]),ox=os.filter(t=>!sx.has(t));function ax(t){const e=[];return ox.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const Yr={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:Ym(4,13),y:Ym(5,14)};Yr.translateX=Yr.x;Yr.translateY=Yr.y;const Ni=new Set;let Cd=!1,wd=!1;function Eb(){if(wd){const t=Array.from(Ni).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=ax(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([s,o])=>{var a;(a=i.getValue(s))===null||a===void 0||a.set(o)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}wd=!1,Cd=!1,Ni.forEach(t=>t.complete()),Ni.clear()}function xb(){Ni.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(wd=!0)})}function cx(){xb(),Eb()}class Hf{constructor(e,n,i,r,s,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=s,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ni.add(this),Cd||(Cd=!0,ue.read(xb),ue.resolveKeyframes(Eb))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;for(let s=0;s<e.length;s++)if(e[s]===null)if(s===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&n){const c=i.readValue(n,a);c!=null&&(e[0]=c)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ni.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ni.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Rb=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),lx=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ux(t){const e=lx.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function _b(t,e,n=1){const[i,r]=ux(t);if(!i)return;const s=window.getComputedStyle(e).getPropertyValue(i);if(s){const o=s.trim();return Rb(o)?parseFloat(o):o}return xf(r)?_b(r,e,n+1):r}const Ib=t=>e=>e.test(t),dx={test:t=>t==="auto",parse:t=>t},Ab=[as,W,on,qn,eE,ZP,dx],Xm=t=>Ab.find(Ib(t));class Db extends Hf{constructor(e,n,i,r,s){super(e,n,i,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let l=e[c];if(typeof l=="string"&&(l=l.trim(),xf(l))){const u=_b(l,n.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=l)}}if(this.resolveNoneKeyframes(),!cb.has(i)||e.length!==2)return;const[r,s]=e,o=Xm(r),a=Xm(s);if(o!==a)if(Qm(o)&&Qm(a))for(let c=0;c<e.length;c++){const l=e[c];typeof l=="string"&&(e[c]=parseFloat(l))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)BE(e[r])&&i.push(r);i.length&&rx(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Yr[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:i,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const s=n.getValue(i);s&&s.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=Yr[i](n.measureViewportBox(),window.getComputedStyle(n.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([c,l])=>{n.getValue(c).set(l)}),this.resolveNoneKeyframes()}}const Zm=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(pi.test(t)||t==="0")&&!t.startsWith("url("));function hx(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function fx(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=t[t.length-1],o=Zm(r,e),a=Zm(s,e);return!o||!a?!1:hx(t)||(n==="spring"||Nf(n))&&i}const px=t=>t!==null;function el(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(px),s=e&&n!=="loop"&&e%2===1?0:r.length-1;return!s||i===void 0?r[s]:i}const mx=40;class Ob{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=an.now(),this.options={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:s,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>mx?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&cx(),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=an.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:s,delay:o,onComplete:a,onUpdate:c,isGenerator:l}=this.options;if(!l&&!fx(e,i,r,s))if(o)this.options.duration=0;else{c&&c(el(e,this.options,n)),a&&a(),this.resolveFinishedPromise();return}const u=this.initPlayback(e,n);u!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...u},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const me=(t,e,n)=>t+(e-t)*n;function Hl(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function gx({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,s=0,o=0;if(!e)r=s=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,c=2*n-a;r=Hl(c,a,t+1/3),s=Hl(c,a,t),o=Hl(c,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:i}}function pc(t,e){return n=>n>0?e:t}const Kl=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},vx=[Sd,Di,Sr],yx=t=>vx.find(e=>e.test(t));function eg(t){const e=yx(t);if(!e)return!1;let n=e.parse(t);return e===Sr&&(n=gx(n)),n}const tg=(t,e)=>{const n=eg(t),i=eg(e);if(!n||!i)return pc(t,e);const r={...n};return s=>(r.red=Kl(n.red,i.red,s),r.green=Kl(n.green,i.green,s),r.blue=Kl(n.blue,i.blue,s),r.alpha=me(n.alpha,i.alpha,s),Di.transform(r))},kx=(t,e)=>n=>e(t(n)),Mo=(...t)=>t.reduce(kx),Pd=new Set(["none","hidden"]);function bx(t,e){return Pd.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function Sx(t,e){return n=>me(t,e,n)}function Kf(t){return typeof t=="number"?Sx:typeof t=="string"?xf(t)?pc:He.test(t)?tg:wx:Array.isArray(t)?Mb:typeof t=="object"?He.test(t)?tg:Tx:pc}function Mb(t,e){const n=[...t],i=n.length,r=t.map((s,o)=>Kf(s)(s,e[o]));return s=>{for(let o=0;o<i;o++)n[o]=r[o](s);return n}}function Tx(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=Kf(t[r])(t[r],e[r]));return r=>{for(const s in i)n[s]=i[s](r);return n}}function Cx(t,e){var n;const i=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const o=e.types[s],a=t.indexes[o][r[o]],c=(n=t.values[a])!==null&&n!==void 0?n:0;i[s]=c,r[o]++}return i}const wx=(t,e)=>{const n=pi.createTransformer(e),i=bo(t),r=bo(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Pd.has(t)&&!r.values.length||Pd.has(e)&&!i.values.length?bx(t,e):Mo(Mb(Cx(i,r),r.values),n):pc(t,e)};function Nb(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?me(t,e,n):Kf(t)(t,e)}const Px=5;function Lb(t,e,n){const i=Math.max(e-Px,0);return lb(n-t(i),e-i)}const ye={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Gl=.001;function Ex({duration:t=ye.duration,bounce:e=ye.bounce,velocity:n=ye.velocity,mass:i=ye.mass}){let r,s,o=1-e;o=Ln(ye.minDamping,ye.maxDamping,o),t=Ln(ye.minDuration,ye.maxDuration,An(t)),o<1?(r=l=>{const u=l*o,d=u*t,h=u-n,f=Ed(l,o),g=Math.exp(-d);return Gl-h/f*g},s=l=>{const d=l*o*t,h=d*n+n,f=Math.pow(o,2)*Math.pow(l,2)*t,g=Math.exp(-d),p=Ed(Math.pow(l,2),o);return(-r(l)+Gl>0?-1:1)*((h-f)*g)/p}):(r=l=>{const u=Math.exp(-l*t),d=(l-n)*t+1;return-Gl+u*d},s=l=>{const u=Math.exp(-l*t),d=(n-l)*(t*t);return u*d});const a=5/t,c=Rx(r,s,a);if(t=In(t),isNaN(c))return{stiffness:ye.stiffness,damping:ye.damping,duration:t};{const l=Math.pow(c,2)*i;return{stiffness:l,damping:o*2*Math.sqrt(i*l),duration:t}}}const xx=12;function Rx(t,e,n){let i=n;for(let r=1;r<xx;r++)i=i-t(i)/e(i);return i}function Ed(t,e){return t*Math.sqrt(1-e*e)}const _x=["duration","bounce"],Ix=["stiffness","damping","mass"];function ng(t,e){return e.some(n=>t[n]!==void 0)}function Ax(t){let e={velocity:ye.velocity,stiffness:ye.stiffness,damping:ye.damping,mass:ye.mass,isResolvedFromDuration:!1,...t};if(!ng(t,Ix)&&ng(t,_x))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,s=2*Ln(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:ye.mass,stiffness:r,damping:s}}else{const n=Ex(t);e={...e,...n,mass:ye.mass},e.isResolvedFromDuration=!0}return e}function Ub(t=ye.visualDuration,e=ye.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const s=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:s},{stiffness:c,damping:l,mass:u,duration:d,velocity:h,isResolvedFromDuration:f}=Ax({...n,velocity:-An(n.velocity||0)}),g=h||0,p=l/(2*Math.sqrt(c*u)),S=o-s,m=An(Math.sqrt(c/u)),v=Math.abs(S)<5;i||(i=v?ye.restSpeed.granular:ye.restSpeed.default),r||(r=v?ye.restDelta.granular:ye.restDelta.default);let y;if(p<1){const b=Ed(m,p);y=w=>{const P=Math.exp(-p*m*w);return o-P*((g+p*m*S)/b*Math.sin(b*w)+S*Math.cos(b*w))}}else if(p===1)y=b=>o-Math.exp(-m*b)*(S+(g+m*S)*b);else{const b=m*Math.sqrt(p*p-1);y=w=>{const P=Math.exp(-p*m*w),E=Math.min(b*w,300);return o-P*((g+p*m*S)*Math.sinh(E)+b*S*Math.cosh(E))/b}}const k={calculatedDuration:f&&d||null,next:b=>{const w=y(b);if(f)a.done=b>=d;else{let P=0;p<1&&(P=b===0?In(g):Lb(y,b,w));const E=Math.abs(P)<=i,D=Math.abs(o-w)<=r;a.done=E&&D}return a.value=a.done?o:w,a},toString:()=>{const b=Math.min(tb(k),yd),w=nb(P=>k.next(b*P).value,b,30);return b+"ms "+w}};return k}function ig({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:c,restDelta:l=.5,restSpeed:u}){const d=t[0],h={done:!1,value:d},f=E=>a!==void 0&&E<a||c!==void 0&&E>c,g=E=>a===void 0?c:c===void 0||Math.abs(a-E)<Math.abs(c-E)?a:c;let p=n*e;const S=d+p,m=o===void 0?S:o(S);m!==S&&(p=m-d);const v=E=>-p*Math.exp(-E/i),y=E=>m+v(E),k=E=>{const D=v(E),I=y(E);h.done=Math.abs(D)<=l,h.value=h.done?m:I};let b,w;const P=E=>{f(h.value)&&(b=E,w=Ub({keyframes:[h.value,g(h.value)],velocity:Lb(y,E,h.value),damping:r,stiffness:s,restDelta:l,restSpeed:u}))};return P(0),{calculatedDuration:null,next:E=>{let D=!1;return!w&&b===void 0&&(D=!0,k(E),P(E)),b!==void 0&&E>=b?w.next(E-b):(!D&&k(E),h)}}}const Dx=Oo(.42,0,1,1),Ox=Oo(0,0,.58,1),Fb=Oo(.42,0,.58,1),Mx=t=>Array.isArray(t)&&typeof t[0]!="number",Nx={linear:gt,easeIn:Dx,easeInOut:Fb,easeOut:Ox,circIn:zf,circInOut:yb,circOut:vb,backIn:Bf,backInOut:mb,backOut:pb,anticipate:gb},rg=t=>{if(Lf(t)){Nk(t.length===4);const[e,n,i,r]=t;return Oo(e,n,i,r)}else if(typeof t=="string")return Nx[t];return t};function Lx(t,e,n){const i=[],r=n||Nb,s=t.length-1;for(let o=0;o<s;o++){let a=r(t[o],t[o+1]);if(e){const c=Array.isArray(e)?e[o]||gt:e;a=Mo(c,a)}i.push(a)}return i}function Ux(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const s=t.length;if(Nk(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=Lx(e,i,r),c=a.length,l=u=>{if(o&&u<t[0])return e[0];let d=0;if(c>1)for(;d<t.length-2&&!(u<t[d+1]);d++);const h=Qr(t[d],t[d+1],u);return a[d](h)};return n?u=>l(Ln(t[0],t[s-1],u)):l}function Fx(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=Qr(0,e,i);t.push(me(n,1,r))}}function jx(t){const e=[0];return Fx(e,t.length-1),e}function Vx(t,e){return t.map(n=>n*e)}function Bx(t,e){return t.map(()=>e||Fb).splice(0,t.length-1)}function mc({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=Mx(i)?i.map(rg):rg(i),s={done:!1,value:e[0]},o=Vx(n&&n.length===e.length?n:jx(e),t),a=Ux(o,e,{ease:Array.isArray(r)?r:Bx(e,r)});return{calculatedDuration:t,next:c=>(s.value=a(c),s.done=c>=t,s)}}const zx=t=>{const e=({timestamp:n})=>t(n);return{start:()=>ue.update(e,!0),stop:()=>fi(e),now:()=>Ve.isProcessing?Ve.timestamp:an.now()}},$x={decay:ig,inertia:ig,tween:mc,keyframes:mc,spring:Ub},Wx=t=>t/100;class Gf extends Ob{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:n,motionValue:i,element:r,keyframes:s}=this.options,o=(r==null?void 0:r.KeyframeResolver)||Hf,a=(c,l)=>this.onKeyframesResolved(c,l);this.resolver=new o(s,a,n,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:s,velocity:o=0}=this.options,a=Nf(n)?n:$x[n]||mc;let c,l;a!==mc&&typeof e[0]!="number"&&(c=Mo(Wx,Nb(e[0],e[1])),e=[0,100]);const u=a({...this.options,keyframes:e});s==="mirror"&&(l=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=tb(u));const{calculatedDuration:d}=u,h=d+r,f=h*(i+1)-r;return{generator:u,mirroredGenerator:l,mapPercentToKeyframes:c,calculatedDuration:d,resolvedDuration:h,totalDuration:f}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:i}=this;if(!i){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:r,generator:s,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:c,calculatedDuration:l,totalDuration:u,resolvedDuration:d}=i;if(this.startTime===null)return s.next(0);const{delay:h,repeat:f,repeatType:g,repeatDelay:p,onUpdate:S}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const m=this.currentTime-h*(this.speed>=0?1:-1),v=this.speed>=0?m<0:m>u;this.currentTime=Math.max(m,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let y=this.currentTime,k=s;if(f){const E=Math.min(this.currentTime,u)/d;let D=Math.floor(E),I=E%1;!I&&E>=1&&(I=1),I===1&&D--,D=Math.min(D,f+1),!!(D%2)&&(g==="reverse"?(I=1-I,p&&(I-=p/d)):g==="mirror"&&(k=o)),y=Ln(0,1,I)*d}const b=v?{done:!1,value:c[0]}:k.next(y);a&&(b.value=a(b.value));let{done:w}=b;!v&&l!==null&&(w=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const P=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&w);return P&&r!==void 0&&(b.value=el(c,this.options,r)),S&&S(b.value),P&&this.finish(),b}get duration(){const{resolved:e}=this;return e?An(e.calculatedDuration):0}get time(){return An(this.currentTime)}set time(e){e=In(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=An(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=zx,onPlay:n,startTime:i}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),n&&n();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const qx=new Set(["opacity","clipPath","filter","transform"]);function Hx(t,e,n,{delay:i=0,duration:r=300,repeat:s=0,repeatType:o="loop",ease:a="easeInOut",times:c}={}){const l={[e]:n};c&&(l.offset=c);const u=rb(a,r);return Array.isArray(u)&&(l.easing=u),t.animate(l,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"})}const Kx=bf(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),gc=10,Gx=2e4;function Qx(t){return Nf(t.type)||t.type==="spring"||!ib(t.ease)}function Jx(t,e){const n=new Gf({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:t[0]};const r=[];let s=0;for(;!i.done&&s<Gx;)i=n.sample(s),r.push(i.value),s+=gc;return{times:void 0,keyframes:r,duration:s-gc,ease:"linear"}}const jb={anticipate:gb,backInOut:mb,circInOut:yb};function Yx(t){return t in jb}class sg extends Ob{constructor(e){super(e);const{name:n,motionValue:i,element:r,keyframes:s}=this.options;this.resolver=new Db(s,(o,a)=>this.onKeyframesResolved(o,a),n,i,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:i=300,times:r,ease:s,type:o,motionValue:a,name:c,startTime:l}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof s=="string"&&fc()&&Yx(s)&&(s=jb[s]),Qx(this.options)){const{onComplete:d,onUpdate:h,motionValue:f,element:g,...p}=this.options,S=Jx(e,p);e=S.keyframes,e.length===1&&(e[1]=e[0]),i=S.duration,r=S.times,s=S.ease,o="keyframes"}const u=Hx(a.owner.current,c,e,{...this.options,duration:i,times:r,ease:s});return u.startTime=l??this.calcStartTime(),this.pendingTimeline?($m(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:d}=this.options;a.set(el(e,this.options,n)),d&&d(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:o,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return An(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return An(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.currentTime=In(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return gt;const{animation:i}=n;$m(i,e)}return gt}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:i,duration:r,type:s,ease:o,times:a}=e;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:l,onUpdate:u,onComplete:d,element:h,...f}=this.options,g=new Gf({...f,keyframes:i,duration:r,type:s,ease:o,times:a,isGenerator:!0}),p=In(this.time);l.setWithVelocity(g.sample(p-gc).value,g.sample(p).value,gc)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:i,repeatDelay:r,repeatType:s,damping:o,type:a}=e;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:l}=n.owner.getProps();return Kx()&&i&&qx.has(i)&&!c&&!l&&!r&&s!=="mirror"&&o!==0&&a!=="inertia"}}const Xx={type:"spring",stiffness:500,damping:25,restSpeed:10},Zx=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),eR={type:"keyframes",duration:.8},tR={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},nR=(t,{keyframes:e})=>e.length>2?eR:Xi.has(t)?t.startsWith("scale")?Zx(e[1]):Xx:tR;function iR({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:c,elapsed:l,...u}){return!!Object.keys(u).length}const Qf=(t,e,n,i={},r,s)=>o=>{const a=Mf(i,t)||{},c=a.delay||i.delay||0;let{elapsed:l=0}=i;l=l-In(c);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-l,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:s?void 0:r};iR(a)||(u={...u,...nR(t,u)}),u.duration&&(u.duration=In(u.duration)),u.repeatDelay&&(u.repeatDelay=In(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(d=!0)),d&&!s&&e.get()!==void 0){const h=el(u.keyframes,a);if(h!==void 0)return ue.update(()=>{u.onUpdate(h),u.onComplete()}),new TE([])}return!s&&sg.supports(u)?new sg(u):new Gf(u)};function rR({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function Vb(t,e,{delay:n=0,transitionOverride:i,type:r}={}){var s;let{transition:o=t.getDefaultTransition(),transitionEnd:a,...c}=e;i&&(o=i);const l=[],u=r&&t.animationState&&t.animationState.getState()[r];for(const d in c){const h=t.getValue(d,(s=t.latestValues[d])!==null&&s!==void 0?s:null),f=c[d];if(f===void 0||u&&rR(u,d))continue;const g={delay:n,...Mf(o||{},d)};let p=!1;if(window.MotionHandoffAnimation){const m=ub(t);if(m){const v=window.MotionHandoffAnimation(m,d,ue);v!==null&&(g.startTime=v,p=!0)}}bd(t,d),h.start(Qf(d,h,f,t.shouldReduceMotion&&cb.has(d)?{type:!1}:g,t,p));const S=h.animation;S&&l.push(S)}return a&&Promise.all(l).then(()=>{ue.update(()=>{a&&LE(t,a)})}),l}function xd(t,e,n={}){var i;const r=Zc(t,e,n.type==="exit"?(i=t.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const o=r?()=>Promise.all(Vb(t,r,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(l=0)=>{const{delayChildren:u=0,staggerChildren:d,staggerDirection:h}=s;return sR(t,e,u+l,d,h,n)}:()=>Promise.resolve(),{when:c}=s;if(c){const[l,u]=c==="beforeChildren"?[o,a]:[a,o];return l().then(()=>u())}else return Promise.all([o(),a(n.delay)])}function sR(t,e,n=0,i=0,r=1,s){const o=[],a=(t.variantChildren.size-1)*i,c=r===1?(l=0)=>l*i:(l=0)=>a-l*i;return Array.from(t.variantChildren).sort(oR).forEach((l,u)=>{l.notify("AnimationStart",e),o.push(xd(l,e,{...s,delay:n+c(u)}).then(()=>l.notify("AnimationComplete",e)))}),Promise.all(o)}function oR(t,e){return t.sortNodePosition(e)}function aR(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(s=>xd(t,s,n));i=Promise.all(r)}else if(typeof e=="string")i=xd(t,e,n);else{const r=typeof e=="function"?Zc(t,e,n.custom):e;i=Promise.all(Vb(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}const cR=Tf.length;function Bb(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?Bb(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<cR;n++){const i=Tf[n],r=t.props[i];(vo(r)||r===!1)&&(e[i]=r)}return e}const lR=[...Sf].reverse(),uR=Sf.length;function dR(t){return e=>Promise.all(e.map(({animation:n,options:i})=>aR(t,n,i)))}function hR(t){let e=dR(t),n=og(),i=!0;const r=c=>(l,u)=>{var d;const h=Zc(t,u,c==="exit"?(d=t.presenceContext)===null||d===void 0?void 0:d.custom:void 0);if(h){const{transition:f,transitionEnd:g,...p}=h;l={...l,...p,...g}}return l};function s(c){e=c(t)}function o(c){const{props:l}=t,u=Bb(t.parent)||{},d=[],h=new Set;let f={},g=1/0;for(let S=0;S<uR;S++){const m=lR[S],v=n[m],y=l[m]!==void 0?l[m]:u[m],k=vo(y),b=m===c?v.isActive:null;b===!1&&(g=S);let w=y===u[m]&&y!==l[m]&&k;if(w&&i&&t.manuallyAnimateOnMount&&(w=!1),v.protectedKeys={...f},!v.isActive&&b===null||!y&&!v.prevProp||Yc(y)||typeof y=="boolean")continue;const P=fR(v.prevProp,y);let E=P||m===c&&v.isActive&&!w&&k||S>g&&k,D=!1;const I=Array.isArray(y)?y:[y];let M=I.reduce(r(m),{});b===!1&&(M={});const{prevResolvedValues:V={}}=v,H={...V,...M},ee=J=>{E=!0,h.has(J)&&(D=!0,h.delete(J)),v.needsAnimating[J]=!0;const U=t.getValue(J);U&&(U.liveStyle=!1)};for(const J in H){const U=M[J],z=V[J];if(f.hasOwnProperty(J))continue;let $=!1;vd(U)&&vd(z)?$=!eb(U,z):$=U!==z,$?U!=null?ee(J):h.add(J):U!==void 0&&h.has(J)?ee(J):v.protectedKeys[J]=!0}v.prevProp=y,v.prevResolvedValues=M,v.isActive&&(f={...f,...M}),i&&t.blockInitialAnimation&&(E=!1),E&&(!(w&&P)||D)&&d.push(...I.map(J=>({animation:J,options:{type:m}})))}if(h.size){const S={};h.forEach(m=>{const v=t.getBaseTarget(m),y=t.getValue(m);y&&(y.liveStyle=!0),S[m]=v??null}),d.push({animation:S})}let p=!!d.length;return i&&(l.initial===!1||l.initial===l.animate)&&!t.manuallyAnimateOnMount&&(p=!1),i=!1,p?e(d):Promise.resolve()}function a(c,l){var u;if(n[c].isActive===l)return Promise.resolve();(u=t.variantChildren)===null||u===void 0||u.forEach(h=>{var f;return(f=h.animationState)===null||f===void 0?void 0:f.setActive(c,l)}),n[c].isActive=l;const d=o(c);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>n,reset:()=>{n=og(),i=!0}}}function fR(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!eb(e,t):!1}function Ci(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function og(){return{animate:Ci(!0),whileInView:Ci(),whileHover:Ci(),whileTap:Ci(),whileDrag:Ci(),whileFocus:Ci(),exit:Ci()}}class bi{constructor(e){this.isMounted=!1,this.node=e}update(){}}class pR extends bi{constructor(e){super(e),e.animationState||(e.animationState=hR(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Yc(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let mR=0;class gR extends bi{constructor(){super(...arguments),this.id=mR++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const vR={animation:{Feature:pR},exit:{Feature:gR}};function So(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function No(t){return{point:{x:t.pageX,y:t.pageY}}}const yR=t=>e=>Uf(e)&&t(e,No(e));function Ks(t,e,n,i){return So(t,e,yR(n),i)}const ag=(t,e)=>Math.abs(t-e);function kR(t,e){const n=ag(t.x,e.x),i=ag(t.y,e.y);return Math.sqrt(n**2+i**2)}class zb{constructor(e,n,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=Jl(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,f=kR(d.offset,{x:0,y:0})>=3;if(!h&&!f)return;const{point:g}=d,{timestamp:p}=Ve;this.history.push({...g,timestamp:p});const{onStart:S,onMove:m}=this.handlers;h||(S&&S(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),m&&m(this.lastMoveEvent,d)},this.handlePointerMove=(d,h)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=Ql(h,this.transformPagePoint),ue.update(this.updatePoint,!0)},this.handlePointerUp=(d,h)=>{this.end();const{onEnd:f,onSessionEnd:g,resumeAnimation:p}=this.handlers;if(this.dragSnapToOrigin&&p&&p(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=Jl(d.type==="pointercancel"?this.lastMoveEventInfo:Ql(h,this.transformPagePoint),this.history);this.startEvent&&f&&f(d,S),g&&g(d,S)},!Uf(e))return;this.dragSnapToOrigin=s,this.handlers=n,this.transformPagePoint=i,this.contextWindow=r||window;const o=No(e),a=Ql(o,this.transformPagePoint),{point:c}=a,{timestamp:l}=Ve;this.history=[{...c,timestamp:l}];const{onSessionStart:u}=n;u&&u(e,Jl(a,this.history)),this.removeListeners=Mo(Ks(this.contextWindow,"pointermove",this.handlePointerMove),Ks(this.contextWindow,"pointerup",this.handlePointerUp),Ks(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),fi(this.updatePoint)}}function Ql(t,e){return e?{point:e(t.point)}:t}function cg(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Jl({point:t},e){return{point:t,delta:cg(t,$b(e)),offset:cg(t,bR(e)),velocity:SR(e,.1)}}function bR(t){return t[0]}function $b(t){return t[t.length-1]}function SR(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=$b(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>In(e)));)n--;if(!i)return{x:0,y:0};const s=An(r.timestamp-i.timestamp);if(s===0)return{x:0,y:0};const o={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const Wb=1e-4,TR=1-Wb,CR=1+Wb,qb=.01,wR=0-qb,PR=0+qb;function bt(t){return t.max-t.min}function ER(t,e,n){return Math.abs(t-e)<=n}function lg(t,e,n,i=.5){t.origin=i,t.originPoint=me(e.min,e.max,t.origin),t.scale=bt(n)/bt(e),t.translate=me(n.min,n.max,t.origin)-t.originPoint,(t.scale>=TR&&t.scale<=CR||isNaN(t.scale))&&(t.scale=1),(t.translate>=wR&&t.translate<=PR||isNaN(t.translate))&&(t.translate=0)}function Gs(t,e,n,i){lg(t.x,e.x,n.x,i?i.originX:void 0),lg(t.y,e.y,n.y,i?i.originY:void 0)}function ug(t,e,n){t.min=n.min+e.min,t.max=t.min+bt(e)}function xR(t,e,n){ug(t.x,e.x,n.x),ug(t.y,e.y,n.y)}function dg(t,e,n){t.min=e.min-n.min,t.max=t.min+bt(e)}function Qs(t,e,n){dg(t.x,e.x,n.x),dg(t.y,e.y,n.y)}function RR(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?me(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?me(n,t,i.max):Math.min(t,n)),t}function hg(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function _R(t,{top:e,left:n,bottom:i,right:r}){return{x:hg(t.x,n,r),y:hg(t.y,e,i)}}function fg(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function IR(t,e){return{x:fg(t.x,e.x),y:fg(t.y,e.y)}}function AR(t,e){let n=.5;const i=bt(t),r=bt(e);return r>i?n=Qr(e.min,e.max-i,t.min):i>r&&(n=Qr(t.min,t.max-r,e.min)),Ln(0,1,n)}function DR(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Rd=.35;function OR(t=Rd){return t===!1?t=0:t===!0&&(t=Rd),{x:pg(t,"left","right"),y:pg(t,"top","bottom")}}function pg(t,e,n){return{min:mg(t,e),max:mg(t,n)}}function mg(t,e){return typeof t=="number"?t:t[e]||0}const gg=()=>({translate:0,scale:1,origin:0,originPoint:0}),Tr=()=>({x:gg(),y:gg()}),vg=()=>({min:0,max:0}),Ce=()=>({x:vg(),y:vg()});function Et(t){return[t("x"),t("y")]}function Hb({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function MR({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function NR(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Yl(t){return t===void 0||t===1}function _d({scale:t,scaleX:e,scaleY:n}){return!Yl(t)||!Yl(e)||!Yl(n)}function Ei(t){return _d(t)||Kb(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Kb(t){return yg(t.x)||yg(t.y)}function yg(t){return t&&t!=="0%"}function vc(t,e,n){const i=t-n,r=e*i;return n+r}function kg(t,e,n,i,r){return r!==void 0&&(t=vc(t,r,i)),vc(t,n,i)+e}function Id(t,e=0,n=1,i,r){t.min=kg(t.min,e,n,i,r),t.max=kg(t.max,e,n,i,r)}function Gb(t,{x:e,y:n}){Id(t.x,e.translate,e.scale,e.originPoint),Id(t.y,n.translate,n.scale,n.originPoint)}const bg=.999999999999,Sg=1.0000000000001;function LR(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let s,o;for(let a=0;a<r;a++){s=n[a],o=s.projectionDelta;const{visualElement:c}=s.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&wr(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,Gb(t,o)),i&&Ei(s.latestValues)&&wr(t,s.latestValues))}e.x<Sg&&e.x>bg&&(e.x=1),e.y<Sg&&e.y>bg&&(e.y=1)}function Cr(t,e){t.min=t.min+e,t.max=t.max+e}function Tg(t,e,n,i,r=.5){const s=me(t.min,t.max,r);Id(t,e,n,s,i)}function wr(t,e){Tg(t.x,e.x,e.scaleX,e.scale,e.originX),Tg(t.y,e.y,e.scaleY,e.scale,e.originY)}function Qb(t,e){return Hb(NR(t.getBoundingClientRect(),e))}function UR(t,e,n){const i=Qb(t,n),{scroll:r}=e;return r&&(Cr(i.x,r.offset.x),Cr(i.y,r.offset.y)),i}const Jb=({current:t})=>t?t.ownerDocument.defaultView:null,FR=new WeakMap;class jR{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ce(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(No(u).point)},s=(u,d)=>{const{drag:h,dragPropagation:f,onDragStart:g}=this.getProps();if(h&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=AE(h),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Et(S=>{let m=this.getAxisMotionValue(S).get()||0;if(on.test(m)){const{projection:v}=this.visualElement;if(v&&v.layout){const y=v.layout.layoutBox[S];y&&(m=bt(y)*(parseFloat(m)/100))}}this.originPoint[S]=m}),g&&ue.postRender(()=>g(u,d)),bd(this.visualElement,"transform");const{animationState:p}=this.visualElement;p&&p.setActive("whileDrag",!0)},o=(u,d)=>{const{dragPropagation:h,dragDirectionLock:f,onDirectionLock:g,onDrag:p}=this.getProps();if(!h&&!this.openDragLock)return;const{offset:S}=d;if(f&&this.currentDirection===null){this.currentDirection=VR(S),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",d.point,S),this.updateAxis("y",d.point,S),this.visualElement.render(),p&&p(u,d)},a=(u,d)=>this.stop(u,d),c=()=>Et(u=>{var d;return this.getAnimationState(u)==="paused"&&((d=this.getAxisMotionValue(u).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:l}=this.getProps();this.panSession=new zb(e,{onSessionStart:r,onStart:s,onMove:o,onSessionEnd:a,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:l,contextWindow:Jb(this.visualElement)})}stop(e,n){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&ue.postRender(()=>s(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!sa(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(o=RR(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;n&&br(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=_R(r.layoutBox,n):this.constraints=!1,this.elastic=OR(i),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Et(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=DR(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!br(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=UR(i,r.root,this.visualElement.getTransformPagePoint());let o=IR(r.layout.layoutBox,s);if(n){const a=n(MR(o));this.hasMutatedConstraints=!!a,a&&(o=Hb(a))}return o}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),c=this.constraints||{},l=Et(u=>{if(!sa(u,n,this.currentDirection))return;let d=c&&c[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,f=r?40:1e7,g={type:"inertia",velocity:i?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(u,g)});return Promise.all(l).then(a)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return bd(this.visualElement,e),i.start(Qf(e,i,0,n,this.visualElement,!1))}stopAnimation(){Et(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Et(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){Et(n=>{const{drag:i}=this.getProps();if(!sa(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];s.set(e[n]-me(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!br(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Et(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const c=a.get();r[o]=AR({min:c,max:c},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Et(o=>{if(!sa(o,e,null))return;const a=this.getAxisMotionValue(o),{min:c,max:l}=this.constraints[o];a.set(me(c,l,r[o]))})}addListeners(){if(!this.visualElement.current)return;FR.set(this.visualElement,this);const e=this.visualElement.current,n=Ks(e,"pointerdown",c=>{const{drag:l,dragListener:u=!0}=this.getProps();l&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();br(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),ue.read(i);const o=So(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:c,hasLayoutChanged:l})=>{this.isDragging&&l&&(Et(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=c[u].translate,d.set(d.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),n(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:o=Rd,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function sa(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function VR(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class BR extends bi{constructor(e){super(e),this.removeGroupControls=gt,this.removeListeners=gt,this.controls=new jR(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||gt}unmount(){this.removeGroupControls(),this.removeListeners()}}const Cg=t=>(e,n)=>{t&&ue.postRender(()=>t(e,n))};class zR extends bi{constructor(){super(...arguments),this.removePointerDownListener=gt}onPointerDown(e){this.session=new zb(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Jb(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Cg(e),onStart:Cg(n),onMove:i,onEnd:(s,o)=>{delete this.session,r&&ue.postRender(()=>r(s,o))}}}mount(){this.removePointerDownListener=Ks(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Pa={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function wg(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const bs={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(W.test(t))t=parseFloat(t);else return t;const n=wg(t,e.target.x),i=wg(t,e.target.y);return`${n}% ${i}%`}},$R={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=pi.parse(t);if(r.length>5)return i;const s=pi.createTransformer(t),o=typeof r[0]!="number"?1:0,a=n.x.scale*e.x,c=n.y.scale*e.y;r[0+o]/=a,r[1+o]/=c;const l=me(a,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=l),typeof r[3+o]=="number"&&(r[3+o]/=l),s(r)}};class WR extends T.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:s}=e;uE(qR),s&&(n.group&&n.group.add(s),i&&i.register&&r&&i.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),Pa.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:s}=this.props,o=i.projection;return o&&(o.isPresent=s,r||e.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||ue.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),wf.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Yb(t){const[e,n]=PP(),i=T.useContext(Ok);return A.jsx(WR,{...t,layoutGroup:i,switchLayoutGroup:T.useContext(Bk),isPresent:e,safeToRemove:n})}const qR={borderRadius:{...bs,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:bs,borderTopRightRadius:bs,borderBottomLeftRadius:bs,borderBottomRightRadius:bs,boxShadow:$R};function HR(t,e,n){const i=Ge(t)?t:ko(t);return i.start(Qf("",i,e,n)),i.animation}function KR(t){return t instanceof SVGElement&&t.tagName!=="svg"}const GR=(t,e)=>t.depth-e.depth;class QR{constructor(){this.children=[],this.isDirty=!1}add(e){Ff(this.children,e),this.isDirty=!0}remove(e){jf(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(GR),this.isDirty=!1,this.children.forEach(e)}}function JR(t,e){const n=an.now(),i=({timestamp:r})=>{const s=r-n;s>=e&&(fi(i),t(s-e))};return ue.read(i,!0),()=>fi(i)}const Xb=["TopLeft","TopRight","BottomLeft","BottomRight"],YR=Xb.length,Pg=t=>typeof t=="string"?parseFloat(t):t,Eg=t=>typeof t=="number"||W.test(t);function XR(t,e,n,i,r,s){r?(t.opacity=me(0,n.opacity!==void 0?n.opacity:1,ZR(i)),t.opacityExit=me(e.opacity!==void 0?e.opacity:1,0,e_(i))):s&&(t.opacity=me(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,i));for(let o=0;o<YR;o++){const a=`border${Xb[o]}Radius`;let c=xg(e,a),l=xg(n,a);if(c===void 0&&l===void 0)continue;c||(c=0),l||(l=0),c===0||l===0||Eg(c)===Eg(l)?(t[a]=Math.max(me(Pg(c),Pg(l),i),0),(on.test(l)||on.test(c))&&(t[a]+="%")):t[a]=l}(e.rotate||n.rotate)&&(t.rotate=me(e.rotate||0,n.rotate||0,i))}function xg(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const ZR=Zb(0,.5,vb),e_=Zb(.5,.95,gt);function Zb(t,e,n){return i=>i<t?0:i>e?1:n(Qr(t,e,i))}function Rg(t,e){t.min=e.min,t.max=e.max}function Pt(t,e){Rg(t.x,e.x),Rg(t.y,e.y)}function _g(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function Ig(t,e,n,i,r){return t-=e,t=vc(t,1/n,i),r!==void 0&&(t=vc(t,1/r,i)),t}function t_(t,e=0,n=1,i=.5,r,s=t,o=t){if(on.test(e)&&(e=parseFloat(e),e=me(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=me(s.min,s.max,i);t===s&&(a-=e),t.min=Ig(t.min,e,n,a,r),t.max=Ig(t.max,e,n,a,r)}function Ag(t,e,[n,i,r],s,o){t_(t,e[n],e[i],e[r],e.scale,s,o)}const n_=["x","scaleX","originX"],i_=["y","scaleY","originY"];function Dg(t,e,n,i){Ag(t.x,e,n_,n?n.x:void 0,i?i.x:void 0),Ag(t.y,e,i_,n?n.y:void 0,i?i.y:void 0)}function Og(t){return t.translate===0&&t.scale===1}function eS(t){return Og(t.x)&&Og(t.y)}function Mg(t,e){return t.min===e.min&&t.max===e.max}function r_(t,e){return Mg(t.x,e.x)&&Mg(t.y,e.y)}function Ng(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function tS(t,e){return Ng(t.x,e.x)&&Ng(t.y,e.y)}function Lg(t){return bt(t.x)/bt(t.y)}function Ug(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class s_{constructor(){this.members=[]}add(e){Ff(this.members,e),e.scheduleRender()}remove(e){if(jf(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){i=s;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function o_(t,e,n){let i="";const r=t.x.translate/e.x,s=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((r||s||o)&&(i=`translate3d(${r}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:l,rotate:u,rotateX:d,rotateY:h,skewX:f,skewY:g}=n;l&&(i=`perspective(${l}px) ${i}`),u&&(i+=`rotate(${u}deg) `),d&&(i+=`rotateX(${d}deg) `),h&&(i+=`rotateY(${h}deg) `),f&&(i+=`skewX(${f}deg) `),g&&(i+=`skewY(${g}deg) `)}const a=t.x.scale*e.x,c=t.y.scale*e.y;return(a!==1||c!==1)&&(i+=`scale(${a}, ${c})`),i||"none"}const xi={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Ms=typeof window<"u"&&window.MotionDebug!==void 0,Xl=["","X","Y","Z"],a_={visibility:"hidden"},Fg=1e3;let c_=0;function Zl(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function nS(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=ub(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:s}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",ue,!(r||s))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&nS(i)}function iS({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=c_++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ms&&(xi.totalNodes=xi.resolvedTargetDeltas=xi.recalculatedProjection=0),this.nodes.forEach(d_),this.nodes.forEach(g_),this.nodes.forEach(v_),this.nodes.forEach(h_),Ms&&window.MotionDebug.record(xi)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new QR)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Vf),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const c=this.eventHandlers.get(o);c&&c.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=KR(o),this.instance=o;const{layoutId:c,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(l||c)&&(this.isLayoutDirty=!0),t){let d;const h=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=JR(h,250),Pa.hasAnimatedSinceResize&&(Pa.hasAnimatedSinceResize=!1,this.nodes.forEach(Vg))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeTargetChanged:f,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||u.getDefaultTransition()||T_,{onLayoutAnimationStart:S,onLayoutAnimationComplete:m}=u.getProps(),v=!this.targetLayout||!tS(this.targetLayout,g)||f,y=!h&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||y||h&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,y);const k={...Mf(p,"layout"),onPlay:S,onComplete:m};(u.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k)}else h||Vg(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,fi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(y_),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&nS(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:c}=this.options;if(a===void 0&&!c)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(jg);return}this.isUpdating||this.nodes.forEach(p_),this.isUpdating=!1,this.nodes.forEach(m_),this.nodes.forEach(l_),this.nodes.forEach(u_),this.clearAllSnapshots();const a=an.now();Ve.delta=Ln(0,1e3/60,a-Ve.timestamp),Ve.timestamp=a,Ve.isProcessing=!0,$l.update.process(Ve),$l.preRender.process(Ve),$l.render.process(Ve),Ve.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,wf.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(f_),this.sharedNodes.forEach(k_)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ue.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ue.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ce(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!eS(this.projectionDelta),c=this.getTransformTemplate(),l=c?c(this.latestValues,""):void 0,u=l!==this.prevTransformTemplateValue;o&&(a||Ei(this.latestValues)||u)&&(r(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let c=this.removeElementScroll(a);return o&&(c=this.removeTransform(c)),C_(c),{animationId:this.root.animationId,measuredBox:a,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Ce();const c=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(w_))){const{scroll:u}=this.root;u&&(Cr(c.x,u.offset.x),Cr(c.y,u.offset.y))}return c}removeElementScroll(o){var a;const c=Ce();if(Pt(c,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return c;for(let l=0;l<this.path.length;l++){const u=this.path[l],{scroll:d,options:h}=u;u!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&Pt(c,o),Cr(c.x,d.offset.x),Cr(c.y,d.offset.y))}return c}applyTransform(o,a=!1){const c=Ce();Pt(c,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&wr(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Ei(u.latestValues)&&wr(c,u.latestValues)}return Ei(this.latestValues)&&wr(c,this.latestValues),c}removeTransform(o){const a=Ce();Pt(a,o);for(let c=0;c<this.path.length;c++){const l=this.path[c];if(!l.instance||!Ei(l.latestValues))continue;_d(l.latestValues)&&l.updateSnapshot();const u=Ce(),d=l.measurePageBox();Pt(u,d),Dg(a,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,u)}return Ei(this.latestValues)&&Dg(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ve.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==c;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=Ve.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ce(),this.relativeTargetOrigin=Ce(),Qs(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Pt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ce(),this.targetWithTransforms=Ce()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),xR(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pt(this.target,this.layout.layoutBox),Gb(this.target,this.targetDelta)):Pt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ce(),this.relativeTargetOrigin=Ce(),Qs(this.relativeTargetOrigin,this.target,f.target),Pt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ms&&xi.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||_d(this.parent.latestValues)||Kb(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),c=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(l=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Ve.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Pt(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;LR(this.layoutCorrected,this.treeScale,this.path,c),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Ce());const{target:g}=a;if(!g){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(_g(this.prevProjectionDelta.x,this.projectionDelta.x),_g(this.prevProjectionDelta.y,this.projectionDelta.y)),Gs(this.projectionDelta,this.layoutCorrected,g,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!Ug(this.projectionDelta.x,this.prevProjectionDelta.x)||!Ug(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),Ms&&xi.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Tr(),this.projectionDelta=Tr(),this.projectionDeltaWithTransform=Tr()}setAnimationOrigin(o,a=!1){const c=this.snapshot,l=c?c.latestValues:{},u={...this.latestValues},d=Tr();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ce(),f=c?c.source:void 0,g=this.layout?this.layout.source:void 0,p=f!==g,S=this.getStack(),m=!S||S.members.length<=1,v=!!(p&&!m&&this.options.crossfade===!0&&!this.path.some(S_));this.animationProgress=0;let y;this.mixTargetDelta=k=>{const b=k/1e3;Bg(d.x,o.x,b),Bg(d.y,o.y,b),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Qs(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),b_(this.relativeTarget,this.relativeTargetOrigin,h,b),y&&r_(this.relativeTarget,y)&&(this.isProjectionDirty=!1),y||(y=Ce()),Pt(y,this.relativeTarget)),p&&(this.animationValues=u,XR(u,l,this.latestValues,b,v,m)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(fi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ue.update(()=>{Pa.hasAnimatedSinceResize=!0,this.currentAnimation=HR(0,Fg,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Fg),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:c,layout:l,latestValues:u}=o;if(!(!a||!c||!l)){if(this!==o&&this.layout&&l&&rS(this.options.animationType,this.layout.layoutBox,l.layoutBox)){c=this.target||Ce();const d=bt(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+d;const h=bt(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}Pt(a,c),wr(a,u),Gs(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new s_),this.sharedNodes.get(o).add(a);const l=a.options.initialPromotionConfig;a.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:c}={}){const l=this.getStack();l&&l.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(a=!0),!a)return;const l={};c.z&&Zl("z",o,l,this.animationValues);for(let u=0;u<Xl.length;u++)Zl(`rotate${Xl[u]}`,o,l,this.animationValues),Zl(`skew${Xl[u]}`,o,l,this.animationValues);o.render();for(const u in l)o.setStaticValue(u,l[u]),this.animationValues&&(this.animationValues[u]=l[u]);o.scheduleRender()}getProjectionStyles(o){var a,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return a_;const l={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,l.opacity="",l.pointerEvents=Ca(o==null?void 0:o.pointerEvents)||"",l.transform=u?u(this.latestValues,""):"none",l;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const p={};return this.options.layoutId&&(p.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,p.pointerEvents=Ca(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Ei(this.latestValues)&&(p.transform=u?u({},""):"none",this.hasProjected=!1),p}const h=d.animationValues||d.latestValues;this.applyTransformsToTarget(),l.transform=o_(this.projectionDeltaWithTransform,this.treeScale,h),u&&(l.transform=u(h,l.transform));const{x:f,y:g}=this.projectionDelta;l.transformOrigin=`${f.origin*100}% ${g.origin*100}% 0`,d.animationValues?l.opacity=d===this?(c=(a=h.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:l.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const p in hc){if(h[p]===void 0)continue;const{correct:S,applyTo:m}=hc[p],v=l.transform==="none"?h[p]:S(h[p],d);if(m){const y=m.length;for(let k=0;k<y;k++)l[m[k]]=v}else l[p]=v}return this.options.layoutId&&(l.pointerEvents=d===this?Ca(o==null?void 0:o.pointerEvents)||"":"none"),l}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(jg),this.root.sharedNodes.clear()}}}function l_(t){t.updateLayout()}function u_(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=t.layout,{animationType:s}=t.options,o=n.source!==t.layout.source;s==="size"?Et(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=bt(h);h.min=i[d].min,h.max=h.min+f}):rS(s,n.layoutBox,i)&&Et(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=bt(i[d]);h.max=h.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+f)});const a=Tr();Gs(a,i,n.layoutBox);const c=Tr();o?Gs(c,t.applyTransform(r,!0),n.measuredBox):Gs(c,i,n.layoutBox);const l=!eS(a);let u=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const g=Ce();Qs(g,n.layoutBox,h.layoutBox);const p=Ce();Qs(p,i,f.layoutBox),tS(g,p)||(u=!0),d.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=g,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:n,delta:c,layoutDelta:a,hasLayoutChanged:l,hasRelativeTargetChanged:u})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function d_(t){Ms&&xi.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function h_(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function f_(t){t.clearSnapshot()}function jg(t){t.clearMeasurements()}function p_(t){t.isLayoutDirty=!1}function m_(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Vg(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function g_(t){t.resolveTargetDelta()}function v_(t){t.calcProjection()}function y_(t){t.resetSkewAndRotation()}function k_(t){t.removeLeadSnapshot()}function Bg(t,e,n){t.translate=me(e.translate,0,n),t.scale=me(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function zg(t,e,n,i){t.min=me(e.min,n.min,i),t.max=me(e.max,n.max,i)}function b_(t,e,n,i){zg(t.x,e.x,n.x,i),zg(t.y,e.y,n.y,i)}function S_(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const T_={duration:.45,ease:[.4,0,.1,1]},$g=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Wg=$g("applewebkit/")&&!$g("chrome/")?Math.round:gt;function qg(t){t.min=Wg(t.min),t.max=Wg(t.max)}function C_(t){qg(t.x),qg(t.y)}function rS(t,e,n){return t==="position"||t==="preserve-aspect"&&!ER(Lg(e),Lg(n),.2)}function w_(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const P_=iS({attachResizeListener:(t,e)=>So(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),eu={current:void 0},sS=iS({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!eu.current){const t=new P_({});t.mount(window),t.setOptions({layoutScroll:!0}),eu.current=t}return eu.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),E_={pan:{Feature:zR},drag:{Feature:BR,ProjectionNode:sS,MeasureLayout:Yb}};function Hg(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,s=i[r];s&&ue.postRender(()=>s(e,No(e)))}class x_ extends bi{mount(){const{current:e}=this.node;e&&(this.unmount=EE(e,n=>(Hg(this.node,n,"Start"),i=>Hg(this.node,i,"End"))))}unmount(){}}class R_ extends bi{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Mo(So(this.node.current,"focus",()=>this.onFocus()),So(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Kg(t,e,n){const{props:i}=t;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),s=i[r];s&&ue.postRender(()=>s(e,No(e)))}class __ extends bi{mount(){const{current:e}=this.node;e&&(this.unmount=IE(e,n=>(Kg(this.node,n,"Start"),(i,{success:r})=>Kg(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ad=new WeakMap,tu=new WeakMap,I_=t=>{const e=Ad.get(t.target);e&&e(t)},A_=t=>{t.forEach(I_)};function D_({root:t,...e}){const n=t||document;tu.has(n)||tu.set(n,{});const i=tu.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(A_,{root:t,...e})),i[r]}function O_(t,e,n){const i=D_(e);return Ad.set(t,n),i.observe(t),()=>{Ad.delete(t),i.unobserve(t)}}const M_={some:0,all:1};class N_ extends bi{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:s}=e,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:M_[r]},a=c=>{const{isIntersecting:l}=c;if(this.isInView===l||(this.isInView=l,s&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=l?u:d;h&&h(c)};return O_(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(L_(e,n))&&this.startObserver()}unmount(){}}function L_({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const U_={inView:{Feature:N_},tap:{Feature:__},focus:{Feature:R_},hover:{Feature:x_}},F_={layout:{ProjectionNode:sS,MeasureLayout:Yb}},Dd={current:null},oS={current:!1};function j_(){if(oS.current=!0,!!kf)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Dd.current=t.matches;t.addListener(e),e()}else Dd.current=!1}const V_=[...Ab,He,pi],B_=t=>V_.find(Ib(t)),Gg=new WeakMap;function z_(t,e,n){for(const i in e){const r=e[i],s=n[i];if(Ge(r))t.addValue(i,r);else if(Ge(s))t.addValue(i,ko(r,{owner:t}));else if(s!==r)if(t.hasValue(i)){const o=t.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(i);t.addValue(i,ko(o!==void 0?o:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const Qg=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class $_{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Hf,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=an.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,ue.render(this.render,!1,!0))};const{latestValues:c,renderState:l,onUpdate:u}=o;this.onUpdate=u,this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=Xc(n),this.isVariantNode=jk(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in h){const g=h[f];c[f]!==void 0&&Ge(g)&&g.set(c[f],!1)}}mount(e){this.current=e,Gg.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),oS.current||j_(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Dd.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Gg.delete(this.current),this.projection&&this.projection.unmount(),fi(this.notifyUpdate),fi(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Xi.has(e),r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&ue.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),s=n.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),s(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Jr){const n=Jr[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ce()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Qg.length;i++){const r=Qg[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,o=e[s];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=z_(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=ko(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){var i;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(i=this.getBaseTargetFromProps(this.props,e))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(Rb(r)||kb(r))?r=parseFloat(r):!B_(r)&&pi.test(n)&&(r=Pb(e,n)),this.setBaseTarget(e,Ge(r)?r.get():r)),Ge(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const o=Ef(this.props,i,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);o&&(r=o[e])}if(i&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!Ge(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Vf),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class aS extends $_{constructor(){super(...arguments),this.KeyframeResolver=Db}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ge(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function W_(t){return window.getComputedStyle(t)}class q_ extends aS{constructor(){super(...arguments),this.type="html",this.renderInstance=Gk}readValueFromInstance(e,n){if(Xi.has(n)){const i=qf(n);return i&&i.default||0}else{const i=W_(e),r=(qk(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return Qb(e,n)}build(e,n,i){_f(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return Of(e,n,i)}}class H_ extends aS{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ce}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Xi.has(n)){const i=qf(n);return i&&i.default||0}return n=Qk.has(n)?n:Cf(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return Xk(e,n,i)}build(e,n,i){If(e,n,this.isSVGTag,i.transformTemplate)}renderInstance(e,n,i,r){Jk(e,n,i,r)}mount(e){this.isSVGTag=Df(e.tagName),super.mount(e)}}const K_=(t,e)=>Pf(t)?new H_(e):new q_(e,{allowProjection:t!==T.Fragment}),G_=kE({...vR,...U_,...E_,...F_},K_),rr=MP(G_);function Q_(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var J_=Object.defineProperty,Y_=(t,e,n)=>e in t?J_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jg=(t,e,n)=>Y_(t,typeof e!="symbol"?e+"":e,n);let Ye=class{constructor(){Jg(this,"_locking"),Jg(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function Se(t,e){if(!t)throw new Error(e)}const X_=34028234663852886e22,Z_=-34028234663852886e22,eI=4294967295,tI=2147483647,nI=-2147483648;function Ea(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>tI||t<nI)throw new Error("invalid int 32: "+t)}function Od(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>eI||t<0)throw new Error("invalid uint 32: "+t)}function cS(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>X_||t<Z_))throw new Error("invalid float 32: "+t)}const lS=Symbol("@bufbuild/protobuf/enum-type");function iI(t){const e=t[lS];return Se(e,"missing enum type on enum object"),e}function uS(t,e,n,i){t[lS]=dS(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function dS(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=hS(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function rI(t,e,n){const i={};for(const r of e){const s=hS(r);i[s.localName]=s.no,i[s.no]=s.localName}return uS(i,t,e),i}function hS(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Jf{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function sI(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Jf),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function oI(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function nu(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const xa=4294967296;function Yg(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=xa&&(r=r+(i/xa|0),i=i%xa)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?pS(i,r):Yf(i,r)}function aI(t,e){let n=Yf(t,e);const i=n.hi&2147483648;i&&(n=pS(n.lo,n.hi));const r=fS(n.lo,n.hi);return i?"-"+r:r}function fS(t,e){if({lo:t,hi:e}=cI(t,e),e<=2097151)return String(xa*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+Xg(o)+Xg(s)}function cI(t,e){return{lo:t>>>0,hi:e>>>0}}function Yf(t,e){return{lo:t|0,hi:e|0}}function pS(t,e){return e=~e,t?t=~t+1:e+=1,Yf(t,e)}const Xg=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Zg(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function lI(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function uI(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>Se(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Se(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Yg(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Yg(r)},dec(r,s){return aI(r,s)},uDec(r,s){return fS(r,s)}}}const fe=uI();var N;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(N||(N={}));var mi;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(mi||(mi={}));function $n(t,e,n){if(e===n)return!0;if(t==N.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case N.UINT64:case N.FIXED64:case N.INT64:case N.SFIXED64:case N.SINT64:return e==n}return!1}function Xr(t,e){switch(t){case N.BOOL:return!1;case N.UINT64:case N.FIXED64:case N.INT64:case N.SFIXED64:case N.SINT64:return e==0?fe.zero:"0";case N.DOUBLE:case N.FLOAT:return 0;case N.BYTES:return new Uint8Array(0);case N.STRING:return"";default:return 0}}function mS(t,e){switch(t){case N.BOOL:return e===!1;case N.STRING:return e==="";case N.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Pe;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Pe||(Pe={}));class dI{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Od(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Ea(e),Zg(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){cS(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Od(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Ea(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Ea(e),e=(e<<1^e>>31)>>>0,Zg(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=fe.enc(e);return nu(n.lo,n.hi,this.buf),this}sint64(e){let n=fe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return nu(r,s,this.buf),this}uint64(e){let n=fe.uEnc(e);return nu(n.lo,n.hi,this.buf),this}}class hI{constructor(e,n){this.varint64=oI,this.uint32=lI,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Pe.Varint:for(;this.buf[this.pos++]&128;);break;case Pe.Bit64:this.pos+=4;case Pe.Bit32:this.pos+=4;break;case Pe.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Pe.StartGroup:for(;;){const[s,o]=this.tag();if(o===Pe.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return fe.dec(...this.varint64())}uint64(){return fe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,fe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return fe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return fe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function fI(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function gS(t){const e=t.field.localName,n=Object.create(null);return n[e]=pI(t),[n,()=>n[e]]}function pI(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Xr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function mI(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),tl=[];for(let t=0;t<Cn.length;t++)tl[Cn[t].charCodeAt(0)]=t;tl["-".charCodeAt(0)]=Cn.indexOf("+");tl["_".charCodeAt(0)]=Cn.indexOf("/");const vS={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=tl[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Cn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Cn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Cn[r|i>>6],e+=Cn[i&63],n=0;break}return n&&(e+=Cn[r],e+="=",n==1&&(e+="=")),e}};function gI(t,e,n){kS(e,t);const i=e.runtime.bin.makeReadOptions(n),r=mI(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=gS(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function vI(t,e,n,i){kS(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(yS(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function yS(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function kS(t,e){Se(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function bS(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!mS(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function ev(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Xr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function wn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Jf.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function SS(t,e){return wn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}N.DOUBLE,N.FLOAT,N.INT64,N.UINT64,N.INT32,N.UINT32,N.BOOL,N.STRING,N.BYTES;const tv={ignoreUnknownFields:!1},nv={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function yI(t){return t?Object.assign(Object.assign({},tv),t):tv}function kI(t){return t?Object.assign(Object.assign({},nv),t):nv}const yc=Symbol(),Ra=Symbol();function bI(){return{makeReadOptions:yI,makeWriteOptions:kI,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(en(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}iv(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=gS(u);iv(d,a,u.field,n,u),vI(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!bS(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!TI(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=rv(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&yS(t,a)){const c=gI(t,a,e),l=rv(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Js(t,e,n??mi.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||mS(t,e)))return _a(t,e)},debug:en}}function en(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function iv(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Se(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=iu(n.T,a,i.ignoreUnknownFields,!0);c!==Ra&&o.push(c);break;case"scalar":try{o.push(Js(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=SI(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=iu(n.V.T,c,i.ignoreUnknownFields,!0);u!==Ra&&(o[l]=u);break;case"scalar":try{o[l]=Js(n.V.T,c,mi.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];wn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=iu(n.T,e,i.ignoreUnknownFields,!1);switch(c){case yc:ev(n,t);break;case Ra:break;default:t[s]=c;break}break;case"scalar":try{const l=Js(n.T,e,n.L,!1);switch(l){case yc:ev(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function SI(t,e){if(t===N.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Js(t,e,mi.BIGINT,!0).toString()}function Js(t,e,n,i){if(e===null)return i?Xr(t,n):yc;switch(t){case N.DOUBLE:case N.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==N.FLOAT&&cS(r),r;case N.INT32:case N.FIXED32:case N.SFIXED32:case N.SINT32:case N.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==N.UINT32||t==N.FIXED32?Od(s):Ea(s),s;case N.INT64:case N.SFIXED64:case N.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=fe.parse(e);return n?o.toString():o;case N.FIXED64:case N.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=fe.uParse(e);return n?a.toString():a;case N.BOOL:if(typeof e!="boolean")break;return e;case N.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case N.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return vS.dec(e)}throw new Error}function iu(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:yc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Ra;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(en(e)))}function TI(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function rv(t,e,n){if(t.kind=="map"){Se(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=_a(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=ru(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Se(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(_a(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(ru(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return _a(t.T,e);case"enum":return ru(t.T,e,n.enumAsInteger);case"message":return SS(t.T,e).toJson(n)}}function ru(t,e,n){var i;if(Se(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function _a(t,e){switch(t){case N.INT32:case N.SFIXED32:case N.SINT32:case N.FIXED32:case N.UINT32:return Se(typeof e=="number"),e;case N.FLOAT:case N.DOUBLE:return Se(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case N.STRING:return Se(typeof e=="string"),e;case N.BOOL:return Se(typeof e=="boolean"),e;case N.UINT64:case N.FIXED64:case N.INT64:case N.SFIXED64:case N.SINT64:return Se(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case N.BYTES:return Se(e instanceof Uint8Array),vS.enc(e)}}const sr=Symbol("@bufbuild/protobuf/unknown-fields"),sv={readUnknownFields:!0,readerFactory:t=>new hI(t)},ov={writeUnknownFields:!0,writerFactory:()=>new dI};function CI(t){return t?Object.assign(Object.assign({},sv),t):sv}function wI(t){return t?Object.assign(Object.assign({},ov),t):ov}function PI(){return{makeReadOptions:CI,makeWriteOptions:wI,listUnknownFields(t){var e;return(e=t[sr])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[sr]},writeUnknownFields(t,e){const i=t[sr];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[sr])||(r[sr]=[]),r[sr].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==Pe.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}av(t,e,l,c,i)}if(r&&(c!=Pe.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:av,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!bS(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];cv(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&cv(t,e,n,i)}}}function av(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?N.INT32:n.T;let c=kc;if(n.kind=="scalar"&&n.L>0&&(c=xI),s){let h=t[o];if(i==Pe.LengthDelimited&&a!=N.STRING&&a!=N.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(Ia(e,new l,r,n)):wn(t[o])?Ia(e,t[o],r,n):(t[o]=Ia(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=EI(n,e,r);t[o][u]=d;break}}function Ia(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function EI(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=kc(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=kc(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Ia(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Xr(t.K,mi.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Xr(t.V.T,mi.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function xI(t,e){const n=kc(t,e);return typeof n=="bigint"?n.toString():n}function kc(t,e){switch(e){case N.STRING:return t.string();case N.BOOL:return t.bool();case N.DOUBLE:return t.double();case N.FLOAT:return t.float();case N.INT32:return t.int32();case N.INT64:return t.int64();case N.UINT64:return t.uint64();case N.FIXED64:return t.fixed64();case N.BYTES:return t.bytes();case N.FIXED32:return t.fixed32();case N.SFIXED32:return t.sfixed32();case N.SFIXED64:return t.sfixed64();case N.SINT64:return t.sint64();case N.UINT32:return t.uint32();case N.SINT32:return t.sint32()}}function cv(t,e,n,i){Se(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?N.INT32:t.T;if(r)if(Se(Array.isArray(e)),t.packed)_I(n,s,t.no,e);else for(const o of e)Ys(n,s,t.no,o);else Ys(n,s,t.no,e);break;case"message":if(r){Se(Array.isArray(e));for(const o of e)lv(n,i,t,o)}else lv(n,i,t,e);break;case"map":Se(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))RI(n,i,t,o,a);break}}function RI(t,e,n,i,r){t.tag(n.no,Pe.LengthDelimited),t.fork();let s=i;switch(n.K){case N.INT32:case N.FIXED32:case N.UINT32:case N.SFIXED32:case N.SINT32:s=Number.parseInt(i);break;case N.BOOL:Se(i=="true"||i=="false"),s=i=="true";break}switch(Ys(t,n.K,1,s),n.V.kind){case"scalar":Ys(t,n.V.T,2,r);break;case"enum":Ys(t,N.INT32,2,r);break;case"message":Se(r!==void 0),t.tag(2,Pe.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function lv(t,e,n,i){const r=SS(n.T,i);n.delimited?t.tag(n.no,Pe.StartGroup).raw(r.toBinary(e)).tag(n.no,Pe.EndGroup):t.tag(n.no,Pe.LengthDelimited).bytes(r.toBinary(e))}function Ys(t,e,n,i){Se(i!==void 0);let[r,s]=TS(e);t.tag(n,r)[s](i)}function _I(t,e,n,i){if(!i.length)return;t.tag(n,Pe.LengthDelimited).fork();let[,r]=TS(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function TS(t){let e=Pe.Varint;switch(t){case N.BYTES:case N.STRING:e=Pe.LengthDelimited;break;case N.DOUBLE:case N.FIXED64:case N.SFIXED64:e=Pe.Bit64;break;case N.FIXED32:case N.SFIXED32:case N.FLOAT:e=Pe.Bit32;break}const n=N[t].toLowerCase();return[e,n]}function II(){return{setEnumType:uS,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!wn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===N.BYTES&&(l=Ss(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===N.BYTES&&(u=i.repeated?u.map(Ss):Ss(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===N.BYTES)for(const[f,g]of Object.entries(o[r]))s[r][f]=Ss(g);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(o[r])){let g=o[r][f];h.fieldWrapper||(g=new h(g)),s[r][f]=g}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>wn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=Ss(h):s[r]=h:s[r]=wn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>$n(i.T,o,s[a]));case"enum":return r.every((o,a)=>$n(N.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!wn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!wn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return $n(N.INT32,r,s);case"scalar":return $n(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return $n(N.INT32,r.value,s.value);case"scalar":return $n(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(h=>u.equals(r[h],s[h]));case"enum":return l.every(h=>$n(N.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return l.every(h=>$n(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(oa);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=oa(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:oa(s.value)}:{case:void 0}:o=oa(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function oa(t){if(t===void 0)return t;if(wn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Ss(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function AI(t,e,n){return{syntax:t,json:bI(),bin:PI(),util:Object.assign(Object.assign({},II()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return sI(this,i,r,s)},makeEnum:rI,makeEnumType:dS,getEnumType:iI,makeExtension(i,r,s){return fI(this,i,r,s)}}}class DI{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function CS(t,e){const n=wS(t);return e?n:FI(UI(n))}function OI(t){return CS(t,!1)}const MI=wS;function wS(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const NI=new Set(["constructor","toString","toJSON","valueOf"]),LI=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),PS=t=>"".concat(t,"$"),UI=t=>LI.has(t)?PS(t):t,FI=t=>NI.has(t)?PS(t):t;class jI{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=OI(e)}addField(e){Se(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function VI(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=CS(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:MI(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:mi.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=N.BYTES&&u.T!=N.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new jI(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const R=AI("proto3",t=>new DI(t,e=>VI(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Xr(e.T,e.L);break}}});class it extends Jf{constructor(e){super(),this.seconds=fe.zero,this.nanos=0,R.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(R.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=fe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return it.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new it({seconds:fe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new it().fromBinary(e,n)}static fromJson(e,n){return new it().fromJson(e,n)}static fromJsonString(e,n){return new it().fromJsonString(e,n)}static equals(e,n){return R.util.equals(it,e,n)}}it.runtime=R;it.typeName="google.protobuf.Timestamp";it.fields=R.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const BI=R.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:it},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:zI,repeated:!0},{no:5,name:"events",kind:"message",T:WI,repeated:!0}]),zI=R.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:$I,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),$I=R.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:it},{no:3,name:"value",kind:"scalar",T:2}]),WI=R.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:it},{no:7,name:"normalized_end_timestamp",kind:"message",T:it,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),ES=R.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),zt=R.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),xe=R.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Xf=R.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Ns=R.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),To=R.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Wt=R.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),or=R.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),qI=R.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Le=R.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),nl=R.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:bc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:jS}]),bc=R.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),HI=R.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:R.getEnumType(xe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Wi=R.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(Mr)},{no:4,name:"tracks",kind:"message",T:Pr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:HI},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:R.getEnumType(qi)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:R.getEnumType(Wt)},{no:18,name:"kind_details",kind:"enum",T:R.getEnumType(KI),repeated:!0}]),Mr=R.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),qi=R.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),KI=R.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ht=R.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),GI=R.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Li,repeated:!0}]),Pr=R.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:R.getEnumType(zt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:R.getEnumType(xe)},{no:10,name:"layers",kind:"message",T:Li,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:GI,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:R.getEnumType(ht)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:jS},{no:19,name:"audio_features",kind:"enum",T:R.getEnumType(Le),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(ES)}]),Li=R.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Xf)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),tt=R.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:R.getEnumType(q)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:RS,oneof:"value"},{no:3,name:"speaker",kind:"message",T:QI,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:_S,oneof:"value"},{no:7,name:"transcription",kind:"message",T:JI,oneof:"value"},{no:8,name:"metrics",kind:"message",T:BI,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Md,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:IS,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:AS,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:DS,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Ld,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ud,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Fd,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),q=R.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),QI=R.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:xS,repeated:!0}]),xS=R.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),RS=R.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),_S=R.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),JI=R.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:YI,repeated:!0}]),YI=R.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Md=R.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),IS=R.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),AS=R.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),DS=R.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:OS,oneof:"value"}]),OS=R.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),MS=R.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),NS=R.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:R.getEnumType(LS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),LS=R.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),XI=R.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:R.getEnumType(US)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),US=R.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),FS=R.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:uv},{no:2,name:"screen",kind:"message",T:uv},{no:3,name:"resume_connection",kind:"enum",T:R.getEnumType(To)},{no:4,name:"disabled_codecs",kind:"message",T:ZI},{no:5,name:"force_relay",kind:"enum",T:R.getEnumType(To)}]),uv=R.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:R.getEnumType(To)}]),ZI=R.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:bc,repeated:!0},{no:2,name:"publish",kind:"message",T:bc,repeated:!0}]),jS=R.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Nd=R.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),VS=R.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:R.getEnumType(Nd)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),BS=R.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Ld=R.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:R.getEnumType(ht)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:VS,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:BS,oneof:"content_header"}],{localName:"DataStream_Header"}),Ud=R.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Fd=R.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),$t=R.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),jd=R.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),eA=R.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),tA=R.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Hi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Zf,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Bd,oneof:"message"},{no:5,name:"mute",kind:"message",T:ep,oneof:"message"},{no:6,name:"subscription",kind:"message",T:il,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:zS,oneof:"message"},{no:8,name:"leave",kind:"message",T:rl,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:WS,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:GS,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:QS,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Xt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:qS,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:XS,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:$S,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:oA,oneof:"message"}]),dv=R.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:nA,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Hi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Zf,oneof:"message"},{no:5,name:"update",kind:"message",T:sA,oneof:"message"},{no:6,name:"track_published",kind:"message",T:tp,oneof:"message"},{no:8,name:"leave",kind:"message",T:rl,oneof:"message"},{no:9,name:"mute",kind:"message",T:ep,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:aA,oneof:"message"},{no:11,name:"room_update",kind:"message",T:cA,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:uA,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:hA,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:pA,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:mA,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:rA,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:iA,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:vA,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:bA,oneof:"message"},{no:22,name:"request_response",kind:"message",T:SA,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:TA,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:gA,oneof:"message"}]),Vd=R.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),Bd=R.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:R.getEnumType(zt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:R.getEnumType(xe)},{no:9,name:"layers",kind:"message",T:Li,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Vd,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:R.getEnumType(ht)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(ES)},{no:17,name:"audio_features",kind:"enum",T:R.getEnumType(Le),repeated:!0}]),Zf=R.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:R.getEnumType($t)},{no:3,name:"final",kind:"scalar",T:8}]),ep=R.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),nA=R.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:nl},{no:2,name:"participant",kind:"message",T:Wi},{no:3,name:"other_participants",kind:"message",T:Wi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:HS,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:FS},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:NS},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:bc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),iA=R.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:HS,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:FS},{no:3,name:"server_info",kind:"message",T:NS},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),tp=R.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Pr}]),rA=R.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Hi=R.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),sA=R.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Wi,repeated:!0}]),il=R.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:MS,repeated:!0}]),zS=R.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:R.getEnumType(Xf)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),$S=R.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:R.getEnumType(Le),repeated:!0}]),oA=R.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),rl=R.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:R.getEnumType(Wt)},{no:3,name:"action",kind:"enum",T:R.getEnumType(Nr)},{no:4,name:"regions",kind:"message",T:yA}]),Nr=R.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),WS=R.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Li,repeated:!0}]),qS=R.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),HS=R.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),aA=R.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:xS,repeated:!0}]),cA=R.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:nl}]),lA=R.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:R.getEnumType(Ns)},{no:3,name:"score",kind:"scalar",T:2}]),uA=R.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:lA,repeated:!0}]),dA=R.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(jd)}]),hA=R.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:dA,repeated:!0}]),np=R.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Xf)},{no:2,name:"enabled",kind:"scalar",T:8}]),fA=R.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:np,repeated:!0}]),pA=R.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:np,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:fA,repeated:!0}]),KS=R.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),GS=R.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:KS,repeated:!0}]),mA=R.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),gA=R.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:nl},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Wi},{no:4,name:"other_participants",kind:"message",T:Wi,repeated:!0}]),QS=R.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Hi},{no:2,name:"subscription",kind:"message",T:il},{no:3,name:"publish_tracks",kind:"message",T:tp,repeated:!0},{no:4,name:"data_channels",kind:"message",T:YS,repeated:!0},{no:5,name:"offer",kind:"message",T:Hi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:JS,repeated:!0}]),JS=R.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),YS=R.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:R.getEnumType($t)}]),Xt=R.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:R.getEnumType(eA),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),XS=R.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),vA=R.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),yA=R.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:kA,repeated:!0}]),kA=R.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),bA=R.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:R.getEnumType(qI)}]),SA=R.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:R.getEnumType(ip)},{no:3,name:"message",kind:"scalar",T:9}]),ip=R.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),TA=R.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function CA(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Aa={exports:{}},wA=Aa.exports,hv;function PA(){return hv||(hv=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(wA,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(p,S){var m=p[S];if(typeof m.bind=="function")return m.bind(p);try{return Function.prototype.bind.call(m,p)}catch{return function(){return Function.prototype.apply.apply(m,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?c:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function u(){for(var p=this.getLevel(),S=0;S<r.length;S++){var m=r[S];this[m]=S<p?e:this.methodFactory(m,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function d(p){return function(){typeof console!==n&&(u.call(this),this[p].apply(this,arguments))}}function h(p,S,m){return l(p)||d.apply(this,arguments)}function f(p,S){var m=this,v,y,k,b="loglevel";typeof p=="string"?b+=":"+p:typeof p=="symbol"&&(b=void 0);function w(M){var V=(r[M]||"silent").toUpperCase();if(!(typeof window===n||!b)){try{window.localStorage[b]=V;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+V+";"}catch{}}}function P(){var M;if(!(typeof window===n||!b)){try{M=window.localStorage[b]}catch{}if(typeof M===n)try{var V=window.document.cookie,H=encodeURIComponent(b),ee=V.indexOf(H+"=");ee!==-1&&(M=/^([^;]+)/.exec(V.slice(ee+H.length+1))[1])}catch{}return m.levels[M]===void 0&&(M=void 0),M}}function E(){if(!(typeof window===n||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(M){var V=M;if(typeof V=="string"&&m.levels[V.toUpperCase()]!==void 0&&(V=m.levels[V.toUpperCase()]),typeof V=="number"&&V>=0&&V<=m.levels.SILENT)return V;throw new TypeError("log.setLevel() called with invalid level: "+M)}m.name=p,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=S||h,m.getLevel=function(){return k??y??v},m.setLevel=function(M,V){return k=D(M),V!==!1&&w(k),u.call(m)},m.setDefaultLevel=function(M){y=D(M),P()||m.setLevel(M,!1)},m.resetLevel=function(){k=null,E(),u.call(m)},m.enableAll=function(M){m.setLevel(m.levels.TRACE,M)},m.disableAll=function(M){m.setLevel(m.levels.SILENT,M)},m.rebuild=function(){if(o!==m&&(v=D(o.getLevel())),u.call(m),o===m)for(var M in s)s[M].rebuild()},v=D(o?o.getLevel():"WARN");var I=P();I!=null&&(k=D(I)),u.call(m)}o=new f,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var m=s[S];return m||(m=s[S]=new f(S,o.methodFactory)),m};var g=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=g),o},o.getLoggers=function(){return s},o.default=o,o})}(Aa)),Aa.exports}var sl=PA(),zd;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(zd||(zd={}));var Gt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Gt||(Gt={}));let Q=sl.getLogger("livekit");Object.values(Gt).map(t=>sl.getLogger(t));Q.setDefaultLevel(zd.info);function Un(t){const e=sl.getLogger(t);return e.setDefaultLevel(Q.getLevel()),e}const EA=sl.getLogger("lk-e2ee"),Ts=7e3,xA=[0,300,2*2*300,3*3*300,4*4*300,Ts,Ts,Ts,Ts,Ts];class RA{constructor(e){this._retryDelays=e!==void 0?[...e]:xA}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function _A(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function C(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function fv(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof fv=="function"?fv(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var aa={exports:{}},pv;function IA(){if(pv)return aa.exports;pv=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,w,P){return Function.prototype.apply.call(b,w,P)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function i(k){console&&console.warn&&console.warn(k)}var r=Number.isNaN||function(b){return b!==b};function s(){s.init.call(this)}aa.exports=s,aa.exports.once=m,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");o=k}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function c(k){return k._maxListeners===void 0?s.defaultMaxListeners:k._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(b){for(var w=[],P=1;P<arguments.length;P++)w.push(arguments[P]);var E=b==="error",D=this._events;if(D!==void 0)E=E&&D.error===void 0;else if(!E)return!1;if(E){var I;if(w.length>0&&(I=w[0]),I instanceof Error)throw I;var M=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw M.context=I,M}var V=D[b];if(V===void 0)return!1;if(typeof V=="function")e(V,this,w);else for(var H=V.length,ee=g(V,H),P=0;P<H;++P)e(ee[P],this,w);return!0};function l(k,b,w,P){var E,D,I;if(a(w),D=k._events,D===void 0?(D=k._events=Object.create(null),k._eventsCount=0):(D.newListener!==void 0&&(k.emit("newListener",b,w.listener?w.listener:w),D=k._events),I=D[b]),I===void 0)I=D[b]=w,++k._eventsCount;else if(typeof I=="function"?I=D[b]=P?[w,I]:[I,w]:P?I.unshift(w):I.push(w),E=c(k),E>0&&I.length>E&&!I.warned){I.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=k,M.type=b,M.count=I.length,i(M)}return k}s.prototype.addListener=function(b,w){return l(this,b,w,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(b,w){return l(this,b,w,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(k,b,w){var P={fired:!1,wrapFn:void 0,target:k,type:b,listener:w},E=u.bind(P);return E.listener=w,P.wrapFn=E,E}s.prototype.once=function(b,w){return a(w),this.on(b,d(this,b,w)),this},s.prototype.prependOnceListener=function(b,w){return a(w),this.prependListener(b,d(this,b,w)),this},s.prototype.removeListener=function(b,w){var P,E,D,I,M;if(a(w),E=this._events,E===void 0)return this;if(P=E[b],P===void 0)return this;if(P===w||P.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete E[b],E.removeListener&&this.emit("removeListener",b,P.listener||w));else if(typeof P!="function"){for(D=-1,I=P.length-1;I>=0;I--)if(P[I]===w||P[I].listener===w){M=P[I].listener,D=I;break}if(D<0)return this;D===0?P.shift():p(P,D),P.length===1&&(E[b]=P[0]),E.removeListener!==void 0&&this.emit("removeListener",b,M||w)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(b){var w,P,E;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[b]),this;if(arguments.length===0){var D=Object.keys(P),I;for(E=0;E<D.length;++E)I=D[E],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=P[b],typeof w=="function")this.removeListener(b,w);else if(w!==void 0)for(E=w.length-1;E>=0;E--)this.removeListener(b,w[E]);return this};function h(k,b,w){var P=k._events;if(P===void 0)return[];var E=P[b];return E===void 0?[]:typeof E=="function"?w?[E.listener||E]:[E]:w?S(E):g(E,E.length)}s.prototype.listeners=function(b){return h(this,b,!0)},s.prototype.rawListeners=function(b){return h(this,b,!1)},s.listenerCount=function(k,b){return typeof k.listenerCount=="function"?k.listenerCount(b):f.call(k,b)},s.prototype.listenerCount=f;function f(k){var b=this._events;if(b!==void 0){var w=b[k];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(k,b){for(var w=new Array(b),P=0;P<b;++P)w[P]=k[P];return w}function p(k,b){for(;b+1<k.length;b++)k[b]=k[b+1];k.pop()}function S(k){for(var b=new Array(k.length),w=0;w<b.length;++w)b[w]=k[w].listener||k[w];return b}function m(k,b){return new Promise(function(w,P){function E(I){k.removeListener(b,D),P(I)}function D(){typeof k.removeListener=="function"&&k.removeListener("error",E),w([].slice.call(arguments))}y(k,b,D,{once:!0}),b!=="error"&&v(k,E,{once:!0})})}function v(k,b,w){typeof k.on=="function"&&y(k,"error",b,w)}function y(k,b,w,P){if(typeof k.on=="function")P.once?k.once(b,w):k.on(b,w);else if(typeof k.addEventListener=="function")k.addEventListener(b,function E(D){P.once&&k.removeEventListener(b,E),w(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return aa.exports}var pn=IA();let ZS=!0,eT=!0;function Ls(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Zi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function AA(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ZS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function DA(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(eT=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function tT(){if(typeof window=="object"){if(ZS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function rp(t,e){eT&&console.warn(t+" is deprecated, please use "+e+" instead.")}function OA(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ls(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ls(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ls(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ls(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function mv(t){return Object.prototype.toString.call(t)==="[object Object]"}function nT(t){return mv(t)?Object.keys(t).reduce(function(e,n){const i=mv(t[n]),r=i?nT(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function $d(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?$d(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{$d(t,t.get(r),n)})}))}function gv(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&$d(t,a,r)})}),r}const vv=tT;function iT(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(g=>g.kind==="videoinput");let f=h.find(g=>d.some(p=>g.label.toLowerCase().includes(p)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=l.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),vv("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return vv("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function rT(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function sT(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function oT(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function aT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>gv(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Zi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>gv(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function cT(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function lT(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return cT(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(p=>p===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([u]);this._streams[d.id]=p,this._reverseStreams[p.id]=d,this.addStream(p)}return this.getSenders().find(p=>p.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],g=l._streams[f.id];d=d.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],g=l._streams[f.id];d=d.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const p=s(this,g);h[0].apply(null,[p])},g=>{h[1]&&h[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>s(this,g))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(p=>u.track===p)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wd(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function uT(t,e){Zi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var yv=Object.freeze({__proto__:null,fixNegotiationNeeded:uT,shimAddTrackRemoveTrack:lT,shimAddTrackRemoveTrackWithNative:cT,shimGetSendersWithDtmf:oT,shimGetUserMedia:iT,shimMediaStream:rT,shimOnTrack:sT,shimPeerConnection:Wd,shimSenderReceiverGetStats:aT});function dT(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){rp("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function MA(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function hT(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qd(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function fT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function pT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Zi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function mT(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){rp("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function gT(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function vT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function yT(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function kT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function bT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var kv=Object.freeze({__proto__:null,shimAddTransceiver:vT,shimCreateAnswer:bT,shimCreateOffer:kT,shimGetDisplayMedia:MA,shimGetParameters:yT,shimGetUserMedia:dT,shimOnTrack:hT,shimPeerConnection:qd,shimRTCDataChannel:gT,shimReceiverGetStats:pT,shimRemoveStream:mT,shimSenderGetStats:fT});function ST(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function TT(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function CT(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function wT(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(PT(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function PT(t){return t&&t.video!==void 0?Object.assign({},t,{video:nT(t.video)}):t}function ET(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(rp("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function xT(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function RT(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function _T(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var bv=Object.freeze({__proto__:null,shimAudioContext:_T,shimCallbacksAPI:CT,shimConstraints:PT,shimCreateOfferLegacy:RT,shimGetUserMedia:wT,shimLocalStreamsAPI:ST,shimRTCIceServerUrls:ET,shimRemoteStreamsAPI:TT,shimTrackEventTransceiver:xT}),su={exports:{}},Sv;function NA(){return Sv||(Sv=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(g=>parseInt(g,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(f.rtx={ssrc:l}),i.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(su)),su.exports}var IT=NA(),Lr=CA(IT),LA=Q_({__proto__:null,default:Lr},[IT]);function Da(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Lr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Zi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Hd(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Zi(t,"icecandidate",e=>{if(e.candidate){const n=Lr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Oa(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Lr.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Lr.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Lr.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function Ma(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Zi(t,"datachannel",i=>(e(i.channel,i.target),i))}function Kd(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Gd(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Na(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function La(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var UA=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gd,shimAddIceCandidateNullOrEmpty:Na,shimConnectionState:Kd,shimMaxMessageSize:Oa,shimParameterlessSetLocalDescription:La,shimRTCIceCandidate:Da,shimRTCIceCandidateRelayProtocol:Hd,shimSendThrowTypeError:Ma});function FA(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=tT,i=OA(t),r={browserDetails:i,commonShim:UA,extractVersion:Ls,disableLog:AA,disableWarnings:DA,sdp:LA};switch(i.browser){case"chrome":if(!yv||!Wd||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=yv,Na(t,i),La(t),iT(t,i),rT(t),Wd(t,i),sT(t),lT(t,i),oT(t),aT(t),uT(t,i),Da(t),Hd(t),Kd(t),Oa(t,i),Ma(t),Gd(t,i);break;case"firefox":if(!kv||!qd||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=kv,Na(t,i),La(t),dT(t,i),qd(t,i),hT(t),mT(t),fT(t),pT(t),gT(t),vT(t),yT(t),kT(t),bT(t),Da(t),Kd(t),Oa(t,i),Ma(t);break;case"safari":if(!bv||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=bv,Na(t,i),La(t),ET(t),RT(t),CT(t),ST(t),TT(t),xT(t),wT(t),_T(t),Da(t),Hd(t),Oa(t,i),Ma(t),Gd(t,i);break;default:n("Unsupported browser!");break}return r}FA({window:typeof window>"u"?void 0:window});const jA=10,Cs="lk_e2ee",VA="LKFrameEncryptionKey",BA={sharedKey:!1,ratchetSalt:VA,ratchetWindowSize:8,failureTolerance:jA,keyringSize:16};var li;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(li||(li={}));var Tv;(function(t){t.KeyRatcheted="keyRatcheted"})(Tv||(Tv={}));var ei;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(ei||(ei={}));var Cv;(function(t){t.Error="cryptorError"})(Cv||(Cv={}));function zA(){return $A()||Qd()}function Qd(){return typeof window.RTCRtpScriptTransform<"u"}function $A(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class JL extends pn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Q.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},BA),e),this.on(li.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(li.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(li.RatchetRequest,e,n)}}class Si extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var X;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(X||(X={}));class se extends Si{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=X[n]}}class sp extends Si{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class En extends Si{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class WA extends Si{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ae extends Si{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Jd extends Si{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class wv extends Si{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Pv extends Si{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:ip[n]}}var Sc;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Sc||(Sc={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Sc||(Sc={}));var Ev;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Ev||(Ev={}));var _;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(_||(_={}));var O;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(O||(O={}));var j;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(j||(j={}));var F;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(F||(F={}));function qA(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const HA=/version\/(\d+(\.?_?\d+)+)/i;let ou;function vt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof t>"u"&&typeof navigator>"u")return;const n=(t??navigator.userAgent).toLowerCase();if(ou===void 0||e){const i=KA.find(r=>{let{test:s}=r;return s.test(n)});ou=i==null?void 0:i.describe(n)}return ou}const KA=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Ua(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:au(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Ua(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:au(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Ua(HA,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:au(t)}}}];function Ua(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function au(t){return t.includes("mac os")?Ua(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var GA="2.15.3";const QA=GA,JA=16;class Be{}Be.setTimeout=function(){return setTimeout(...arguments)};Be.setInterval=function(){return setInterval(...arguments)};Be.clearTimeout=function(){return clearTimeout(...arguments)};Be.clearInterval=function(){return clearInterval(...arguments)};const YA=5e3,ws=[];var pt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(pt||(pt={}));class x extends pn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=x.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Q,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),YA):this.handleAppVisibilityChanged()},this.log=Un((r=i.loggerName)!==null&&r!==void 0?r:Gt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=x.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),K(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===x.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===x.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(ws.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&ws.splice(ws.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Er(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?F.AudioPlaybackStarted:F.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?F.AudioPlaybackFailed:F.VideoPlaybackFailed,s):s.name==="AbortError"?Q.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Q.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(F.ElementAttached,e),e}detach(e){try{if(e){Ur(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(F.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Ur(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(F.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Un(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),ws.forEach(i=>{i.parentElement||(n=!1)}),n&&ws.push(e)}}handleAppVisibilityChanged(){return C(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===x.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){st()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){st()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Er(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Ki()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Ki()||Zr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Ur(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return zt.AUDIO;case e.Video:return zt.VIDEO;default:return zt.DATA}}t.kindToProto=r;function s(l){switch(l){case zt.AUDIO:return e.Audio;case zt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return xe.CAMERA;case n.Microphone:return xe.MICROPHONE;case n.ScreenShare:return xe.SCREEN_SHARE;case n.ScreenShareAudio:return xe.SCREEN_SHARE_AUDIO;default:return xe.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case xe.CAMERA:return n.Camera;case xe.MICROPHONE:return n.Microphone;case xe.SCREEN_SHARE:return n.ScreenShare;case xe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case jd.ACTIVE:return i.Active;case jd.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(x||(x={}));class ie{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const XA=["vp8","h264"],ZA=["vp8","h264","vp9","av1","h265"];function eD(t){return!!XA.find(e=>e===t)}var xv;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(xv||(xv={}));var Yd;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Yd||(Yd={}));const Co={h90:new ie(160,90,9e4,20),h180:new ie(320,180,16e4,20),h216:new ie(384,216,18e4,20),h360:new ie(640,360,45e4,20),h540:new ie(960,540,8e5,25),h720:new ie(1280,720,17e5,30),h1080:new ie(1920,1080,3e6,30),h1440:new ie(2560,1440,5e6,30),h2160:new ie(3840,2160,8e6,30)},Xd={h120:new ie(160,120,7e4,20),h180:new ie(240,180,125e3,20),h240:new ie(320,240,14e4,20),h360:new ie(480,360,33e4,20),h480:new ie(640,480,5e5,20),h540:new ie(720,540,6e5,25),h720:new ie(960,720,13e5,30),h1080:new ie(1440,1080,23e5,30),h1440:new ie(1920,1440,38e5,30)},op={h360fps3:new ie(640,360,2e5,3,"medium"),h360fps15:new ie(640,360,4e5,15,"medium"),h720fps5:new ie(1280,720,8e5,5,"medium"),h720fps15:new ie(1280,720,15e5,15,"medium"),h720fps30:new ie(1280,720,2e6,30,"medium"),h1080fps15:new ie(1920,1080,25e5,15,"medium"),h1080fps30:new ie(1920,1080,5e6,30,"medium"),original:new ie(0,0,7e6,30,"medium")},tD="|",Rv="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function nD(t){const e=t.split(tD);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function lt(t){return C(this,void 0,void 0,function*(){return new Promise(e=>Be.setTimeout(e,t))})}function Zd(){return"addTransceiver"in RTCPeerConnection.prototype}function eh(){return"addTrack"in RTCPeerConnection.prototype}function iD(){if(!("getCapabilities"in RTCRtpSender)||Ki())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function rD(){if(!("getCapabilities"in RTCRtpSender)||Zr())return!1;if(Ki()){const n=vt();if(n!=null&&n.version&&dn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&dn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function nn(t){return t==="av1"||t==="vp9"}function th(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function sD(){return typeof RTCPeerConnection>"u"?!1:Zd()||eh()}function Zr(){var t;return((t=vt())===null||t===void 0?void 0:t.name)==="Firefox"}function Ki(){var t;return((t=vt())===null||t===void 0?void 0:t.name)==="Safari"}function nh(){const t=vt();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function oD(){const t=vt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&dn(t.osVersion,"17")>=0}function aD(t){return t||(t=vt()),(t==null?void 0:t.name)==="Safari"&&dn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&dn(t.osVersion,"18.3")>0}function AT(){var t,e;return st()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function cD(){const t=vt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&dn(e,t.osVersion)>=0?!0:t.name==="Safari"&&dn(e,t.version)>=0}function st(){return typeof document<"u"}function un(){return navigator.product=="ReactNative"}function ih(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function DT(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function OT(){if(!un())return;let t=DT();if(t)return t.platform}function _v(){if(st())return window.devicePixelRatio;if(un()){let t=DT();if(t)return t.devicePixelRatio}return 1}function dn(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function lD(t){for(const e of t)e.target.handleResize(e)}function uD(t){for(const e of t)e.target.handleVisibilityChanged(e)}let cu=null;const Iv=()=>(cu||(cu=new ResizeObserver(lD)),cu);let lu=null;const Av=()=>(lu||(lu=new IntersectionObserver(uD,{root:null,rootMargin:"0px"})),lu);function dD(){var t;const e=new XI({sdk:US.JS,protocol:JA,version:QA});return un()&&(e.os=(t=OT())!==null&&t!==void 0?t:""),e}function Dv(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Ps;function uu(){if(!Ps){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Ps]=i.stream.getAudioTracks(),!Ps)throw Error("Could not get empty media stream audio track");Ps.enabled=!1}return Ps.clone()}class xr{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>C(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function hD(t,e){const n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},e),i=cp();if(!i)throw new Error("Audio Context not supported on this browser");const r=n.cloneTrack?t.mediaStreamTrack.clone():t.mediaStreamTrack,s=i.createMediaStreamSource(new MediaStream([r])),o=i.createAnalyser();o.minDecibels=n.minDecibels,o.maxDecibels=n.maxDecibels,o.fftSize=n.fftSize,o.smoothingTimeConstant=n.smoothingTimeConstant,s.connect(o);const a=new Uint8Array(o.frequencyBinCount);return{calculateVolume:()=>{o.getByteFrequencyData(a);let u=0;for(const h of a)u+=Math.pow(h/255,2);return Math.sqrt(u/a.length)},analyser:o,cleanup:()=>C(this,void 0,void 0,function*(){yield i.close(),n.cloneTrack&&r.stop()})}}function fD(t){return ZA.includes(t)}function ui(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function pD(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function rh(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function mD(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function gD(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Ov(t){switch(t.reason){case X.LeaveRequest:return t.context;case X.Cancelled:return Wt.CLIENT_INITIATED;case X.NotAllowed:return Wt.USER_REJECTED;case X.ServerUnreachable:return Wt.JOIN_FAILURE;default:return Wt.UNKNOWN_REASON}}function Fa(t){return t!==void 0?Number(t):void 0}function Ri(t){return t!==void 0?BigInt(t):void 0}function Fr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function cn(t){return!!t&&t.kind==x.Kind.Audio}function er(t){return!!t&&t.kind==x.Kind.Video}function Wn(t){return Fr(t)&&er(t)}function kn(t){return Fr(t)&&cn(t)}function sh(t){return!!t&&!t.isLocal}function vD(t){return!!t&&!t.isLocal}function du(t){return sh(t)&&er(t)}function yD(t){return t.isLocal}function kD(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function MT(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=LT(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(oh(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(oh(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function oh(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function ap(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":oh(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function NT(t){return C(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=cp();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield lt(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function cp(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>C(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function bD(t){return t==="audioinput"?x.Source.Microphone:t==="videoinput"?x.Source.Camera:x.Source.Unknown}function ah(t){return t===x.Source.Microphone?"audioinput":t===x.Source.Camera?"videoinput":void 0}function SD(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ki()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function ja(t){return t.split("/")[1].toLowerCase()}function TD(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new tp({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function K(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?K(t.track):{})}}function CD(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function wD(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function LT(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:qA(e)}}function PD(t){switch(t){case xe.CAMERA:return x.Source.Camera;case xe.MICROPHONE:return x.Source.Microphone;case xe.SCREEN_SHARE:return x.Source.ScreenShare;case xe.SCREEN_SHARE_AUDIO:return x.Source.ScreenShareAudio;default:return x.Source.Unknown}}function Mv(t,e){return t.width*t.height<e.width*e.height}function ED(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class xD extends pn.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:s,data:o}=n.data;switch(s){case"error":Q.error(o.error.message),this.emit(ei.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(ei.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(ei.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(li.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break}},this.onWorkerError=n=>{Q.error("e2ee worker encountered an error:",{error:n.error}),this.emit(ei.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!zA())throw new sp("tried to setup end-to-end encryption on an unsupported browser");if(Q.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:EA.getLevel()}};this.worker&&(Q.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Q.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Q.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(j.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(_.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==ht.NONE,r.identity)),e.on(_.ConnectionStateChanged,i=>{i===Y.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==ht.NONE,r.identity)})})}).on(_.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(_.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(_.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(O.LocalSenderCreated,(i,r)=>C(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(li.SetKey,i=>this.postKey(i)).on(li.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?ja(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Fr(e)||!n){n||Q.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return C(this,void 0,void 0,function*(){if(this.worker){if(Qd()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Cs in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:Cs in e}};this.worker.postMessage(a,[o,s])}e[Cs]=!0}})}handleSender(e,n,i){var r;if(!(Cs in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Qd()){Q.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Q.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[Cs]=!0}}}const hu="default";class Ue{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ue),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Ue.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Q.debug("awaiting getUserMedia promise");try{n?yield Ue.userMediaPromiseMap.get(n):yield Promise.all(Ue.userMediaPromiseMap.values())}catch{Q.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ki()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return C(this,void 0,void 0,function*(){if(n!==hu)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===hu);if(!s){Q.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==hu&&a.groupId===(i??s.groupId));if(!o){Q.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ue.userMediaPromiseMap.has(e):Ue.userMediaPromiseMap.size>0}}Ue.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ue.userMediaPromiseMap=new Map;var Xs;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Xs||(Xs={}));class RD{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ye,this.nextTaskIndex=0}run(e){return C(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Xs.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Xs.RUNNING,yield e()}finally{n.status=Xs.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function _D(t,e){const n=new URL(pD(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),UT(n,"rtc")}function ID(t){const e=new URL(rh(t));return UT(e,"validate")}function AD(t){return t.endsWith("/")?t:"".concat(t,"/")}function UT(t,e){return t.pathname="".concat(AD(t.pathname)).concat(e),t.toString()}const DD=["syncState","trickle","offer","answer","simulate","leave"];function OD(t){const e=DD.indexOf(t.case)>=0;return Q.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var ce;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(ce||(ce={}));class lp{get currentState(){return this.state}get isDisconnected(){return this.state===ce.DISCONNECTING||this.state===ce.DISCONNECTED}get isEstablishingConnection(){return this.state===ce.CONNECTING||this.state===ce.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=ce.DISCONNECTED,this.log=Q,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Un((i=n.loggerName)!==null&&i!==void 0?i:Gt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new RD,this.queuedRequests=[],this.closingLock=new Ye,this.connectionLock=new Ye,this.state=ce.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return C(this,void 0,void 0,function*(){return this.state=ce.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=ce.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=dD(),o=MD(n,s,i),a=_D(e,o),c=ID(a);return new Promise((l,u)=>C(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const h=()=>C(this,void 0,void 0,function*(){this.close(),clearTimeout(f),u(new se("room connection has been cancelled (signal)",X.Cancelled))}),f=setTimeout(()=>{this.close(),u(new se("room connection has timed out (signal)",X.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const g=new URL(a);g.searchParams.has("access_token")&&g.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(g),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=p=>C(this,void 0,void 0,function*(){if(this.state!==ce.CONNECTED){this.state=ce.DISCONNECTED,clearTimeout(f);try{const S=yield fetch(c);if(S.status.toFixed(0).startsWith("4")){const m=yield S.text();u(new se(m,X.NotAllowed,S.status))}else u(new se("Encountered unknown websocket error during connection: ".concat(p.toString()),X.InternalError,S.status))}catch(S){u(new se(S instanceof Error?S.message:"server was not reachable",X.ServerUnreachable))}return}this.handleWSError(p)}),this.ws.onmessage=p=>C(this,void 0,void 0,function*(){var S,m,v;let y;if(typeof p.data=="string"){const k=JSON.parse(p.data);y=dv.fromJson(k,{ignoreUnknownFields:!0})}else if(p.data instanceof ArrayBuffer)y=dv.fromBinary(new Uint8Array(p.data));else{this.log.error("could not decode websocket message: ".concat(typeof p.data),this.logContext);return}if(this.state!==ce.CONNECTED){let k=!1;if(((S=y.message)===null||S===void 0?void 0:S.case)==="join"?(this.state=ce.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=y.message.value.pingTimeout,this.pingIntervalDuration=y.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(y.message.value)):this.state===ce.RECONNECTING&&y.message.case!=="leave"?(this.state=ce.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((m=y.message)===null||m===void 0?void 0:m.case)==="reconnect"?l(y.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),k=!0)):this.isEstablishingConnection&&y.message.case==="leave"?u(new se("Received leave request while trying to (re)connect",X.LeaveRequest,void 0,y.message.value.reason)):i.reconnect||u(new se("did not receive join response, got ".concat((v=y.message)===null||v===void 0?void 0:v.case," instead"),X.InternalError)),!k)return}this.signalLatency&&(yield lt(this.signalLatency)),this.handleSignalResponse(y)}),this.ws.onclose=p=>{this.isEstablishingConnection&&u(new se("Websocket got closed during a (re)connection attempt",X.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:p.reason,code:p.code,wasClean:p.wasClean,state:this.state})),this.handleOnClose(p.reason)}}finally{d()}}))}close(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=ce.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,lt(250)])),e.ws=void 0}}finally{n&&(e.state=ce.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Tc(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Tc(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Zf({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ep({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new qS({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new WS({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new GS({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:fe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new XS({timestamp:fe.parse(Date.now()),rtt:fe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new $S({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new rl({reason:Wt.CLIENT_INITIATED,action:Nr.DISCONNECT})})}sendRequest(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!OD(n)&&i.state===ce.RECONNECTING){i.queuedRequests.push(()=>C(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield lt(i.signalLatency)),!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new tA({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=Nv(r.value);this.onAnswer&&this.onAnswer(o,r.value.id)}else if(r.case==="offer"){const o=Nv(r.value);this.onOffer&&this.onOffer(o,r.value.id)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return C(this,void 0,void 0,function*(){if(this.state===ce.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Be.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Be.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Be.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Be.clearInterval(this.pingInterval)}}function Nv(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Tc(t,e){return new Hi({sdp:t.sdp,type:t.type,id:e})}function MD(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",un()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class Lv{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class ND{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Nt={},fu={},pu={exports:{}},Uv;function up(){if(Uv)return pu.exports;Uv=1;var t=pu.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),pu.exports}var Fv;function LD(){return Fv||(Fv=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=up(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],f=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var g=0;g<(r[h]||[]).length;g+=1){var p=r[h][g];if(p.reg.test(f))return i(p,u,f)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(fu)),fu}var mu,jv;function UD(){if(jv)return mu;jv=1;var t=up(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return mu=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(f){u.push(i(d,h,f))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(f){f.name in d&&d[f.name]!=null?u.push(i(h,f,d)):f.push in d&&d[f.push]!=null&&d[f.push].forEach(function(g){u.push(i(h,f,g))})})})}),u.join(`\r
`)+`\r
`},mu}var Vv;function FD(){if(Vv)return Nt;Vv=1;var t=LD(),e=UD(),n=up();return Nt.grammar=n,Nt.write=e,Nt.parse=t.parse,Nt.parseParams=t.parseParams,Nt.parseFmtpConfig=t.parseFmtpConfig,Nt.parsePayloads=t.parsePayloads,Nt.parseRemoteCandidates=t.parseRemoteCandidates,Nt.parseImageAttributes=t.parseImageAttributes,Nt.parseSimulcastStreamList=t.parseSimulcastStreamList,Nt}var Hn=FD();function dp(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var f=Date.now()-l;if(f+e>=c)return c-f}return e}var h=function(){var f=[].slice.call(arguments),g=this;return new Promise(function(p,S){var m=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var y=t.apply(g,f);a&&a(y),u.forEach(function(k){return(0,k.resolve)(y)}),u=[]}},d()),m){var v=t.apply(g,f);return a&&a(v),p(v)}u.push({resolve:p,reject:S})})};return h.cancel=function(f){s!==void 0&&clearTimeout(s),u.forEach(function(g){return(0,g.reject)(f)}),u=[]},h}const jD=.7,VD=20,jr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Bv extends pn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Q,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=dp(r=>C(this,void 0,void 0,function*(){this.emit(jr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),VD),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Un((i=n.loggerName)!==null&&i!==void 0?i:Gt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Ye}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return C(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return C(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=BD(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Hn.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||o.mid!=a.transceiver.mid)return!1;let c=0;if(o.rtp.some(u=>u.codec.toUpperCase()===a.codec.toUpperCase()?(c=u.payload,!0):!1),c===0)return!0;let l=!1;for(const u of o.fmtp)if(u.payload===c){u.config=u.config.split(";").filter(d=>!d.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(u.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=Hn.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(jr.NegotiationComplete),e.sdp&&Hn.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(jr.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Hn.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{$v(a),a.type==="audio"?zv(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(nn(c.codec)&&!Ki()&&this.ensureVideoDDExtensionForSVC(a,o),c.codec!=="av1"))return!0;const u=Math.round(c.maxbr*jD);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Hn.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Hn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{$v(r),r.type==="audio"&&zv(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Hn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ae("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ae("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return C(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return C(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Jd(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===Rv))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Rv})}}}function zv(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function BD(t){var e;const n=[],i=[],r=Hn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function $v(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const ch="vp8",zD={audioPreset:Yd.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:op.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:ch,backupCodec:!0,preConnectBuffer:!1},FT={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},jT={deviceId:{ideal:"default"},resolution:Co.h720.resolution},$D={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new RA,disconnectOnPageLeave:!0,webAudioMix:!1},hp={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ke;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ke||(ke={}));class WD{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=hp.peerConnectionTimeout,this.log=Q,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ke.CONNECTED:a.some(c=>c==="failed")?this.state=ke.FAILED:a.some(c=>c==="connecting")?this.state=ke.CONNECTING:a.every(c=>c==="closed")?this.state=ke.CLOSED:a.some(c=>c==="closed")?this.state=ke.CLOSING:a.every(c=>c==="new")&&(this.state=ke.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(ke[o]," to ").concat(ke[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Un((r=i.loggerName)!==null&&r!==void 0?r:Gt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new Bv(e,i),this.subscriber=new Bv(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,$t.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,$t.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ke.NEW,this.connectionLock=new Ye,this.remoteOfferLock=new Ye}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return C(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return C(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return C(this,void 0,void 0,function*(){n===$t.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return C(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return C(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return C(this,void 0,void 0,function*(){return new Promise((n,i)=>C(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(jr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(jr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===$t.PUBLISHER?this.publisher.getConnectedAddress():e===$t.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>C(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Be.clearTimeout(d),l(new se("room connection has been cancelled",X.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Be.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(new se("could not establish pc connection",X.InternalError))},o);for(;this.state!==ke.CONNECTED;)if(yield lt(50),r!=null&&r.signal.aborted){l(new se("room connection has been cancelled",X.Cancelled));return}Be.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}class Te extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Wv(n,Te.MAX_MESSAGE_BYTES),this.data=i?Wv(i,Te.MAX_DATA_BYTES):void 0}static fromProto(e){return new Te(e.code,e.message,e.data)}toProto(){return new OS({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Te(Te.ErrorCode[e],Te.ErrorMessage[e],n)}}Te.MAX_MESSAGE_BYTES=256;Te.MAX_DATA_BYTES=15360;Te.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Te.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const VT=15360;function fp(t){return new TextEncoder().encode(t).length}function Wv(t,e){if(fp(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const pp=2e3;function ol(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const mp=typeof MediaRecorder<"u";class qD{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const HD=mp?MediaRecorder:qD;class KD extends HD{constructor(e,n){if(!mp)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>C(this,void 0,void 0,function*(){const u=yield l.data.arrayBuffer();s()||c.enqueue(new Uint8Array(u))}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function GD(){return mp}const QD=1e3,JD=1e4;class BT extends x{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=dp(()=>C(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>C(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(F.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ye,this.pauseUpstreamLock=new Ye,this.processorLock=new Ye,this.restartLock=new Ye,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==x.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return C(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Ur(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Er(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{s()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Er(r??e,s)}))})}waitForDimensions(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:QD;return function*(){var i;if(e.kind===x.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=vt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield lt(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield lt(50)}throw new En("unable to get track dimensions after timeout")}()})}setDeviceId(e){return C(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ui(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ui(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===x.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===x.Kind.Audio?"audioinput":"videoinput";return n?Ue.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return C(this,void 0,void 0,function*(){if(!this.sender)throw new En("unable to replace an unpublished track");let i,r;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return C(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=_A(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===x.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{Ur(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(F.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?F.Muted:F.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),AT()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(F.UpstreamPaused,this);const i=vt();if((i==null?void 0:i.name)==="Safari"&&dn(i.version,"12.0")<0)throw new sp("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(F.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Er(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(Ur(i._mediaStreamTrack,l),Er(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(F.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(F.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!GD()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(!this.localTrackRecorder)this.localTrackRecorder=new KD(this,{mimeType:"audio/webm;codecs=opus"});else{this.log.warn("preconnect buffer already started");return}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},JD)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}}class Cc extends BT{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,x.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=ol(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(F.AudioTrackFeatureUpdate,this,Le.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(F.AudioTrackFeatureUpdate,this,Le.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ui(this._constraints.deviceId);return this.source===x.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return C(this,void 0,void 0,function*(){let n;if(e){const i=ap({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return C(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){st()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},pp)))}setProcessor(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!un()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(F.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return C(this,void 0,void 0,function*(){const e=yield NT(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(F.AudioSilenceDetected)),e})}}function YD(t,e,n){switch(t.kind){case"audio":return new Cc(t,e,!1,void 0,n);case"video":return new wc(t,e,!1,n);default:throw new En("unsupported track type: ".concat(t.kind))}}const XD=Object.values(Co),ZD=Object.values(Xd),eO=Object.values(op),tO=[Co.h180,Co.h360],nO=[Xd.h180,Xd.h360],iO=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ie(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),lh=["q","h","f"];function uh(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=sO(t,e,n,l),Q.debug("using video encoding",o));const u=o.maxFramerate,d=new ie(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&nn(l)){const g=new zT(c),p=[];if(g.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const S=vt();if(nh()||un()||(S==null?void 0:S.name)==="Chrome"&&dn(S==null?void 0:S.version,"113")<0){const m=g.suffix=="h"?2:3,v=aD(S);for(let y=0;y<g.spatial;y+=1)p.push({rid:lh[2-y],maxBitrate:o.maxBitrate/Math.pow(m,y),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:v?Math.pow(2,y):void 0});p[0].scalabilityMode=c}else p.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(p[0].priority=d.encoding.priority,p[0].networkPriority=d.encoding.priority),Q.debug("using svc encoding",{encodings:p}),p}if(!a)return[o];let h=[];t?h=(r=Hv(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:qv(t,d):h=(s=Hv(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:qv(t,d);let f;if(h.length>0){const g=h[0];h.length>1&&([,f]=h);const p=Math.max(e,n);if(p>=960&&f)return gu(e,n,[g,f,d],u);if(p>=480)return gu(e,n,[g,d],u)}return gu(e,n,[d])}function rO(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Q.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===x.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),uh(t.source===x.Source.ScreenShare,c,l,n)}function sO(t,e,n,i){const r=oO(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function oO(t,e,n){if(t)return eO;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?XD:ZD}function qv(t,e){if(t)return iO(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?tO:nO}function gu(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=lh.length)return;const a=Math.min(t,e),l={rid:lh[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=Zr()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),un()&&OT()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,Q.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Q.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Hv(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class zT{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function aO(t){return t.source===x.Source.ScreenShare||t.constraints.height&&ui(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const cO=5e3;class wc extends BT{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,x.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(F.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=ol(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Ye}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!st())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},pp))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Pn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Pn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=pt.LOW;i<=pt.HIGH;i+=1)n.push(new np({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(nn(this.codec),n)}restartTrack(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=ap({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=Pn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return C(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,f=Pn(r.simulcastCodecs.values()),g;g=yield f.next(),o=g.done,!o;h=!0)l=g.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(p){a={error:p}}finally{try{!h&&!o&&(c=f.return)&&(yield c.call(f))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return C(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},cO))}setPublishingCodecs(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(nn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=Pn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(nn(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Kv(d.sender,d.encodings,u.qualities,this.senderLock,nn(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return C(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Kv(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return C(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&nn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),AT()&&this.isInBackground&&this.source===x.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Kv(t,e,n,i,r,s,o){return C(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),l.forEach((h,f)=>{var g;let p=(g=h.rid)!==null&&g!==void 0?g:"";p===""&&(p="q");const S=$T(p),m=n.find(v=>v.quality===S);m&&h.active!==m.enabled&&(u=!0,h.active=m.enabled,s.debug("setting layer ".concat(m.quality," to ").concat(h.active?"enabled":"disabled"),o),Zr()&&(m.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function $T(t){switch(t){case"f":return pt.HIGH;case"h":return pt.MEDIUM;case"q":return pt.LOW;default:return pt.HIGH}}function Gv(t,e,n,i){if(!n)return[new Li({quality:pt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new zT(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Li({quality:Math.min(pt.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=$T((o=r.rid)!==null&&o!==void 0?o:"");return new Li({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Qv="_lossy",Jv="_reliable",lO=2*1e3,vu="leave-reconnect",uO=3e4;var Ut;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ut||(Ut={}));class dO extends pn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=hp.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ut.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Q,this.reliableDataSequence=1,this.reliableMessageBuffer=new Lv,this.reliableReceivedState=new ND(uO),this.handleDataChannel=i=>C(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===Jv)s.reliableDCSub=o;else if(o.label===Qv)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>C(this,void 0,void 0,function*(){var r,s;const o=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=tt.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(j.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&fO(c,c.value.value),this.emit(j.DataPacketReceived,c))}finally{o()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?q.LOSSY:q.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(j.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===vu&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Be.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Ut.Connected&&i();const s=()=>{this.off(j.Disconnected,o),i()},o=()=>{this.off(j.Restarted,s),r()};this.once(j.Restarted,s),this.once(j.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(j.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===q.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===ce.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(or.RR_SIGNAL_DISCONNECTED))},this.log=Un((n=e.loggerName)!==null&&n!==void 0?n:Gt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new lp(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ye,this.dataProcessLock=new Ye,this.dcBufferStatus=new Map([[q.LOSSY,!0],[q.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(j.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(j.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(j.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(j.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(j.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(j.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(j.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(j.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return C(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,this.emit(j.SignalConnected,s),s}catch(s){if(s instanceof se&&s.reason===X.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return C(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(j.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return C(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Lv,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return C(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new En("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new se("publication of local track timed out, no response from server",X.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return C(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return C(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ke.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new WD(r,e.subscriberPrimary,this.loggerOptions),this.emit(j.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>C(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ke.CONNECTED){const u=this.pcState===Ut.New;this.pcState=Ut.Connected,u&&this.emit(j.Connected,e)}else s===ke.FAILED&&this.pcState===Ut.Connected&&(this.pcState=Ut.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?or.RR_SUBSCRIBER_FAILED:or.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===ce.RECONNECTING,l=[ke.FAILED,ke.CLOSING,ke.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(j.Offline)}),this.pcManager.onTrack=s=>{this.emit(j.MediaTrackAdded,s.track,s.streams[0],s.receiver)},hO((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>C(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>C(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(j.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(j.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(j.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(j.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(j.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",or.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Nr.DISCONNECT:this.emit(j.Disconnected,e==null?void 0:e.reason),this.close();break;case Nr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(vu);break;case Nr.RESUME:this.handleDisconnect(vu)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===To.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Qv,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Jv,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return C(this,void 0,void 0,function*(){if(Zd())return yield this.createTransceiverRTCRtpSender(e,n,i);if(eh())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ae("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(Zd())return this.createSimulcastTransceiverSender(e,n,i,r);if(eh())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ae("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),er(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return C(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Q.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===To.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ke.NEW)===ke.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Ae?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof ar||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",or.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(j.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return C(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Ae("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(j.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ar;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof se&&o.reason===X.NotAllowed?new Ae("could not reconnect, token might be expired"):new ar}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(j.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==ce.CONNECTED)throw new ar("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(j.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return C(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ae("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ae("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(j.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof se&&r.reason===X.NotAllowed?new Ae("could not reconnect, token might be expired"):r instanceof se&&r.reason===X.LeaveRequest?r:new ar(s)}if(this.emit(j.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ce.CONNECTED)throw new ar("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(j.Resumed)})}waitForPCInitialConnection(e,n){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ae("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return C(this,void 0,void 0,function*(){this.pcState=Ut.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield lt(lO),!this.pcManager)throw new Ae("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ut.Connected}catch(e){throw this.pcState=Ut.Disconnected,new se("could not establish PC connection, ".concat(e.message),X.InternalError)}})}publishRpcResponse(e,n,i,r){return C(this,void 0,void 0,function*(){const s=new tt({destinationIdentities:[e],kind:q.RELIABLE,value:{case:"rpcResponse",value:new DS({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,q.RELIABLE)})}publishRpcAck(e,n){return C(this,void 0,void 0,function*(){const i=new tt({destinationIdentities:[e],kind:q.RELIABLE,value:{case:"rpcAck",value:new AS({requestId:n})}});yield this.sendDataPacket(i,q.RELIABLE)})}sendDataPacket(e,n){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===q.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===q.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(q.RELIABLE);const n=this.dataChannelForKind(q.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(q.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>C(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(j.Closing,r);!this.dcBufferStatus.get(e);)yield lt(10);this.off(j.Closing,r),n()}}))}ensureDataTransportConnected(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Ae("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new se("".concat(a," connection not set"),X.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield lt(50)}throw new se("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),X.InternalError)}()})}ensurePublisherConnected(e){return C(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ke.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return C(this,void 0,void 0,function*(){return new Promise((e,n)=>C(this,void 0,void 0,function*(){if(!this.pcManager){n(new Jd("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(j.Closing,r),this.pcManager.publisher.once(jr.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();fD(c)&&o.set(a.payload,c)}),this.emit(j.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof Jd&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",or.RR_UNKNOWN),n(s)}finally{this.off(j.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===q.LOSSY)return this.lossyDCSub;if(e===q.RELIABLE)return this.reliableDCSub}else{if(e===q.LOSSY)return this.lossyDC;if(e===q.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new QS({answer:s?Tc({sdp:s.sdp,type:s.type}):void 0,offer:o?Tc({sdp:o.sdp,type:o.type}):void 0,subscription:new il({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:TD(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((u,d)=>new JS({publisherSid:d,lastSeq:u}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new YS({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(q.LOSSY),$t.PUBLISHER),n(this.dataChannelForKind(q.RELIABLE),$t.PUBLISHER),n(this.dataChannelForKind(q.LOSSY,!0),$t.SUBSCRIBER),n(this.dataChannelForKind(q.RELIABLE,!0),$t.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Be.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){st()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){st()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class ar extends Error{}function hO(t){return t!==void 0&&t>13}function fO(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class dh{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return ih(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return C(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),Q.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return C(this,void 0,void 0,function*(){const n=yield fetch("".concat(pO(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new se("Could not fetch region settings: ".concat(n.statusText),n.status===401?X.NotAllowed:X.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function pO(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class WT{get info(){return this._info}constructor(e,n,i){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class mO extends WT{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>C(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return C(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return C(this,void 0,void 0,function*(){var e,n,i,r;let s=new Set;try{for(var o=!0,a=Pn(this),c;c=yield a.next(),e=c.done,!e;o=!0){r=c.value,o=!1;const l=r;s.add(l)}}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return Array.from(s)})}}class gO extends WT{constructor(e,n,i){super(e,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Fa(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>C(this,void 0,void 0,function*(){try{const{done:i,value:r}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:n.decode(r.content)})}catch{return{done:!0,value:void 0}}}),return(){return C(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return C(this,void 0,void 0,function*(){var e,n,i,r;let s="";try{for(var o=!0,a=Pn(this),c;c=yield a.next(),e=c.done,!e;o=!0)r=c.value,o=!1,s+=r}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}}class qT{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return C(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class vO extends qT{}class yO extends qT{}class HT extends x{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?F.Muted:F.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(F.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),pp)),CD()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(F.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class KT extends HT{constructor(e,n,i,r,s,o){super(e,n,x.Kind.Audio,i,o),this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=ol(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;un()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(un())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return C(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(th(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&th(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(F.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(F.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const yu=100;class kO extends HT{constructor(e,n,i,r,s){super(e,n,x.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=ol(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=dp(()=>{this.updateDimensions()},yu),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Ur(this._mediaStreamTrack,n):Er(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new bO(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!r||s;if(this.lastVisible!==o){if(!o&&Date.now()-i<yu){Be.setTimeout(()=>{this.updateVisibility()},yu);return}this.lastVisible=o,this.emit(F.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(F.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?_v():n||(_v()>2?2:1)}}class bO{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=Es(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Es(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Es(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??hh(e),this.isPiP=st()&&Es(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=hh(this.element),this.isPiP=Es(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Av().observe(this.element),Iv().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Av())===null||e===void 0||e.unobserve(this.element),(n=Iv())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Es(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?hh(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function hh(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class Tn extends pn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=ht.NONE,this.log=Q,this.handleMuted=()=>{this.emit(F.Muted)},this.handleUnmuted=()=>{this.emit(F.Unmuted)},this.log=Un((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Gt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=x.Source.Unknown}setTrack(e){this.track&&(this.track.off(F.Muted,this.handleMuted),this.track.off(F.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(F.Muted,this.handleMuted),e.on(F.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),K(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ht.NONE}get audioTrack(){if(cn(this.track))return this.track}get videoTrack(){if(er(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=x.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===x.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Tn||(Tn={}));class fh extends Tn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(F.Ended)},this.handleCpuConstrained=()=>{this.track&&er(this.track)&&this.emit(F.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(F.Ended,this.handleTrackEnded),this.track.off(F.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(F.Ended,this.handleTrackEnded),e.on(F.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(cn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Le.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Le.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Le.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Le.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Le.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Le.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function al(t,e){return C(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=LT(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=MT(s,FT,jT),l=ap(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(Ue.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Ue.userMediaPromiseMap.delete("audioinput"))),s.video&&(Ue.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Ue.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>C(this,void 0,void 0,function*(){const f=h.kind==="audio";let g=f?c.audio:c.video;(typeof g=="boolean"||!g)&&(g={});let p;const S=f?l.audio:l.video;typeof S!="boolean"&&(p=S);const m=h.getSettings().deviceId;p!=null&&p.deviceId&&ui(p.deviceId)!==m?p.deviceId=m:p||(p={deviceId:m});const v=YD(h,p,e);return v.kind===x.Kind.Video?v.source=x.Source.Camera:v.kind===x.Kind.Audio&&(v.source=x.Source.Microphone),v.mediaStream=d,cn(v)&&i?yield v.setProcessor(i):er(v)&&r&&(yield v.setProcessor(r)),v})))}catch(d){if(!n)throw d;return al(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function SO(t){return C(this,void 0,void 0,function*(){return(yield al({audio:!1,video:t??!0}))[0]})}function TO(t){return C(this,void 0,void 0,function*(){return(yield al({audio:t??!0,video:!1}))[0]})}var Yn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Yn||(Yn={}));function CO(t){switch(t){case Ns.EXCELLENT:return Yn.Excellent;case Ns.GOOD:return Yn.Good;case Ns.POOR:return Yn.Poor;case Ns.LOST:return Yn.Lost;default:return Yn.Unknown}}class GT extends pn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===qi.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Mr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:qi.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Yn.Unknown,this.log=Q,this.log=Un((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Gt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new xr,this.once(O.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(x.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(x.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(x.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Mr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Mr.ACTIVE&&this.emit(O.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(O.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(O.ParticipantNameChanged,e)}_setAttributes(e){const n=wD(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(O.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(O.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(O.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=CO(e),n!==this._connectionQuality&&this.emit(O.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>cn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(F.Muted,()=>{this.emit(O.TrackMuted,e)}),e.on(F.Unmuted,()=>{this.emit(O.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case x.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case x.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function wO(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new KS({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}const Yv=15e3;class PO extends GT{constructor(e,n,i,r,s){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ht.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new xr)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a,c,l,u,d;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((l=(c=this.signalConnectedFuture).reject)===null||l===void 0||l.call(c,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(d=(u=this.activeAgentFuture)===null||u===void 0?void 0:u.reject)===null||d===void 0||d.call(u,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var a,c;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new xr),(c=(a=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(a)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:c,message:l}=o,u=this.pendingSignalRequests.get(a);u&&(c!==ip.OK&&u.reject(new Pv(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=Te.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>wO(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),K(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),K(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),K(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.onTrackCpuConstrained=(o,a)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),K(a))),this.emit(O.LocalTrackCpuConstrained,o,a)},this.handleSubscribedQualityUpdate=o=>C(this,void 0,void 0,function*(){var a,c,l,u,d;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const h=this.videoTrackPublications.get(o.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!h.videoTrack)return;const f=yield h.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var g=!0,p=Pn(f),S;S=yield p.next(),a=S.done,!a;g=!0){u=S.value,g=!1;const m=u;eD(m)&&(this.log.debug("publish ".concat(m," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),K(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,m,h.options))}}catch(m){c={error:m}}finally{try{!g&&!a&&(l=p.return)&&(yield l.call(p))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>C(this,void 0,void 0,function*(){if(o.source===x.Source.ScreenShare||o.source===x.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),K(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(kn(o)||Wn(o))try{if(st())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===x.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),K(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),K(o))),kn(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),K(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ht.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(j.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(j.Connected,this.handleReconnected).on(j.SignalConnected,this.handleSignalConnected).on(j.SignalRestarted,this.handleReconnected).on(j.SignalResumed,this.handleReconnected).on(j.Restarting,this.handleReconnecting).on(j.Resuming,this.handleReconnecting).on(j.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(j.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(j.Disconnected,this.handleDisconnected).on(j.SignalRequestResponse,this.handleSignalRequestResponse).on(j.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return C(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>C(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:g=>{c(g),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-f<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(g=>{let[p,S]=g;return this.attributes[p]===S||S===""&&!this.attributes[p]}))){this.pendingSignalRequests.delete(h),a();return}yield lt(50)}c(new Pv("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(x.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(x.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(x.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(O.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){this.encryptionType=e?ht.GCM:ht.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return C(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case x.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case x.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case x.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new En(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(O.MediaDevicesError,l,ah(e)),this.pendingPublishing.delete(e),l}for(const l of c)e===x.Source.Microphone&&cn(l)&&(r!=null&&r.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer());try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),K(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===x.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(x.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return C(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(x.Source.Camera)||this.pendingPublishing.has(x.Source.Microphone))){this.pendingPublishing.add(x.Source.Camera),this.pendingPublishing.add(x.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(x.Source.Camera),this.pendingPublishing.delete(x.Source.Microphone)}}})}createTracks(e){return C(this,void 0,void 0,function*(){var n,i;e??(e={});const r=MT(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield al(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(cn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=x.Source.Microphone,this.emit(O.AudioStreamAcquired)),er(a)&&(this.cameraError=void 0,a.source=x.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return C(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new sp("getDisplayMedia not supported");e.resolution===void 0&&!oD()&&(e.resolution=op.h1080fps30.resolution);const n=SD(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new En("no video track found");const s=new wc(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=x.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(O.AudioStreamAcquired);const a=new Cc(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=x.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return C(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;kn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Fr(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let m;switch(i.source){case x.Source.Microphone:m="audioinput";break;case x.Source.Camera:m="videoinput"}m&&s.activeDeviceMap.has(m)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(m)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Cc(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new wc(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new En("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(m=>{m.track&&m.track===i&&(h=m)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),K(h))),h;const f="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:f;g&&(r||(r={}),r.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),K(i))),r.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(u=r.red)!==null&&u!==void 0||(r.red=!1));const p=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r);!cD()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const S=new Promise((m,v)=>C(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==ce.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:K(i)}));const y=setTimeout(()=>{v(new wv("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(y);const k=yield this.publish(i,p,g);m(k)}else try{const y=yield this.publish(i,p,g);m(y)}catch(y){v(y)}}catch(y){v(y)}}));s.pendingPublishPromises.set(i,S);try{return yield S}catch(m){throw m}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new xr),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),K(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>PD(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),K(e))),!1)}publish(e,n,i){return C(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,f;if(!this.hasPermissionsToPublish(e))throw new wv("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(D=>Fr(e)&&D.source===e.source)&&e.source!==x.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),K(e))),n.stopMicTrackOnMute&&cn(e)&&(e.stopOnMute=!0),e.source===x.Source.ScreenShare&&Zr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!iD()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!rD()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=ch),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(D=>n.videoCodec===ja(D.mime))||(n.videoCodec=ja(this.enabledPublishVideoCodecs[0].mime)));const p=n.videoCodec;e.on(F.Muted,this.onTrackMuted),e.on(F.Unmuted,this.onTrackUnmuted),e.on(F.Ended,this.handleTrackEnded),e.on(F.UpstreamPaused,this.onTrackUpstreamPaused),e.on(F.UpstreamResumed,this.onTrackUpstreamResumed),e.on(F.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const S=[],m=!(!((r=n.dtx)!==null&&r!==void 0)||r),v=e.getSourceTrackSettings();v.autoGainControl&&S.push(Le.TF_AUTO_GAIN_CONTROL),v.echoCancellation&&S.push(Le.TF_ECHO_CANCELLATION),v.noiseSuppression&&S.push(Le.TF_NOISE_SUPPRESSION),v.channelCount&&v.channelCount>1&&S.push(Le.TF_STEREO),m&&S.push(Le.TF_NO_DTX),kn(e)&&e.hasPreConnectBuffer&&S.push(Le.TF_PRECONNECT_BUFFER);const y=new Bd({cid:e.mediaStreamTrack.id,name:n.name,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:S});let k;if(e.kind===x.Kind.Video){let D={width:0,height:0};try{D=yield e.waitForDimensions()}catch{const M=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Co.h720.resolution;D={width:M.width,height:M.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{dims:D}))}y.width=D.width,y.height=D.height,Wn(e)&&(nn(p)&&(e.source===x.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),K(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),y.simulcastCodecs=[new Vd({codec:p,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:ch}),n.backupCodec&&p!==n.backupCodec.codec&&y.encryption===ht.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),y.simulcastCodecs.push(new Vd({codec:n.backupCodec.codec,cid:""})))),k=uh(e.source===x.Source.ScreenShare,y.width,y.height,n),y.layers=Gv(y.width,y.height,k,nn(n.videoCodec))}else e.kind===x.Kind.Audio&&(k=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ae("cannot publish track when not connected");const b=()=>C(this,void 0,void 0,function*(){var D,I,M;if(!this.engine.pcManager)throw new Ae("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,k),this.emit(O.LocalSenderCreated,e.sender,e),Wn(e)&&((D=n.degradationPreference)!==null&&D!==void 0||(n.degradationPreference=aO(e)),e.setDegradationPreference(n.degradationPreference)),k)if(Zr()&&e.kind===x.Kind.Audio){let V;for(const H of this.engine.pcManager.publisher.getTransceivers())if(H.sender===e.sender){V=H;break}V&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:V,codec:"opus",maxbr:!((I=k[0])===null||I===void 0)&&I.maxBitrate?k[0].maxBitrate/1e3:0})}else e.codec&&nn(e.codec)&&(!((M=k[0])===null||M===void 0)&&M.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:y.cid,codec:e.codec,maxbr:k[0].maxBitrate/1e3});yield this.engine.negotiate()});let w;const P=new Promise((D,I)=>C(this,void 0,void 0,function*(){var M;try{w=yield this.engine.addTrack(y),D(w)}catch(V){e.sender&&(!((M=this.engine.pcManager)===null||M===void 0)&&M.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(H=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{error:H}))})),I(V)}}));if(this.enabledPublishVideoCodecs.length>0)w=(yield Promise.all([P,b()]))[0];else{w=yield P;let D;if(w.codecs.forEach(I=>{D===void 0&&(D=I.mimeType)}),D&&e.kind===x.Kind.Video){const I=ja(D);I!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{codec:I})),n.videoCodec=I,k=uh(e.source===x.Source.ScreenShare,y.width,y.height,n))}yield b()}const E=new fh(e.kind,w,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(E.on(F.CpuConstrained,D=>this.onTrackCpuConstrained(D,E)),E.options=n,e.sid=w.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:k,trackInfo:w})),Wn(e)?e.startMonitor(this.engine.client):kn(e)&&e.startMonitor(),this.addTrackPublication(E),this.emit(O.LocalTrackPublished,E),kn(e)&&w.audioFeatures.includes(Le.TF_PRECONNECT_BUFFER)){const D=e.getPreConnectBuffer();this.on(O.LocalTrackSubscribed,I=>{if(I.trackSid===w.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),K(e))),e.stopPreConnectBuffer()}}),D&&new Promise((M,V)=>C(this,void 0,void 0,function*(){var H,ee,ut,Ie,J,U;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),K(e)));const re=setTimeout(()=>{V(new Error("agent not active within 10 seconds"))},1e4),vn=yield this.waitUntilActiveAgentPresent();clearTimeout(re),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),K(e)));const wt=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[vn.identity],attributes:{trackId:E.trackSid,sampleRate:String((J=v.sampleRate)!==null&&J!==void 0?J:"48000"),channels:String((U=v.channelCount)!==null&&U!==void 0?U:"1")}});try{for(var z=!0,$=Pn(D),ne;ne=yield $.next(),H=ne.done,!H;z=!0){Ie=ne.value,z=!1;const yn=Ie;yield wt.write(yn)}}catch(yn){ee={error:yn}}finally{try{!z&&!H&&(ut=$.return)&&(yield ut.call($))}finally{if(ee)throw ee.error}}yield wt.close(),M()}catch(re){V(re)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),K(e)))}).catch(M=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{error:M}))})}return E})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return C(this,void 0,void 0,function*(){var r;if(this.encryptionType!==ht.NONE)return;let s;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(s=f)}),!s)throw new En("track is not published");if(!Wn(e))throw new En("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=rO(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),K(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new Bd({cid:c.mediaStreamTrack.id,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Gv(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Ae("cannot publish track when not connected");const u=()=>C(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return C(this,void 0,void 0,function*(){var i,r;if(Fr(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),K(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?K(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(F.Muted,this.onTrackMuted),e.off(F.Unmuted,this.onTrackUnmuted),e.off(F.Ended,this.handleTrackEnded),e.off(F.UpstreamPaused,this.onTrackUpstreamPaused),e.off(F.UpstreamResumed,this.onTrackUpstreamResumed),e.off(F.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ke.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Wn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case x.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case x.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(O.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return C(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>C(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>C(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==x.Source.ScreenShare&&l.source!==x.Source.ScreenShareAudio&&(kn(l)||Wn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?q.RELIABLE:q.LOSSY,o=r.destinationIdentities,a=r.topic,c=new tt({kind:s,value:{case:"user",value:new RS({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a})}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return C(this,void 0,void 0,function*(){const i=new tt({kind:q.RELIABLE,value:{case:"sipDtmf",value:new _S({code:e,digit:n})}});yield this.engine.sendDataPacket(i,q.RELIABLE)})}sendChatMessage(e,n){return C(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new tt({value:{case:"chatMessage",value:new Md(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,q.RELIABLE),this.emit(O.ChatMessage,i),i})}editChatMessage(e,n){return C(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new tt({value:{case:"chatMessage",value:new Md(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp),editTimestamp:fe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,q.RELIABLE),this.emit(O.ChatMessage,i),i})}sendText(e,n){return C(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var f;c[h]=d;const g=c.reduce((p,S)=>p+S,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,g)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>C(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:f=>{l(f,h+1)}})})))),u.info})}streamText(e){return C(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new Ld({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:Ri(s.timestamp),totalLength:Ri(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new VS({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Nd.UPDATE:Nd.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new tt({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,q.RELIABLE);let l=0;const u=this,d=new WritableStream({write(g){return C(this,void 0,void 0,function*(){for(const p of kD(g,Yv)){yield u.engine.waitForBufferStatusLow(q.RELIABLE);const S=new Ud({content:p,streamId:r,chunkIndex:Ri(l)}),m=new tt({destinationIdentities:a,value:{case:"streamChunk",value:S}});yield u.engine.sendDataPacket(m,q.RELIABLE),l+=1}})},close(){return C(this,void 0,void 0,function*(){const g=new Fd({streamId:r}),p=new tt({destinationIdentities:a,value:{case:"streamTrailer",value:g}});yield u.engine.sendDataPacket(p,q.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let h=()=>C(this,void 0,void 0,function*(){yield f.close()});u.engine.once(j.Closing,h);const f=new vO(d,s,()=>this.engine.off(j.Closing,h));return f})}sendFile(e,n){return C(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return C(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},u=new Ld({totalLength:Ri((o=l.size)!==null&&o!==void 0?o:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:Ri(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new BS({name:l.name})}}),d=new tt({destinationIdentities:c,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(d,q.RELIABLE);let h=0;const f=new Ye,g=this.engine,p=this.log,S=new WritableStream({write(v){return C(this,void 0,void 0,function*(){const y=yield f.lock();let k=0;try{for(;k<v.byteLength;){const b=v.slice(k,k+Yv);yield g.waitForBufferStatusLow(q.RELIABLE);const w=new tt({destinationIdentities:c,value:{case:"streamChunk",value:new Ud({content:b,streamId:a,chunkIndex:Ri(h)})}});yield g.sendDataPacket(w,q.RELIABLE),h+=1,k+=b.byteLength}}finally{y()}})},close(){return C(this,void 0,void 0,function*(){const v=new Fd({streamId:a}),y=new tt({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield g.sendDataPacket(y,q.RELIABLE)})},abort(v){p.error("Sink error:",v)}});return new yO(S,l)})}performRpc(e){return C(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,u)=>C(i,void 0,void 0,function*(){var d,h,f,g;if(fp(o)>VT){u(Te.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&dn((g=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){u(Te.builtIn("UNSUPPORTED_SERVER"));return}const p=crypto.randomUUID();yield this.publishRpcRequest(r,p,s,o,a-2e3);const S=setTimeout(()=>{this.pendingAcks.delete(p),u(Te.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(p),clearTimeout(m)},2e3);this.pendingAcks.set(p,{resolve:()=>{clearTimeout(S)},participantIdentity:r});const m=setTimeout(()=>{this.pendingResponses.delete(p),u(Te.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(p,{resolve:(v,y)=>{clearTimeout(m),this.pendingAcks.has(p)&&(console.warn("RPC response received before ack",p),this.pendingAcks.delete(p),clearTimeout(S)),y?u(y):l(v??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return C(this,void 0,void 0,function*(){const o=new tt({destinationIdentities:[e],kind:q.RELIABLE,value:{case:"rpcRequest",value:new IS({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,q.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Te.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),K(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new xr),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(kn(r)||Wn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return C(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield lt(20)}})}}class Pc extends Tn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(F.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new il({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new MS({participantSid:"",trackSids:[this.trackSid]})]});this.emit(F.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Tn.SubscriptionStatus.Unsubscribed:super.isSubscribed?Tn.SubscriptionStatus.Subscribed:Tn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Tn.PermissionStatus.Allowed:Tn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(du(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&du(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:pt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(F.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(F.VisibilityChanged,this.handleVisibilityChange),r.off(F.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(F.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(F.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(F.VisibilityChanged,this.handleVisibilityChange),e.on(F.Ended,this.handleEnded),this.emit(F.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(F.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?F.Muted:F.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(F.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(F.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return du(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new zS({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===x.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Mv(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=ED(this.trackInfo,this.requestedMaxQuality);i&&Mv(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:pt.HIGH})),e.quality=pt.HIGH)}this.emit(F.UpdateSettings,e)}}class Ec extends GT{static fromParticipantInfo(e,n,i){return new Ec(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:qi.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(F.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(F.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(F.SubscriptionPermissionChanged,n=>{this.emit(O.TrackSubscriptionPermissionChanged,e,n)}),e.on(F.SubscriptionStatusChanged,n=>{this.emit(O.TrackSubscriptionStatusChanged,e,n)}),e.on(F.Subscribed,n=>{this.emit(O.TrackSubscribed,n,e)}),e.on(F.Unsubscribed,n=>{this.emit(O.TrackUnsubscribed,n,e)}),e.on(F.SubscriptionFailed,n=>{this.emit(O.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(O.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),K(a))),this.emit(O.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new kO(e,n,r,s):l=new KT(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&sh(l)&&cn(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=x.kindFromProto(r.type);if(!c)return;a=new Pc(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==x.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:K(l),newTrack:K(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),K(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(O.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case x.Kind.Audio:this.audioTrackPublications.delete(e);break;case x.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(O.TrackUnpublished,i)}setAudioOutput(e){return C(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;cn(i.track)&&sh(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Y;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Y||(Y={}));const EO=4*1e3;class Fn extends pn.EventEmitter{constructor(e){var n,i,r,s;if(super(),n=this,this.state=Y.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Q,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,c)=>C(this,void 0,void 0,function*(){var l;if(!sD())throw un()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Y.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Y.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),ih(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new dh(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(f=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const d=(f,g,p)=>C(this,void 0,void 0,function*(){var S,m;this.abortController&&this.abortController.abort();const v=new AbortController;this.abortController=v,u==null||u();try{yield this.attemptConnection(p??o,a,c,v),this.abortController=void 0,f()}catch(y){if(this.regionUrlProvider&&y instanceof se&&y.reason!==X.Cancelled&&y.reason!==X.NotAllowed){let k=null;try{k=yield this.regionUrlProvider.getNextBestRegionUrl((S=this.abortController)===null||S===void 0?void 0:S.signal)}catch(b){if(b instanceof se&&(b.status===401||b.reason===X.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(b);return}}k&&!(!((m=this.abortController)===null||m===void 0)&&m.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(y.message,". Retrying with another region: ").concat(k),this.logContext),this.recreateEngine(),yield d(f,g,k)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ov(y)),g(y))}else{let k=Wt.UNKNOWN_REASON;y instanceof se&&(k=Ov(y)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,k),g(y)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new xr((f,g)=>{d(f,g,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>C(this,void 0,void 0,function*(){var h,f,g;const p=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let S=p.serverInfo;if(S||(S={version:p.serverVersion,region:p.serverRegion}),this.serverInfo=S,this.log.debug("connected to Livekit Server ".concat(Object.entries(S).map(m=>{let[v,y]=m;return"".concat(v,": ").concat(y)}).join(", ")),{room:(h=p.room)===null||h===void 0?void 0:h.name,roomSid:(f=p.room)===null||f===void 0?void 0:f.sid,identity:(g=p.participant)===null||g===void 0?void 0:g.identity}),!S.version)throw new WA("unknown server version");return S.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),p}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>C(this,void 0,void 0,function*(){var u,d;this.state===Y.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},hp),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(_.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new se("could not establish signal connection",X.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof se&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new se("Connection attempt aborted",X.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}st()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),st()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Y.Connected),this.emit(_.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return C(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,f,g;const p=yield l.disconnectLock.lock();try{if(l.state===Y.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===Y.Connecting||l.state===Y.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(f=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new se("Client initiated disconnect",X.Cancelled)),l.connectFuture=void 0),!((g=l.engine)===null||g===void 0)&&g.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Wt.CLIENT_INITIATED),l.engine=void 0}finally{p()}}()})},this.onPageLeave=()=>C(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>C(this,void 0,void 0,function*(){const o=[],a=vt();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=uu();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(_.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>C(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Y.Reconnecting)&&this.emit(_.Reconnecting)},this.handleSignalRestarted=o=>C(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Y.Connected),this.emit(_.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===Mr.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(_.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(_.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=x.streamStateFromProto(a.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(O.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(_.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(_.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(O.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(_.SipDTMFReceived,a,o),o==null||o.emit(O.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=mD(a,this.transcriptionReceivedTimes);l==null||l.emit(F.TranscriptionReceived,u),c==null||c.emit(O.TranscriptionReceived,u,l),this.emit(_.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=gD(a);this.emit(_.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(_.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(_.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(_.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(_.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(_.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>C(this,void 0,void 0,function*(){var o;((o=vt())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(_.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(_.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(_.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(_.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(_.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(_.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(_.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(_.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>C(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(F.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(F.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(_.LocalTrackPublished,o,this.localParticipant),kn(o.track)&&(yield o.track.checkForSilence())&&this.emit(_.LocalAudioSilenceDetected,o);const f=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),g=ah(o.source);g&&f&&f!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,f),this.emit(_.ActiveDeviceChanged,g,f))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(F.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(F.Restarted,this.onLocalTrackRestarted),this.emit(_.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>C(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=ah(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(_.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(_.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(_.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(_.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(_.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},$D),e),this.log=Un((i=this.options.loggerName)!==null&&i!==void 0?i:Gt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},FT),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},jT),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},zD),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ye,this.localParticipant=new PO("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ui(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ui(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ui(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),st()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Fn.cleanupRegistry&&Fn.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,i,r,s,o){return C(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Te.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Te.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});fp(u)>VT?(c=Te.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof Te?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=Te.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new xD(this.options.e2ee),this.e2eeManager.on(ei.ParticipantEncryptionStatusChanged,(n,i)=>{yD(i)&&(this.isE2EEEnabled=n),this.emit(_.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(ei.EncryptionError,n=>this.emit(_.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return C(this,void 0,void 0,function*(){return this.state===Y.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(j.RoomUpdate,i),e(r.sid))};this.engine.on(j.RoomUpdate,i),this.once(_.Disconnected,()=>{this.engine.off(j.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new dO(this.options),this.engine.on(j.ParticipantUpdate,this.handleParticipantUpdates).on(j.RoomUpdate,this.handleRoomUpdate).on(j.SpeakersChanged,this.handleSpeakersChanged).on(j.StreamStateChanged,this.handleStreamStateUpdate).on(j.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(j.SubscriptionError,this.handleSubscriptionError).on(j.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(j.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(j.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(j.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(j.DataPacketReceived,this.handleDataPacket).on(j.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Y.SignalReconnecting)&&this.emit(_.SignalReconnecting)}).on(j.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Y.Connected)&&this.emit(_.Reconnected)}).on(j.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Y.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(j.Restarting,this.handleRestarting).on(j.SignalRestarted,this.handleSignalRestarted).on(j.Offline,()=>{this.setAndEmitConnectionState(Y.Reconnecting)&&this.emit(_.Reconnecting)}).on(j.DCBufferStatusChanged,(e,n)=>{this.emit(_.DCBufferStatusChanged,e,n)}).on(j.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(O.LocalTrackSubscribed,n),this.emitWhenConnected(_.LocalTrackSubscribed,n,this.localParticipant)}).on(j.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(_.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ue.getInstance().getDevices(e,n)}prepareConnection(e,n){return C(this,void 0,void 0,function*(){if(this.state===Y.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(ih(new URL(e))&&n){this.regionUrlProvider=new dh(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Y.Disconnected&&(this.regionUrl=i,yield fetch(rh(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(rh(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return C(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Xt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Xt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Xt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Xt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Xt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Xt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Xt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>C(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new rl({reason:Wt.CLIENT_INITIATED,action:Nr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Xt({scenario:{case:"subscriberBandwidth",value:Ri(n)}});break;case"leave-full-reconnect":r=new Xt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,f;let g=!0,p=!1;const S=o?{exact:r}:r;if(i==="audioinput"){p=s.localParticipant.audioTrackPublications.size===0;const m=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=S;const v=Array.from(s.localParticipant.audioTrackPublications.values()).filter(k=>k.source===x.Source.Microphone);try{g=(yield Promise.all(v.map(k=>{var b;return(b=k.audioTrack)===null||b===void 0?void 0:b.setDeviceId(S)}))).every(k=>k===!0)}catch(k){throw s.options.audioCaptureDefaults.deviceId=m,k}const y=v.some(k=>{var b,w;return(w=(b=k.track)===null||b===void 0?void 0:b.isMuted)!==null&&w!==void 0?w:!1});g&&y&&(p=!0)}else if(i==="videoinput"){p=s.localParticipant.videoTrackPublications.size===0;const m=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=S;const v=Array.from(s.localParticipant.videoTrackPublications.values()).filter(k=>k.source===x.Source.Camera);try{g=(yield Promise.all(v.map(k=>{var b;return(b=k.videoTrack)===null||b===void 0?void 0:b.setDeviceId(S)}))).every(k=>k===!0)}catch(k){throw s.options.videoCaptureDefaults.deviceId=m,k}const y=v.some(k=>{var b,w;return(w=(b=k.track)===null||b===void 0?void 0:b.isMuted)!==null&&w!==void 0?w:!1});g&&y&&(p=!0)}else if(i==="audiooutput"){if(p=!0,!th()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(r=(l=yield Ue.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(f=s.options).audioOutput)!==null&&u!==void 0||(f.audioOutput={});const m=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(v=>v.setAudioOutput({deviceId:r})))}catch(v){throw s.options.audioOutput.deviceId=m,v}}return p&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(_.ActiveDeviceChanged,i,r)),g}()})}setupLocalParticipantEvents(){this.localParticipant.on(O.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(O.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(O.AttributesChanged,this.onLocalAttributesChanged).on(O.TrackMuted,this.onLocalTrackMuted).on(O.TrackUnmuted,this.onLocalTrackUnmuted).on(O.LocalTrackPublished,this.onLocalTrackPublished).on(O.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(O.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(O.MediaDevicesError,this.onMediaDevicesError).on(O.AudioStreamAcquired,this.startAudio).on(O.ChatMessage,this.onLocalChatMessageSent).on(O.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Y.Connecting||this.state===Y.Reconnecting){const u=()=>{this.onTrackAdded(e,n,i),d()},d=()=>{this.off(_.Reconnected,u),this.off(_.Connected,u),this.off(_.Disconnected,d)};this.once(_.Reconnected,u),this.once(_.Connected,u),this.once(_.Disconnected,d);return}if(this.state===Y.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=nD(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Y.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(O.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(O.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(O.AttributesChanged,this.onLocalAttributesChanged).off(O.TrackMuted,this.onLocalTrackMuted).off(O.TrackUnmuted,this.onLocalTrackUnmuted).off(O.LocalTrackPublished,this.onLocalTrackPublished).off(O.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(O.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(O.MediaDevicesError,this.onMediaDevicesError).off(O.AudioStreamAcquired,this.startAudio).off(O.ChatMessage,this.onLocalChatMessageSent).off(O.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),st()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Y.Disconnected),this.emit(_.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(_.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return C(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Fa(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new mO(o,a,Fa(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new gO(o,a,Fa(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return C(this,void 0,void 0,function*(){var e,n,i;const r=Ue.getInstance().previousDevices,s=yield Ue.getInstance().getDevices(void 0,!1),o=vt();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(_.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=bD(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(f=>f.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(f=>f.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!nh()||c==="videoinput"||d.length>0&&!d.find(f=>f.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!nh())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return C(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=cp())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),lt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(_.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Ec.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Ec(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(_.ParticipantConnected,i),i.on(O.TrackPublished,r=>{this.emitWhenConnected(_.TrackPublished,r,i)}).on(O.TrackSubscribed,(r,s)=>{r.kind===x.Kind.Audio?(r.on(F.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(F.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===x.Kind.Video&&(r.on(F.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(F.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(_.TrackSubscribed,r,s,i)}).on(O.TrackUnpublished,r=>{this.emit(_.TrackUnpublished,r,i)}).on(O.TrackUnsubscribed,(r,s)=>{this.emit(_.TrackUnsubscribed,r,s,i)}).on(O.TrackMuted,r=>{this.emitWhenConnected(_.TrackMuted,r,i)}).on(O.TrackUnmuted,r=>{this.emitWhenConnected(_.TrackUnmuted,r,i)}).on(O.ParticipantMetadataChanged,r=>{this.emitWhenConnected(_.ParticipantMetadataChanged,r,i)}).on(O.ParticipantNameChanged,r=>{this.emitWhenConnected(_.ParticipantNameChanged,r,i)}).on(O.AttributesChanged,r=>{this.emitWhenConnected(_.ParticipantAttributesChanged,r,i)}).on(O.ConnectionQualityChanged,r=>{this.emitWhenConnected(_.ConnectionQualityChanged,r,i)}).on(O.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(_.ParticipantPermissionsChanged,r,i)}).on(O.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(_.TrackSubscriptionStatusChanged,r,s,i)}).on(O.TrackSubscriptionFailed,(r,s)=>{this.emit(_.TrackSubscriptionFailed,r,i,s)}).on(O.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(_.TrackSubscriptionPermissionChanged,r,s,i)}).on(O.Active,()=>{this.emitWhenConnected(_.ParticipantActive,i),i.kind===qi.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&vD(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Be.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Wt.STATE_MISMATCH))):e=0},EO)}clearConnectionReconcile(){this.connectionReconcileInterval&&Be.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(_.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Y.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Y.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return C(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new nl({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:fe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Wi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(_.SignalConnected),this.emit(_.Connected),this.setAndEmitConnectionState(Y.Connected),r.video){const o=new fh(x.Kind.Video,new Pr({source:xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO,name:"video-dummy"}),new wc(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Dv(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(O.LocalTrackPublished,o)}if(r.audio){const o=new fh(x.Kind.Audio,new Pr({source:xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO}),new Cc(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:uu(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(O.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Wi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Mr.ACTIVE,tracks:[],joinedAt:fe.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=Dv(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Pr({source:xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=uu(),u=new Pr({source:xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==_.ActiveSpeakersChanged&&e!==_.TranscriptionReceived){const s=QT(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Fn.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function QT(t){return t.map(e=>{if(e)return Array.isArray(e)?QT(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Vt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Vt||(Vt={}));class Ti extends pn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Vt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Fn(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return C(this,void 0,void 0,function*(){if(this.status!==Vt.IDLE)throw Error("check is running already");this.setStatus(Vt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Vt.SKIPPED&&this.setStatus(this.isSuccess()?Vt.SUCCESS:Vt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return C(this,void 0,void 0,function*(){return this.room.state===Y.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return C(this,void 0,void 0,function*(){this.room&&this.room.state!==Y.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Vt.SKIPPED)}switchProtocol(e){return C(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(_.Reconnecting,()=>{n=!0}),this.room.once(_.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield lt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class xO extends Ti{get description(){return"Cloud regions"}perform(){return C(this,void 0,void 0,function*(){const e=new dh(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return C(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let g=0;g<c;g++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(g=>{g.type==="candidate-pair"&&g.nominated&&(f.rtt=g.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const ku=1e4;class RO extends Ti{get description(){return"Connection via UDP vs TCP"}perform(){return C(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(ku/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(ku/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return C(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>C(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(u.packetsSent=f.packetsSent,u.qualityLimitationDurations=f.qualityLimitationDurations,u.bitrateTotal+=f.targetBitrate,u.count++):f.type==="remote-inbound-rtp"&&(u.packetsLost=f.packetsLost,u.rttTotal+=f.roundTripTime,u.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,ku)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class _O extends Ti{get description(){return"Can publish audio"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield TO();if(yield NT(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class IO extends Ti{get description(){return"Can publish video"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield SO();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return C(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const f=l.getContext("2d");f.drawImage(i,0,0);const p=f.getImageData(0,0,l.width,l.height).data;let S=!0;for(let m=0;m<p.length;m+=4)if(p[m]!==0||p[m+1]!==0||p[m+2]!==0){S=!1;break}S?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class AO extends Ti{get description(){return"Resuming connection after interruption"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(_.SignalReconnecting,a).on(_.Reconnecting,a).on(_.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==Y.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class DO extends Ti{get description(){return"Can connect via TURN"}perform(){return C(this,void 0,void 0,function*(){var e,n;const i=new lp,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class OO extends Ti{get description(){return"Establishing WebRTC connection"}perform(){return C(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(_.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(MO(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),Q.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function MO(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class NO extends Ti{get description(){return"Connecting to signal connection via WebSocket"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new lp;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===LS.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class YL extends pn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Vt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Vt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return C(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(NO)})}checkWebRTC(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(OO)})}checkTURN(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(DO)})}checkReconnect(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(AO)})}checkPublishAudio(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(_O)})}checkPublishVideo(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(IO)})}checkConnectionProtocol(){return C(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(RO);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(xO)})}}const Xv="https://realtime-api.convai.com",LO=()=>{const[t]=T.useState(new Fn),[e,n]=T.useState(!1),[i,r]=T.useState(!1),[s,o]=T.useState("Idle"),[a,c]=T.useState([]);T.useEffect(()=>{if(!t)return;const f=(g,p)=>{var S,m,v,y,k;try{const w=new TextDecoder().decode(g),P=JSON.parse(w);console.group(" WebRTC Data Message Received"),console.log("From:",(p==null?void 0:p.identity)||"Unknown participant"),console.log("Participant SID:",(p==null?void 0:p.sid)||"Unknown"),console.log("Message Type:",P.type||"No type specified"),console.log("Timestamp:",new Date().toISOString()),console.log("Raw bytes length:",g.length),console.log("Parsed Data:",P),console.groupEnd();const E=new Date().toISOString(),D=`${P.type}-${Date.now()}-${Math.random()}`;switch(P.type){case"user-llm-text":if((S=P.data)!=null&&S.text){const I={id:D,type:"user",content:P.data.text,timestamp:E};c(M=>[...M,I]),console.log(" User Message:",P.data.text)}break;case"bot-llm-text":if((m=P.data)!=null&&m.text){const I={id:D,type:"convai",content:P.data.text,timestamp:E};c(M=>[...M,I]),console.log(" Convai Response:",P.data.text)}break;case"server-message":if((v=P.data)!=null&&v.emotion){const I={id:D,type:"emotion",content:P.data.emotion,timestamp:E};c(M=>[...M,I]),console.log(" Emotion:",P.data.emotion)}else if(((y=P.data)==null?void 0:y.type)==="behavior-tree-response"&&((k=P.data)!=null&&k.narrative_section_id)){const I={id:D,type:"behavior-tree",content:P.data.narrative_section_id,timestamp:E};c(M=>[...M,I]),console.log(" Behavior Tree:",P.data.narrative_section_id)}break}P.type&&P.type.includes("rtvi")&&console.log(" RTVI Message:",P),P.type==="trigger-message"&&console.log(" Trigger Message Response:",P)}catch(b){console.group(" Failed to parse incoming data message"),console.error("Parse Error:",b),console.log("Raw bytes length:",g.length);try{const P=new TextDecoder().decode(g);console.log("Raw string content:",P)}catch(w){console.error("Failed to decode as string:",w),console.log("Raw bytes (first 100):",Array.from(g.slice(0,100)))}console.groupEnd()}};return t.on(_.DataReceived,f),console.log(" Data message listener initialized in useConvaiClient"),()=>{t.off(_.DataReceived,f),console.log(" Data message listener cleaned up from useConvaiClient")}},[t]);const l=T.useMemo(()=>({isConnected:e,isConnecting:i,isListening:!1,isThinking:!1,isSpeaking:!1,agentState:"disconnected"}),[e,i]),u=T.useCallback(async f=>{if(!f.apiKey||!f.characterId)throw new Error("apiKey and characterId are required");r(!0),o("Connecting...");try{const g={character_id:f.characterId,transport:"livekit",connection_type:"audio",llm_provider:f.llmProvider||"gemini-baml",...f.actionConfig&&{action_config:f.actionConfig}};console.log("Connecting to Convai with config:",{url:f.url||Xv,characterId:f.characterId,llmProvider:f.llmProvider||"gemini-baml",hasActionConfig:!!f.actionConfig});const p=await fetch(`${f.url||Xv}/connect`,{method:"POST",headers:{"x-api-key":f.apiKey,"Content-Type":"application/json"},body:JSON.stringify(g)});if(!p.ok){const m=await p.text();console.error("API Error Response:",{status:p.status,statusText:p.statusText,body:m});let v=`HTTP error! status: ${p.status}`;try{const y=JSON.parse(m);y.message?v=y.message:y.error&&(v=y.error)}catch{m&&(v=`${v}: ${m}`)}throw new Error(v)}const S=await p.json();console.log("Connection data received:",S),await t.connect(S.room_url,S.token,{rtcConfig:{iceTransportPolicy:"relay"}}),f.enableAudio!==!1&&await t.localParticipant.setMicrophoneEnabled(!0),f.enableVideo!==!1&&await t.localParticipant.setCameraEnabled(!0),n(!0),o("Connected"),console.log("Connected to room:",S.room_name),console.log("Session ID:",S.session_id)}catch(g){throw console.error("Connection failed:",g),n(!1),o("Connection failed"),g}finally{r(!1)}},[t]),d=T.useCallback(async()=>{t&&(await t.disconnect(),n(!1),o("Disconnected"),c([]))},[t]),h=T.useCallback((f,g)=>{if(t&&t.localParticipant){const p={type:"rtvi-trigger",trigger:f,message:g||""};t.localParticipant.publishData(new TextEncoder().encode(JSON.stringify(p)),{reliable:!0})}},[t]);return{state:l,connect:u,disconnect:d,messages:[],transcriptions:[],room:t,videoTrack:null,audioTrack:null,sendRTVI:h,activity:s,chatMessages:a}},xc=Math.min,Ui=Math.max,Rc=Math.round,ca=Math.floor,ln=t=>({x:t,y:t}),UO={left:"right",right:"left",bottom:"top",top:"bottom"},FO={start:"end",end:"start"};function Zv(t,e,n){return Ui(t,xc(e,n))}function cl(t,e){return typeof t=="function"?t(e):t}function Gi(t){return t.split("-")[0]}function ll(t){return t.split("-")[1]}function JT(t){return t==="x"?"y":"x"}function YT(t){return t==="y"?"height":"width"}function es(t){return["top","bottom"].includes(Gi(t))?"y":"x"}function XT(t){return JT(es(t))}function jO(t,e,n){n===void 0&&(n=!1);const i=ll(t),r=XT(t),s=YT(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=_c(o)),[o,_c(o)]}function VO(t){const e=_c(t);return[ph(t),e,ph(e)]}function ph(t){return t.replace(/start|end/g,e=>FO[e])}function BO(t,e,n){const i=["left","right"],r=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:i:e?i:r;case"left":case"right":return e?s:o;default:return[]}}function zO(t,e,n,i){const r=ll(t);let s=BO(Gi(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(ph)))),s}function _c(t){return t.replace(/left|right|bottom|top/g,e=>UO[e])}function $O(t){return{top:0,right:0,bottom:0,left:0,...t}}function WO(t){return typeof t!="number"?$O(t):{top:t,right:t,bottom:t,left:t}}function Ic(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function e0(t,e,n){let{reference:i,floating:r}=t;const s=es(e),o=XT(e),a=YT(o),c=Gi(e),l=s==="y",u=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,h=i[a]/2-r[a]/2;let f;switch(c){case"top":f={x:u,y:i.y-r.height};break;case"bottom":f={x:u,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:d};break;case"left":f={x:i.x-r.width,y:d};break;default:f={x:i.x,y:i.y}}switch(ll(e)){case"start":f[o]-=h*(n&&l?-1:1);break;case"end":f[o]+=h*(n&&l?-1:1);break}return f}const qO=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:u,y:d}=e0(l,i,c),h=i,f={},g=0;for(let p=0;p<a.length;p++){const{name:S,fn:m}=a[p],{x:v,y,data:k,reset:b}=await m({x:u,y:d,initialPlacement:i,placement:h,strategy:r,middlewareData:f,rects:l,platform:o,elements:{reference:t,floating:e}});u=v??u,d=y??d,f={...f,[S]:{...f[S],...k}},b&&g<=50&&(g++,typeof b=="object"&&(b.placement&&(h=b.placement),b.rects&&(l=b.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):b.rects),{x:u,y:d}=e0(l,h,c)),p=-1)}return{x:u,y:d,placement:h,strategy:r,middlewareData:f}};async function ZT(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=cl(e,t),g=WO(f),p=a[h?d==="floating"?"reference":"floating":d],S=Ic(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(p)))==null||n?p:p.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),m=d==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,v=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),y=await(s.isElement==null?void 0:s.isElement(v))?await(s.getScale==null?void 0:s.getScale(v))||{x:1,y:1}:{x:1,y:1},k=Ic(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:m,offsetParent:v,strategy:c}):m);return{top:(S.top-k.top+g.top)/y.y,bottom:(k.bottom-S.bottom+g.bottom)/y.y,left:(S.left-k.left+g.left)/y.x,right:(k.right-S.right+g.right)/y.x}}const HO=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:p=!0,...S}=cl(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const m=Gi(r),v=es(a),y=Gi(a)===a,k=await(c.isRTL==null?void 0:c.isRTL(l.floating)),b=h||(y||!p?[_c(a)]:VO(a)),w=g!=="none";!h&&w&&b.push(...zO(a,p,g,k));const P=[a,...b],E=await ZT(e,S),D=[];let I=((i=s.flip)==null?void 0:i.overflows)||[];if(u&&D.push(E[m]),d){const ee=jO(r,o,k);D.push(E[ee[0]],E[ee[1]])}if(I=[...I,{placement:r,overflows:D}],!D.every(ee=>ee<=0)){var M,V;const ee=(((M=s.flip)==null?void 0:M.index)||0)+1,ut=P[ee];if(ut)return{data:{index:ee,overflows:I},reset:{placement:ut}};let Ie=(V=I.filter(J=>J.overflows[0]<=0).sort((J,U)=>J.overflows[1]-U.overflows[1])[0])==null?void 0:V.placement;if(!Ie)switch(f){case"bestFit":{var H;const J=(H=I.filter(U=>{if(w){const z=es(U.placement);return z===v||z==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(z=>z>0).reduce((z,$)=>z+$,0)]).sort((U,z)=>U[1]-z[1])[0])==null?void 0:H[0];J&&(Ie=J);break}case"initialPlacement":Ie=a;break}if(r!==Ie)return{reset:{placement:Ie}}}return{}}}};async function KO(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=Gi(n),a=ll(n),c=es(n)==="y",l=["left","top"].includes(o)?-1:1,u=s&&c?-1:1,d=cl(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(f=a==="end"?g*-1:g),c?{x:f*u,y:h*l}:{x:h*l,y:f*u}}const GO=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,c=await KO(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+c.x,y:s+c.y,data:{...c,placement:o}}}}},QO=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:m,y:v}=S;return{x:m,y:v}}},...c}=cl(t,e),l={x:n,y:i},u=await ZT(e,c),d=es(Gi(r)),h=JT(d);let f=l[h],g=l[d];if(s){const S=h==="y"?"top":"left",m=h==="y"?"bottom":"right",v=f+u[S],y=f-u[m];f=Zv(v,f,y)}if(o){const S=d==="y"?"top":"left",m=d==="y"?"bottom":"right",v=g+u[S],y=g-u[m];g=Zv(v,g,y)}const p=a.fn({...e,[h]:f,[d]:g});return{...p,data:{x:p.x-n,y:p.y-i,enabled:{[h]:s,[d]:o}}}}}};function ul(){return typeof window<"u"}function cs(t){return eC(t)?(t.nodeName||"").toLowerCase():"#document"}function yt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function mn(t){var e;return(e=(eC(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function eC(t){return ul()?t instanceof Node||t instanceof yt(t).Node:!1}function Qt(t){return ul()?t instanceof Element||t instanceof yt(t).Element:!1}function hn(t){return ul()?t instanceof HTMLElement||t instanceof yt(t).HTMLElement:!1}function t0(t){return!ul()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof yt(t).ShadowRoot}function Lo(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=Jt(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(r)}function JO(t){return["table","td","th"].includes(cs(t))}function dl(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function gp(t){const e=vp(),n=Qt(t)?Jt(t):t;return["transform","translate","scale","rotate","perspective"].some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function YO(t){let e=gi(t);for(;hn(e)&&!ts(e);){if(gp(e))return e;if(dl(e))return null;e=gi(e)}return null}function vp(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ts(t){return["html","body","#document"].includes(cs(t))}function Jt(t){return yt(t).getComputedStyle(t)}function hl(t){return Qt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function gi(t){if(cs(t)==="html")return t;const e=t.assignedSlot||t.parentNode||t0(t)&&t.host||mn(t);return t0(e)?e.host:e}function tC(t){const e=gi(t);return ts(e)?t.ownerDocument?t.ownerDocument.body:t.body:hn(e)&&Lo(e)?e:tC(e)}function wo(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=tC(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=yt(r);if(s){const a=mh(o);return e.concat(o,o.visualViewport||[],Lo(r)?r:[],a&&n?wo(a):[])}return e.concat(r,wo(r,[],n))}function mh(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function nC(t){const e=Jt(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=hn(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=Rc(n)!==s||Rc(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function yp(t){return Qt(t)?t:t.contextElement}function Vr(t){const e=yp(t);if(!hn(e))return ln(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=nC(e);let o=(s?Rc(n.width):n.width)/i,a=(s?Rc(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const XO=ln(0);function iC(t){const e=yt(t);return!vp()||!e.visualViewport?XO:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function ZO(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==yt(t)?!1:e}function Qi(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=yp(t);let o=ln(1);e&&(i?Qt(i)&&(o=Vr(i)):o=Vr(t));const a=ZO(s,n,i)?iC(s):ln(0);let c=(r.left+a.x)/o.x,l=(r.top+a.y)/o.y,u=r.width/o.x,d=r.height/o.y;if(s){const h=yt(s),f=i&&Qt(i)?yt(i):i;let g=h,p=mh(g);for(;p&&i&&f!==g;){const S=Vr(p),m=p.getBoundingClientRect(),v=Jt(p),y=m.left+(p.clientLeft+parseFloat(v.paddingLeft))*S.x,k=m.top+(p.clientTop+parseFloat(v.paddingTop))*S.y;c*=S.x,l*=S.y,u*=S.x,d*=S.y,c+=y,l+=k,g=yt(p),p=mh(g)}}return Ic({width:u,height:d,x:c,y:l})}function kp(t,e){const n=hl(t).scrollLeft;return e?e.left+n:Qi(mn(t)).left+n}function rC(t,e,n){n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=i.left+e.scrollLeft-(n?0:kp(t,i)),s=i.top+e.scrollTop;return{x:r,y:s}}function eM(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=mn(i),a=e?dl(e.floating):!1;if(i===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=ln(1);const u=ln(0),d=hn(i);if((d||!d&&!s)&&((cs(i)!=="body"||Lo(o))&&(c=hl(i)),hn(i))){const f=Qi(i);l=Vr(i),u.x=f.x+i.clientLeft,u.y=f.y+i.clientTop}const h=o&&!d&&!s?rC(o,c,!0):ln(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+h.x,y:n.y*l.y-c.scrollTop*l.y+u.y+h.y}}function tM(t){return Array.from(t.getClientRects())}function nM(t){const e=mn(t),n=hl(t),i=t.ownerDocument.body,r=Ui(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Ui(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+kp(t);const a=-n.scrollTop;return Jt(i).direction==="rtl"&&(o+=Ui(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}function iM(t,e){const n=yt(t),i=mn(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,c=0;if(r){s=r.width,o=r.height;const l=vp();(!l||l&&e==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}return{width:s,height:o,x:a,y:c}}function rM(t,e){const n=Qi(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=hn(t)?Vr(t):ln(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=r*s.x,l=i*s.y;return{width:o,height:a,x:c,y:l}}function n0(t,e,n){let i;if(e==="viewport")i=iM(t,n);else if(e==="document")i=nM(mn(t));else if(Qt(e))i=rM(e,n);else{const r=iC(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Ic(i)}function sC(t,e){const n=gi(t);return n===e||!Qt(n)||ts(n)?!1:Jt(n).position==="fixed"||sC(n,e)}function sM(t,e){const n=e.get(t);if(n)return n;let i=wo(t,[],!1).filter(a=>Qt(a)&&cs(a)!=="body"),r=null;const s=Jt(t).position==="fixed";let o=s?gi(t):t;for(;Qt(o)&&!ts(o);){const a=Jt(o),c=gp(o);!c&&a.position==="fixed"&&(r=null),(s?!c&&!r:!c&&a.position==="static"&&r&&["absolute","fixed"].includes(r.position)||Lo(o)&&!c&&sC(t,o))?i=i.filter(l=>l!==o):r=a,o=gi(o)}return e.set(t,i),i}function oM(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const s=[...n==="clippingAncestors"?dl(e)?[]:sM(e,this._c):[].concat(n),i],o=s[0],a=s.reduce((c,l)=>{const u=n0(e,l,r);return c.top=Ui(u.top,c.top),c.right=xc(u.right,c.right),c.bottom=xc(u.bottom,c.bottom),c.left=Ui(u.left,c.left),c},n0(e,o,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function aM(t){const{width:e,height:n}=nC(t);return{width:e,height:n}}function cM(t,e,n){const i=hn(e),r=mn(e),s=n==="fixed",o=Qi(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=ln(0);if(i||!i&&!s)if((cs(e)!=="body"||Lo(r))&&(a=hl(e)),i){const h=Qi(e,!0,s,e);c.x=h.x+e.clientLeft,c.y=h.y+e.clientTop}else r&&(c.x=kp(r));const l=r&&!i&&!s?rC(r,a):ln(0),u=o.left+a.scrollLeft-c.x-l.x,d=o.top+a.scrollTop-c.y-l.y;return{x:u,y:d,width:o.width,height:o.height}}function bu(t){return Jt(t).position==="static"}function i0(t,e){if(!hn(t)||Jt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return mn(t)===n&&(n=n.ownerDocument.body),n}function oC(t,e){const n=yt(t);if(dl(t))return n;if(!hn(t)){let r=gi(t);for(;r&&!ts(r);){if(Qt(r)&&!bu(r))return r;r=gi(r)}return n}let i=i0(t,e);for(;i&&JO(i)&&bu(i);)i=i0(i,e);return i&&ts(i)&&bu(i)&&!gp(i)?n:i||YO(t)||n}const lM=async function(t){const e=this.getOffsetParent||oC,n=this.getDimensions,i=await n(t.floating);return{reference:cM(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function uM(t){return Jt(t).direction==="rtl"}const dM={convertOffsetParentRelativeRectToViewportRelativeRect:eM,getDocumentElement:mn,getClippingRect:oM,getOffsetParent:oC,getElementRects:lM,getClientRects:tM,getDimensions:aM,getScale:Vr,isElement:Qt,isRTL:uM};function aC(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function hM(t,e){let n=null,i;const r=mn(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const l=t.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=l;if(a||e(),!h||!f)return;const g=ca(d),p=ca(r.clientWidth-(u+h)),S=ca(r.clientHeight-(d+f)),m=ca(u),v={rootMargin:-g+"px "+-p+"px "+-S+"px "+-m+"px",threshold:Ui(0,xc(1,c))||1};let y=!0;function k(b){const w=b[0].intersectionRatio;if(w!==c){if(!y)return o();w?o(!1,w):i=setTimeout(()=>{o(!1,1e-7)},1e3)}w===1&&!aC(l,t.getBoundingClientRect())&&o(),y=!1}try{n=new IntersectionObserver(k,{...v,root:r.ownerDocument})}catch{n=new IntersectionObserver(k,v)}n.observe(t)}return o(!0),s}function fM(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=i,l=yp(t),u=r||s?[...l?wo(l):[],...wo(e)]:[];u.forEach(m=>{r&&m.addEventListener("scroll",n,{passive:!0}),s&&m.addEventListener("resize",n)});const d=l&&a?hM(l,n):null;let h=-1,f=null;o&&(f=new ResizeObserver(m=>{let[v]=m;v&&v.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let g,p=c?Qi(t):null;c&&S();function S(){const m=Qi(t);p&&!aC(p,m)&&n(),p=m,g=requestAnimationFrame(S)}return n(),()=>{var m;u.forEach(v=>{r&&v.removeEventListener("scroll",n),s&&v.removeEventListener("resize",n)}),d==null||d(),(m=f)==null||m.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const pM=GO,mM=QO,gM=HO,vM=(t,e,n)=>{const i=new Map,r={platform:dM,...n},s={...r.platform,_c:i};return qO(t,e,{...r,platform:s})};var la=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cC(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gh={exports:{}},yM=gh.exports,r0;function kM(){return r0||(r0=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(yM,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(p,S){var m=p[S];if(typeof m.bind=="function")return m.bind(p);try{return Function.prototype.bind.call(m,p)}catch{return function(){return Function.prototype.apply.apply(m,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?c:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function u(){for(var p=this.getLevel(),S=0;S<r.length;S++){var m=r[S];this[m]=S<p?e:this.methodFactory(m,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function d(p){return function(){typeof console!==n&&(u.call(this),this[p].apply(this,arguments))}}function h(p,S,m){return l(p)||d.apply(this,arguments)}function f(p,S){var m=this,v,y,k,b="loglevel";typeof p=="string"?b+=":"+p:typeof p=="symbol"&&(b=void 0);function w(M){var V=(r[M]||"silent").toUpperCase();if(!(typeof window===n||!b)){try{window.localStorage[b]=V;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+V+";"}catch{}}}function P(){var M;if(!(typeof window===n||!b)){try{M=window.localStorage[b]}catch{}if(typeof M===n)try{var V=window.document.cookie,H=encodeURIComponent(b),ee=V.indexOf(H+"=");ee!==-1&&(M=/^([^;]+)/.exec(V.slice(ee+H.length+1))[1])}catch{}return m.levels[M]===void 0&&(M=void 0),M}}function E(){if(!(typeof window===n||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(M){var V=M;if(typeof V=="string"&&m.levels[V.toUpperCase()]!==void 0&&(V=m.levels[V.toUpperCase()]),typeof V=="number"&&V>=0&&V<=m.levels.SILENT)return V;throw new TypeError("log.setLevel() called with invalid level: "+M)}m.name=p,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=S||h,m.getLevel=function(){return k??y??v},m.setLevel=function(M,V){return k=D(M),V!==!1&&w(k),u.call(m)},m.setDefaultLevel=function(M){y=D(M),P()||m.setLevel(M,!1)},m.resetLevel=function(){k=null,E(),u.call(m)},m.enableAll=function(M){m.setLevel(m.levels.TRACE,M)},m.disableAll=function(M){m.setLevel(m.levels.SILENT,M)},m.rebuild=function(){if(o!==m&&(v=D(o.getLevel())),u.call(m),o===m)for(var M in s)s[M].rebuild()},v=D(o?o.getLevel():"WARN");var I=P();I!=null&&(k=D(I)),u.call(m)}o=new f,o.getLogger=function(p){if(typeof p!="symbol"&&typeof p!="string"||p==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[p];return S||(S=s[p]=new f(p,o.methodFactory)),S};var g=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=g),o},o.getLoggers=function(){return s},o.default=o,o})}(gh)),gh.exports}var bM=kM();const SM=cC(bM);var vh=function(t,e){return vh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},vh(t,e)};function Vn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");vh(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function TM(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function lC(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ns(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ac(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Dc(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function Br(t){return this instanceof Br?(this.v=t,this):new Br(t)}function CM(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(f){return function(g){return Promise.resolve(g).then(f,d)}}function a(f,g){i[f]&&(r[f]=function(p){return new Promise(function(S,m){s.push([f,p,S,m])>1||c(f,p)})},g&&(r[f]=g(r[f])))}function c(f,g){try{l(i[f](g))}catch(p){h(s[0][3],p)}}function l(f){f.value instanceof Br?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,g){f(g),s.shift(),s.length&&c(s[0][0],s[0][1])}}function wM(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ns=="function"?ns(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Me(t){return typeof t=="function"}function bp(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Su=bp(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Oc(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Uo=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=ns(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(p){e={error:p}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Me(u))try{u()}catch(p){s=p instanceof Su?p.errors:[p]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=ns(d),f=h.next();!f.done;f=h.next()){var g=f.value;try{s0(g)}catch(p){s=s??[],p instanceof Su?s=Dc(Dc([],Ac(s)),Ac(p.errors)):s.push(p)}}}catch(p){i={error:p}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}}if(s)throw new Su(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)s0(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Oc(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Oc(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),uC=Uo.EMPTY;function dC(t){return t instanceof Uo||t&&"closed"in t&&Me(t.remove)&&Me(t.add)&&Me(t.unsubscribe)}function s0(t){Me(t)?t():t.unsubscribe()}var PM={Promise:void 0},EM={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Dc([t,e],Ac(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function hC(t){EM.setTimeout(function(){throw t})}function o0(){}function Va(t){t()}var Sp=function(t){Vn(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,dC(n)&&n.add(i)):i.destination=_M,i}return e.create=function(n,i,r){return new yh(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Uo),xM=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){ua(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){ua(i)}else ua(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){ua(n)}},t}(),yh=function(t){Vn(e,t);function e(n,i,r){var s=t.call(this)||this,o;return Me(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new xM(o),s}return e}(Sp);function ua(t){hC(t)}function RM(t){throw t}var _M={closed:!0,next:o0,error:RM,complete:o0},Tp=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function fC(t){return t}function IM(t){return t.length===0?fC:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var _e=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=DM(e)?e:new yh(e,n,i);return Va(function(){var o=r,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=a0(n),new n(function(r,s){var o=new yh({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Tp]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return IM(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=a0(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function a0(t){var e;return(e=t??PM.Promise)!==null&&e!==void 0?e:Promise}function AM(t){return t&&Me(t.next)&&Me(t.error)&&Me(t.complete)}function DM(t){return t&&t instanceof Sp||AM(t)&&dC(t)}function OM(t){return Me(t==null?void 0:t.lift)}function ls(t){return function(e){if(OM(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Po(t,e,n,i,r){return new MM(t,e,n,i,r)}var MM=function(t){Vn(e,t);function e(n,i,r,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=i?function(l){try{i(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Sp),NM=bp(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Eo=function(t){Vn(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new c0(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new NM},e.prototype.next=function(n){var i=this;Va(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=ns(i.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;Va(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;Va(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?uC:(this.currentObservers=null,a.push(n),new Uo(function(){i.currentObservers=null,Oc(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new _e;return n.source=this,n},e.create=function(n,i){return new c0(n,i)},e}(_e),c0=function(t){Vn(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:uC},e}(Eo),LM=function(t){Vn(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Eo),UM={now:function(){return Date.now()}},FM=function(t){Vn(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Uo),l0={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Dc([t,e],Ac(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},jM=function(t){Vn(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),l0.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&l0.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Oc(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(FM),u0=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=UM.now,t}(),VM=function(t){Vn(e,t);function e(n,i){i===void 0&&(i=u0.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}(u0);new VM(jM);function BM(t){return t&&Me(t.schedule)}function zM(t){return t[t.length-1]}function pC(t){return BM(zM(t))?t.pop():void 0}var mC=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function gC(t){return Me(t==null?void 0:t.then)}function vC(t){return Me(t[Tp])}function yC(t){return Symbol.asyncIterator&&Me(t==null?void 0:t[Symbol.asyncIterator])}function kC(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function $M(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var bC=$M();function SC(t){return Me(t==null?void 0:t[bC])}function TC(t){return CM(this,arguments,function(){var e,n,i,r;return lC(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Br(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,Br(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Br(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function CC(t){return Me(t==null?void 0:t.getReader)}function Fo(t){if(t instanceof _e)return t;if(t!=null){if(vC(t))return WM(t);if(mC(t))return qM(t);if(gC(t))return HM(t);if(yC(t))return wC(t);if(SC(t))return KM(t);if(CC(t))return GM(t)}throw kC(t)}function WM(t){return new _e(function(e){var n=t[Tp]();if(Me(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function qM(t){return new _e(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function HM(t){return new _e(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,hC)})}function KM(t){return new _e(function(e){var n,i;try{for(var r=ns(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function wC(t){return new _e(function(e){QM(t,e).catch(function(n){return e.error(n)})})}function GM(t){return wC(TC(t))}function QM(t,e){var n,i,r,s;return TM(this,void 0,void 0,function(){var o,a;return lC(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=wM(t),c.label=1;case 1:return[4,n.next()];case 2:if(i=c.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Fi(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function PC(t,e){return e===void 0&&(e=0),ls(function(n,i){n.subscribe(Po(i,function(r){return Fi(i,t,function(){return i.next(r)},e)},function(){return Fi(i,t,function(){return i.complete()},e)},function(r){return Fi(i,t,function(){return i.error(r)},e)}))})}function EC(t,e){return e===void 0&&(e=0),ls(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function JM(t,e){return Fo(t).pipe(EC(e),PC(e))}function YM(t,e){return Fo(t).pipe(EC(e),PC(e))}function XM(t,e){return new _e(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function ZM(t,e){return new _e(function(n){var i;return Fi(n,e,function(){i=t[bC](),Fi(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Me(i==null?void 0:i.return)&&i.return()}})}function xC(t,e){if(!t)throw new Error("Iterable cannot be null");return new _e(function(n){Fi(n,e,function(){var i=t[Symbol.asyncIterator]();Fi(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function eN(t,e){return xC(TC(t),e)}function tN(t,e){if(t!=null){if(vC(t))return JM(t,e);if(mC(t))return XM(t,e);if(gC(t))return YM(t,e);if(yC(t))return xC(t,e);if(SC(t))return ZM(t,e);if(CC(t))return eN(t,e)}throw kC(t)}function nN(t,e){return e?tN(t,e):Fo(t)}bp(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Ct(t,e){return ls(function(n,i){var r=0;n.subscribe(Po(i,function(s){i.next(t.call(e,s,r++))}))})}function iN(t,e,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,h=function(){d&&!c.length&&!l&&e.complete()},f=function(p){return l<i?g(p):c.push(p)},g=function(p){l++;var S=!1;Fo(n(p,u++)).subscribe(Po(e,function(m){e.next(m)},function(){S=!0},void 0,function(){if(S)try{l--;for(var m=function(){var v=c.shift();o||g(v)};c.length&&l<i;)m();h()}catch(v){e.error(v)}}))};return t.subscribe(Po(e,f,function(){d=!0,h()})),function(){}}function RC(t,e,n){return n===void 0&&(n=1/0),Me(e)?RC(function(i,r){return Ct(function(s,o){return e(i,s,r,o)})(Fo(t(i,r)))},n):(typeof e=="number"&&(n=e),ls(function(i,r){return iN(i,r,t,n)}))}function rN(t){return RC(fC,t)}function sN(){return rN(1)}function kh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return sN()(nN(t,pC(t)))}function oN(t,e){return ls(function(n,i){var r=0;n.subscribe(Po(i,function(s){return t.call(e,s,r++)&&i.next(s)}))})}function gn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=pC(t);return ls(function(i,r){(n?kh(t,i,n):kh(t,i)).subscribe(r)})}var aN=Object.defineProperty,cN=Object.defineProperties,lN=Object.getOwnPropertyDescriptors,d0=Object.getOwnPropertySymbols,uN=Object.prototype.hasOwnProperty,dN=Object.prototype.propertyIsEnumerable,h0=(t,e,n)=>e in t?aN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,bh=(t,e)=>{for(var n in e||(e={}))uN.call(e,n)&&h0(t,n,e[n]);if(d0)for(var n of d0(e))dN.call(e,n)&&h0(t,n,e[n]);return t},hN=(t,e)=>cN(t,lN(e)),tr=(t,e,n)=>new Promise((i,r)=>{var s=c=>{try{a(n.next(c))}catch(l){r(l)}},o=c=>{try{a(n.throw(c))}catch(l){r(l)}},a=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,o);a((n=n.apply(t,e)).next())}),_C="lk";function Cp(t){return typeof t>"u"?!1:fN(t)||pN(t)}function fN(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function pN(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function mN(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function IC(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(mN(t))return`${t.participant.identity}_${t.source}_placeholder`;if(Cp(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}function gN(t,e,n){return fM(t,e,()=>tr(this,null,function*(){const{x:i,y:r}=yield vM(t,e,{placement:"top",middleware:[pM(6),gM(),mM({padding:5})]});n==null||n(i,r)}))}function vN(t,e){return!t.contains(e.target)}var yN=[_.ConnectionStateChanged,_.RoomMetadataChanged,_.ActiveSpeakersChanged,_.ConnectionQualityChanged,_.ParticipantConnected,_.ParticipantDisconnected,_.ParticipantPermissionsChanged,_.ParticipantMetadataChanged,_.ParticipantNameChanged,_.ParticipantAttributesChanged,_.TrackMuted,_.TrackUnmuted,_.TrackPublished,_.TrackUnpublished,_.TrackStreamStateChanged,_.TrackSubscriptionFailed,_.TrackSubscriptionPermissionChanged,_.TrackSubscriptionStatusChanged],AC=[...yN,_.LocalTrackPublished,_.LocalTrackUnpublished],kN=[O.TrackPublished,O.TrackUnpublished,O.TrackMuted,O.TrackUnmuted,O.TrackStreamStateChanged,O.TrackSubscribed,O.TrackUnsubscribed,O.TrackSubscriptionPermissionChanged,O.TrackSubscriptionFailed,O.LocalTrackPublished,O.LocalTrackUnpublished],bN=[O.ConnectionQualityChanged,O.IsSpeakingChanged,O.ParticipantMetadataChanged,O.ParticipantPermissionsChanged,O.TrackMuted,O.TrackUnmuted,O.TrackPublished,O.TrackUnpublished,O.TrackStreamStateChanged,O.TrackSubscriptionFailed,O.TrackSubscriptionPermissionChanged,O.TrackSubscriptionStatusChanged];[...bN,O.LocalTrackPublished,O.LocalTrackUnpublished];var Ee=SM.getLogger("lk-components-js");Ee.setDefaultLevel("WARN");function SN(t,e){var n;return hN(bh({},t),{receivedAtMediaTimestamp:(n=e.rtpTimestamp)!=null?n:0,receivedAt:e.timestamp})}function TN(t,e,n){return[...t,...e].reduceRight((i,r)=>(i.find(s=>s.id===r.id)||i.unshift(r),i),[]).slice(0-n)}function DC(t){return typeof t=="object"}function OC(t){return Array.isArray(t)&&t.filter(DC).length>0}function nr(t){return`${_C}-${t}`}function CN(t){const e=Sh(t),n=wp(t.participant).pipe(Ct(()=>Sh(t)),gn(e));return{className:nr(t.source===x.Source.Camera||t.source===x.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function Sh(t){if(Cp(t))return t.publication;{const{source:e,name:n,participant:i}=t;if(e&&n)return i.getTrackPublications().find(r=>r.source===e&&r.trackName===n);if(n)return i.getTrackPublicationByName(n);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function fl(t,...e){return new _e(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(gn(t))}function MC(t,e){return new _e(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function wN(t){return MC(t,_.ConnectionStateChanged).pipe(Ct(([e])=>e),gn(t.state))}function PN(t,e,n=!0){const i=new _e(s=>{Fn.getLocalDevices(t,n).then(o=>{s.next(o),s.complete()}).catch(o=>{e==null||e(o),s.next([]),s.complete()})}),r=new _e(s=>{var o;const a=()=>tr(this,null,function*(){try{const c=yield Fn.getLocalDevices(t,n);s.next(c)}catch(c){e==null||e(c)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(o=navigator==null?void 0:navigator.mediaDevices)==null||o.addEventListener("devicechange",a)}return()=>{var c;(c=navigator==null?void 0:navigator.mediaDevices)==null||c.removeEventListener("devicechange",a)}});return kh(i,r)}function EN(t){return fl(t,_.AudioPlaybackStatusChanged).pipe(Ct(e=>({canPlayAudio:e.canPlaybackAudio})))}function xN(t){return fl(t,_.VideoPlaybackStatusChanged).pipe(Ct(e=>({canPlayVideo:e.canPlaybackVideo})))}function RN(t,e){return MC(t,_.ActiveDeviceChanged).pipe(oN(([n])=>n===e),Ct(([n,i])=>(Ee.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:n,deviceId:i}),i)))}function NC(t,...e){return new _e(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(gn(t))}function wp(t){return NC(t,O.TrackMuted,O.TrackUnmuted,O.ParticipantPermissionsChanged,O.TrackPublished,O.TrackUnpublished,O.LocalTrackPublished,O.LocalTrackUnpublished,O.MediaDevicesError,O.TrackSubscriptionStatusChanged).pipe(Ct(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(x.Source.Microphone),o=e.getTrackPublication(x.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function LC(t,e){return new _e(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function _N(t,e={}){var n;let i;const r=new _e(c=>(i=c,()=>a.unsubscribe())).pipe(gn(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:AC,o=Array.from(new Set([_.ParticipantConnected,_.ParticipantDisconnected,_.ConnectionStateChanged,...s])),a=fl(t,...o).subscribe(c=>i==null?void 0:i.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&(i==null||i.next(Array.from(t.remoteParticipants.values()))),r}function IN(t){return LC(t,O.ParticipantPermissionsChanged).pipe(Ct(()=>t.permissions),gn(t.permissions))}function f0(t){return typeof t>"u"?new _e:LC(t,O.AttributesChanged).pipe(Ct(([e])=>({changed:e,attributes:t.attributes})),gn({changed:t.attributes,attributes:t.attributes}))}function AN(t,e,n,i,r){const{localParticipant:s}=e,o=(u,d)=>{let h=!1;switch(u){case x.Source.Camera:h=d.isCameraEnabled;break;case x.Source.Microphone:h=d.isMicrophoneEnabled;break;case x.Source.ScreenShare:h=d.isScreenShareEnabled;break}return h},a=wp(s).pipe(Ct(u=>o(t,u.participant)),gn(o(t,s))),c=new Eo,l=(u,d)=>tr(this,null,function*(){try{switch(d??(d=n),c.next(!0),t){case x.Source.Camera:return yield s.setCameraEnabled(u??!s.isCameraEnabled,d,i),s.isCameraEnabled;case x.Source.Microphone:return yield s.setMicrophoneEnabled(u??!s.isMicrophoneEnabled,d,i),s.isMicrophoneEnabled;case x.Source.ScreenShare:return yield s.setScreenShareEnabled(u??!s.isScreenShareEnabled,d,i),s.isScreenShareEnabled;default:throw new TypeError("Tried to toggle unsupported source")}}catch(h){if(r&&h instanceof Error){r==null||r(h);return}else throw h}finally{c.next(!1)}});return{className:nr("button"),toggle:l,enabledObserver:a,pendingObserver:c.asObservable()}}function DN(){let t=!1;const e=new Eo,n=new Eo,i=r=>tr(this,null,function*(){n.next(!0),t=r??!t,e.next(t),n.next(!1)});return{className:nr("button"),toggle:i,enabledObserver:e.asObservable(),pendingObserver:n.asObservable()}}function ON(t,e,n){const i=new LM(void 0),r=RN(e,t),s=(o,...a)=>tr(this,[o,...a],function*(c,l={}){var u,d,h;if(e){Ee.debug(`Switching active device of kind "${t}" with id ${c}.`),yield e.switchActiveDevice(t,c,l.exact);const f=(u=e.getActiveDevice(t))!=null?u:c;f!==c&&c!=="default"&&Ee.info(`We tried to select the device with id (${c}), but the browser decided to select the device with id (${f}) instead.`);let g;t==="audioinput"?g=(d=e.localParticipant.getTrackPublication(x.Source.Microphone))==null?void 0:d.track:t==="videoinput"&&(g=(h=e.localParticipant.getTrackPublication(x.Source.Camera))==null?void 0:h.track);const p=c==="default"&&!g||c==="default"&&(g==null?void 0:g.mediaStreamTrack.label.startsWith("Default"));i.next(p?c:f)}});return{className:nr("media-device-select"),activeDeviceObservable:r,setActiveMediaDevice:s}}function MN(t){const e=n=>{t.disconnect(n)};return{className:nr("disconnect-button"),disconnect:e}}function NN(){const t=e=>tr(this,null,function*(){Ee.info("Start Audio for room: ",e),yield e.startAudio()});return{className:nr("start-audio-button"),roomAudioPlaybackAllowedObservable:EN,handleStartAudioPlayback:t}}function LN(){const t=e=>tr(this,null,function*(){Ee.info("Start Video for room: ",e),yield e.startVideo()});return{className:nr("start-audio-button"),roomVideoPlaybackAllowedObservable:xN,handleStartVideoPlayback:t}}function p0(t,e,n=!0){const i=[t.localParticipant,...Array.from(t.remoteParticipants.values())],r=[];return i.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));r.push(...a)})}),{trackReferences:r,participants:i}}function m0(t,e,n=!1){const{sources:i,kind:r,name:s}=e;return Array.from(t.trackPublications.values()).filter(o=>(!i||i.includes(o.source))&&(!r||o.kind===r)&&(!s||o.trackName===s)&&(!n||o.track)).map(o=>({participant:t,publication:o,source:o.source}))}function UN(t,e,n){var i,r;const s=(i=n.additionalRoomEvents)!=null?i:AC,o=(r=n.onlySubscribed)!=null?r:!0,a=Array.from(new Set([_.ParticipantConnected,_.ParticipantDisconnected,_.ConnectionStateChanged,_.LocalTrackPublished,_.LocalTrackUnpublished,_.TrackPublished,_.TrackUnpublished,_.TrackSubscriptionStatusChanged,...s]).values());return fl(t,...a).pipe(Ct(c=>{const l=p0(c,e,o);return Ee.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),gn(p0(t,e,o)))}function FN(t,e){return NC(t,...kN).pipe(Ct(n=>{const i=m0(n,e);return Ee.debug(`TrackReference[] was updated. (length ${i.length})`,i),i}),gn(m0(t,e)))}function UC(t,e){return new _e(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function jN(t){return UC(t,F.TranscriptionReceived)}function VN(t){return UC(t,F.TimeSyncUpdate).pipe(Ct(([e])=>e))}function BN(t,e){if(typeof localStorage>"u"){Ee.error("Local storage is not available.");return}try{if(e){const n=Object.fromEntries(Object.entries(e).filter(([,i])=>i!==""));localStorage.setItem(t,JSON.stringify(n))}}catch(n){Ee.error(`Error setting item to local storage: ${n}`)}}function zN(t){if(typeof localStorage>"u"){Ee.error("Local storage is not available.");return}try{const e=localStorage.getItem(t);if(!e){Ee.warn(`Item with key ${t} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){Ee.error(`Error getting item from local storage: ${e}`);return}}function $N(t){return{load:()=>zN(t),save:e=>BN(t,e)}}var WN=`${_C}-user-choices`,xs={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"default",audioDeviceId:"default",username:""},{load:qN,save:HN}=$N(WN);function KN(t,e=!1){e!==!0&&HN(t)}function GN(t,e=!1){var n,i,r,s,o;const a={videoEnabled:(n=t==null?void 0:t.videoEnabled)!=null?n:xs.videoEnabled,audioEnabled:(i=t==null?void 0:t.audioEnabled)!=null?i:xs.audioEnabled,videoDeviceId:(r=t==null?void 0:t.videoDeviceId)!=null?r:xs.videoDeviceId,audioDeviceId:(s=t==null?void 0:t.audioDeviceId)!=null?s:xs.audioDeviceId,username:(o=t==null?void 0:t.username)!=null?o:xs.username};if(e)return a;{const c=qN();return bh(bh({},a),c??{})}}T.createContext(void 0);const QN=T.createContext(void 0);function FC(){return T.useContext(QN)}function jC(t){const e=FC(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}const JN=T.createContext(void 0);function VC(){return T.useContext(JN)}const pl=T.createContext(void 0);function Pp(){const t=T.useContext(pl);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function ml(){return T.useContext(pl)}function us(t){const e=ml(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}T.createContext(void 0);function BC(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=BC(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function zC(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=BC(t))&&(i&&(i+=" "),i+=e);return i}function YN(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(i){console.error(i)}}}function jo(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const i=t[n];for(const r in i){const s=e[r],o=i[r];typeof s=="function"&&typeof o=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=YN(s,o):(r==="className"||r==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[r]=zC(s,o):e[r]=o!==void 0?o:s}}return e}function XN(t){return t!==void 0}function gl(...t){return jo(...t.filter(XN))}function ZN(t,e,n){return T.Children.map(t,i=>T.isValidElement(i)&&T.Children.only(t)?(i.props.className&&(e??(e={}),e.className=zC(i.props.className,e.className),e.style={...i.props.style,...e.style}),T.cloneElement(i,{...e,key:n})):i)}function fn(t,e,n=!0){const[i,r]=T.useState(e);return T.useEffect(()=>{if(n&&r(e),typeof window>"u"||!t)return;const s=t.subscribe(r);return()=>s.unsubscribe()},[t,n]),i}function $C(t){const e=us(t),n=T.useMemo(()=>wN(e),[e]);return fn(n,e.state)}function eL(t){const e=Pp(),n=$C(e);return{buttonProps:T.useMemo(()=>{const{className:i,disconnect:r}=MN(e);return jo(t,{className:i,onClick:()=>r(t.stopTracks??!0),disabled:n===Y.Disconnected})},[e,t,n])}}function WC(t={}){const e=us(t.room),[n,i]=T.useState(e.localParticipant),[r,s]=T.useState(n.isMicrophoneEnabled),[o,a]=T.useState(n.isCameraEnabled),[c,l]=T.useState(n.isScreenShareEnabled),[u,d]=T.useState(n.lastMicrophoneError),[h,f]=T.useState(n.lastCameraError),[g,p]=T.useState(void 0),[S,m]=T.useState(void 0),v=y=>{a(y.isCameraEnabled),s(y.isMicrophoneEnabled),l(y.isScreenShareEnabled),m(y.cameraTrack),p(y.microphoneTrack),d(y.participant.lastMicrophoneError),f(y.participant.lastCameraError),i(y.participant)};return T.useEffect(()=>{const y=wp(e.localParticipant).subscribe(v);return()=>y.unsubscribe()},[e]),{isMicrophoneEnabled:r,isScreenShareEnabled:c,isCameraEnabled:o,microphoneTrack:g,cameraTrack:S,lastMicrophoneError:u,lastCameraError:h,localParticipant:n}}function tL(){const t=Pp(),e=T.useMemo(()=>IN(t.localParticipant),[t]);return fn(e,t.localParticipant.permissions)}function nL({kind:t,room:e,track:n,requestPermissions:i,onError:r}){const s=ml(),o=T.useMemo(()=>e??s??new Fn,[e,s]),a=T.useMemo(()=>PN(t,r,i),[t,i,r]),c=fn(a,[]),[l,u]=T.useState((o==null?void 0:o.getActiveDevice(t))??"default"),{className:d,activeDeviceObservable:h,setActiveMediaDevice:f}=T.useMemo(()=>ON(t,o),[t,o,n]);return T.useEffect(()=>{const g=h.subscribe(p=>{p&&(Ee.info("setCurrentDeviceId",p),u(p))});return()=>{g==null||g.unsubscribe()}},[h]),{devices:c,className:d,activeDeviceId:l,setActiveMediaDevice:f}}function qC(t={}){const e=us(t.room),[n,i]=T.useState([]);return T.useEffect(()=>{const r=_N(e,{additionalRoomEvents:t.updateOnlyOn}).subscribe(i);return()=>r.unsubscribe()},[e,JSON.stringify(t.updateOnlyOn)]),n}function iL({room:t,props:e}){const n=us(t),{className:i,roomAudioPlaybackAllowedObservable:r,handleStartAudioPlayback:s}=T.useMemo(()=>NN(),[]),o=T.useMemo(()=>r(n),[n,r]),{canPlayAudio:a}=fn(o,{canPlayAudio:n.canPlaybackAudio});return{mergedProps:T.useMemo(()=>jo(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayAudio:a}}function rL({room:t,props:e}){const n=us(t),{className:i,roomVideoPlaybackAllowedObservable:r,handleStartVideoPlayback:s}=T.useMemo(()=>LN(),[]),o=T.useMemo(()=>r(n),[n,r]),{canPlayVideo:a}=fn(o,{canPlayVideo:n.canPlaybackVideo});return{mergedProps:T.useMemo(()=>jo(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayVideo:a}}function sL({source:t,onChange:e,initialState:n,captureOptions:i,publishOptions:r,onDeviceError:s,...o}){var a;const c=ml(),l=(a=c==null?void 0:c.localParticipant)==null?void 0:a.getTrackPublication(t),u=T.useRef(!1),{toggle:d,className:h,pendingObserver:f,enabledObserver:g}=T.useMemo(()=>c?AN(t,c,i,r,s):DN(),[c,t,JSON.stringify(i),r]),p=fn(f,!1),S=fn(g,n??!!(l!=null&&l.isEnabled));T.useEffect(()=>{e==null||e(S,u.current),u.current=!1},[S,e]),T.useEffect(()=>{n!==void 0&&(Ee.debug("forcing initial toggle state",t,n),d(n))},[]);const m=T.useMemo(()=>jo(o,{className:h}),[o,h]),v=T.useCallback(y=>{var k;u.current=!0,d().catch(()=>u.current=!1),(k=o.onClick)==null||k.call(o,y)},[o,d]);return{toggle:d,enabled:S,pending:p,track:l,buttonProps:{...m,"aria-pressed":S,"data-lk-source":t,"data-lk-enabled":S,disabled:p,onClick:v}}}function oL(t=[x.Source.Camera,x.Source.Microphone,x.Source.ScreenShare,x.Source.ScreenShareAudio,x.Source.Unknown],e={}){const n=us(e.room),[i,r]=T.useState([]),[s,o]=T.useState([]),a=T.useMemo(()=>t.map(c=>DC(c)?c.source:c),[JSON.stringify(t)]);return T.useEffect(()=>{const c=UN(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:u})=>{Ee.debug("setting track bundles",l,u),r(l),o(u)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),T.useMemo(()=>{if(OC(t)){const c=cL(t,s),l=Array.from(i);return s.forEach(u=>{c.has(u.identity)&&(c.get(u.identity)??[]).forEach(d=>{if(i.find(({participant:f,publication:g})=>u.identity===f.identity&&g.source===d))return;Ee.debug(`Add ${d} placeholder for participant ${u.identity}.`);const h={participant:u,source:d};l.push(h)})}),l}else return i},[i,s,t])}function aL(t,e){const n=new Set(t);for(const i of e)n.delete(i);return n}function cL(t,e){const n=new Map;if(OC(t)){const i=t.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const s=r.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(aL(new Set(i),new Set(s)));o.length>0&&n.set(r.identity,o)})}return n}function lL(t={}){const[e,n]=T.useState(GN(t.defaults,t.preventLoad??!1)),i=T.useCallback(c=>{n(l=>({...l,audioEnabled:c}))},[]),r=T.useCallback(c=>{n(l=>({...l,videoEnabled:c}))},[]),s=T.useCallback(c=>{n(l=>({...l,audioDeviceId:c}))},[]),o=T.useCallback(c=>{n(l=>({...l,videoDeviceId:c}))},[]),a=T.useCallback(c=>{n(l=>({...l,username:c}))},[]);return T.useEffect(()=>{KN(e,t.preventSave??!1)},[e,t.preventSave]),{userChoices:e,saveAudioInputEnabled:i,saveVideoInputEnabled:r,saveAudioInputDeviceId:s,saveVideoInputDeviceId:o,saveUsername:a}}const uL=t=>{const e=n=>{let i=1-Math.max(-100,Math.min(-10,n))*-1/100;return i=Math.sqrt(i),i};return t.map(n=>n===-1/0?0:e(n))},dL={bands:5,loPass:100,hiPass:600,updateInterval:32,analyserOptions:{fftSize:2048}};function hL(t,e={}){var n;const i=t instanceof x?t:(n=t==null?void 0:t.publication)==null?void 0:n.track,r={...dL,...e},[s,o]=T.useState(new Array(r.bands).fill(0));return T.useEffect(()=>{if(!i||!(i!=null&&i.mediaStream))return;const{analyser:a,cleanup:c}=hD(i,r.analyserOptions),l=a.frequencyBinCount,u=new Float32Array(l),d=setInterval(()=>{a.getFloatFrequencyData(u);let h=new Float32Array(u.length);for(let S=0;S<u.length;S++)h[S]=u[S];h=h.slice(e.loPass,e.hiPass);const f=uL(h),g=Math.ceil(f.length/r.bands),p=[];for(let S=0;S<r.bands;S++){const m=f.slice(S*g,(S+1)*g).reduce((v,y)=>v+=y,0);p.push(m/g)}o(p)},r.updateInterval);return()=>{c(),clearInterval(d)}},[i,i==null?void 0:i.mediaStream,JSON.stringify(e)]),s}function g0(t,e){const n=VC(),i=qC({updateOnlyOn:[]}),r=T.useMemo(()=>e?i.find(o=>o.identity===e):n,[e,i,n]),s=T.useMemo(()=>{if(r)return FN(r,{sources:t})},[r,JSON.stringify(t)]);return fn(s,[])}function fL(t){var e,n,i;const r=T.useMemo(()=>{var s;return(s=t==null?void 0:t.publication)!=null&&s.track?VN(t==null?void 0:t.publication.track):void 0},[(e=t==null?void 0:t.publication)==null?void 0:e.track]);return fn(r,{timestamp:Date.now(),rtpTimestamp:(i=(n=t==null?void 0:t.publication)==null?void 0:n.track)==null?void 0:i.rtpTimestamp})}const pL={bufferSize:100};function mL(t,e){const n={...pL,...e},[i,r]=T.useState([]),s=fL(t),o=a=>{var c;(c=n.onTranscription)==null||c.call(n,a),r(l=>TN(l,a.map(u=>SN(u,s)),n.bufferSize))};return T.useEffect(()=>{if(!(t!=null&&t.publication))return;const a=jN(t.publication).subscribe(c=>{o(...c)});return()=>{a.unsubscribe()}},[t&&IC(t),o]),{segments:i}}function gL(t={}){const e=VC(),n=t.participant??e,i=T.useMemo(()=>f0(n),[n]);return fn(i,{attributes:n==null?void 0:n.attributes})}const v0="lk.agent.state";function HC(){const t=qC(),e=t.find(d=>d.kind===qi.AGENT&&!("lk.publish_on_behalf"in d.attributes)),n=t.find(d=>d.kind===qi.AGENT&&d.attributes["lk.publish_on_behalf"]===(e==null?void 0:e.identity)),i=g0([x.Source.Microphone,x.Source.Camera],e==null?void 0:e.identity),r=g0([x.Source.Microphone,x.Source.Camera],n==null?void 0:n.identity),s=i.find(d=>d.source===x.Source.Microphone)??r.find(d=>d.source===x.Source.Microphone),o=i.find(d=>d.source===x.Source.Camera)??r.find(d=>d.source===x.Source.Camera),{segments:a}=mL(s),c=$C(),{attributes:l}=gL({participant:e}),u=T.useMemo(()=>c===Y.Disconnected?"disconnected":c===Y.Connecting||!e||!(l!=null&&l[v0])?"connecting":l[v0],[l,e,c]);return{agent:e,state:u,audioTrack:s,videoTrack:o,agentTranscriptions:a,agentAttributes:l}}const KC=T.forwardRef(function(t,e){const{buttonProps:n}=eL(t);return T.createElement("button",{ref:e,...n},t.children)}),vL=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),T.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),yL=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),kL=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),T.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),bL=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),T.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),SL=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),TL=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},T.createElement("g",{fill:"currentColor"},T.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),T.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),Tu=T.forwardRef(function({kind:t,initialSelection:e,onActiveDeviceChange:n,onDeviceListChange:i,onDeviceSelectError:r,exactMatch:s,track:o,requestPermissions:a,onError:c,...l},u){const d=ml(),h=T.useRef("default"),f=T.useCallback(w=>{d&&d.emit(_.MediaDevicesError,w),c==null||c(w)},[d,c]),{devices:g,activeDeviceId:p,setActiveMediaDevice:S,className:m}=nL({kind:t,room:d,track:o,requestPermissions:a,onError:f});T.useEffect(()=>{e!==void 0&&S(e)},[S]),T.useEffect(()=>{typeof i=="function"&&i(g)},[i,g]),T.useEffect(()=>{p!==h.current&&(n==null||n(p)),h.current=p},[p]);const v=async w=>{try{await S(w,{exact:s??!0})}catch(P){if(P instanceof Error)r==null||r(P);else throw P}},y=T.useMemo(()=>gl(l,{className:m},{className:"lk-list"}),[m,l]),k=!!g.find(w=>w.label.toLowerCase().startsWith("default"));function b(w,P,E){return w===P||!k&&E===0&&P==="default"}return T.createElement("ul",{ref:u,...y},g.map((w,P)=>T.createElement("li",{key:w.deviceId,id:w.deviceId,"data-lk-active":b(w.deviceId,p,P),"aria-selected":b(w.deviceId,p,P),role:"option"},T.createElement("button",{className:"lk-button",onClick:()=>v(w.deviceId)},w.label))))}),CL=T.forwardRef(function({label:t,...e},n){const i=Pp(),{mergedProps:r,canPlayAudio:s}=iL({room:i,props:e}),{mergedProps:o,canPlayVideo:a}=rL({room:i,props:r}),{style:c,...l}=o;return c.display=s&&a?"none":"block",T.createElement("button",{ref:n,style:c,...l},t??`Start ${s?"Video":"Audio"}`)});function wL(t,e){switch(t){case x.Source.Microphone:return e?T.createElement(bL,null):T.createElement(kL,null);case x.Source.Camera:return e?T.createElement(yL,null):T.createElement(vL,null);case x.Source.ScreenShare:return e?T.createElement(TL,null):T.createElement(SL,null);default:return}}const PL=T.forwardRef(function({showIcon:t,...e},n){const{buttonProps:i,enabled:r}=sL(e),[s,o]=T.useState(!1);return T.useEffect(()=>{o(!0)},[]),s&&T.createElement("button",{ref:n,...i},(t??!0)&&wL(e.source,r),e.children)});function GC(t,e={}){const[n,i]=T.useState(Sh(t)),[r,s]=T.useState(n==null?void 0:n.isMuted),[o,a]=T.useState(n==null?void 0:n.isSubscribed),[c,l]=T.useState(n==null?void 0:n.track),[u,d]=T.useState("landscape"),h=T.useRef(),{className:f,trackObserver:g}=T.useMemo(()=>CN(t),[t.participant.sid??t.participant.identity,t.source,Cp(t)&&t.publication.trackSid]);return T.useEffect(()=>{const p=g.subscribe(S=>{Ee.debug("update track",S),i(S),s(S==null?void 0:S.isMuted),a(S==null?void 0:S.isSubscribed),l(S==null?void 0:S.track)});return()=>p==null?void 0:p.unsubscribe()},[g]),T.useEffect(()=>{var p,S;return c&&(h.current&&c.detach(h.current),(p=e.element)!=null&&p.current&&!(t.participant.isLocal&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),h.current=(S=e.element)==null?void 0:S.current,()=>{h.current&&(c==null||c.detach(h.current))}},[c,e.element]),T.useEffect(()=>{var p,S;if(typeof((p=n==null?void 0:n.dimensions)==null?void 0:p.width)=="number"&&typeof((S=n==null?void 0:n.dimensions)==null?void 0:S.height)=="number"){const m=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(m)}},[n]),{publication:n,isMuted:r,isSubscribed:o,track:c,elementProps:gl(e.props,{className:f,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var Cu,y0;function EL(){if(y0)return Cu;y0=1;var t="Expected a function",e=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof la=="object"&&la&&la.Object===Object&&la,l=typeof self=="object"&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype,h=d.toString,f=Math.max,g=Math.min,p=function(){return u.Date.now()};function S(b,w,P){var E,D,I,M,V,H,ee=0,ut=!1,Ie=!1,J=!0;if(typeof b!="function")throw new TypeError(t);w=k(w)||0,m(P)&&(ut=!!P.leading,Ie="maxWait"in P,I=Ie?f(k(P.maxWait)||0,w):I,J="trailing"in P?!!P.trailing:J);function U(de){var Bn=E,ds=D;return E=D=void 0,ee=de,M=b.apply(ds,Bn),M}function z(de){return ee=de,V=setTimeout(re,w),ut?U(de):M}function $(de){var Bn=de-H,ds=de-ee,Ep=w-Bn;return Ie?g(Ep,I-ds):Ep}function ne(de){var Bn=de-H,ds=de-ee;return H===void 0||Bn>=w||Bn<0||Ie&&ds>=I}function re(){var de=p();if(ne(de))return vn(de);V=setTimeout(re,$(de))}function vn(de){return V=void 0,J&&E?U(de):(E=D=void 0,M)}function wt(){V!==void 0&&clearTimeout(V),ee=0,E=H=D=V=void 0}function yn(){return V===void 0?M:vn(p())}function Ot(){var de=p(),Bn=ne(de);if(E=arguments,D=this,H=de,Bn){if(V===void 0)return z(H);if(Ie)return V=setTimeout(re,w),U(H)}return V===void 0&&(V=setTimeout(re,w)),M}return Ot.cancel=wt,Ot.flush=yn,Ot}function m(b){var w=typeof b;return!!b&&(w=="object"||w=="function")}function v(b){return!!b&&typeof b=="object"}function y(b){return typeof b=="symbol"||v(b)&&h.call(b)==n}function k(b){if(typeof b=="number")return b;if(y(b))return e;if(m(b)){var w=typeof b.valueOf=="function"?b.valueOf():b;b=m(w)?w+"":w}if(typeof b!="string")return b===0?b:+b;b=b.replace(i,"");var P=s.test(b);return P||o.test(b)?a(b.slice(2),P?2:8):r.test(b)?e:+b}return Cu=S,Cu}var xL=EL();const k0=cC(xL);function RL(t){const e=T.useRef(t);e.current=t,T.useEffect(()=>()=>{e.current()},[])}function _L(t,e=500,n){const i=T.useRef();RL(()=>{i.current&&i.current.cancel()});const r=T.useMemo(()=>{const s=k0(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!i.current,o.flush=()=>s.flush(),o},[t,e,n]);return T.useEffect(()=>{i.current=k0(t,e,n)},[t,e,n]),r}function IL(t,e,n){const i=(l,u)=>l===u,r=t instanceof Function?t():t,[s,o]=T.useState(r),a=T.useRef(r),c=_L(o,e,n);return i(a.current,r)||(c(r),a.current=r),[s,c]}function AL({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:i=!1,initialIsIntersecting:r=!1,onChange:s}={}){var o;const[a,c]=T.useState(null),[l,u]=T.useState(()=>({isIntersecting:r,entry:void 0})),d=T.useRef();d.current=s;const h=((o=l.entry)==null?void 0:o.isIntersecting)&&i;T.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||h)return;const p=new IntersectionObserver(S=>{const m=Array.isArray(p.thresholds)?p.thresholds:[p.thresholds];S.forEach(v=>{const y=v.isIntersecting&&m.some(k=>v.intersectionRatio>=k);u({isIntersecting:y,entry:v}),d.current&&d.current(y,v)})},{threshold:t,root:e,rootMargin:n});return p.observe(a),()=>{p.disconnect()}},[a,JSON.stringify(t),e,n,h,i]);const f=T.useRef(null);T.useEffect(()=>{var p;!a&&(p=l.entry)!=null&&p.target&&!i&&!h&&f.current!==l.entry.target&&(f.current=l.entry.target,u({isIntersecting:r,entry:void 0}))},[a,l.entry,i,h,r]);const g=[c,!!l.isIntersecting,l.entry];return g.ref=g[0],g.isIntersecting=g[1],g.entry=g[2],g}const Th=T.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:i,manageSubscription:r,...s},o){const a=jC(i),c=T.useRef(null);T.useImperativeHandle(o,()=>c.current);const l=AL({root:c.current}),[u]=IL(l,3e3);T.useEffect(()=>{r&&a.publication instanceof Pc&&(u==null?void 0:u.isIntersecting)===!1&&(l==null?void 0:l.isIntersecting)===!1&&a.publication.setSubscribed(!1)},[u,a,r]),T.useEffect(()=>{r&&a.publication instanceof Pc&&(l==null?void 0:l.isIntersecting)===!0&&a.publication.setSubscribed(!0)},[l,a,r]);const{elementProps:d,publication:h,isSubscribed:f}=GC(a,{element:c,props:s});T.useEffect(()=>{n==null||n(!!f)},[f,n]);const g=p=>{e==null||e(p),t==null||t({participant:a==null?void 0:a.participant,track:h})};return T.createElement("video",{ref:c,...d,muted:!0,onClick:g})}),DL=T.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...i},r){const s=jC(t),o=T.useRef(null);T.useImperativeHandle(r,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:u}=GC(s,{element:o,props:i});return T.useEffect(()=>{e==null||e(!!c)},[c,e]),T.useEffect(()=>{l===void 0||n===void 0||(l instanceof KT?l.setVolume(n):Ee.warn("Volume can only be set on remote audio tracks."))},[n,l]),T.useEffect(()=>{u===void 0||i.muted===void 0||(u instanceof Pc?u.setEnabled(!i.muted):Ee.warn("Can only call setEnabled on remote track publications."))},[i.muted,u,l]),T.createElement("audio",{ref:o,...a})});function OL({volume:t,muted:e}){const n=oL([x.Source.Microphone,x.Source.ScreenShareAudio,x.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(i=>!i.participant.isLocal&&i.publication.kind===x.Kind.Audio);return T.createElement("div",{style:{display:"none"}},n.map(i=>T.createElement(DL,{key:IC(i),trackRef:i,volume:t,muted:e})))}const ML=t=>{const e=[];for(let n=0;n<t;n++)e.push([n,t-1-n]);return e},b0=t=>[[Math.floor(t/2)],[-1]],NL=(t,e,n)=>{const[i,r]=T.useState(0),[s,o]=T.useState([[]]);T.useEffect(()=>{if(t==="thinking")o(b0(e));else if(t==="connecting"||t==="initializing"){const c=[...ML(e)];o(c)}else o(t==="listening"?b0(e):t===void 0||t==="speaking"?[new Array(e).fill(0).map((c,l)=>l)]:[[]]);r(0)},[t,e]);const a=T.useRef(null);return T.useEffect(()=>{let c=performance.now();const l=u=>{u-c>=n&&(r(d=>d+1),c=u),a.current=requestAnimationFrame(l)};return a.current=requestAnimationFrame(l),()=>{a.current!==null&&cancelAnimationFrame(a.current)}},[n,e,t,s.length]),s[i%s.length]},LL=new Map([["connecting",2e3],["initializing",2e3],["listening",500],["thinking",150]]),UL=(t,e)=>{if(t===void 0)return 1e3;let n=LL.get(t);if(n)switch(t){case"connecting":n/=e;break}return n},QC=T.forwardRef(function({state:t,options:e,barCount:n=15,trackRef:i,children:r,...s},o){const a=gl(s,{className:"lk-audio-bar-visualizer"});let c=FC();i&&(c=i);const l=hL(c,{bands:n,loPass:100,hiPass:200}),u=(e==null?void 0:e.minHeight)??20,d=(e==null?void 0:e.maxHeight)??100,h=NL(t,n,UL(t,n)??100);return T.createElement("div",{ref:o,...a,"data-lk-va-state":t},l.map((f,g)=>r?ZN(r,{"data-lk-highlighted":h.includes(g),"data-lk-bar-index":g,className:"lk-audio-bar",style:{height:`${Math.min(d,Math.max(u,f*100+5))}%`}}):T.createElement("span",{key:g,"data-lk-highlighted":h.includes(g),"data-lk-bar-index":g,className:`lk-audio-bar ${h.includes(g)&&"lk-highlighted"}`,style:{height:`${Math.min(d,Math.max(u,f*100+5))}%`}})))});function FL({kind:t,initialSelection:e,onActiveDeviceChange:n,tracks:i,requestPermissions:r=!1,...s}){const[o,a]=T.useState(!1),[c,l]=T.useState([]),[u,d]=T.useState(!0),[h,f]=T.useState(r),g=(v,y)=>{Ee.debug("handle device change"),a(!1),n==null||n(v,y)},p=T.useRef(null),S=T.useRef(null);T.useLayoutEffect(()=>{o&&f(!0)},[o]),T.useLayoutEffect(()=>{let v;return p.current&&S.current&&(c||u)&&(v=gN(p.current,S.current,(y,k)=>{S.current&&Object.assign(S.current.style,{left:`${y}px`,top:`${k}px`})})),d(!1),()=>{v==null||v()}},[p,S,c,u]);const m=T.useCallback(v=>{S.current&&v.target!==p.current&&o&&vN(S.current,v)&&a(!1)},[o,S,p]);return T.useEffect(()=>(document.addEventListener("click",m),()=>{document.removeEventListener("click",m)}),[m]),T.createElement(T.Fragment,null,T.createElement("button",{className:"lk-button lk-button-menu","aria-pressed":o,...s,onClick:()=>a(!o),ref:p},s.children),!s.disabled&&T.createElement("div",{className:"lk-device-menu",ref:S,style:{visibility:o?"visible":"hidden"}},t?T.createElement(Tu,{initialSelection:e,onActiveDeviceChange:v=>g(t,v),onDeviceListChange:l,kind:t,track:i==null?void 0:i[t],requestPermissions:h}):T.createElement(T.Fragment,null,T.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),T.createElement(Tu,{kind:"audioinput",onActiveDeviceChange:v=>g("audioinput",v),onDeviceListChange:l,track:i==null?void 0:i.audioinput,requestPermissions:h}),T.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),T.createElement(Tu,{kind:"videoinput",onActiveDeviceChange:v=>g("videoinput",v),onDeviceListChange:l,track:i==null?void 0:i.videoinput,requestPermissions:h}))))}function jL({controls:t,saveUserChoices:e=!0,onDeviceError:n,...i}){const r={leave:!0,microphone:!0,...t},s=tL(),{microphoneTrack:o,localParticipant:a}=WC(),c=T.useMemo(()=>({participant:a,source:x.Source.Microphone,publication:o}),[a,o]);s?r.microphone??(r.microphone=s.canPublish):r.microphone=!1;const l=gl({className:"lk-agent-control-bar"},i),{saveAudioInputEnabled:u,saveAudioInputDeviceId:d}=lL({preventSave:!e}),h=T.useCallback((f,g)=>{g&&u(f)},[u]);return T.createElement("div",{...l},r.microphone&&T.createElement("div",{className:"lk-button-group"},T.createElement(PL,{source:x.Source.Microphone,showIcon:!0,onChange:h,onDeviceError:f=>n==null?void 0:n({source:x.Source.Microphone,error:f})},T.createElement(QC,{trackRef:c,barCount:7,options:{minHeight:5}})),T.createElement("div",{className:"lk-button-group-menu"},T.createElement(FL,{kind:"audioinput",onActiveDeviceChange:(f,g)=>d(g??"default")}))),r.leave&&T.createElement(KC,null,"Disconnect"),T.createElement(CL,null))}function VL(){return A.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:A.jsx("path",{d:"M3.16602 3.16666L12.8327 12.8333M12.8327 3.16666L3.16602 12.8333",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square"})})}const BL=({convaiClient:t,onConnect:e})=>{const[n,i]=T.useState(!1),r=T.useRef(null),{state:s,activity:o,chatMessages:a}=t;T.useEffect(()=>{var d;(d=r.current)==null||d.scrollIntoView({behavior:"smooth"})},[a]);const c=()=>s.isConnected?"bg-emerald-400":s.isConnecting?"bg-yellow-400":"bg-slate-400",l=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=d=>{switch(d.type){case"user":return A.jsx("div",{className:"flex justify-end mb-3",children:A.jsxs("div",{className:"bg-emerald-500/20 border border-emerald-500/30 rounded-lg px-3 py-2 max-w-[80%]",children:[A.jsx("p",{className:"text-emerald-300 text-sm",children:d.content}),A.jsx("p",{className:"text-emerald-400/60 text-xs mt-1",children:l(d.timestamp)})]})},d.id);case"convai":return A.jsx("div",{className:"flex justify-start mb-3",children:A.jsxs("div",{className:"bg-slate-700/50 border border-slate-600/30 rounded-lg px-3 py-2 max-w-[80%]",children:[A.jsx("p",{className:"text-slate-200 text-sm",children:d.content}),A.jsx("p",{className:"text-slate-400/60 text-xs mt-1",children:l(d.timestamp)})]})},d.id);case"emotion":return A.jsx("div",{className:"flex justify-center mb-2",children:A.jsx("div",{className:"bg-purple-500/20 border border-purple-500/30 rounded-lg px-3 py-1",children:A.jsxs("p",{className:"text-purple-300 text-xs",children:[" ",d.content]})})},d.id);case"behavior-tree":return A.jsx("div",{className:"flex justify-center mb-2",children:A.jsx("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg px-3 py-1",children:A.jsxs("p",{className:"text-blue-300 text-xs",children:[" ",d.content]})})},d.id);default:return null}};return T.useEffect(()=>{s.isConnected&&n&&i(!1)},[s.isConnected,n]),A.jsx(pl.Provider,{value:t.room,children:A.jsxs("div",{className:"relative",children:[A.jsx("div",{className:"glass-light rounded-t-2xl px-4 py-3 mb-2 border-b border-emerald-500/20",children:A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("div",{className:`w-3 h-3 ${c()} rounded-full animate-pulse`}),A.jsx("span",{className:"text-slate-300 text-sm font-medium",children:"Chat"}),o&&A.jsxs("span",{className:"text-slate-400 text-xs",children:[" ",o]})]}),A.jsx("div",{className:"flex items-center space-x-2",children:A.jsx("button",{onClick:()=>i(!n),className:"p-1.5 hover:bg-emerald-500/20 rounded-lg transition-all duration-200 text-slate-300 hover:text-emerald-300",children:A.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})})]})}),A.jsxs("div",{className:`glass rounded-b-2xl overflow-hidden transition-all duration-300 ${n?"w-80 h-16":"w-96 h-[440px]"}`,children:[!n&&A.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-900/30 h-[360px]",children:[a.length===0?A.jsx("div",{className:"flex items-center justify-center h-full",children:A.jsxs("div",{className:"text-center text-slate-400",children:[A.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),A.jsx("p",{className:"text-sm font-medium mb-1",children:"Voice Assistant Ready"}),A.jsx("p",{className:"text-xs opacity-75",children:"Click connect to start the conversation"})]})}):A.jsx("div",{className:"space-y-2",children:a.map(u)}),A.jsx("div",{ref:r})]}),A.jsx("div",{className:"p-4 border-t border-emerald-500/20",children:s.isConnected?A.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[A.jsx(jL,{controls:{leave:!1}}),A.jsx(KC,{children:A.jsx(VL,{})})]}):A.jsx("button",{onClick:e,disabled:s.isConnecting,className:"w-full px-4 py-2 bg-emerald-500 hover:bg-emerald-600 disabled:bg-emerald-500/50 text-white rounded-lg font-medium transition-colors",children:s.isConnecting?"Connecting...":"Connect"})})]}),A.jsx(OL,{})]})})};function zL(){const{cameraTrack:t,localParticipant:e}=WC();return T.useMemo(()=>({participant:e,source:x.Source.Camera,publication:t}),[e,t])}const $L=({room:t,videoTrack:e})=>{const[n,i]=T.useState(!1);return t?A.jsx(pl.Provider,{value:t,children:A.jsxs("div",{className:"relative",children:[A.jsx("div",{className:"glass-light rounded-t-2xl px-4 py-3 mb-2 border-b border-emerald-500/20",children:A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("div",{className:"w-3 h-3 bg-emerald-400 rounded-full animate-pulse"}),A.jsx("span",{className:"text-emerald-300 text-sm font-medium",children:"Video"})]}),A.jsx("div",{className:"flex items-center space-x-2",children:A.jsx("button",{onClick:()=>i(!n),className:"p-1.5 hover:bg-emerald-500/20 rounded-lg transition-all duration-200 text-slate-300 hover:text-emerald-300",children:A.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})})]})}),A.jsx("div",{className:`glass rounded-b-2xl overflow-hidden transition-all duration-300 ${n?"w-[512px] h-[512px]":"w-80 h-16"}`,children:n?A.jsxs("div",{className:"relative w-full h-full",children:[A.jsx("div",{className:"absolute top-4 right-4 z-10",children:A.jsx(WL,{})}),A.jsx("div",{className:"w-full h-full flex items-center justify-center",children:A.jsx(qL,{})})]}):A.jsx("div",{className:"flex items-center justify-center h-full bg-slate-900/50",children:A.jsxs("div",{className:"flex items-center space-x-3 text-slate-400",children:[A.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center",children:A.jsx("svg",{className:"w-4 h-4 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),A.jsx("span",{className:"text-sm font-medium",children:"Video"})]})})})]})}):A.jsxs("div",{className:"relative",children:[A.jsx("div",{className:"glass-light rounded-t-2xl px-4 py-3 mb-2 border-b border-emerald-500/20",children:A.jsx("div",{className:"flex items-center justify-between",children:A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsx("div",{className:"w-3 h-3 bg-slate-400 rounded-full"}),A.jsx("span",{className:"text-slate-300 text-sm font-medium",children:"Video"})]})})}),A.jsx("div",{className:"glass rounded-b-2xl overflow-hidden w-80 h-16",children:A.jsx("div",{className:"flex items-center justify-center h-full bg-slate-900/50",children:A.jsxs("div",{className:"flex items-center space-x-3 text-slate-400",children:[A.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-500/10 flex items-center justify-center",children:A.jsx("svg",{className:"w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),A.jsx("span",{className:"text-sm font-medium",children:"Not Connected"})]})})})]})},WL=()=>{var n;const t=zL(),{videoTrack:e}=HC();return(n=t.publication)!=null&&n.isSubscribed?A.jsxs("div",{className:"w-48 h-36 rounded-lg overflow-hidden border-2 border-gray-600 relative",children:[A.jsx(Th,{trackRef:t}),A.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"You"}),e&&A.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center",children:A.jsx("div",{className:"w-full h-full",children:A.jsx(Th,{trackRef:e})})})]}):A.jsx("div",{className:"w-48 h-36 bg-gray-800 rounded-lg flex items-center justify-center border-2 border-gray-600",children:A.jsx("span",{className:"text-gray-400 text-sm",children:"Camera Off"})})},qL=()=>{const{state:t,videoTrack:e,audioTrack:n}=HC();return e?A.jsx("div",{className:"h-[512px] w-[512px] rounded-lg overflow-hidden",children:A.jsx(Th,{trackRef:e})}):A.jsx("div",{className:"h-[300px] w-full",children:A.jsx(QC,{state:t,barCount:5,trackRef:n,className:"agent-visualizer",options:{minHeight:24}})})};T.createContext(null);function HL(){const t=LO(),[e,n]=T.useState(null),i=T.useCallback(async()=>{n(null);try{await t.connect({apiKey:"ea401720eb28daa6810bab6508b4188f",characterId:"6bae239c-11ab-11ef-9870-42010a7be00e",enableVideo:!0,enableAudio:!0,llmProvider:"gemini-baml",actionConfig:{actions:["Wave","Flip your hair","Touch user's hair"],characters:[{name:"Ty",bio:"Ty is an AI powered virtual hair stylist trained on 60+ decades of TRESemm expert hair knowledge. She gives personalized, on-demand hair styling advice that people can relate to, as well as answering questions about TRESemm and TRESemm products."},{name:"Player",bio:""}],objects:[{name:"Tresseme shampoo",description:"A shampoo bottle"},{name:"Tresseme conditioner",description:"A conditioner bottle"},{name:"Tresseme hairspray",description:"A hairspray bottle"}],currentAttentionObject:"Tresseme shampoo"}})}catch(r){console.error("Failed to connect:",r),n(r instanceof Error?r.message:"Connection failed")}},[t]);return A.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 relative overflow-hidden",children:[A.jsxs("div",{className:"absolute inset-0",children:[A.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-emerald-500/10 rounded-full blur-3xl animate-pulse"}),A.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-emerald-400/5 rounded-full blur-3xl animate-pulse delay-1000"}),A.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-emerald-300/5 rounded-full blur-3xl animate-pulse delay-500"})]}),A.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-[0.02]"}),A.jsx("div",{className:"relative z-10 w-full h-screen flex items-center justify-center p-8",children:A.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},className:"text-center max-w-3xl mx-auto",children:[A.jsxs(rr.div,{initial:{scale:.9},animate:{scale:1},transition:{duration:.6,delay:.2},className:"mb-8",children:[A.jsx("h1",{className:"text-5xl md:text-7xl font-bold bg-gradient-to-r from-emerald-400 via-emerald-500 to-emerald-600 bg-clip-text text-transparent mb-6 tracking-tight",children:"Convai Handsfree"}),A.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-emerald-500 to-emerald-400 mx-auto rounded-full mb-8"})]}),A.jsx(rr.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"text-xl text-slate-300 mb-12 leading-relaxed max-w-2xl mx-auto",children:"A React package for integrating Convai's AI-powered voice assistants to web for real-time audio/video conversations."}),e&&A.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-300",children:[A.jsx("p",{className:"text-sm font-medium",children:"Connection Error"}),A.jsx("p",{className:"text-xs opacity-75 mt-1",children:e})]}),!t.state.isConnected&&A.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},className:"space-y-6",children:[A.jsxs("div",{className:"flex items-center justify-center space-x-3 text-slate-400",children:[A.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full animate-pulse"}),A.jsx("span",{className:"text-sm font-medium tracking-wide",children:"Ready to connect"})]}),A.jsx("p",{className:"text-sm text-slate-500 max-w-md mx-auto",children:"Click the chat interface in the bottom right to start your conversation"})]}),t.state.isConnected&&A.jsxs(rr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"inline-flex items-center space-x-3 px-6 py-3 bg-emerald-500/10 backdrop-blur-sm border border-emerald-500/20 rounded-2xl",children:[A.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"}),A.jsx("span",{className:"text-emerald-400 font-medium",children:"Connected & Ready"})]})]})}),A.jsx("div",{className:"fixed bottom-5 left-5 z-[999]",children:A.jsx($L,{room:t.room,videoTrack:t.videoTrack})}),A.jsx("div",{className:"fixed bottom-5 right-5 z-[999]",children:A.jsx(BL,{convaiClient:t,onConnect:i})})]})}wu.createRoot(document.getElementById("root")).render(A.jsx(h1.StrictMode,{children:A.jsx(HL,{})}));
