(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function i1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ry={exports:{}},Nc={},_y={exports:{}},G={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xo=Symbol.for("react.element"),r1=Symbol.for("react.portal"),s1=Symbol.for("react.fragment"),o1=Symbol.for("react.strict_mode"),a1=Symbol.for("react.profiler"),c1=Symbol.for("react.provider"),l1=Symbol.for("react.context"),u1=Symbol.for("react.forward_ref"),d1=Symbol.for("react.suspense"),h1=Symbol.for("react.memo"),f1=Symbol.for("react.lazy"),Mp=Symbol.iterator;function p1(t){return t===null||typeof t!="object"?null:(t=Mp&&t[Mp]||t["@@iterator"],typeof t=="function"?t:null)}var Iy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Dy=Object.assign,Ay={};function ns(t,e,n){this.props=t,this.context=e,this.refs=Ay,this.updater=n||Iy}ns.prototype.isReactComponent={};ns.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ns.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function My(){}My.prototype=ns.prototype;function xh(t,e,n){this.props=t,this.context=e,this.refs=Ay,this.updater=n||Iy}var Rh=xh.prototype=new My;Rh.constructor=xh;Dy(Rh,ns.prototype);Rh.isPureReactComponent=!0;var Op=Array.isArray,Oy=Object.prototype.hasOwnProperty,_h={current:null},Ly={key:!0,ref:!0,__self:!0,__source:!0};function Ny(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Oy.call(e,i)&&!Ly.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:xo,type:t,key:s,ref:o,props:r,_owner:_h.current}}function m1(t,e){return{$$typeof:xo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ih(t){return typeof t=="object"&&t!==null&&t.$$typeof===xo}function g1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Lp=/\/+/g;function Sl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?g1(""+t.key):e.toString(36)}function fa(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case xo:case r1:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Sl(o,0):i,Op(r)?(n="",t!=null&&(n=t.replace(Lp,"$&/")+"/"),fa(r,e,n,"",function(l){return l})):r!=null&&(Ih(r)&&(r=m1(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Lp,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Op(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+Sl(s,a);o+=fa(s,e,n,c,r)}else if(c=p1(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+Sl(s,a++),o+=fa(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Bo(t,e,n){if(t==null)return t;var i=[],r=0;return fa(t,i,"","",function(s){return e.call(n,s,r++)}),i}function v1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ze={current:null},pa={transition:null},y1={ReactCurrentDispatcher:Ze,ReactCurrentBatchConfig:pa,ReactCurrentOwner:_h};function Uy(){throw Error("act(...) is not supported in production builds of React.")}G.Children={map:Bo,forEach:function(t,e,n){Bo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Bo(t,function(){e++}),e},toArray:function(t){return Bo(t,function(e){return e})||[]},only:function(t){if(!Ih(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};G.Component=ns;G.Fragment=s1;G.Profiler=a1;G.PureComponent=xh;G.StrictMode=o1;G.Suspense=d1;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y1;G.act=Uy;G.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Dy({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=_h.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Oy.call(e,c)&&!Ly.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:xo,type:t.type,key:r,ref:s,props:i,_owner:o}};G.createContext=function(t){return t={$$typeof:l1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:c1,_context:t},t.Consumer=t};G.createElement=Ny;G.createFactory=function(t){var e=Ny.bind(null,t);return e.type=t,e};G.createRef=function(){return{current:null}};G.forwardRef=function(t){return{$$typeof:u1,render:t}};G.isValidElement=Ih;G.lazy=function(t){return{$$typeof:f1,_payload:{_status:-1,_result:t},_init:v1}};G.memo=function(t,e){return{$$typeof:h1,type:t,compare:e===void 0?null:e}};G.startTransition=function(t){var e=pa.transition;pa.transition={};try{t()}finally{pa.transition=e}};G.unstable_act=Uy;G.useCallback=function(t,e){return Ze.current.useCallback(t,e)};G.useContext=function(t){return Ze.current.useContext(t)};G.useDebugValue=function(){};G.useDeferredValue=function(t){return Ze.current.useDeferredValue(t)};G.useEffect=function(t,e){return Ze.current.useEffect(t,e)};G.useId=function(){return Ze.current.useId()};G.useImperativeHandle=function(t,e,n){return Ze.current.useImperativeHandle(t,e,n)};G.useInsertionEffect=function(t,e){return Ze.current.useInsertionEffect(t,e)};G.useLayoutEffect=function(t,e){return Ze.current.useLayoutEffect(t,e)};G.useMemo=function(t,e){return Ze.current.useMemo(t,e)};G.useReducer=function(t,e,n){return Ze.current.useReducer(t,e,n)};G.useRef=function(t){return Ze.current.useRef(t)};G.useState=function(t){return Ze.current.useState(t)};G.useSyncExternalStore=function(t,e,n){return Ze.current.useSyncExternalStore(t,e,n)};G.useTransition=function(){return Ze.current.useTransition()};G.version="18.3.1";_y.exports=G;var T=_y.exports;const k1=i1(T);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b1=T,S1=Symbol.for("react.element"),T1=Symbol.for("react.fragment"),C1=Object.prototype.hasOwnProperty,w1=b1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,P1={key:!0,ref:!0,__self:!0,__source:!0};function Fy(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)C1.call(e,i)&&!P1.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:S1,type:t,key:s,ref:o,props:r,_owner:w1.current}}Nc.Fragment=T1;Nc.jsx=Fy;Nc.jsxs=Fy;Ry.exports=Nc;var F=Ry.exports,Ru={},jy={exports:{}},St={},Vy={exports:{}},By={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(N,z){var $=N.length;N.push(z);e:for(;0<$;){var ne=$-1>>>1,re=N[ne];if(0<r(re,z))N[ne]=z,N[$]=re,$=ne;else break e}}function n(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var z=N[0],$=N.pop();if($!==z){N[0]=$;e:for(var ne=0,re=N.length,vn=re>>>1;ne<vn;){var wt=2*(ne+1)-1,yn=N[wt],Mt=wt+1,de=N[Mt];if(0>r(yn,$))Mt<re&&0>r(de,yn)?(N[ne]=de,N[Mt]=$,ne=Mt):(N[ne]=yn,N[wt]=$,ne=wt);else if(Mt<re&&0>r(de,$))N[ne]=de,N[Mt]=$,ne=Mt;else break e}}return z}function r(N,z){var $=N.sortIndex-z.sortIndex;return $!==0?$:N.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,f=!1,g=!1,m=!1,S=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(N){for(var z=n(l);z!==null;){if(z.callback===null)i(l);else if(z.startTime<=N)i(l),z.sortIndex=z.expirationTime,e(c,z);else break;z=n(l)}}function b(N){if(m=!1,y(N),!g)if(n(c)!==null)g=!0,Ie(k);else{var z=n(l);z!==null&&J(b,z.startTime-N)}}function k(N,z){g=!1,m&&(m=!1,p(P),P=-1),f=!0;var $=h;try{for(y(z),d=n(c);d!==null&&(!(d.expirationTime>z)||N&&!O());){var ne=d.callback;if(typeof ne=="function"){d.callback=null,h=d.priorityLevel;var re=ne(d.expirationTime<=z);z=t.unstable_now(),typeof re=="function"?d.callback=re:d===n(c)&&i(c),y(z)}else i(c);d=n(c)}if(d!==null)var vn=!0;else{var wt=n(l);wt!==null&&J(b,wt.startTime-z),vn=!1}return vn}finally{d=null,h=$,f=!1}}var w=!1,E=null,P=-1,D=5,I=-1;function O(){return!(t.unstable_now()-I<D)}function V(){if(E!==null){var N=t.unstable_now();I=N;var z=!0;try{z=E(!0,N)}finally{z?H():(w=!1,E=null)}}else w=!1}var H;if(typeof v=="function")H=function(){v(V)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,ut=ee.port2;ee.port1.onmessage=V,H=function(){ut.postMessage(null)}}else H=function(){S(V,0)};function Ie(N){E=N,w||(w=!0,H())}function J(N,z){P=S(function(){N(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,Ie(k))},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(N){switch(h){case 1:case 2:case 3:var z=3;break;default:z=h}var $=h;h=z;try{return N()}finally{h=$}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(N,z){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var $=h;h=N;try{return z()}finally{h=$}},t.unstable_scheduleCallback=function(N,z,$){var ne=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?ne+$:ne):$=ne,N){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=$+re,N={id:u++,callback:z,priorityLevel:N,startTime:$,expirationTime:re,sortIndex:-1},$>ne?(N.sortIndex=$,e(l,N),n(c)===null&&N===n(l)&&(m?(p(P),P=-1):m=!0,J(b,$-ne))):(N.sortIndex=re,e(c,N),g||f||(g=!0,Ie(k))),N},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(N){var z=h;return function(){var $=h;h=z;try{return N.apply(this,arguments)}finally{h=$}}}})(By);Vy.exports=By;var E1=Vy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x1=T,kt=E1;function L(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var zy=new Set,Zs={};function Ji(t,e){Br(t,e),Br(t+"Capture",e)}function Br(t,e){for(Zs[t]=e,t=0;t<e.length;t++)zy.add(e[t])}var An=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_u=Object.prototype.hasOwnProperty,R1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Np={},Up={};function _1(t){return _u.call(Up,t)?!0:_u.call(Np,t)?!1:R1.test(t)?Up[t]=!0:(Np[t]=!0,!1)}function I1(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function D1(t,e,n,i){if(e===null||typeof e>"u"||I1(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function et(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var $e={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){$e[t]=new et(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];$e[e]=new et(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){$e[t]=new et(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){$e[t]=new et(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){$e[t]=new et(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){$e[t]=new et(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){$e[t]=new et(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){$e[t]=new et(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){$e[t]=new et(t,5,!1,t.toLowerCase(),null,!1,!1)});var Dh=/[\-:]([a-z])/g;function Ah(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Dh,Ah);$e[e]=new et(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Dh,Ah);$e[e]=new et(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Dh,Ah);$e[e]=new et(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){$e[t]=new et(t,1,!1,t.toLowerCase(),null,!1,!1)});$e.xlinkHref=new et("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){$e[t]=new et(t,1,!1,t.toLowerCase(),null,!0,!0)});function Mh(t,e,n,i){var r=$e.hasOwnProperty(e)?$e[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(D1(e,n,r,i)&&(n=null),i||r===null?_1(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var jn=x1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zo=Symbol.for("react.element"),ar=Symbol.for("react.portal"),cr=Symbol.for("react.fragment"),Oh=Symbol.for("react.strict_mode"),Iu=Symbol.for("react.profiler"),$y=Symbol.for("react.provider"),Wy=Symbol.for("react.context"),Lh=Symbol.for("react.forward_ref"),Du=Symbol.for("react.suspense"),Au=Symbol.for("react.suspense_list"),Nh=Symbol.for("react.memo"),Kn=Symbol.for("react.lazy"),qy=Symbol.for("react.offscreen"),Fp=Symbol.iterator;function ds(t){return t===null||typeof t!="object"?null:(t=Fp&&t[Fp]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,Tl;function xs(t){if(Tl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Tl=e&&e[1]||""}return`
`+Tl+t}var Cl=!1;function wl(t,e){if(!t||Cl)return"";Cl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Cl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?xs(t):""}function A1(t){switch(t.tag){case 5:return xs(t.type);case 16:return xs("Lazy");case 13:return xs("Suspense");case 19:return xs("SuspenseList");case 0:case 2:case 15:return t=wl(t.type,!1),t;case 11:return t=wl(t.type.render,!1),t;case 1:return t=wl(t.type,!0),t;default:return""}}function Mu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case cr:return"Fragment";case ar:return"Portal";case Iu:return"Profiler";case Oh:return"StrictMode";case Du:return"Suspense";case Au:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Wy:return(t.displayName||"Context")+".Consumer";case $y:return(t._context.displayName||"Context")+".Provider";case Lh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Nh:return e=t.displayName||null,e!==null?e:Mu(t.type)||"Memo";case Kn:e=t._payload,t=t._init;try{return Mu(t(e))}catch{}}return null}function M1(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Mu(e);case 8:return e===Oh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function di(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Hy(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function O1(t){var e=Hy(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $o(t){t._valueTracker||(t._valueTracker=O1(t))}function Ky(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Hy(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function $a(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ou(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function jp(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=di(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Gy(t,e){e=e.checked,e!=null&&Mh(t,"checked",e,!1)}function Lu(t,e){Gy(t,e);var n=di(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Nu(t,e.type,n):e.hasOwnProperty("defaultValue")&&Nu(t,e.type,di(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Vp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Nu(t,e,n){(e!=="number"||$a(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Rs=Array.isArray;function xr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+di(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Uu(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(L(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Bp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(L(92));if(Rs(n)){if(1<n.length)throw Error(L(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:di(n)}}function Qy(t,e){var n=di(e.value),i=di(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function zp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Jy(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Jy(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Wo,Yy=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Wo=Wo||document.createElement("div"),Wo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Wo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function eo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ns={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},L1=["Webkit","ms","Moz","O"];Object.keys(Ns).forEach(function(t){L1.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ns[e]=Ns[t]})});function Xy(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ns.hasOwnProperty(t)&&Ns[t]?(""+e).trim():e+"px"}function Zy(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Xy(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var N1=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ju(t,e){if(e){if(N1[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(L(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(L(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(L(61))}if(e.style!=null&&typeof e.style!="object")throw Error(L(62))}}function Vu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bu=null;function Uh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zu=null,Rr=null,_r=null;function $p(t){if(t=Io(t)){if(typeof zu!="function")throw Error(L(280));var e=t.stateNode;e&&(e=Bc(e),zu(t.stateNode,t.type,e))}}function e0(t){Rr?_r?_r.push(t):_r=[t]:Rr=t}function t0(){if(Rr){var t=Rr,e=_r;if(_r=Rr=null,$p(t),e)for(t=0;t<e.length;t++)$p(e[t])}}function n0(t,e){return t(e)}function i0(){}var Pl=!1;function r0(t,e,n){if(Pl)return t(e,n);Pl=!0;try{return n0(t,e,n)}finally{Pl=!1,(Rr!==null||_r!==null)&&(i0(),t0())}}function to(t,e){var n=t.stateNode;if(n===null)return null;var i=Bc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var $u=!1;if(An)try{var hs={};Object.defineProperty(hs,"passive",{get:function(){$u=!0}}),window.addEventListener("test",hs,hs),window.removeEventListener("test",hs,hs)}catch{$u=!1}function U1(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Us=!1,Wa=null,qa=!1,Wu=null,F1={onError:function(t){Us=!0,Wa=t}};function j1(t,e,n,i,r,s,o,a,c){Us=!1,Wa=null,U1.apply(F1,arguments)}function V1(t,e,n,i,r,s,o,a,c){if(j1.apply(this,arguments),Us){if(Us){var l=Wa;Us=!1,Wa=null}else throw Error(L(198));qa||(qa=!0,Wu=l)}}function Yi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function s0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Wp(t){if(Yi(t)!==t)throw Error(L(188))}function B1(t){var e=t.alternate;if(!e){if(e=Yi(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Wp(r),t;if(s===i)return Wp(r),e;s=s.sibling}throw Error(L(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(L(189))}}if(n.alternate!==i)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function o0(t){return t=B1(t),t!==null?a0(t):null}function a0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=a0(t);if(e!==null)return e;t=t.sibling}return null}var c0=kt.unstable_scheduleCallback,qp=kt.unstable_cancelCallback,z1=kt.unstable_shouldYield,$1=kt.unstable_requestPaint,we=kt.unstable_now,W1=kt.unstable_getCurrentPriorityLevel,Fh=kt.unstable_ImmediatePriority,l0=kt.unstable_UserBlockingPriority,Ha=kt.unstable_NormalPriority,q1=kt.unstable_LowPriority,u0=kt.unstable_IdlePriority,Uc=null,rn=null;function H1(t){if(rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(Uc,t,void 0,(t.current.flags&128)===128)}catch{}}var qt=Math.clz32?Math.clz32:Q1,K1=Math.log,G1=Math.LN2;function Q1(t){return t>>>=0,t===0?32:31-(K1(t)/G1|0)|0}var qo=64,Ho=4194304;function _s(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ka(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=_s(a):(s&=o,s!==0&&(i=_s(s)))}else o=n&~r,o!==0?i=_s(o):s!==0&&(i=_s(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-qt(e),r=1<<n,i|=t[n],e&=~r;return i}function J1(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Y1(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-qt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=J1(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function qu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function d0(){var t=qo;return qo<<=1,!(qo&4194240)&&(qo=64),t}function El(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ro(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qt(e),t[e]=n}function X1(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-qt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function jh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-qt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var te=0;function h0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var f0,Vh,p0,m0,g0,Hu=!1,Ko=[],ti=null,ni=null,ii=null,no=new Map,io=new Map,Qn=[],Z1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hp(t,e){switch(t){case"focusin":case"focusout":ti=null;break;case"dragenter":case"dragleave":ni=null;break;case"mouseover":case"mouseout":ii=null;break;case"pointerover":case"pointerout":no.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":io.delete(e.pointerId)}}function fs(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Io(e),e!==null&&Vh(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function ew(t,e,n,i,r){switch(e){case"focusin":return ti=fs(ti,t,e,n,i,r),!0;case"dragenter":return ni=fs(ni,t,e,n,i,r),!0;case"mouseover":return ii=fs(ii,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return no.set(s,fs(no.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,io.set(s,fs(io.get(s)||null,t,e,n,i,r)),!0}return!1}function v0(t){var e=_i(t.target);if(e!==null){var n=Yi(e);if(n!==null){if(e=n.tag,e===13){if(e=s0(n),e!==null){t.blockedOn=e,g0(t.priority,function(){p0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ma(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ku(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Bu=i,n.target.dispatchEvent(i),Bu=null}else return e=Io(n),e!==null&&Vh(e),t.blockedOn=n,!1;e.shift()}return!0}function Kp(t,e,n){ma(t)&&n.delete(e)}function tw(){Hu=!1,ti!==null&&ma(ti)&&(ti=null),ni!==null&&ma(ni)&&(ni=null),ii!==null&&ma(ii)&&(ii=null),no.forEach(Kp),io.forEach(Kp)}function ps(t,e){t.blockedOn===e&&(t.blockedOn=null,Hu||(Hu=!0,kt.unstable_scheduleCallback(kt.unstable_NormalPriority,tw)))}function ro(t){function e(r){return ps(r,t)}if(0<Ko.length){ps(Ko[0],t);for(var n=1;n<Ko.length;n++){var i=Ko[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ti!==null&&ps(ti,t),ni!==null&&ps(ni,t),ii!==null&&ps(ii,t),no.forEach(e),io.forEach(e),n=0;n<Qn.length;n++)i=Qn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Qn.length&&(n=Qn[0],n.blockedOn===null);)v0(n),n.blockedOn===null&&Qn.shift()}var Ir=jn.ReactCurrentBatchConfig,Ga=!0;function nw(t,e,n,i){var r=te,s=Ir.transition;Ir.transition=null;try{te=1,Bh(t,e,n,i)}finally{te=r,Ir.transition=s}}function iw(t,e,n,i){var r=te,s=Ir.transition;Ir.transition=null;try{te=4,Bh(t,e,n,i)}finally{te=r,Ir.transition=s}}function Bh(t,e,n,i){if(Ga){var r=Ku(t,e,n,i);if(r===null)Nl(t,e,i,Qa,n),Hp(t,i);else if(ew(r,t,e,n,i))i.stopPropagation();else if(Hp(t,i),e&4&&-1<Z1.indexOf(t)){for(;r!==null;){var s=Io(r);if(s!==null&&f0(s),s=Ku(t,e,n,i),s===null&&Nl(t,e,i,Qa,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Nl(t,e,i,null,n)}}var Qa=null;function Ku(t,e,n,i){if(Qa=null,t=Uh(i),t=_i(t),t!==null)if(e=Yi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=s0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qa=t,null}function y0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(W1()){case Fh:return 1;case l0:return 4;case Ha:case q1:return 16;case u0:return 536870912;default:return 16}default:return 16}}var Xn=null,zh=null,ga=null;function k0(){if(ga)return ga;var t,e=zh,n=e.length,i,r="value"in Xn?Xn.value:Xn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return ga=r.slice(t,1<i?1-i:void 0)}function va(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Go(){return!0}function Gp(){return!1}function Tt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Go:Gp,this.isPropagationStopped=Gp,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Go)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Go)},persist:function(){},isPersistent:Go}),e}var is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$h=Tt(is),_o=ve({},is,{view:0,detail:0}),rw=Tt(_o),xl,Rl,ms,Fc=ve({},_o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ms&&(ms&&t.type==="mousemove"?(xl=t.screenX-ms.screenX,Rl=t.screenY-ms.screenY):Rl=xl=0,ms=t),xl)},movementY:function(t){return"movementY"in t?t.movementY:Rl}}),Qp=Tt(Fc),sw=ve({},Fc,{dataTransfer:0}),ow=Tt(sw),aw=ve({},_o,{relatedTarget:0}),_l=Tt(aw),cw=ve({},is,{animationName:0,elapsedTime:0,pseudoElement:0}),lw=Tt(cw),uw=ve({},is,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dw=Tt(uw),hw=ve({},is,{data:0}),Jp=Tt(hw),fw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=mw[t])?!!e[t]:!1}function Wh(){return gw}var vw=ve({},_o,{key:function(t){if(t.key){var e=fw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=va(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?pw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wh,charCode:function(t){return t.type==="keypress"?va(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?va(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),yw=Tt(vw),kw=ve({},Fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yp=Tt(kw),bw=ve({},_o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wh}),Sw=Tt(bw),Tw=ve({},is,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cw=Tt(Tw),ww=ve({},Fc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Pw=Tt(ww),Ew=[9,13,27,32],qh=An&&"CompositionEvent"in window,Fs=null;An&&"documentMode"in document&&(Fs=document.documentMode);var xw=An&&"TextEvent"in window&&!Fs,b0=An&&(!qh||Fs&&8<Fs&&11>=Fs),Xp=String.fromCharCode(32),Zp=!1;function S0(t,e){switch(t){case"keyup":return Ew.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function T0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var lr=!1;function Rw(t,e){switch(t){case"compositionend":return T0(e);case"keypress":return e.which!==32?null:(Zp=!0,Xp);case"textInput":return t=e.data,t===Xp&&Zp?null:t;default:return null}}function _w(t,e){if(lr)return t==="compositionend"||!qh&&S0(t,e)?(t=k0(),ga=zh=Xn=null,lr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return b0&&e.locale!=="ko"?null:e.data;default:return null}}var Iw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function em(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Iw[t.type]:e==="textarea"}function C0(t,e,n,i){e0(i),e=Ja(e,"onChange"),0<e.length&&(n=new $h("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var js=null,so=null;function Dw(t){O0(t,0)}function jc(t){var e=hr(t);if(Ky(e))return t}function Aw(t,e){if(t==="change")return e}var w0=!1;if(An){var Il;if(An){var Dl="oninput"in document;if(!Dl){var tm=document.createElement("div");tm.setAttribute("oninput","return;"),Dl=typeof tm.oninput=="function"}Il=Dl}else Il=!1;w0=Il&&(!document.documentMode||9<document.documentMode)}function nm(){js&&(js.detachEvent("onpropertychange",P0),so=js=null)}function P0(t){if(t.propertyName==="value"&&jc(so)){var e=[];C0(e,so,t,Uh(t)),r0(Dw,e)}}function Mw(t,e,n){t==="focusin"?(nm(),js=e,so=n,js.attachEvent("onpropertychange",P0)):t==="focusout"&&nm()}function Ow(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return jc(so)}function Lw(t,e){if(t==="click")return jc(e)}function Nw(t,e){if(t==="input"||t==="change")return jc(e)}function Uw(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Kt=typeof Object.is=="function"?Object.is:Uw;function oo(t,e){if(Kt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!_u.call(e,r)||!Kt(t[r],e[r]))return!1}return!0}function im(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function rm(t,e){var n=im(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=im(n)}}function E0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?E0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function x0(){for(var t=window,e=$a();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=$a(t.document)}return e}function Hh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Fw(t){var e=x0(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&E0(n.ownerDocument.documentElement,n)){if(i!==null&&Hh(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=rm(n,s);var o=rm(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var jw=An&&"documentMode"in document&&11>=document.documentMode,ur=null,Gu=null,Vs=null,Qu=!1;function sm(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Qu||ur==null||ur!==$a(i)||(i=ur,"selectionStart"in i&&Hh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Vs&&oo(Vs,i)||(Vs=i,i=Ja(Gu,"onSelect"),0<i.length&&(e=new $h("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=ur)))}function Qo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var dr={animationend:Qo("Animation","AnimationEnd"),animationiteration:Qo("Animation","AnimationIteration"),animationstart:Qo("Animation","AnimationStart"),transitionend:Qo("Transition","TransitionEnd")},Al={},R0={};An&&(R0=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);function Vc(t){if(Al[t])return Al[t];if(!dr[t])return t;var e=dr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in R0)return Al[t]=e[n];return t}var _0=Vc("animationend"),I0=Vc("animationiteration"),D0=Vc("animationstart"),A0=Vc("transitionend"),M0=new Map,om="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vi(t,e){M0.set(t,e),Ji(e,[t])}for(var Ml=0;Ml<om.length;Ml++){var Ol=om[Ml],Vw=Ol.toLowerCase(),Bw=Ol[0].toUpperCase()+Ol.slice(1);vi(Vw,"on"+Bw)}vi(_0,"onAnimationEnd");vi(I0,"onAnimationIteration");vi(D0,"onAnimationStart");vi("dblclick","onDoubleClick");vi("focusin","onFocus");vi("focusout","onBlur");vi(A0,"onTransitionEnd");Br("onMouseEnter",["mouseout","mouseover"]);Br("onMouseLeave",["mouseout","mouseover"]);Br("onPointerEnter",["pointerout","pointerover"]);Br("onPointerLeave",["pointerout","pointerover"]);Ji("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ji("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ji("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ji("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ji("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ji("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Is="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zw=new Set("cancel close invalid load scroll toggle".split(" ").concat(Is));function am(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,V1(i,e,void 0,t),t.currentTarget=null}function O0(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;am(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;am(r,a,l),s=c}}}if(qa)throw t=Wu,qa=!1,Wu=null,t}function ae(t,e){var n=e[ed];n===void 0&&(n=e[ed]=new Set);var i=t+"__bubble";n.has(i)||(L0(e,t,2,!1),n.add(i))}function Ll(t,e,n){var i=0;e&&(i|=4),L0(n,t,i,e)}var Jo="_reactListening"+Math.random().toString(36).slice(2);function ao(t){if(!t[Jo]){t[Jo]=!0,zy.forEach(function(n){n!=="selectionchange"&&(zw.has(n)||Ll(n,!1,t),Ll(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Jo]||(e[Jo]=!0,Ll("selectionchange",!1,e))}}function L0(t,e,n,i){switch(y0(e)){case 1:var r=nw;break;case 4:r=iw;break;default:r=Bh}n=r.bind(null,e,n,t),r=void 0,!$u||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Nl(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=_i(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}r0(function(){var l=s,u=Uh(n),d=[];e:{var h=M0.get(t);if(h!==void 0){var f=$h,g=t;switch(t){case"keypress":if(va(n)===0)break e;case"keydown":case"keyup":f=yw;break;case"focusin":g="focus",f=_l;break;case"focusout":g="blur",f=_l;break;case"beforeblur":case"afterblur":f=_l;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=ow;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Sw;break;case _0:case I0:case D0:f=lw;break;case A0:f=Cw;break;case"scroll":f=rw;break;case"wheel":f=Pw;break;case"copy":case"cut":case"paste":f=dw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Yp}var m=(e&4)!==0,S=!m&&t==="scroll",p=m?h!==null?h+"Capture":null:h;m=[];for(var v=l,y;v!==null;){y=v;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,p!==null&&(b=to(v,p),b!=null&&m.push(co(v,b,y)))),S)break;v=v.return}0<m.length&&(h=new f(h,g,null,n,u),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==Bu&&(g=n.relatedTarget||n.fromElement)&&(_i(g)||g[Mn]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=n.relatedTarget||n.toElement,f=l,g=g?_i(g):null,g!==null&&(S=Yi(g),g!==S||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=l),f!==g)){if(m=Qp,b="onMouseLeave",p="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(m=Yp,b="onPointerLeave",p="onPointerEnter",v="pointer"),S=f==null?h:hr(f),y=g==null?h:hr(g),h=new m(b,v+"leave",f,n,u),h.target=S,h.relatedTarget=y,b=null,_i(u)===l&&(m=new m(p,v+"enter",g,n,u),m.target=y,m.relatedTarget=S,b=m),S=b,f&&g)t:{for(m=f,p=g,v=0,y=m;y;y=ir(y))v++;for(y=0,b=p;b;b=ir(b))y++;for(;0<v-y;)m=ir(m),v--;for(;0<y-v;)p=ir(p),y--;for(;v--;){if(m===p||p!==null&&m===p.alternate)break t;m=ir(m),p=ir(p)}m=null}else m=null;f!==null&&cm(d,h,f,m,!1),g!==null&&S!==null&&cm(d,S,g,m,!0)}}e:{if(h=l?hr(l):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var k=Aw;else if(em(h))if(w0)k=Nw;else{k=Ow;var w=Mw}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=Lw);if(k&&(k=k(t,l))){C0(d,k,n,u);break e}w&&w(t,h,l),t==="focusout"&&(w=h._wrapperState)&&w.controlled&&h.type==="number"&&Nu(h,"number",h.value)}switch(w=l?hr(l):window,t){case"focusin":(em(w)||w.contentEditable==="true")&&(ur=w,Gu=l,Vs=null);break;case"focusout":Vs=Gu=ur=null;break;case"mousedown":Qu=!0;break;case"contextmenu":case"mouseup":case"dragend":Qu=!1,sm(d,n,u);break;case"selectionchange":if(jw)break;case"keydown":case"keyup":sm(d,n,u)}var E;if(qh)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else lr?S0(t,n)&&(P="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(P="onCompositionStart");P&&(b0&&n.locale!=="ko"&&(lr||P!=="onCompositionStart"?P==="onCompositionEnd"&&lr&&(E=k0()):(Xn=u,zh="value"in Xn?Xn.value:Xn.textContent,lr=!0)),w=Ja(l,P),0<w.length&&(P=new Jp(P,t,null,n,u),d.push({event:P,listeners:w}),E?P.data=E:(E=T0(n),E!==null&&(P.data=E)))),(E=xw?Rw(t,n):_w(t,n))&&(l=Ja(l,"onBeforeInput"),0<l.length&&(u=new Jp("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=E))}O0(d,e)})}function co(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ja(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=to(t,n),s!=null&&i.unshift(co(t,s,r)),s=to(t,e),s!=null&&i.push(co(t,s,r))),t=t.return}return i}function ir(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function cm(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=to(n,s),c!=null&&o.unshift(co(n,c,a))):r||(c=to(n,s),c!=null&&o.push(co(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var $w=/\r\n?/g,Ww=/\u0000|\uFFFD/g;function lm(t){return(typeof t=="string"?t:""+t).replace($w,`
`).replace(Ww,"")}function Yo(t,e,n){if(e=lm(e),lm(t)!==e&&n)throw Error(L(425))}function Ya(){}var Ju=null,Yu=null;function Xu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zu=typeof setTimeout=="function"?setTimeout:void 0,qw=typeof clearTimeout=="function"?clearTimeout:void 0,um=typeof Promise=="function"?Promise:void 0,Hw=typeof queueMicrotask=="function"?queueMicrotask:typeof um<"u"?function(t){return um.resolve(null).then(t).catch(Kw)}:Zu;function Kw(t){setTimeout(function(){throw t})}function Ul(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),ro(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);ro(e)}function ri(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function dm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var rs=Math.random().toString(36).slice(2),tn="__reactFiber$"+rs,lo="__reactProps$"+rs,Mn="__reactContainer$"+rs,ed="__reactEvents$"+rs,Gw="__reactListeners$"+rs,Qw="__reactHandles$"+rs;function _i(t){var e=t[tn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Mn]||n[tn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=dm(t);t!==null;){if(n=t[tn])return n;t=dm(t)}return e}t=n,n=t.parentNode}return null}function Io(t){return t=t[tn]||t[Mn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function hr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(L(33))}function Bc(t){return t[lo]||null}var td=[],fr=-1;function yi(t){return{current:t}}function le(t){0>fr||(t.current=td[fr],td[fr]=null,fr--)}function oe(t,e){fr++,td[fr]=t.current,t.current=e}var hi={},Qe=yi(hi),ot=yi(!1),ji=hi;function zr(t,e){var n=t.type.contextTypes;if(!n)return hi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function at(t){return t=t.childContextTypes,t!=null}function Xa(){le(ot),le(Qe)}function hm(t,e,n){if(Qe.current!==hi)throw Error(L(168));oe(Qe,e),oe(ot,n)}function N0(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(L(108,M1(t)||"Unknown",r));return ve({},n,i)}function Za(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hi,ji=Qe.current,oe(Qe,t),oe(ot,ot.current),!0}function fm(t,e,n){var i=t.stateNode;if(!i)throw Error(L(169));n?(t=N0(t,e,ji),i.__reactInternalMemoizedMergedChildContext=t,le(ot),le(Qe),oe(Qe,t)):le(ot),oe(ot,n)}var Sn=null,zc=!1,Fl=!1;function U0(t){Sn===null?Sn=[t]:Sn.push(t)}function Jw(t){zc=!0,U0(t)}function ki(){if(!Fl&&Sn!==null){Fl=!0;var t=0,e=te;try{var n=Sn;for(te=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Sn=null,zc=!1}catch(r){throw Sn!==null&&(Sn=Sn.slice(t+1)),c0(Fh,ki),r}finally{te=e,Fl=!1}}return null}var pr=[],mr=0,ec=null,tc=0,xt=[],Rt=0,Vi=null,xn=1,Rn="";function wi(t,e){pr[mr++]=tc,pr[mr++]=ec,ec=t,tc=e}function F0(t,e,n){xt[Rt++]=xn,xt[Rt++]=Rn,xt[Rt++]=Vi,Vi=t;var i=xn;t=Rn;var r=32-qt(i)-1;i&=~(1<<r),n+=1;var s=32-qt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,xn=1<<32-qt(e)+r|n<<r|i,Rn=s+t}else xn=1<<s|n<<r|i,Rn=t}function Kh(t){t.return!==null&&(wi(t,1),F0(t,1,0))}function Gh(t){for(;t===ec;)ec=pr[--mr],pr[mr]=null,tc=pr[--mr],pr[mr]=null;for(;t===Vi;)Vi=xt[--Rt],xt[Rt]=null,Rn=xt[--Rt],xt[Rt]=null,xn=xt[--Rt],xt[Rt]=null}var mt=null,ft=null,he=!1,Bt=null;function j0(t,e){var n=_t(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function pm(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,mt=t,ft=ri(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,mt=t,ft=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Vi!==null?{id:xn,overflow:Rn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_t(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,mt=t,ft=null,!0):!1;default:return!1}}function nd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function id(t){if(he){var e=ft;if(e){var n=e;if(!pm(t,e)){if(nd(t))throw Error(L(418));e=ri(n.nextSibling);var i=mt;e&&pm(t,e)?j0(i,n):(t.flags=t.flags&-4097|2,he=!1,mt=t)}}else{if(nd(t))throw Error(L(418));t.flags=t.flags&-4097|2,he=!1,mt=t}}}function mm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;mt=t}function Xo(t){if(t!==mt)return!1;if(!he)return mm(t),he=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Xu(t.type,t.memoizedProps)),e&&(e=ft)){if(nd(t))throw V0(),Error(L(418));for(;e;)j0(t,e),e=ri(e.nextSibling)}if(mm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ft=ri(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ft=null}}else ft=mt?ri(t.stateNode.nextSibling):null;return!0}function V0(){for(var t=ft;t;)t=ri(t.nextSibling)}function $r(){ft=mt=null,he=!1}function Qh(t){Bt===null?Bt=[t]:Bt.push(t)}var Yw=jn.ReactCurrentBatchConfig;function gs(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(L(309));var i=n.stateNode}if(!i)throw Error(L(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(L(284));if(!n._owner)throw Error(L(290,t))}return t}function Zo(t,e){throw t=Object.prototype.toString.call(e),Error(L(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function gm(t){var e=t._init;return e(t._payload)}function B0(t){function e(p,v){if(t){var y=p.deletions;y===null?(p.deletions=[v],p.flags|=16):y.push(v)}}function n(p,v){if(!t)return null;for(;v!==null;)e(p,v),v=v.sibling;return null}function i(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function r(p,v){return p=ci(p,v),p.index=0,p.sibling=null,p}function s(p,v,y){return p.index=y,t?(y=p.alternate,y!==null?(y=y.index,y<v?(p.flags|=2,v):y):(p.flags|=2,v)):(p.flags|=1048576,v)}function o(p){return t&&p.alternate===null&&(p.flags|=2),p}function a(p,v,y,b){return v===null||v.tag!==6?(v=ql(y,p.mode,b),v.return=p,v):(v=r(v,y),v.return=p,v)}function c(p,v,y,b){var k=y.type;return k===cr?u(p,v,y.props.children,b,y.key):v!==null&&(v.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Kn&&gm(k)===v.type)?(b=r(v,y.props),b.ref=gs(p,v,y),b.return=p,b):(b=wa(y.type,y.key,y.props,null,p.mode,b),b.ref=gs(p,v,y),b.return=p,b)}function l(p,v,y,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==y.containerInfo||v.stateNode.implementation!==y.implementation?(v=Hl(y,p.mode,b),v.return=p,v):(v=r(v,y.children||[]),v.return=p,v)}function u(p,v,y,b,k){return v===null||v.tag!==7?(v=Oi(y,p.mode,b,k),v.return=p,v):(v=r(v,y),v.return=p,v)}function d(p,v,y){if(typeof v=="string"&&v!==""||typeof v=="number")return v=ql(""+v,p.mode,y),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case zo:return y=wa(v.type,v.key,v.props,null,p.mode,y),y.ref=gs(p,null,v),y.return=p,y;case ar:return v=Hl(v,p.mode,y),v.return=p,v;case Kn:var b=v._init;return d(p,b(v._payload),y)}if(Rs(v)||ds(v))return v=Oi(v,p.mode,y,null),v.return=p,v;Zo(p,v)}return null}function h(p,v,y,b){var k=v!==null?v.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return k!==null?null:a(p,v,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case zo:return y.key===k?c(p,v,y,b):null;case ar:return y.key===k?l(p,v,y,b):null;case Kn:return k=y._init,h(p,v,k(y._payload),b)}if(Rs(y)||ds(y))return k!==null?null:u(p,v,y,b,null);Zo(p,y)}return null}function f(p,v,y,b,k){if(typeof b=="string"&&b!==""||typeof b=="number")return p=p.get(y)||null,a(v,p,""+b,k);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case zo:return p=p.get(b.key===null?y:b.key)||null,c(v,p,b,k);case ar:return p=p.get(b.key===null?y:b.key)||null,l(v,p,b,k);case Kn:var w=b._init;return f(p,v,y,w(b._payload),k)}if(Rs(b)||ds(b))return p=p.get(y)||null,u(v,p,b,k,null);Zo(v,b)}return null}function g(p,v,y,b){for(var k=null,w=null,E=v,P=v=0,D=null;E!==null&&P<y.length;P++){E.index>P?(D=E,E=null):D=E.sibling;var I=h(p,E,y[P],b);if(I===null){E===null&&(E=D);break}t&&E&&I.alternate===null&&e(p,E),v=s(I,v,P),w===null?k=I:w.sibling=I,w=I,E=D}if(P===y.length)return n(p,E),he&&wi(p,P),k;if(E===null){for(;P<y.length;P++)E=d(p,y[P],b),E!==null&&(v=s(E,v,P),w===null?k=E:w.sibling=E,w=E);return he&&wi(p,P),k}for(E=i(p,E);P<y.length;P++)D=f(E,p,P,y[P],b),D!==null&&(t&&D.alternate!==null&&E.delete(D.key===null?P:D.key),v=s(D,v,P),w===null?k=D:w.sibling=D,w=D);return t&&E.forEach(function(O){return e(p,O)}),he&&wi(p,P),k}function m(p,v,y,b){var k=ds(y);if(typeof k!="function")throw Error(L(150));if(y=k.call(y),y==null)throw Error(L(151));for(var w=k=null,E=v,P=v=0,D=null,I=y.next();E!==null&&!I.done;P++,I=y.next()){E.index>P?(D=E,E=null):D=E.sibling;var O=h(p,E,I.value,b);if(O===null){E===null&&(E=D);break}t&&E&&O.alternate===null&&e(p,E),v=s(O,v,P),w===null?k=O:w.sibling=O,w=O,E=D}if(I.done)return n(p,E),he&&wi(p,P),k;if(E===null){for(;!I.done;P++,I=y.next())I=d(p,I.value,b),I!==null&&(v=s(I,v,P),w===null?k=I:w.sibling=I,w=I);return he&&wi(p,P),k}for(E=i(p,E);!I.done;P++,I=y.next())I=f(E,p,P,I.value,b),I!==null&&(t&&I.alternate!==null&&E.delete(I.key===null?P:I.key),v=s(I,v,P),w===null?k=I:w.sibling=I,w=I);return t&&E.forEach(function(V){return e(p,V)}),he&&wi(p,P),k}function S(p,v,y,b){if(typeof y=="object"&&y!==null&&y.type===cr&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case zo:e:{for(var k=y.key,w=v;w!==null;){if(w.key===k){if(k=y.type,k===cr){if(w.tag===7){n(p,w.sibling),v=r(w,y.props.children),v.return=p,p=v;break e}}else if(w.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Kn&&gm(k)===w.type){n(p,w.sibling),v=r(w,y.props),v.ref=gs(p,w,y),v.return=p,p=v;break e}n(p,w);break}else e(p,w);w=w.sibling}y.type===cr?(v=Oi(y.props.children,p.mode,b,y.key),v.return=p,p=v):(b=wa(y.type,y.key,y.props,null,p.mode,b),b.ref=gs(p,v,y),b.return=p,p=b)}return o(p);case ar:e:{for(w=y.key;v!==null;){if(v.key===w)if(v.tag===4&&v.stateNode.containerInfo===y.containerInfo&&v.stateNode.implementation===y.implementation){n(p,v.sibling),v=r(v,y.children||[]),v.return=p,p=v;break e}else{n(p,v);break}else e(p,v);v=v.sibling}v=Hl(y,p.mode,b),v.return=p,p=v}return o(p);case Kn:return w=y._init,S(p,v,w(y._payload),b)}if(Rs(y))return g(p,v,y,b);if(ds(y))return m(p,v,y,b);Zo(p,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,v!==null&&v.tag===6?(n(p,v.sibling),v=r(v,y),v.return=p,p=v):(n(p,v),v=ql(y,p.mode,b),v.return=p,p=v),o(p)):n(p,v)}return S}var Wr=B0(!0),z0=B0(!1),nc=yi(null),ic=null,gr=null,Jh=null;function Yh(){Jh=gr=ic=null}function Xh(t){var e=nc.current;le(nc),t._currentValue=e}function rd(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Dr(t,e){ic=t,Jh=gr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function Dt(t){var e=t._currentValue;if(Jh!==t)if(t={context:t,memoizedValue:e,next:null},gr===null){if(ic===null)throw Error(L(308));gr=t,ic.dependencies={lanes:0,firstContext:t}}else gr=gr.next=t;return e}var Ii=null;function Zh(t){Ii===null?Ii=[t]:Ii.push(t)}function $0(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Zh(e)):(n.next=r.next,r.next=n),e.interleaved=n,On(t,i)}function On(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Gn=!1;function ef(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function W0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _n(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function si(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Z&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,On(t,n)}return r=i.interleaved,r===null?(e.next=e,Zh(i)):(e.next=r.next,r.next=e),i.interleaved=e,On(t,n)}function ya(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,jh(t,n)}}function vm(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function rc(t,e,n,i){var r=t.updateQueue;Gn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,f=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,m=a;switch(h=e,f=n,m.tag){case 1:if(g=m.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=ve({},d,h);break e;case 2:Gn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=f,c=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);zi|=o,t.lanes=o,t.memoizedState=d}}function ym(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(L(191,r));r.call(i)}}}var Do={},sn=yi(Do),uo=yi(Do),ho=yi(Do);function Di(t){if(t===Do)throw Error(L(174));return t}function tf(t,e){switch(oe(ho,e),oe(uo,t),oe(sn,Do),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Fu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Fu(e,t)}le(sn),oe(sn,e)}function qr(){le(sn),le(uo),le(ho)}function q0(t){Di(ho.current);var e=Di(sn.current),n=Fu(e,t.type);e!==n&&(oe(uo,t),oe(sn,n))}function nf(t){uo.current===t&&(le(sn),le(uo))}var pe=yi(0);function sc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var jl=[];function rf(){for(var t=0;t<jl.length;t++)jl[t]._workInProgressVersionPrimary=null;jl.length=0}var ka=jn.ReactCurrentDispatcher,Vl=jn.ReactCurrentBatchConfig,Bi=0,ge=null,Ae=null,Le=null,oc=!1,Bs=!1,fo=0,Xw=0;function We(){throw Error(L(321))}function sf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Kt(t[n],e[n]))return!1;return!0}function of(t,e,n,i,r,s){if(Bi=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ka.current=t===null||t.memoizedState===null?nP:iP,t=n(i,r),Bs){s=0;do{if(Bs=!1,fo=0,25<=s)throw Error(L(301));s+=1,Le=Ae=null,e.updateQueue=null,ka.current=rP,t=n(i,r)}while(Bs)}if(ka.current=ac,e=Ae!==null&&Ae.next!==null,Bi=0,Le=Ae=ge=null,oc=!1,e)throw Error(L(300));return t}function af(){var t=fo!==0;return fo=0,t}function Zt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Le===null?ge.memoizedState=Le=t:Le=Le.next=t,Le}function At(){if(Ae===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=Ae.next;var e=Le===null?ge.memoizedState:Le.next;if(e!==null)Le=e,Ae=t;else{if(t===null)throw Error(L(310));Ae=t,t={memoizedState:Ae.memoizedState,baseState:Ae.baseState,baseQueue:Ae.baseQueue,queue:Ae.queue,next:null},Le===null?ge.memoizedState=Le=t:Le=Le.next=t}return Le}function po(t,e){return typeof e=="function"?e(t):e}function Bl(t){var e=At(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var i=Ae,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Bi&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,ge.lanes|=u,zi|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Kt(i,e.memoizedState)||(rt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ge.lanes|=s,zi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function zl(t){var e=At(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Kt(s,e.memoizedState)||(rt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function H0(){}function K0(t,e){var n=ge,i=At(),r=e(),s=!Kt(i.memoizedState,r);if(s&&(i.memoizedState=r,rt=!0),i=i.queue,cf(J0.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Le!==null&&Le.memoizedState.tag&1){if(n.flags|=2048,mo(9,Q0.bind(null,n,i,r,e),void 0,null),Fe===null)throw Error(L(349));Bi&30||G0(n,e,r)}return r}function G0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Q0(t,e,n,i){e.value=n,e.getSnapshot=i,Y0(e)&&X0(t)}function J0(t,e,n){return n(function(){Y0(e)&&X0(t)})}function Y0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Kt(t,n)}catch{return!0}}function X0(t){var e=On(t,1);e!==null&&Ht(e,t,1,-1)}function km(t){var e=Zt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:t},e.queue=t,t=t.dispatch=tP.bind(null,ge,t),[e.memoizedState,t]}function mo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Z0(){return At().memoizedState}function ba(t,e,n,i){var r=Zt();ge.flags|=t,r.memoizedState=mo(1|e,n,void 0,i===void 0?null:i)}function $c(t,e,n,i){var r=At();i=i===void 0?null:i;var s=void 0;if(Ae!==null){var o=Ae.memoizedState;if(s=o.destroy,i!==null&&sf(i,o.deps)){r.memoizedState=mo(e,n,s,i);return}}ge.flags|=t,r.memoizedState=mo(1|e,n,s,i)}function bm(t,e){return ba(8390656,8,t,e)}function cf(t,e){return $c(2048,8,t,e)}function ek(t,e){return $c(4,2,t,e)}function tk(t,e){return $c(4,4,t,e)}function nk(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ik(t,e,n){return n=n!=null?n.concat([t]):null,$c(4,4,nk.bind(null,e,t),n)}function lf(){}function rk(t,e){var n=At();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&sf(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function sk(t,e){var n=At();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&sf(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function ok(t,e,n){return Bi&21?(Kt(n,e)||(n=d0(),ge.lanes|=n,zi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=n)}function Zw(t,e){var n=te;te=n!==0&&4>n?n:4,t(!0);var i=Vl.transition;Vl.transition={};try{t(!1),e()}finally{te=n,Vl.transition=i}}function ak(){return At().memoizedState}function eP(t,e,n){var i=ai(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ck(t))lk(e,n);else if(n=$0(t,e,n,i),n!==null){var r=Xe();Ht(n,t,i,r),uk(n,e,i)}}function tP(t,e,n){var i=ai(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ck(t))lk(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Kt(a,o)){var c=e.interleaved;c===null?(r.next=r,Zh(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=$0(t,e,r,i),n!==null&&(r=Xe(),Ht(n,t,i,r),uk(n,e,i))}}function ck(t){var e=t.alternate;return t===ge||e!==null&&e===ge}function lk(t,e){Bs=oc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function uk(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,jh(t,n)}}var ac={readContext:Dt,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useInsertionEffect:We,useLayoutEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useMutableSource:We,useSyncExternalStore:We,useId:We,unstable_isNewReconciler:!1},nP={readContext:Dt,useCallback:function(t,e){return Zt().memoizedState=[t,e===void 0?null:e],t},useContext:Dt,useEffect:bm,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ba(4194308,4,nk.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ba(4194308,4,t,e)},useInsertionEffect:function(t,e){return ba(4,2,t,e)},useMemo:function(t,e){var n=Zt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Zt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=eP.bind(null,ge,t),[i.memoizedState,t]},useRef:function(t){var e=Zt();return t={current:t},e.memoizedState=t},useState:km,useDebugValue:lf,useDeferredValue:function(t){return Zt().memoizedState=t},useTransition:function(){var t=km(!1),e=t[0];return t=Zw.bind(null,t[1]),Zt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ge,r=Zt();if(he){if(n===void 0)throw Error(L(407));n=n()}else{if(n=e(),Fe===null)throw Error(L(349));Bi&30||G0(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,bm(J0.bind(null,i,s,t),[t]),i.flags|=2048,mo(9,Q0.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Zt(),e=Fe.identifierPrefix;if(he){var n=Rn,i=xn;n=(i&~(1<<32-qt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=fo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Xw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},iP={readContext:Dt,useCallback:rk,useContext:Dt,useEffect:cf,useImperativeHandle:ik,useInsertionEffect:ek,useLayoutEffect:tk,useMemo:sk,useReducer:Bl,useRef:Z0,useState:function(){return Bl(po)},useDebugValue:lf,useDeferredValue:function(t){var e=At();return ok(e,Ae.memoizedState,t)},useTransition:function(){var t=Bl(po)[0],e=At().memoizedState;return[t,e]},useMutableSource:H0,useSyncExternalStore:K0,useId:ak,unstable_isNewReconciler:!1},rP={readContext:Dt,useCallback:rk,useContext:Dt,useEffect:cf,useImperativeHandle:ik,useInsertionEffect:ek,useLayoutEffect:tk,useMemo:sk,useReducer:zl,useRef:Z0,useState:function(){return zl(po)},useDebugValue:lf,useDeferredValue:function(t){var e=At();return Ae===null?e.memoizedState=t:ok(e,Ae.memoizedState,t)},useTransition:function(){var t=zl(po)[0],e=At().memoizedState;return[t,e]},useMutableSource:H0,useSyncExternalStore:K0,useId:ak,unstable_isNewReconciler:!1};function Ft(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function sd(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Wc={isMounted:function(t){return(t=t._reactInternals)?Yi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Xe(),r=ai(t),s=_n(i,r);s.payload=e,n!=null&&(s.callback=n),e=si(t,s,r),e!==null&&(Ht(e,t,r,i),ya(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Xe(),r=ai(t),s=_n(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=si(t,s,r),e!==null&&(Ht(e,t,r,i),ya(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Xe(),i=ai(t),r=_n(n,i);r.tag=2,e!=null&&(r.callback=e),e=si(t,r,i),e!==null&&(Ht(e,t,i,n),ya(e,t,i))}};function Sm(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!oo(n,i)||!oo(r,s):!0}function dk(t,e,n){var i=!1,r=hi,s=e.contextType;return typeof s=="object"&&s!==null?s=Dt(s):(r=at(e)?ji:Qe.current,i=e.contextTypes,s=(i=i!=null)?zr(t,r):hi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Wc,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Tm(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Wc.enqueueReplaceState(e,e.state,null)}function od(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},ef(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Dt(s):(s=at(e)?ji:Qe.current,r.context=zr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(sd(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Wc.enqueueReplaceState(r,r.state,null),rc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Hr(t,e){try{var n="",i=e;do n+=A1(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function $l(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ad(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var sP=typeof WeakMap=="function"?WeakMap:Map;function hk(t,e,n){n=_n(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){lc||(lc=!0,vd=i),ad(t,e)},n}function fk(t,e,n){n=_n(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){ad(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){ad(t,e),typeof i!="function"&&(oi===null?oi=new Set([this]):oi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Cm(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new sP;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=kP.bind(null,t,e,n),e.then(t,t))}function wm(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Pm(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_n(-1,1),e.tag=2,si(n,e,1))),n.lanes|=1),t)}var oP=jn.ReactCurrentOwner,rt=!1;function Je(t,e,n,i){e.child=t===null?z0(e,null,n,i):Wr(e,t.child,n,i)}function Em(t,e,n,i,r){n=n.render;var s=e.ref;return Dr(e,r),i=of(t,e,n,i,s,r),n=af(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Ln(t,e,r)):(he&&n&&Kh(e),e.flags|=1,Je(t,e,i,r),e.child)}function xm(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!vf(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,pk(t,e,s,i,r)):(t=wa(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:oo,n(o,i)&&t.ref===e.ref)return Ln(t,e,r)}return e.flags|=1,t=ci(s,i),t.ref=e.ref,t.return=e,e.child=t}function pk(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(oo(s,i)&&t.ref===e.ref)if(rt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,Ln(t,e,r)}return cd(t,e,n,i,r)}function mk(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},oe(yr,dt),dt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,oe(yr,dt),dt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,oe(yr,dt),dt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,oe(yr,dt),dt|=i;return Je(t,e,r,n),e.child}function gk(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function cd(t,e,n,i,r){var s=at(n)?ji:Qe.current;return s=zr(e,s),Dr(e,r),n=of(t,e,n,i,s,r),i=af(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Ln(t,e,r)):(he&&i&&Kh(e),e.flags|=1,Je(t,e,n,r),e.child)}function Rm(t,e,n,i,r){if(at(n)){var s=!0;Za(e)}else s=!1;if(Dr(e,r),e.stateNode===null)Sa(t,e),dk(e,n,i),od(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Dt(l):(l=at(n)?ji:Qe.current,l=zr(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&Tm(e,o,i,l),Gn=!1;var h=e.memoizedState;o.state=h,rc(e,i,o,r),c=e.memoizedState,a!==i||h!==c||ot.current||Gn?(typeof u=="function"&&(sd(e,n,u,i),c=e.memoizedState),(a=Gn||Sm(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,W0(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Ft(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Dt(c):(c=at(n)?ji:Qe.current,c=zr(e,c));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&Tm(e,o,i,c),Gn=!1,h=e.memoizedState,o.state=h,rc(e,i,o,r);var g=e.memoizedState;a!==d||h!==g||ot.current||Gn?(typeof f=="function"&&(sd(e,n,f,i),g=e.memoizedState),(l=Gn||Sm(e,n,l,i,h,g,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return ld(t,e,n,i,s,r)}function ld(t,e,n,i,r,s){gk(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&fm(e,n,!1),Ln(t,e,s);i=e.stateNode,oP.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Wr(e,t.child,null,s),e.child=Wr(e,null,a,s)):Je(t,e,a,s),e.memoizedState=i.state,r&&fm(e,n,!0),e.child}function vk(t){var e=t.stateNode;e.pendingContext?hm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&hm(t,e.context,!1),tf(t,e.containerInfo)}function _m(t,e,n,i,r){return $r(),Qh(r),e.flags|=256,Je(t,e,n,i),e.child}var ud={dehydrated:null,treeContext:null,retryLane:0};function dd(t){return{baseLanes:t,cachePool:null,transitions:null}}function yk(t,e,n){var i=e.pendingProps,r=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),oe(pe,r&1),t===null)return id(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Kc(o,i,0,null),t=Oi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=dd(n),e.memoizedState=ud,t):uf(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return aP(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=ci(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=ci(a,s):(s=Oi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?dd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=ud,i}return s=t.child,t=s.sibling,i=ci(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function uf(t,e){return e=Kc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ea(t,e,n,i){return i!==null&&Qh(i),Wr(e,t.child,null,n),t=uf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function aP(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=$l(Error(L(422))),ea(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Kc({mode:"visible",children:i.children},r,0,null),s=Oi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Wr(e,t.child,null,o),e.child.memoizedState=dd(o),e.memoizedState=ud,s);if(!(e.mode&1))return ea(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(L(419)),i=$l(s,i,void 0),ea(t,e,o,i)}if(a=(o&t.childLanes)!==0,rt||a){if(i=Fe,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,On(t,r),Ht(i,t,r,-1))}return gf(),i=$l(Error(L(421))),ea(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=bP.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ft=ri(r.nextSibling),mt=e,he=!0,Bt=null,t!==null&&(xt[Rt++]=xn,xt[Rt++]=Rn,xt[Rt++]=Vi,xn=t.id,Rn=t.overflow,Vi=e),e=uf(e,i.children),e.flags|=4096,e)}function Im(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),rd(t.return,e,n)}function Wl(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function kk(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Je(t,e,i.children,n),i=pe.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Im(t,n,e);else if(t.tag===19)Im(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(oe(pe,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&sc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Wl(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&sc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Wl(e,!0,n,null,s);break;case"together":Wl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Sa(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ln(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=ci(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ci(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function cP(t,e,n){switch(e.tag){case 3:vk(e),$r();break;case 5:q0(e);break;case 1:at(e.type)&&Za(e);break;case 4:tf(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;oe(nc,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(oe(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?yk(t,e,n):(oe(pe,pe.current&1),t=Ln(t,e,n),t!==null?t.sibling:null);oe(pe,pe.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return kk(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),oe(pe,pe.current),i)break;return null;case 22:case 23:return e.lanes=0,mk(t,e,n)}return Ln(t,e,n)}var bk,hd,Sk,Tk;bk=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};hd=function(){};Sk=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Di(sn.current);var s=null;switch(n){case"input":r=Ou(t,r),i=Ou(t,i),s=[];break;case"select":r=ve({},r,{value:void 0}),i=ve({},i,{value:void 0}),s=[];break;case"textarea":r=Uu(t,r),i=Uu(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Ya)}ju(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Zs.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Zs.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ae("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Tk=function(t,e,n,i){n!==i&&(e.flags|=4)};function vs(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function lP(t,e,n){var i=e.pendingProps;switch(Gh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(e),null;case 1:return at(e.type)&&Xa(),qe(e),null;case 3:return i=e.stateNode,qr(),le(ot),le(Qe),rf(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Xo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bt!==null&&(bd(Bt),Bt=null))),hd(t,e),qe(e),null;case 5:nf(e);var r=Di(ho.current);if(n=e.type,t!==null&&e.stateNode!=null)Sk(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(L(166));return qe(e),null}if(t=Di(sn.current),Xo(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[tn]=e,i[lo]=s,t=(e.mode&1)!==0,n){case"dialog":ae("cancel",i),ae("close",i);break;case"iframe":case"object":case"embed":ae("load",i);break;case"video":case"audio":for(r=0;r<Is.length;r++)ae(Is[r],i);break;case"source":ae("error",i);break;case"img":case"image":case"link":ae("error",i),ae("load",i);break;case"details":ae("toggle",i);break;case"input":jp(i,s),ae("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ae("invalid",i);break;case"textarea":Bp(i,s),ae("invalid",i)}ju(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Yo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Yo(i.textContent,a,t),r=["children",""+a]):Zs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ae("scroll",i)}switch(n){case"input":$o(i),Vp(i,s,!0);break;case"textarea":$o(i),zp(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Ya)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Jy(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[tn]=e,t[lo]=i,bk(t,e,!1,!1),e.stateNode=t;e:{switch(o=Vu(n,i),n){case"dialog":ae("cancel",t),ae("close",t),r=i;break;case"iframe":case"object":case"embed":ae("load",t),r=i;break;case"video":case"audio":for(r=0;r<Is.length;r++)ae(Is[r],t);r=i;break;case"source":ae("error",t),r=i;break;case"img":case"image":case"link":ae("error",t),ae("load",t),r=i;break;case"details":ae("toggle",t),r=i;break;case"input":jp(t,i),r=Ou(t,i),ae("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ve({},i,{value:void 0}),ae("invalid",t);break;case"textarea":Bp(t,i),r=Uu(t,i),ae("invalid",t);break;default:r=i}ju(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?Zy(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Yy(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&eo(t,c):typeof c=="number"&&eo(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Zs.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ae("scroll",t):c!=null&&Mh(t,s,c,o))}switch(n){case"input":$o(t),Vp(t,i,!1);break;case"textarea":$o(t),zp(t);break;case"option":i.value!=null&&t.setAttribute("value",""+di(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?xr(t,!!i.multiple,s,!1):i.defaultValue!=null&&xr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Ya)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qe(e),null;case 6:if(t&&e.stateNode!=null)Tk(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(L(166));if(n=Di(ho.current),Di(sn.current),Xo(e)){if(i=e.stateNode,n=e.memoizedProps,i[tn]=e,(s=i.nodeValue!==n)&&(t=mt,t!==null))switch(t.tag){case 3:Yo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Yo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[tn]=e,e.stateNode=i}return qe(e),null;case 13:if(le(pe),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(he&&ft!==null&&e.mode&1&&!(e.flags&128))V0(),$r(),e.flags|=98560,s=!1;else if(s=Xo(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(L(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(L(317));s[tn]=e}else $r(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),s=!1}else Bt!==null&&(bd(Bt),Bt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Me===0&&(Me=3):gf())),e.updateQueue!==null&&(e.flags|=4),qe(e),null);case 4:return qr(),hd(t,e),t===null&&ao(e.stateNode.containerInfo),qe(e),null;case 10:return Xh(e.type._context),qe(e),null;case 17:return at(e.type)&&Xa(),qe(e),null;case 19:if(le(pe),s=e.memoizedState,s===null)return qe(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)vs(s,!1);else{if(Me!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=sc(t),o!==null){for(e.flags|=128,vs(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return oe(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&we()>Kr&&(e.flags|=128,i=!0,vs(s,!1),e.lanes=4194304)}else{if(!i)if(t=sc(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),vs(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return qe(e),null}else 2*we()-s.renderingStartTime>Kr&&n!==1073741824&&(e.flags|=128,i=!0,vs(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=we(),e.sibling=null,n=pe.current,oe(pe,i?n&1|2:n&1),e):(qe(e),null);case 22:case 23:return mf(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?dt&1073741824&&(qe(e),e.subtreeFlags&6&&(e.flags|=8192)):qe(e),null;case 24:return null;case 25:return null}throw Error(L(156,e.tag))}function uP(t,e){switch(Gh(e),e.tag){case 1:return at(e.type)&&Xa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return qr(),le(ot),le(Qe),rf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return nf(e),null;case 13:if(le(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(L(340));$r()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return le(pe),null;case 4:return qr(),null;case 10:return Xh(e.type._context),null;case 22:case 23:return mf(),null;case 24:return null;default:return null}}var ta=!1,Ke=!1,dP=typeof WeakSet=="function"?WeakSet:Set,B=null;function vr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){be(t,e,i)}else n.current=null}function fd(t,e,n){try{n()}catch(i){be(t,e,i)}}var Dm=!1;function hP(t,e){if(Ju=Ga,t=x0(),Hh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yu={focusedElem:t,selectionRange:n},Ga=!1,B=e;B!==null;)if(e=B,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,B=t;else for(;B!==null;){e=B;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var m=g.memoizedProps,S=g.memoizedState,p=e.stateNode,v=p.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ft(e.type,m),S);p.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(L(163))}}catch(b){be(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,B=t;break}B=e.return}return g=Dm,Dm=!1,g}function zs(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&fd(e,n,s)}r=r.next}while(r!==i)}}function qc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function pd(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Ck(t){var e=t.alternate;e!==null&&(t.alternate=null,Ck(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[tn],delete e[lo],delete e[ed],delete e[Gw],delete e[Qw])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function wk(t){return t.tag===5||t.tag===3||t.tag===4}function Am(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||wk(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function md(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ya));else if(i!==4&&(t=t.child,t!==null))for(md(t,e,n),t=t.sibling;t!==null;)md(t,e,n),t=t.sibling}function gd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(gd(t,e,n),t=t.sibling;t!==null;)gd(t,e,n),t=t.sibling}var je=null,jt=!1;function zn(t,e,n){for(n=n.child;n!==null;)Pk(t,e,n),n=n.sibling}function Pk(t,e,n){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(Uc,n)}catch{}switch(n.tag){case 5:Ke||vr(n,e);case 6:var i=je,r=jt;je=null,zn(t,e,n),je=i,jt=r,je!==null&&(jt?(t=je,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):je.removeChild(n.stateNode));break;case 18:je!==null&&(jt?(t=je,n=n.stateNode,t.nodeType===8?Ul(t.parentNode,n):t.nodeType===1&&Ul(t,n),ro(t)):Ul(je,n.stateNode));break;case 4:i=je,r=jt,je=n.stateNode.containerInfo,jt=!0,zn(t,e,n),je=i,jt=r;break;case 0:case 11:case 14:case 15:if(!Ke&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&fd(n,e,o),r=r.next}while(r!==i)}zn(t,e,n);break;case 1:if(!Ke&&(vr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){be(n,e,a)}zn(t,e,n);break;case 21:zn(t,e,n);break;case 22:n.mode&1?(Ke=(i=Ke)||n.memoizedState!==null,zn(t,e,n),Ke=i):zn(t,e,n);break;default:zn(t,e,n)}}function Mm(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new dP),e.forEach(function(i){var r=SP.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Ot(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:je=a.stateNode,jt=!1;break e;case 3:je=a.stateNode.containerInfo,jt=!0;break e;case 4:je=a.stateNode.containerInfo,jt=!0;break e}a=a.return}if(je===null)throw Error(L(160));Pk(s,o,r),je=null,jt=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){be(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ek(e,t),e=e.sibling}function Ek(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ot(e,t),Yt(t),i&4){try{zs(3,t,t.return),qc(3,t)}catch(m){be(t,t.return,m)}try{zs(5,t,t.return)}catch(m){be(t,t.return,m)}}break;case 1:Ot(e,t),Yt(t),i&512&&n!==null&&vr(n,n.return);break;case 5:if(Ot(e,t),Yt(t),i&512&&n!==null&&vr(n,n.return),t.flags&32){var r=t.stateNode;try{eo(r,"")}catch(m){be(t,t.return,m)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Gy(r,s),Vu(a,o);var l=Vu(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?Zy(r,d):u==="dangerouslySetInnerHTML"?Yy(r,d):u==="children"?eo(r,d):Mh(r,u,d,l)}switch(a){case"input":Lu(r,s);break;case"textarea":Qy(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?xr(r,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?xr(r,!!s.multiple,s.defaultValue,!0):xr(r,!!s.multiple,s.multiple?[]:"",!1))}r[lo]=s}catch(m){be(t,t.return,m)}}break;case 6:if(Ot(e,t),Yt(t),i&4){if(t.stateNode===null)throw Error(L(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(m){be(t,t.return,m)}}break;case 3:if(Ot(e,t),Yt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{ro(e.containerInfo)}catch(m){be(t,t.return,m)}break;case 4:Ot(e,t),Yt(t);break;case 13:Ot(e,t),Yt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(ff=we())),i&4&&Mm(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ke=(l=Ke)||u,Ot(e,t),Ke=l):Ot(e,t),Yt(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(B=t,u=t.child;u!==null;){for(d=B=u;B!==null;){switch(h=B,f=h.child,h.tag){case 0:case 11:case 14:case 15:zs(4,h,h.return);break;case 1:vr(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){be(i,n,m)}}break;case 5:vr(h,h.return);break;case 22:if(h.memoizedState!==null){Lm(d);continue}}f!==null?(f.return=h,B=f):Lm(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Xy("display",o))}catch(m){be(t,t.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){be(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ot(e,t),Yt(t),i&4&&Mm(t);break;case 21:break;default:Ot(e,t),Yt(t)}}function Yt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(wk(n)){var i=n;break e}n=n.return}throw Error(L(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(eo(r,""),i.flags&=-33);var s=Am(t);gd(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Am(t);md(t,a,o);break;default:throw Error(L(161))}}catch(c){be(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function fP(t,e,n){B=t,xk(t)}function xk(t,e,n){for(var i=(t.mode&1)!==0;B!==null;){var r=B,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||ta;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Ke;a=ta;var l=Ke;if(ta=o,(Ke=c)&&!l)for(B=r;B!==null;)o=B,c=o.child,o.tag===22&&o.memoizedState!==null?Nm(r):c!==null?(c.return=o,B=c):Nm(r);for(;s!==null;)B=s,xk(s),s=s.sibling;B=r,ta=a,Ke=l}Om(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,B=s):Om(t)}}function Om(t){for(;B!==null;){var e=B;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||qc(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ke)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ft(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&ym(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ym(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&ro(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(L(163))}Ke||e.flags&512&&pd(e)}catch(h){be(e,e.return,h)}}if(e===t){B=null;break}if(n=e.sibling,n!==null){n.return=e.return,B=n;break}B=e.return}}function Lm(t){for(;B!==null;){var e=B;if(e===t){B=null;break}var n=e.sibling;if(n!==null){n.return=e.return,B=n;break}B=e.return}}function Nm(t){for(;B!==null;){var e=B;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{qc(4,e)}catch(c){be(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){be(e,r,c)}}var s=e.return;try{pd(e)}catch(c){be(e,s,c)}break;case 5:var o=e.return;try{pd(e)}catch(c){be(e,o,c)}}}catch(c){be(e,e.return,c)}if(e===t){B=null;break}var a=e.sibling;if(a!==null){a.return=e.return,B=a;break}B=e.return}}var pP=Math.ceil,cc=jn.ReactCurrentDispatcher,df=jn.ReactCurrentOwner,It=jn.ReactCurrentBatchConfig,Z=0,Fe=null,Re=null,ze=0,dt=0,yr=yi(0),Me=0,go=null,zi=0,Hc=0,hf=0,$s=null,nt=null,ff=0,Kr=1/0,bn=null,lc=!1,vd=null,oi=null,na=!1,Zn=null,uc=0,Ws=0,yd=null,Ta=-1,Ca=0;function Xe(){return Z&6?we():Ta!==-1?Ta:Ta=we()}function ai(t){return t.mode&1?Z&2&&ze!==0?ze&-ze:Yw.transition!==null?(Ca===0&&(Ca=d0()),Ca):(t=te,t!==0||(t=window.event,t=t===void 0?16:y0(t.type)),t):1}function Ht(t,e,n,i){if(50<Ws)throw Ws=0,yd=null,Error(L(185));Ro(t,n,i),(!(Z&2)||t!==Fe)&&(t===Fe&&(!(Z&2)&&(Hc|=n),Me===4&&Jn(t,ze)),ct(t,i),n===1&&Z===0&&!(e.mode&1)&&(Kr=we()+500,zc&&ki()))}function ct(t,e){var n=t.callbackNode;Y1(t,e);var i=Ka(t,t===Fe?ze:0);if(i===0)n!==null&&qp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&qp(n),e===1)t.tag===0?Jw(Um.bind(null,t)):U0(Um.bind(null,t)),Hw(function(){!(Z&6)&&ki()}),n=null;else{switch(h0(i)){case 1:n=Fh;break;case 4:n=l0;break;case 16:n=Ha;break;case 536870912:n=u0;break;default:n=Ha}n=Lk(n,Rk.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Rk(t,e){if(Ta=-1,Ca=0,Z&6)throw Error(L(327));var n=t.callbackNode;if(Ar()&&t.callbackNode!==n)return null;var i=Ka(t,t===Fe?ze:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=dc(t,i);else{e=i;var r=Z;Z|=2;var s=Ik();(Fe!==t||ze!==e)&&(bn=null,Kr=we()+500,Mi(t,e));do try{vP();break}catch(a){_k(t,a)}while(1);Yh(),cc.current=s,Z=r,Re!==null?e=0:(Fe=null,ze=0,e=Me)}if(e!==0){if(e===2&&(r=qu(t),r!==0&&(i=r,e=kd(t,r))),e===1)throw n=go,Mi(t,0),Jn(t,i),ct(t,we()),n;if(e===6)Jn(t,i);else{if(r=t.current.alternate,!(i&30)&&!mP(r)&&(e=dc(t,i),e===2&&(s=qu(t),s!==0&&(i=s,e=kd(t,s))),e===1))throw n=go,Mi(t,0),Jn(t,i),ct(t,we()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(L(345));case 2:Pi(t,nt,bn);break;case 3:if(Jn(t,i),(i&130023424)===i&&(e=ff+500-we(),10<e)){if(Ka(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Xe(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Zu(Pi.bind(null,t,nt,bn),e);break}Pi(t,nt,bn);break;case 4:if(Jn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-qt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=we()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*pP(i/1960))-i,10<i){t.timeoutHandle=Zu(Pi.bind(null,t,nt,bn),i);break}Pi(t,nt,bn);break;case 5:Pi(t,nt,bn);break;default:throw Error(L(329))}}}return ct(t,we()),t.callbackNode===n?Rk.bind(null,t):null}function kd(t,e){var n=$s;return t.current.memoizedState.isDehydrated&&(Mi(t,e).flags|=256),t=dc(t,e),t!==2&&(e=nt,nt=n,e!==null&&bd(e)),t}function bd(t){nt===null?nt=t:nt.push.apply(nt,t)}function mP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Kt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Jn(t,e){for(e&=~hf,e&=~Hc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-qt(e),i=1<<n;t[n]=-1,e&=~i}}function Um(t){if(Z&6)throw Error(L(327));Ar();var e=Ka(t,0);if(!(e&1))return ct(t,we()),null;var n=dc(t,e);if(t.tag!==0&&n===2){var i=qu(t);i!==0&&(e=i,n=kd(t,i))}if(n===1)throw n=go,Mi(t,0),Jn(t,e),ct(t,we()),n;if(n===6)throw Error(L(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Pi(t,nt,bn),ct(t,we()),null}function pf(t,e){var n=Z;Z|=1;try{return t(e)}finally{Z=n,Z===0&&(Kr=we()+500,zc&&ki())}}function $i(t){Zn!==null&&Zn.tag===0&&!(Z&6)&&Ar();var e=Z;Z|=1;var n=It.transition,i=te;try{if(It.transition=null,te=1,t)return t()}finally{te=i,It.transition=n,Z=e,!(Z&6)&&ki()}}function mf(){dt=yr.current,le(yr)}function Mi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,qw(n)),Re!==null)for(n=Re.return;n!==null;){var i=n;switch(Gh(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Xa();break;case 3:qr(),le(ot),le(Qe),rf();break;case 5:nf(i);break;case 4:qr();break;case 13:le(pe);break;case 19:le(pe);break;case 10:Xh(i.type._context);break;case 22:case 23:mf()}n=n.return}if(Fe=t,Re=t=ci(t.current,null),ze=dt=e,Me=0,go=null,hf=Hc=zi=0,nt=$s=null,Ii!==null){for(e=0;e<Ii.length;e++)if(n=Ii[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ii=null}return t}function _k(t,e){do{var n=Re;try{if(Yh(),ka.current=ac,oc){for(var i=ge.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}oc=!1}if(Bi=0,Le=Ae=ge=null,Bs=!1,fo=0,df.current=null,n===null||n.return===null){Me=1,go=e,Re=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=ze,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=wm(o);if(f!==null){f.flags&=-257,Pm(f,o,a,s,e),f.mode&1&&Cm(s,l,e),e=f,c=l;var g=e.updateQueue;if(g===null){var m=new Set;m.add(c),e.updateQueue=m}else g.add(c);break e}else{if(!(e&1)){Cm(s,l,e),gf();break e}c=Error(L(426))}}else if(he&&a.mode&1){var S=wm(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),Pm(S,o,a,s,e),Qh(Hr(c,a));break e}}s=c=Hr(c,a),Me!==4&&(Me=2),$s===null?$s=[s]:$s.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=hk(s,c,e);vm(s,p);break e;case 1:a=c;var v=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(oi===null||!oi.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=fk(s,a,e);vm(s,b);break e}}s=s.return}while(s!==null)}Ak(n)}catch(k){e=k,Re===n&&n!==null&&(Re=n=n.return);continue}break}while(1)}function Ik(){var t=cc.current;return cc.current=ac,t===null?ac:t}function gf(){(Me===0||Me===3||Me===2)&&(Me=4),Fe===null||!(zi&268435455)&&!(Hc&268435455)||Jn(Fe,ze)}function dc(t,e){var n=Z;Z|=2;var i=Ik();(Fe!==t||ze!==e)&&(bn=null,Mi(t,e));do try{gP();break}catch(r){_k(t,r)}while(1);if(Yh(),Z=n,cc.current=i,Re!==null)throw Error(L(261));return Fe=null,ze=0,Me}function gP(){for(;Re!==null;)Dk(Re)}function vP(){for(;Re!==null&&!z1();)Dk(Re)}function Dk(t){var e=Ok(t.alternate,t,dt);t.memoizedProps=t.pendingProps,e===null?Ak(t):Re=e,df.current=null}function Ak(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=uP(n,e),n!==null){n.flags&=32767,Re=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Me=6,Re=null;return}}else if(n=lP(n,e,dt),n!==null){Re=n;return}if(e=e.sibling,e!==null){Re=e;return}Re=e=t}while(e!==null);Me===0&&(Me=5)}function Pi(t,e,n){var i=te,r=It.transition;try{It.transition=null,te=1,yP(t,e,n,i)}finally{It.transition=r,te=i}return null}function yP(t,e,n,i){do Ar();while(Zn!==null);if(Z&6)throw Error(L(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(L(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(X1(t,s),t===Fe&&(Re=Fe=null,ze=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||na||(na=!0,Lk(Ha,function(){return Ar(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=It.transition,It.transition=null;var o=te;te=1;var a=Z;Z|=4,df.current=null,hP(t,n),Ek(n,t),Fw(Yu),Ga=!!Ju,Yu=Ju=null,t.current=n,fP(n),$1(),Z=a,te=o,It.transition=s}else t.current=n;if(na&&(na=!1,Zn=t,uc=r),s=t.pendingLanes,s===0&&(oi=null),H1(n.stateNode),ct(t,we()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(lc)throw lc=!1,t=vd,vd=null,t;return uc&1&&t.tag!==0&&Ar(),s=t.pendingLanes,s&1?t===yd?Ws++:(Ws=0,yd=t):Ws=0,ki(),null}function Ar(){if(Zn!==null){var t=h0(uc),e=It.transition,n=te;try{if(It.transition=null,te=16>t?16:t,Zn===null)var i=!1;else{if(t=Zn,Zn=null,uc=0,Z&6)throw Error(L(331));var r=Z;for(Z|=4,B=t.current;B!==null;){var s=B,o=s.child;if(B.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(B=l;B!==null;){var u=B;switch(u.tag){case 0:case 11:case 15:zs(8,u,s)}var d=u.child;if(d!==null)d.return=u,B=d;else for(;B!==null;){u=B;var h=u.sibling,f=u.return;if(Ck(u),u===l){B=null;break}if(h!==null){h.return=f,B=h;break}B=f}}}var g=s.alternate;if(g!==null){var m=g.child;if(m!==null){g.child=null;do{var S=m.sibling;m.sibling=null,m=S}while(m!==null)}}B=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,B=o;else e:for(;B!==null;){if(s=B,s.flags&2048)switch(s.tag){case 0:case 11:case 15:zs(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,B=p;break e}B=s.return}}var v=t.current;for(B=v;B!==null;){o=B;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,B=y;else e:for(o=v;B!==null;){if(a=B,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:qc(9,a)}}catch(k){be(a,a.return,k)}if(a===o){B=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,B=b;break e}B=a.return}}if(Z=r,ki(),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(Uc,t)}catch{}i=!0}return i}finally{te=n,It.transition=e}}return!1}function Fm(t,e,n){e=Hr(n,e),e=hk(t,e,1),t=si(t,e,1),e=Xe(),t!==null&&(Ro(t,1,e),ct(t,e))}function be(t,e,n){if(t.tag===3)Fm(t,t,n);else for(;e!==null;){if(e.tag===3){Fm(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(oi===null||!oi.has(i))){t=Hr(n,t),t=fk(e,t,1),e=si(e,t,1),t=Xe(),e!==null&&(Ro(e,1,t),ct(e,t));break}}e=e.return}}function kP(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Xe(),t.pingedLanes|=t.suspendedLanes&n,Fe===t&&(ze&n)===n&&(Me===4||Me===3&&(ze&130023424)===ze&&500>we()-ff?Mi(t,0):hf|=n),ct(t,e)}function Mk(t,e){e===0&&(t.mode&1?(e=Ho,Ho<<=1,!(Ho&130023424)&&(Ho=4194304)):e=1);var n=Xe();t=On(t,e),t!==null&&(Ro(t,e,n),ct(t,n))}function bP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Mk(t,n)}function SP(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(L(314))}i!==null&&i.delete(e),Mk(t,n)}var Ok;Ok=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ot.current)rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return rt=!1,cP(t,e,n);rt=!!(t.flags&131072)}else rt=!1,he&&e.flags&1048576&&F0(e,tc,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Sa(t,e),t=e.pendingProps;var r=zr(e,Qe.current);Dr(e,n),r=of(null,e,i,t,r,n);var s=af();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,at(i)?(s=!0,Za(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,ef(e),r.updater=Wc,e.stateNode=r,r._reactInternals=e,od(e,i,t,n),e=ld(null,e,i,!0,s,n)):(e.tag=0,he&&s&&Kh(e),Je(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Sa(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=CP(i),t=Ft(i,t),r){case 0:e=cd(null,e,i,t,n);break e;case 1:e=Rm(null,e,i,t,n);break e;case 11:e=Em(null,e,i,t,n);break e;case 14:e=xm(null,e,i,Ft(i.type,t),n);break e}throw Error(L(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),cd(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),Rm(t,e,i,r,n);case 3:e:{if(vk(e),t===null)throw Error(L(387));i=e.pendingProps,s=e.memoizedState,r=s.element,W0(t,e),rc(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Hr(Error(L(423)),e),e=_m(t,e,i,n,r);break e}else if(i!==r){r=Hr(Error(L(424)),e),e=_m(t,e,i,n,r);break e}else for(ft=ri(e.stateNode.containerInfo.firstChild),mt=e,he=!0,Bt=null,n=z0(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if($r(),i===r){e=Ln(t,e,n);break e}Je(t,e,i,n)}e=e.child}return e;case 5:return q0(e),t===null&&id(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Xu(i,r)?o=null:s!==null&&Xu(i,s)&&(e.flags|=32),gk(t,e),Je(t,e,o,n),e.child;case 6:return t===null&&id(e),null;case 13:return yk(t,e,n);case 4:return tf(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Wr(e,null,i,n):Je(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),Em(t,e,i,r,n);case 7:return Je(t,e,e.pendingProps,n),e.child;case 8:return Je(t,e,e.pendingProps.children,n),e.child;case 12:return Je(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,oe(nc,i._currentValue),i._currentValue=o,s!==null)if(Kt(s.value,o)){if(s.children===r.children&&!ot.current){e=Ln(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=_n(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),rd(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(L(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),rd(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Je(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Dr(e,n),r=Dt(r),i=i(r),e.flags|=1,Je(t,e,i,n),e.child;case 14:return i=e.type,r=Ft(i,e.pendingProps),r=Ft(i.type,r),xm(t,e,i,r,n);case 15:return pk(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ft(i,r),Sa(t,e),e.tag=1,at(i)?(t=!0,Za(e)):t=!1,Dr(e,n),dk(e,i,r),od(e,i,r,n),ld(null,e,i,!0,t,n);case 19:return kk(t,e,n);case 22:return mk(t,e,n)}throw Error(L(156,e.tag))};function Lk(t,e){return c0(t,e)}function TP(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _t(t,e,n,i){return new TP(t,e,n,i)}function vf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function CP(t){if(typeof t=="function")return vf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Lh)return 11;if(t===Nh)return 14}return 2}function ci(t,e){var n=t.alternate;return n===null?(n=_t(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function wa(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")vf(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case cr:return Oi(n.children,r,s,e);case Oh:o=8,r|=8;break;case Iu:return t=_t(12,n,e,r|2),t.elementType=Iu,t.lanes=s,t;case Du:return t=_t(13,n,e,r),t.elementType=Du,t.lanes=s,t;case Au:return t=_t(19,n,e,r),t.elementType=Au,t.lanes=s,t;case qy:return Kc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case $y:o=10;break e;case Wy:o=9;break e;case Lh:o=11;break e;case Nh:o=14;break e;case Kn:o=16,i=null;break e}throw Error(L(130,t==null?t:typeof t,""))}return e=_t(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Oi(t,e,n,i){return t=_t(7,t,i,e),t.lanes=n,t}function Kc(t,e,n,i){return t=_t(22,t,i,e),t.elementType=qy,t.lanes=n,t.stateNode={isHidden:!1},t}function ql(t,e,n){return t=_t(6,t,null,e),t.lanes=n,t}function Hl(t,e,n){return e=_t(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function wP(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=El(0),this.expirationTimes=El(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=El(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function yf(t,e,n,i,r,s,o,a,c){return t=new wP(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=_t(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ef(s),t}function PP(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ar,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Nk(t){if(!t)return hi;t=t._reactInternals;e:{if(Yi(t)!==t||t.tag!==1)throw Error(L(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(at(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(L(171))}if(t.tag===1){var n=t.type;if(at(n))return N0(t,n,e)}return e}function Uk(t,e,n,i,r,s,o,a,c){return t=yf(n,i,!0,t,r,s,o,a,c),t.context=Nk(null),n=t.current,i=Xe(),r=ai(n),s=_n(i,r),s.callback=e??null,si(n,s,r),t.current.lanes=r,Ro(t,r,i),ct(t,i),t}function Gc(t,e,n,i){var r=e.current,s=Xe(),o=ai(r);return n=Nk(n),e.context===null?e.context=n:e.pendingContext=n,e=_n(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=si(r,e,o),t!==null&&(Ht(t,r,o,s),ya(t,r,o)),o}function hc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jm(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function kf(t,e){jm(t,e),(t=t.alternate)&&jm(t,e)}function EP(){return null}var Fk=typeof reportError=="function"?reportError:function(t){console.error(t)};function bf(t){this._internalRoot=t}Qc.prototype.render=bf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(L(409));Gc(t,e,null,null)};Qc.prototype.unmount=bf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$i(function(){Gc(null,t,null,null)}),e[Mn]=null}};function Qc(t){this._internalRoot=t}Qc.prototype.unstable_scheduleHydration=function(t){if(t){var e=m0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Qn.length&&e!==0&&e<Qn[n].priority;n++);Qn.splice(n,0,t),n===0&&v0(t)}};function Sf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Jc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Vm(){}function xP(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=hc(o);s.call(l)}}var o=Uk(e,i,t,0,null,!1,!1,"",Vm);return t._reactRootContainer=o,t[Mn]=o.current,ao(t.nodeType===8?t.parentNode:t),$i(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=hc(c);a.call(l)}}var c=yf(t,0,!1,null,null,!1,!1,"",Vm);return t._reactRootContainer=c,t[Mn]=c.current,ao(t.nodeType===8?t.parentNode:t),$i(function(){Gc(e,c,n,i)}),c}function Yc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=hc(o);a.call(c)}}Gc(e,o,t,r)}else o=xP(n,e,t,r,i);return hc(o)}f0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=_s(e.pendingLanes);n!==0&&(jh(e,n|1),ct(e,we()),!(Z&6)&&(Kr=we()+500,ki()))}break;case 13:$i(function(){var i=On(t,1);if(i!==null){var r=Xe();Ht(i,t,1,r)}}),kf(t,1)}};Vh=function(t){if(t.tag===13){var e=On(t,134217728);if(e!==null){var n=Xe();Ht(e,t,134217728,n)}kf(t,134217728)}};p0=function(t){if(t.tag===13){var e=ai(t),n=On(t,e);if(n!==null){var i=Xe();Ht(n,t,e,i)}kf(t,e)}};m0=function(){return te};g0=function(t,e){var n=te;try{return te=t,e()}finally{te=n}};zu=function(t,e,n){switch(e){case"input":if(Lu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Bc(i);if(!r)throw Error(L(90));Ky(i),Lu(i,r)}}}break;case"textarea":Qy(t,n);break;case"select":e=n.value,e!=null&&xr(t,!!n.multiple,e,!1)}};n0=pf;i0=$i;var RP={usingClientEntryPoint:!1,Events:[Io,hr,Bc,e0,t0,pf]},ys={findFiberByHostInstance:_i,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_P={bundleType:ys.bundleType,version:ys.version,rendererPackageName:ys.rendererPackageName,rendererConfig:ys.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=o0(t),t===null?null:t.stateNode},findFiberByHostInstance:ys.findFiberByHostInstance||EP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ia=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ia.isDisabled&&ia.supportsFiber)try{Uc=ia.inject(_P),rn=ia}catch{}}St.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RP;St.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Sf(e))throw Error(L(200));return PP(t,e,null,n)};St.createRoot=function(t,e){if(!Sf(t))throw Error(L(299));var n=!1,i="",r=Fk;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=yf(t,1,!1,null,null,n,!1,i,r),t[Mn]=e.current,ao(t.nodeType===8?t.parentNode:t),new bf(e)};St.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):(t=Object.keys(t).join(","),Error(L(268,t)));return t=o0(e),t=t===null?null:t.stateNode,t};St.flushSync=function(t){return $i(t)};St.hydrate=function(t,e,n){if(!Jc(e))throw Error(L(200));return Yc(null,t,e,!0,n)};St.hydrateRoot=function(t,e,n){if(!Sf(t))throw Error(L(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Fk;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Uk(e,null,t,1,n??null,r,!1,s,o),t[Mn]=e.current,ao(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Qc(e)};St.render=function(t,e,n){if(!Jc(e))throw Error(L(200));return Yc(null,t,e,!1,n)};St.unmountComponentAtNode=function(t){if(!Jc(t))throw Error(L(40));return t._reactRootContainer?($i(function(){Yc(null,null,t,!1,function(){t._reactRootContainer=null,t[Mn]=null})}),!0):!1};St.unstable_batchedUpdates=pf;St.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Jc(n))throw Error(L(200));if(t==null||t._reactInternals===void 0)throw Error(L(38));return Yc(t,e,n,!1,i)};St.version="18.3.1-next-f1338f8080-20240426";function jk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jk)}catch(t){console.error(t)}}jk(),jy.exports=St;var IP=jy.exports,Bm=IP;Ru.createRoot=Bm.createRoot,Ru.hydrateRoot=Bm.hydrateRoot;function DP(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var AP=Object.defineProperty,MP=(t,e,n)=>e in t?AP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zm=(t,e,n)=>MP(t,typeof e!="symbol"?e+"":e,n);let Ye=class{constructor(){zm(this,"_locking"),zm(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function Se(t,e){if(!t)throw new Error(e)}const OP=34028234663852886e22,LP=-34028234663852886e22,NP=4294967295,UP=2147483647,FP=-2147483648;function Pa(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>UP||t<FP)throw new Error("invalid int 32: "+t)}function Sd(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>NP||t<0)throw new Error("invalid uint 32: "+t)}function Vk(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>OP||t<LP))throw new Error("invalid float 32: "+t)}const Bk=Symbol("@bufbuild/protobuf/enum-type");function jP(t){const e=t[Bk];return Se(e,"missing enum type on enum object"),e}function zk(t,e,n,i){t[Bk]=$k(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function $k(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=Wk(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function VP(t,e,n){const i={};for(const r of e){const s=Wk(r);i[s.localName]=s.no,i[s.no]=s.localName}return zk(i,t,e),i}function Wk(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Tf{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function BP(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Tf),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function zP(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Kl(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Ea=4294967296;function $m(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Ea&&(r=r+(i/Ea|0),i=i%Ea)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Hk(i,r):Cf(i,r)}function $P(t,e){let n=Cf(t,e);const i=n.hi&2147483648;i&&(n=Hk(n.lo,n.hi));const r=qk(n.lo,n.hi);return i?"-"+r:r}function qk(t,e){if({lo:t,hi:e}=WP(t,e),e<=2097151)return String(Ea*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+Wm(o)+Wm(s)}function WP(t,e){return{lo:t>>>0,hi:e>>>0}}function Cf(t,e){return{lo:t|0,hi:e|0}}function Hk(t,e){return e=~e,t?t=~t+1:e+=1,Cf(t,e)}const Wm=t=>{const e=String(t);return"0000000".slice(e.length)+e};function qm(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function qP(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function HP(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>Se(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Se(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),$m(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),$m(r)},dec(r,s){return $P(r,s)},uDec(r,s){return qk(r,s)}}}const fe=HP();var M;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(M||(M={}));var fi;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(fi||(fi={}));function $n(t,e,n){if(e===n)return!0;if(t==M.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return e==n}return!1}function Gr(t,e){switch(t){case M.BOOL:return!1;case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return e==0?fe.zero:"0";case M.DOUBLE:case M.FLOAT:return 0;case M.BYTES:return new Uint8Array(0);case M.STRING:return"";default:return 0}}function Kk(t,e){switch(t){case M.BOOL:return e===!1;case M.STRING:return e==="";case M.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Pe;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Pe||(Pe={}));class KP{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Sd(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Pa(e),qm(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Vk(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Sd(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Pa(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Pa(e),e=(e<<1^e>>31)>>>0,qm(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=fe.enc(e);return Kl(n.lo,n.hi,this.buf),this}sint64(e){let n=fe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Kl(r,s,this.buf),this}uint64(e){let n=fe.uEnc(e);return Kl(n.lo,n.hi,this.buf),this}}class GP{constructor(e,n){this.varint64=zP,this.uint32=qP,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Pe.Varint:for(;this.buf[this.pos++]&128;);break;case Pe.Bit64:this.pos+=4;case Pe.Bit32:this.pos+=4;break;case Pe.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Pe.StartGroup:for(;;){const[s,o]=this.tag();if(o===Pe.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return fe.dec(...this.varint64())}uint64(){return fe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,fe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return fe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return fe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function QP(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function Gk(t){const e=t.field.localName,n=Object.create(null);return n[e]=JP(t),[n,()=>n[e]]}function JP(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Gr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function YP(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Xc=[];for(let t=0;t<Cn.length;t++)Xc[Cn[t].charCodeAt(0)]=t;Xc["-".charCodeAt(0)]=Cn.indexOf("+");Xc["_".charCodeAt(0)]=Cn.indexOf("/");const Qk={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=Xc[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Cn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Cn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Cn[r|i>>6],e+=Cn[i&63],n=0;break}return n&&(e+=Cn[r],e+="=",n==1&&(e+="=")),e}};function XP(t,e,n){Yk(e,t);const i=e.runtime.bin.makeReadOptions(n),r=YP(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Gk(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function ZP(t,e,n,i){Yk(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(Jk(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function Jk(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function Yk(t,e){Se(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Xk(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Kk(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Hm(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Gr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function wn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Tf.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Zk(t,e){return wn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}M.DOUBLE,M.FLOAT,M.INT64,M.UINT64,M.INT32,M.UINT32,M.BOOL,M.STRING,M.BYTES;const Km={ignoreUnknownFields:!1},Gm={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function eE(t){return t?Object.assign(Object.assign({},Km),t):Km}function tE(t){return t?Object.assign(Object.assign({},Gm),t):Gm}const fc=Symbol(),xa=Symbol();function nE(){return{makeReadOptions:eE,makeWriteOptions:tE,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(en(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}Qm(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=Gk(u);Qm(d,a,u.field,n,u),ZP(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Xk(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!rE(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Jm(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&Jk(t,a)){const c=XP(t,a,e),l=Jm(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return qs(t,e,n??fi.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Kk(t,e)))return Ra(t,e)},debug:en}}function en(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Qm(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Se(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Gl(n.T,a,i.ignoreUnknownFields,!0);c!==xa&&o.push(c);break;case"scalar":try{o.push(qs(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=iE(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=Gl(n.V.T,c,i.ignoreUnknownFields,!0);u!==xa&&(o[l]=u);break;case"scalar":try{o[l]=qs(n.V.T,c,fi.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];wn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Gl(n.T,e,i.ignoreUnknownFields,!1);switch(c){case fc:Hm(n,t);break;case xa:break;default:t[s]=c;break}break;case"scalar":try{const l=qs(n.T,e,n.L,!1);switch(l){case fc:Hm(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(en(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function iE(t,e){if(t===M.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return qs(t,e,fi.BIGINT,!0).toString()}function qs(t,e,n,i){if(e===null)return i?Gr(t,n):fc;switch(t){case M.DOUBLE:case M.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==M.FLOAT&&Vk(r),r;case M.INT32:case M.FIXED32:case M.SFIXED32:case M.SINT32:case M.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==M.UINT32||t==M.FIXED32?Sd(s):Pa(s),s;case M.INT64:case M.SFIXED64:case M.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=fe.parse(e);return n?o.toString():o;case M.FIXED64:case M.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=fe.uParse(e);return n?a.toString():a;case M.BOOL:if(typeof e!="boolean")break;return e;case M.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case M.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Qk.dec(e)}throw new Error}function Gl(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:fc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return xa;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(en(e)))}function rE(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Jm(t,e,n){if(t.kind=="map"){Se(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Ra(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Ql(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Se(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Ra(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Ql(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Ra(t.T,e);case"enum":return Ql(t.T,e,n.enumAsInteger);case"message":return Zk(t.T,e).toJson(n)}}function Ql(t,e,n){var i;if(Se(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Ra(t,e){switch(t){case M.INT32:case M.SFIXED32:case M.SINT32:case M.FIXED32:case M.UINT32:return Se(typeof e=="number"),e;case M.FLOAT:case M.DOUBLE:return Se(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case M.STRING:return Se(typeof e=="string"),e;case M.BOOL:return Se(typeof e=="boolean"),e;case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return Se(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case M.BYTES:return Se(e instanceof Uint8Array),Qk.enc(e)}}const rr=Symbol("@bufbuild/protobuf/unknown-fields"),Ym={readUnknownFields:!0,readerFactory:t=>new GP(t)},Xm={writeUnknownFields:!0,writerFactory:()=>new KP};function sE(t){return t?Object.assign(Object.assign({},Ym),t):Ym}function oE(t){return t?Object.assign(Object.assign({},Xm),t):Xm}function aE(){return{makeReadOptions:sE,makeWriteOptions:oE,listUnknownFields(t){var e;return(e=t[rr])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[rr]},writeUnknownFields(t,e){const i=t[rr];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[rr])||(r[rr]=[]),r[rr].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==Pe.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Zm(t,e,l,c,i)}if(r&&(c!=Pe.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Zm,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!Xk(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];eg(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&eg(t,e,n,i)}}}function Zm(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?M.INT32:n.T;let c=pc;if(n.kind=="scalar"&&n.L>0&&(c=lE),s){let h=t[o];if(i==Pe.LengthDelimited&&a!=M.STRING&&a!=M.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(_a(e,new l,r,n)):wn(t[o])?_a(e,t[o],r,n):(t[o]=_a(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=cE(n,e,r);t[o][u]=d;break}}function _a(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function cE(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=pc(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=pc(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=_a(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Gr(t.K,fi.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Gr(t.V.T,fi.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function lE(t,e){const n=pc(t,e);return typeof n=="bigint"?n.toString():n}function pc(t,e){switch(e){case M.STRING:return t.string();case M.BOOL:return t.bool();case M.DOUBLE:return t.double();case M.FLOAT:return t.float();case M.INT32:return t.int32();case M.INT64:return t.int64();case M.UINT64:return t.uint64();case M.FIXED64:return t.fixed64();case M.BYTES:return t.bytes();case M.FIXED32:return t.fixed32();case M.SFIXED32:return t.sfixed32();case M.SFIXED64:return t.sfixed64();case M.SINT64:return t.sint64();case M.UINT32:return t.uint32();case M.SINT32:return t.sint32()}}function eg(t,e,n,i){Se(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?M.INT32:t.T;if(r)if(Se(Array.isArray(e)),t.packed)dE(n,s,t.no,e);else for(const o of e)Hs(n,s,t.no,o);else Hs(n,s,t.no,e);break;case"message":if(r){Se(Array.isArray(e));for(const o of e)tg(n,i,t,o)}else tg(n,i,t,e);break;case"map":Se(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))uE(n,i,t,o,a);break}}function uE(t,e,n,i,r){t.tag(n.no,Pe.LengthDelimited),t.fork();let s=i;switch(n.K){case M.INT32:case M.FIXED32:case M.UINT32:case M.SFIXED32:case M.SINT32:s=Number.parseInt(i);break;case M.BOOL:Se(i=="true"||i=="false"),s=i=="true";break}switch(Hs(t,n.K,1,s),n.V.kind){case"scalar":Hs(t,n.V.T,2,r);break;case"enum":Hs(t,M.INT32,2,r);break;case"message":Se(r!==void 0),t.tag(2,Pe.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function tg(t,e,n,i){const r=Zk(n.T,i);n.delimited?t.tag(n.no,Pe.StartGroup).raw(r.toBinary(e)).tag(n.no,Pe.EndGroup):t.tag(n.no,Pe.LengthDelimited).bytes(r.toBinary(e))}function Hs(t,e,n,i){Se(i!==void 0);let[r,s]=eb(e);t.tag(n,r)[s](i)}function dE(t,e,n,i){if(!i.length)return;t.tag(n,Pe.LengthDelimited).fork();let[,r]=eb(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function eb(t){let e=Pe.Varint;switch(t){case M.BYTES:case M.STRING:e=Pe.LengthDelimited;break;case M.DOUBLE:case M.FIXED64:case M.SFIXED64:e=Pe.Bit64;break;case M.FIXED32:case M.SFIXED32:case M.FLOAT:e=Pe.Bit32;break}const n=M[t].toLowerCase();return[e,n]}function hE(){return{setEnumType:zk,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!wn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===M.BYTES&&(l=ks(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===M.BYTES&&(u=i.repeated?u.map(ks):ks(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===M.BYTES)for(const[f,g]of Object.entries(o[r]))s[r][f]=ks(g);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(o[r])){let g=o[r][f];h.fieldWrapper||(g=new h(g)),s[r][f]=g}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>wn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=ks(h):s[r]=h:s[r]=wn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>$n(i.T,o,s[a]));case"enum":return r.every((o,a)=>$n(M.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!wn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!wn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return $n(M.INT32,r,s);case"scalar":return $n(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return $n(M.INT32,r.value,s.value);case"scalar":return $n(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(h=>u.equals(r[h],s[h]));case"enum":return l.every(h=>$n(M.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return l.every(h=>$n(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(ra);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=ra(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:ra(s.value)}:{case:void 0}:o=ra(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function ra(t){if(t===void 0)return t;if(wn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function ks(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function fE(t,e,n){return{syntax:t,json:nE(),bin:aE(),util:Object.assign(Object.assign({},hE()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return BP(this,i,r,s)},makeEnum:VP,makeEnumType:$k,getEnumType:jP,makeExtension(i,r,s){return QP(this,i,r,s)}}}class pE{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function tb(t,e){const n=nb(t);return e?n:bE(kE(n))}function mE(t){return tb(t,!1)}const gE=nb;function nb(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const vE=new Set(["constructor","toString","toJSON","valueOf"]),yE=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ib=t=>"".concat(t,"$"),kE=t=>yE.has(t)?ib(t):t,bE=t=>vE.has(t)?ib(t):t;class SE{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=mE(e)}addField(e){Se(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function TE(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=tb(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:gE(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:fi.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=M.BYTES&&u.T!=M.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new SE(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const R=fE("proto3",t=>new pE(t,e=>TE(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Gr(e.T,e.L);break}}});class it extends Tf{constructor(e){super(),this.seconds=fe.zero,this.nanos=0,R.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(R.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=fe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return it.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new it({seconds:fe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new it().fromBinary(e,n)}static fromJson(e,n){return new it().fromJson(e,n)}static fromJsonString(e,n){return new it().fromJsonString(e,n)}static equals(e,n){return R.util.equals(it,e,n)}}it.runtime=R;it.typeName="google.protobuf.Timestamp";it.fields=R.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const CE=R.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:it},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:wE,repeated:!0},{no:5,name:"events",kind:"message",T:EE,repeated:!0}]),wE=R.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:PE,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),PE=R.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:it},{no:3,name:"value",kind:"scalar",T:2}]),EE=R.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:it},{no:7,name:"normalized_end_timestamp",kind:"message",T:it,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),rb=R.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),zt=R.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),xe=R.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),wf=R.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Ds=R.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),vo=R.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Wt=R.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),sr=R.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),xE=R.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ne=R.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Zc=R.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:mc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:vb}]),mc=R.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),RE=R.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:R.getEnumType(xe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Wi=R.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(Mr)},{no:4,name:"tracks",kind:"message",T:kr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:RE},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:R.getEnumType(qi)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:R.getEnumType(Wt)},{no:18,name:"kind_details",kind:"enum",T:R.getEnumType(_E),repeated:!0}]),Mr=R.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),qi=R.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),_E=R.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ht=R.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),IE=R.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Li,repeated:!0}]),kr=R.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:R.getEnumType(zt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:R.getEnumType(xe)},{no:10,name:"layers",kind:"message",T:Li,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:IE,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:R.getEnumType(ht)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:vb},{no:19,name:"audio_features",kind:"enum",T:R.getEnumType(Ne),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(rb)}]),Li=R.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(wf)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),tt=R.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:R.getEnumType(q)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:ob,oneof:"value"},{no:3,name:"speaker",kind:"message",T:DE,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:ab,oneof:"value"},{no:7,name:"transcription",kind:"message",T:AE,oneof:"value"},{no:8,name:"metrics",kind:"message",T:CE,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Td,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:cb,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:lb,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:ub,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:wd,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Pd,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ed,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),q=R.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),DE=R.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:sb,repeated:!0}]),sb=R.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),ob=R.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),ab=R.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),AE=R.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:ME,repeated:!0}]),ME=R.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Td=R.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),cb=R.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),lb=R.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),ub=R.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:db,oneof:"value"}]),db=R.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),hb=R.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),fb=R.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:R.getEnumType(pb)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),pb=R.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),OE=R.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:R.getEnumType(mb)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),mb=R.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),gb=R.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:ng},{no:2,name:"screen",kind:"message",T:ng},{no:3,name:"resume_connection",kind:"enum",T:R.getEnumType(vo)},{no:4,name:"disabled_codecs",kind:"message",T:LE},{no:5,name:"force_relay",kind:"enum",T:R.getEnumType(vo)}]),ng=R.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:R.getEnumType(vo)}]),LE=R.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:mc,repeated:!0},{no:2,name:"publish",kind:"message",T:mc,repeated:!0}]),vb=R.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Cd=R.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),yb=R.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:R.getEnumType(Cd)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),kb=R.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),wd=R.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:R.getEnumType(ht)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:yb,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:kb,oneof:"content_header"}],{localName:"DataStream_Header"}),Pd=R.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ed=R.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),$t=R.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),xd=R.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),NE=R.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),UE=R.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Hi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Pf,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_d,oneof:"message"},{no:5,name:"mute",kind:"message",T:Ef,oneof:"message"},{no:6,name:"subscription",kind:"message",T:el,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:bb,oneof:"message"},{no:8,name:"leave",kind:"message",T:tl,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Tb,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Eb,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:xb,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Xt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Cb,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ib,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Sb,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:zE,oneof:"message"}]),ig=R.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:FE,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Hi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Pf,oneof:"message"},{no:5,name:"update",kind:"message",T:BE,oneof:"message"},{no:6,name:"track_published",kind:"message",T:xf,oneof:"message"},{no:8,name:"leave",kind:"message",T:tl,oneof:"message"},{no:9,name:"mute",kind:"message",T:Ef,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:$E,oneof:"message"},{no:11,name:"room_update",kind:"message",T:WE,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:HE,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:GE,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:JE,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:YE,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:VE,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:jE,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:ZE,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:nx,oneof:"message"},{no:22,name:"request_response",kind:"message",T:ix,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:rx,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:XE,oneof:"message"}]),Rd=R.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),_d=R.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:R.getEnumType(zt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:R.getEnumType(xe)},{no:9,name:"layers",kind:"message",T:Li,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Rd,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:R.getEnumType(ht)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(rb)},{no:17,name:"audio_features",kind:"enum",T:R.getEnumType(Ne),repeated:!0}]),Pf=R.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:R.getEnumType($t)},{no:3,name:"final",kind:"scalar",T:8}]),Ef=R.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),FE=R.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Zc},{no:2,name:"participant",kind:"message",T:Wi},{no:3,name:"other_participants",kind:"message",T:Wi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:wb,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:gb},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:fb},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:mc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),jE=R.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:wb,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:gb},{no:3,name:"server_info",kind:"message",T:fb},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),xf=R.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:kr}]),VE=R.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Hi=R.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),BE=R.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Wi,repeated:!0}]),el=R.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:hb,repeated:!0}]),bb=R.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:R.getEnumType(wf)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Sb=R.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:R.getEnumType(Ne),repeated:!0}]),zE=R.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),tl=R.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:R.getEnumType(Wt)},{no:3,name:"action",kind:"enum",T:R.getEnumType(Or)},{no:4,name:"regions",kind:"message",T:ex}]),Or=R.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Tb=R.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Li,repeated:!0}]),Cb=R.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),wb=R.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),$E=R.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:sb,repeated:!0}]),WE=R.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Zc}]),qE=R.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:R.getEnumType(Ds)},{no:3,name:"score",kind:"scalar",T:2}]),HE=R.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:qE,repeated:!0}]),KE=R.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(xd)}]),GE=R.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:KE,repeated:!0}]),Rf=R.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(wf)},{no:2,name:"enabled",kind:"scalar",T:8}]),QE=R.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Rf,repeated:!0}]),JE=R.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Rf,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:QE,repeated:!0}]),Pb=R.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Eb=R.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Pb,repeated:!0}]),YE=R.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),XE=R.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Zc},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Wi},{no:4,name:"other_participants",kind:"message",T:Wi,repeated:!0}]),xb=R.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Hi},{no:2,name:"subscription",kind:"message",T:el},{no:3,name:"publish_tracks",kind:"message",T:xf,repeated:!0},{no:4,name:"data_channels",kind:"message",T:_b,repeated:!0},{no:5,name:"offer",kind:"message",T:Hi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Rb,repeated:!0}]),Rb=R.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),_b=R.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:R.getEnumType($t)}]),Xt=R.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:R.getEnumType(NE),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ib=R.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),ZE=R.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),ex=R.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:tx,repeated:!0}]),tx=R.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),nx=R.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:R.getEnumType(xE)}]),ix=R.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:R.getEnumType(_f)},{no:3,name:"message",kind:"scalar",T:9}]),_f=R.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),rx=R.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function sx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ia={exports:{}},ox=Ia.exports,rg;function ax(){return rg||(rg=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(ox,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(m,S){var p=m[S];if(typeof p.bind=="function")return p.bind(m);try{return Function.prototype.bind.call(p,m)}catch{return function(){return Function.prototype.apply.apply(p,[m,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&i?c:console[m]!==void 0?a(console,m):console.log!==void 0?a(console,"log"):e}function u(){for(var m=this.getLevel(),S=0;S<r.length;S++){var p=r[S];this[p]=S<m?e:this.methodFactory(p,m,this.name)}if(this.log=this.debug,typeof console===n&&m<this.levels.SILENT)return"No console available for logging"}function d(m){return function(){typeof console!==n&&(u.call(this),this[m].apply(this,arguments))}}function h(m,S,p){return l(m)||d.apply(this,arguments)}function f(m,S){var p=this,v,y,b,k="loglevel";typeof m=="string"?k+=":"+m:typeof m=="symbol"&&(k=void 0);function w(O){var V=(r[O]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=V;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+V+";"}catch{}}}function E(){var O;if(!(typeof window===n||!k)){try{O=window.localStorage[k]}catch{}if(typeof O===n)try{var V=window.document.cookie,H=encodeURIComponent(k),ee=V.indexOf(H+"=");ee!==-1&&(O=/^([^;]+)/.exec(V.slice(ee+H.length+1))[1])}catch{}return p.levels[O]===void 0&&(O=void 0),O}}function P(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(O){var V=O;if(typeof V=="string"&&p.levels[V.toUpperCase()]!==void 0&&(V=p.levels[V.toUpperCase()]),typeof V=="number"&&V>=0&&V<=p.levels.SILENT)return V;throw new TypeError("log.setLevel() called with invalid level: "+O)}p.name=m,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=S||h,p.getLevel=function(){return b??y??v},p.setLevel=function(O,V){return b=D(O),V!==!1&&w(b),u.call(p)},p.setDefaultLevel=function(O){y=D(O),E()||p.setLevel(O,!1)},p.resetLevel=function(){b=null,P(),u.call(p)},p.enableAll=function(O){p.setLevel(p.levels.TRACE,O)},p.disableAll=function(O){p.setLevel(p.levels.SILENT,O)},p.rebuild=function(){if(o!==p&&(v=D(o.getLevel())),u.call(p),o===p)for(var O in s)s[O].rebuild()},v=D(o?o.getLevel():"WARN");var I=E();I!=null&&(b=D(I)),u.call(p)}o=new f,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var p=s[S];return p||(p=s[S]=new f(S,o.methodFactory)),p};var g=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=g),o},o.getLoggers=function(){return s},o.default=o,o})}(Ia)),Ia.exports}var nl=ax(),Id;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Id||(Id={}));var Gt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Gt||(Gt={}));let Q=nl.getLogger("livekit");Object.values(Gt).map(t=>nl.getLogger(t));Q.setDefaultLevel(Id.info);function Nn(t){const e=nl.getLogger(t);return e.setDefaultLevel(Q.getLevel()),e}const cx=nl.getLogger("lk-e2ee"),bs=7e3,lx=[0,300,2*2*300,3*3*300,4*4*300,bs,bs,bs,bs,bs];class ux{constructor(e){this._retryDelays=e!==void 0?[...e]:lx}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function dx(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function C(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function sg(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof sg=="function"?sg(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var sa={exports:{}},og;function hx(){if(og)return sa.exports;og=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,w,E){return Function.prototype.apply.call(k,w,E)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function i(b){console&&console.warn&&console.warn(b)}var r=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}sa.exports=s,sa.exports.once=p,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(k){for(var w=[],E=1;E<arguments.length;E++)w.push(arguments[E]);var P=k==="error",D=this._events;if(D!==void 0)P=P&&D.error===void 0;else if(!P)return!1;if(P){var I;if(w.length>0&&(I=w[0]),I instanceof Error)throw I;var O=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw O.context=I,O}var V=D[k];if(V===void 0)return!1;if(typeof V=="function")e(V,this,w);else for(var H=V.length,ee=g(V,H),E=0;E<H;++E)e(ee[E],this,w);return!0};function l(b,k,w,E){var P,D,I;if(a(w),D=b._events,D===void 0?(D=b._events=Object.create(null),b._eventsCount=0):(D.newListener!==void 0&&(b.emit("newListener",k,w.listener?w.listener:w),D=b._events),I=D[k]),I===void 0)I=D[k]=w,++b._eventsCount;else if(typeof I=="function"?I=D[k]=E?[w,I]:[I,w]:E?I.unshift(w):I.push(w),P=c(b),P>0&&I.length>P&&!I.warned){I.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=b,O.type=k,O.count=I.length,i(O)}return b}s.prototype.addListener=function(k,w){return l(this,k,w,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,w){return l(this,k,w,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(b,k,w){var E={fired:!1,wrapFn:void 0,target:b,type:k,listener:w},P=u.bind(E);return P.listener=w,E.wrapFn=P,P}s.prototype.once=function(k,w){return a(w),this.on(k,d(this,k,w)),this},s.prototype.prependOnceListener=function(k,w){return a(w),this.prependListener(k,d(this,k,w)),this},s.prototype.removeListener=function(k,w){var E,P,D,I,O;if(a(w),P=this._events,P===void 0)return this;if(E=P[k],E===void 0)return this;if(E===w||E.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete P[k],P.removeListener&&this.emit("removeListener",k,E.listener||w));else if(typeof E!="function"){for(D=-1,I=E.length-1;I>=0;I--)if(E[I]===w||E[I].listener===w){O=E[I].listener,D=I;break}if(D<0)return this;D===0?E.shift():m(E,D),E.length===1&&(P[k]=E[0]),P.removeListener!==void 0&&this.emit("removeListener",k,O||w)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var w,E,P;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[k]),this;if(arguments.length===0){var D=Object.keys(E),I;for(P=0;P<D.length;++P)I=D[P],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=E[k],typeof w=="function")this.removeListener(k,w);else if(w!==void 0)for(P=w.length-1;P>=0;P--)this.removeListener(k,w[P]);return this};function h(b,k,w){var E=b._events;if(E===void 0)return[];var P=E[k];return P===void 0?[]:typeof P=="function"?w?[P.listener||P]:[P]:w?S(P):g(P,P.length)}s.prototype.listeners=function(k){return h(this,k,!0)},s.prototype.rawListeners=function(k){return h(this,k,!1)},s.listenerCount=function(b,k){return typeof b.listenerCount=="function"?b.listenerCount(k):f.call(b,k)},s.prototype.listenerCount=f;function f(b){var k=this._events;if(k!==void 0){var w=k[b];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(b,k){for(var w=new Array(k),E=0;E<k;++E)w[E]=b[E];return w}function m(b,k){for(;k+1<b.length;k++)b[k]=b[k+1];b.pop()}function S(b){for(var k=new Array(b.length),w=0;w<k.length;++w)k[w]=b[w].listener||b[w];return k}function p(b,k){return new Promise(function(w,E){function P(I){b.removeListener(k,D),E(I)}function D(){typeof b.removeListener=="function"&&b.removeListener("error",P),w([].slice.call(arguments))}y(b,k,D,{once:!0}),k!=="error"&&v(b,P,{once:!0})})}function v(b,k,w){typeof b.on=="function"&&y(b,"error",k,w)}function y(b,k,w,E){if(typeof b.on=="function")E.once?b.once(k,w):b.on(k,w);else if(typeof b.addEventListener=="function")b.addEventListener(k,function P(D){E.once&&b.removeEventListener(k,P),w(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return sa.exports}var pn=hx();let Db=!0,Ab=!0;function As(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Xi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function fx(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Db=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function px(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Ab=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Mb(){if(typeof window=="object"){if(Db)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function If(t,e){Ab&&console.warn(t+" is deprecated, please use "+e+" instead.")}function mx(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(As(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(As(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(As(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=As(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function ag(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ob(t){return ag(t)?Object.keys(t).reduce(function(e,n){const i=ag(t[n]),r=i?Ob(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function Dd(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Dd(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Dd(t,t.get(r),n)})}))}function cg(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&Dd(t,a,r)})}),r}const lg=Mb;function Lb(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(g=>g.kind==="videoinput");let f=h.find(g=>d.some(m=>g.label.toLowerCase().includes(m)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=l.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),lg("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return lg("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Nb(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Ub(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Xi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Fb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function jb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>cg(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Xi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>cg(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Vb(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Bb(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Vb(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new t.MediaStream([u]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],g=l._streams[f.id];d=d.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],g=l._streams[f.id];d=d.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const m=s(this,g);h[0].apply(null,[m])},g=>{h[1]&&h[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>s(this,g))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(m=>u.track===m)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ad(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function zb(t,e){Xi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var ug=Object.freeze({__proto__:null,fixNegotiationNeeded:zb,shimAddTrackRemoveTrack:Bb,shimAddTrackRemoveTrackWithNative:Vb,shimGetSendersWithDtmf:Fb,shimGetUserMedia:Lb,shimMediaStream:Nb,shimOnTrack:Ub,shimPeerConnection:Ad,shimSenderReceiverGetStats:jb});function $b(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){If("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function gx(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function Wb(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Md(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function qb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Hb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Xi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Kb(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){If("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Gb(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Qb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Jb(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Yb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Xb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var dg=Object.freeze({__proto__:null,shimAddTransceiver:Qb,shimCreateAnswer:Xb,shimCreateOffer:Yb,shimGetDisplayMedia:gx,shimGetParameters:Jb,shimGetUserMedia:$b,shimOnTrack:Wb,shimPeerConnection:Md,shimRTCDataChannel:Gb,shimReceiverGetStats:Hb,shimRemoveStream:Kb,shimSenderGetStats:qb});function Zb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function eS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function tS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function nS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(iS(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function iS(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ob(t.video)}):t}function rS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(If("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function sS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function oS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function aS(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var hg=Object.freeze({__proto__:null,shimAudioContext:aS,shimCallbacksAPI:tS,shimConstraints:iS,shimCreateOfferLegacy:oS,shimGetUserMedia:nS,shimLocalStreamsAPI:Zb,shimRTCIceServerUrls:rS,shimRemoteStreamsAPI:eS,shimTrackEventTransceiver:sS}),Jl={exports:{}},fg;function vx(){return fg||(fg=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(g=>parseInt(g,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(f.rtx={ssrc:l}),i.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Jl)),Jl.exports}var cS=vx(),Lr=sx(cS),yx=DP({__proto__:null,default:Lr},[cS]);function Da(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Lr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Xi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Od(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Xi(t,"icecandidate",e=>{if(e.candidate){const n=Lr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Aa(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Lr.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Lr.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Lr.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function Ma(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Xi(t,"datachannel",i=>(e(i.channel,i.target),i))}function Ld(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Nd(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Oa(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function La(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var kx=Object.freeze({__proto__:null,removeExtmapAllowMixed:Nd,shimAddIceCandidateNullOrEmpty:Oa,shimConnectionState:Ld,shimMaxMessageSize:Aa,shimParameterlessSetLocalDescription:La,shimRTCIceCandidate:Da,shimRTCIceCandidateRelayProtocol:Od,shimSendThrowTypeError:Ma});function bx(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Mb,i=mx(t),r={browserDetails:i,commonShim:kx,extractVersion:As,disableLog:fx,disableWarnings:px,sdp:yx};switch(i.browser){case"chrome":if(!ug||!Ad||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=ug,Oa(t,i),La(t),Lb(t,i),Nb(t),Ad(t,i),Ub(t),Bb(t,i),Fb(t),jb(t),zb(t,i),Da(t),Od(t),Ld(t),Aa(t,i),Ma(t),Nd(t,i);break;case"firefox":if(!dg||!Md||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=dg,Oa(t,i),La(t),$b(t,i),Md(t,i),Wb(t),Kb(t),qb(t),Hb(t),Gb(t),Qb(t),Jb(t),Yb(t),Xb(t),Da(t),Ld(t),Aa(t,i),Ma(t);break;case"safari":if(!hg||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=hg,Oa(t,i),La(t),rS(t),oS(t),tS(t),Zb(t),eS(t),sS(t),nS(t),aS(t),Da(t),Od(t),Aa(t,i),Ma(t),Nd(t,i);break;default:n("Unsupported browser!");break}return r}bx({window:typeof window>"u"?void 0:window});const Sx=10,Ss="lk_e2ee",Tx="LKFrameEncryptionKey",Cx={sharedKey:!1,ratchetSalt:Tx,ratchetWindowSize:8,failureTolerance:Sx,keyringSize:16};var li;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(li||(li={}));var pg;(function(t){t.KeyRatcheted="keyRatcheted"})(pg||(pg={}));var ei;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(ei||(ei={}));var mg;(function(t){t.Error="cryptorError"})(mg||(mg={}));function wx(){return Px()||Ud()}function Ud(){return typeof window.RTCRtpScriptTransform<"u"}function Px(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class u2 extends pn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Q.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Cx),e),this.on(li.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(li.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(li.RatchetRequest,e,n)}}class bi extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var X;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(X||(X={}));class se extends bi{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=X[n]}}class Df extends bi{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class En extends bi{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class Ex extends bi{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class De extends bi{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Fd extends bi{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class gg extends bi{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class vg extends bi{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:_f[n]}}var gc;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(gc||(gc={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(gc||(gc={}));var yg;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(yg||(yg={}));var _;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(_||(_={}));var A;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(A||(A={}));var j;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(j||(j={}));var U;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(U||(U={}));function xx(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const Rx=/version\/(\d+(\.?_?\d+)+)/i;let Yl;function gt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof t>"u"&&typeof navigator>"u")return;const n=(t??navigator.userAgent).toLowerCase();if(Yl===void 0||e){const i=_x.find(r=>{let{test:s}=r;return s.test(n)});Yl=i==null?void 0:i.describe(n)}return Yl}const _x=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Na(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Xl(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Na(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Xl(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Na(Rx,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Xl(t)}}}];function Na(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Xl(t){return t.includes("mac os")?Na(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var Ix="2.15.3";const Dx=Ix,Ax=16;class Be{}Be.setTimeout=function(){return setTimeout(...arguments)};Be.setInterval=function(){return setInterval(...arguments)};Be.clearTimeout=function(){return clearTimeout(...arguments)};Be.clearInterval=function(){return clearInterval(...arguments)};const Mx=5e3,Ts=[];var pt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(pt||(pt={}));class x extends pn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=x.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Q,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),Mx):this.handleAppVisibilityChanged()},this.log=Nn((r=i.loggerName)!==null&&r!==void 0?r:Gt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=x.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),K(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===x.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===x.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Ts.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Ts.splice(Ts.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),br(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?U.AudioPlaybackStarted:U.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?U.AudioPlaybackFailed:U.VideoPlaybackFailed,s):s.name==="AbortError"?Q.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Q.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(U.ElementAttached,e),e}detach(e){try{if(e){Nr(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(U.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Nr(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(U.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Nn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Ts.forEach(i=>{i.parentElement||(n=!1)}),n&&Ts.push(e)}}handleAppVisibilityChanged(){return C(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===x.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){st()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){st()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function br(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Ki()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Ki()||Qr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Nr(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return zt.AUDIO;case e.Video:return zt.VIDEO;default:return zt.DATA}}t.kindToProto=r;function s(l){switch(l){case zt.AUDIO:return e.Audio;case zt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return xe.CAMERA;case n.Microphone:return xe.MICROPHONE;case n.ScreenShare:return xe.SCREEN_SHARE;case n.ScreenShareAudio:return xe.SCREEN_SHARE_AUDIO;default:return xe.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case xe.CAMERA:return n.Camera;case xe.MICROPHONE:return n.Microphone;case xe.SCREEN_SHARE:return n.ScreenShare;case xe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case xd.ACTIVE:return i.Active;case xd.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(x||(x={}));class ie{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Ox=["vp8","h264"],Lx=["vp8","h264","vp9","av1","h265"];function Nx(t){return!!Ox.find(e=>e===t)}var kg;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(kg||(kg={}));var jd;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(jd||(jd={}));const yo={h90:new ie(160,90,9e4,20),h180:new ie(320,180,16e4,20),h216:new ie(384,216,18e4,20),h360:new ie(640,360,45e4,20),h540:new ie(960,540,8e5,25),h720:new ie(1280,720,17e5,30),h1080:new ie(1920,1080,3e6,30),h1440:new ie(2560,1440,5e6,30),h2160:new ie(3840,2160,8e6,30)},Vd={h120:new ie(160,120,7e4,20),h180:new ie(240,180,125e3,20),h240:new ie(320,240,14e4,20),h360:new ie(480,360,33e4,20),h480:new ie(640,480,5e5,20),h540:new ie(720,540,6e5,25),h720:new ie(960,720,13e5,30),h1080:new ie(1440,1080,23e5,30),h1440:new ie(1920,1440,38e5,30)},Af={h360fps3:new ie(640,360,2e5,3,"medium"),h360fps15:new ie(640,360,4e5,15,"medium"),h720fps5:new ie(1280,720,8e5,5,"medium"),h720fps15:new ie(1280,720,15e5,15,"medium"),h720fps30:new ie(1280,720,2e6,30,"medium"),h1080fps15:new ie(1920,1080,25e5,15,"medium"),h1080fps30:new ie(1920,1080,5e6,30,"medium"),original:new ie(0,0,7e6,30,"medium")},Ux="|",bg="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Fx(t){const e=t.split(Ux);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function lt(t){return C(this,void 0,void 0,function*(){return new Promise(e=>Be.setTimeout(e,t))})}function Bd(){return"addTransceiver"in RTCPeerConnection.prototype}function zd(){return"addTrack"in RTCPeerConnection.prototype}function jx(){if(!("getCapabilities"in RTCRtpSender)||Ki())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function Vx(){if(!("getCapabilities"in RTCRtpSender)||Qr())return!1;if(Ki()){const n=gt();if(n!=null&&n.version&&dn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&dn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function nn(t){return t==="av1"||t==="vp9"}function $d(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function Bx(){return typeof RTCPeerConnection>"u"?!1:Bd()||zd()}function Qr(){var t;return((t=gt())===null||t===void 0?void 0:t.name)==="Firefox"}function Ki(){var t;return((t=gt())===null||t===void 0?void 0:t.name)==="Safari"}function Wd(){const t=gt();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function zx(){const t=gt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&dn(t.osVersion,"17")>=0}function $x(t){return t||(t=gt()),(t==null?void 0:t.name)==="Safari"&&dn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&dn(t.osVersion,"18.3")>0}function lS(){var t,e;return st()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Wx(){const t=gt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&dn(e,t.osVersion)>=0?!0:t.name==="Safari"&&dn(e,t.version)>=0}function st(){return typeof document<"u"}function un(){return navigator.product=="ReactNative"}function qd(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function uS(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function dS(){if(!un())return;let t=uS();if(t)return t.platform}function Sg(){if(st())return window.devicePixelRatio;if(un()){let t=uS();if(t)return t.devicePixelRatio}return 1}function dn(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function qx(t){for(const e of t)e.target.handleResize(e)}function Hx(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Zl=null;const Tg=()=>(Zl||(Zl=new ResizeObserver(qx)),Zl);let eu=null;const Cg=()=>(eu||(eu=new IntersectionObserver(Hx,{root:null,rootMargin:"0px"})),eu);function Kx(){var t;const e=new OE({sdk:mb.JS,protocol:Ax,version:Dx});return un()&&(e.os=(t=dS())!==null&&t!==void 0?t:""),e}function wg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Cs;function tu(){if(!Cs){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Cs]=i.stream.getAudioTracks(),!Cs)throw Error("Could not get empty media stream audio track");Cs.enabled=!1}return Cs.clone()}class Sr{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>C(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function Gx(t,e){const n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},e),i=Of();if(!i)throw new Error("Audio Context not supported on this browser");const r=n.cloneTrack?t.mediaStreamTrack.clone():t.mediaStreamTrack,s=i.createMediaStreamSource(new MediaStream([r])),o=i.createAnalyser();o.minDecibels=n.minDecibels,o.maxDecibels=n.maxDecibels,o.fftSize=n.fftSize,o.smoothingTimeConstant=n.smoothingTimeConstant,s.connect(o);const a=new Uint8Array(o.frequencyBinCount);return{calculateVolume:()=>{o.getByteFrequencyData(a);let u=0;for(const h of a)u+=Math.pow(h/255,2);return Math.sqrt(u/a.length)},analyser:o,cleanup:()=>C(this,void 0,void 0,function*(){yield i.close(),n.cloneTrack&&r.stop()})}}function Qx(t){return Lx.includes(t)}function ui(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function Jx(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Hd(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function Yx(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function Xx(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Pg(t){switch(t.reason){case X.LeaveRequest:return t.context;case X.Cancelled:return Wt.CLIENT_INITIATED;case X.NotAllowed:return Wt.USER_REJECTED;case X.ServerUnreachable:return Wt.JOIN_FAILURE;default:return Wt.UNKNOWN_REASON}}function Ua(t){return t!==void 0?Number(t):void 0}function Ei(t){return t!==void 0?BigInt(t):void 0}function Ur(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function on(t){return!!t&&t.kind==x.Kind.Audio}function Zi(t){return!!t&&t.kind==x.Kind.Video}function Wn(t){return Ur(t)&&Zi(t)}function kn(t){return Ur(t)&&on(t)}function Kd(t){return!!t&&!t.isLocal}function Zx(t){return!!t&&!t.isLocal}function nu(t){return Kd(t)&&Zi(t)}function eR(t){return t.isLocal}function tR(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function hS(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=pS(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(Gd(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(Gd(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function Gd(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Mf(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Gd(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function fS(t){return C(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=Of();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield lt(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function Of(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>C(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function nR(t){return t==="audioinput"?x.Source.Microphone:t==="videoinput"?x.Source.Camera:x.Source.Unknown}function Qd(t){return t===x.Source.Microphone?"audioinput":t===x.Source.Camera?"videoinput":void 0}function iR(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ki()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Fa(t){return t.split("/")[1].toLowerCase()}function rR(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new xf({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function K(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?K(t.track):{})}}function sR(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function oR(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function pS(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:xx(e)}}function aR(t){switch(t){case xe.CAMERA:return x.Source.Camera;case xe.MICROPHONE:return x.Source.Microphone;case xe.SCREEN_SHARE:return x.Source.ScreenShare;case xe.SCREEN_SHARE_AUDIO:return x.Source.ScreenShareAudio;default:return x.Source.Unknown}}function Eg(t,e){return t.width*t.height<e.width*e.height}function cR(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class lR extends pn.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:s,data:o}=n.data;switch(s){case"error":Q.error(o.error.message),this.emit(ei.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(ei.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(ei.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(li.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break}},this.onWorkerError=n=>{Q.error("e2ee worker encountered an error:",{error:n.error}),this.emit(ei.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!wx())throw new Df("tried to setup end-to-end encryption on an unsupported browser");if(Q.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:cx.getLevel()}};this.worker&&(Q.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Q.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Q.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(j.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(_.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==ht.NONE,r.identity)),e.on(_.ConnectionStateChanged,i=>{i===Y.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==ht.NONE,r.identity)})})}).on(_.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(_.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(_.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(A.LocalSenderCreated,(i,r)=>C(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(li.SetKey,i=>this.postKey(i)).on(li.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Fa(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Ur(e)||!n){n||Q.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return C(this,void 0,void 0,function*(){if(this.worker){if(Ud()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Ss in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:Ss in e}};this.worker.postMessage(a,[o,s])}e[Ss]=!0}})}handleSender(e,n,i){var r;if(!(Ss in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Ud()){Q.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Q.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[Ss]=!0}}}const iu="default";class Ue{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ue),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Ue.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Q.debug("awaiting getUserMedia promise");try{n?yield Ue.userMediaPromiseMap.get(n):yield Promise.all(Ue.userMediaPromiseMap.values())}catch{Q.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ki()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return C(this,void 0,void 0,function*(){if(n!==iu)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===iu);if(!s){Q.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==iu&&a.groupId===(i??s.groupId));if(!o){Q.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ue.userMediaPromiseMap.has(e):Ue.userMediaPromiseMap.size>0}}Ue.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ue.userMediaPromiseMap=new Map;var Ks;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Ks||(Ks={}));class uR{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ye,this.nextTaskIndex=0}run(e){return C(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ks.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Ks.RUNNING,yield e()}finally{n.status=Ks.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function dR(t,e){const n=new URL(Jx(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),mS(n,"rtc")}function hR(t){const e=new URL(Hd(t));return mS(e,"validate")}function fR(t){return t.endsWith("/")?t:"".concat(t,"/")}function mS(t,e){return t.pathname="".concat(fR(t.pathname)).concat(e),t.toString()}const pR=["syncState","trickle","offer","answer","simulate","leave"];function mR(t){const e=pR.indexOf(t.case)>=0;return Q.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var ce;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(ce||(ce={}));class Lf{get currentState(){return this.state}get isDisconnected(){return this.state===ce.DISCONNECTING||this.state===ce.DISCONNECTED}get isEstablishingConnection(){return this.state===ce.CONNECTING||this.state===ce.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=ce.DISCONNECTED,this.log=Q,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Nn((i=n.loggerName)!==null&&i!==void 0?i:Gt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new uR,this.queuedRequests=[],this.closingLock=new Ye,this.connectionLock=new Ye,this.state=ce.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return C(this,void 0,void 0,function*(){return this.state=ce.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=ce.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=Kx(),o=gR(n,s,i),a=dR(e,o),c=hR(a);return new Promise((l,u)=>C(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const h=()=>C(this,void 0,void 0,function*(){this.close(),clearTimeout(f),u(new se("room connection has been cancelled (signal)",X.Cancelled))}),f=setTimeout(()=>{this.close(),u(new se("room connection has timed out (signal)",X.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const g=new URL(a);g.searchParams.has("access_token")&&g.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(g),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=m=>C(this,void 0,void 0,function*(){if(this.state!==ce.CONNECTED){this.state=ce.DISCONNECTED,clearTimeout(f);try{const S=yield fetch(c);if(S.status.toFixed(0).startsWith("4")){const p=yield S.text();u(new se(p,X.NotAllowed,S.status))}else u(new se("Encountered unknown websocket error during connection: ".concat(m.toString()),X.InternalError,S.status))}catch(S){u(new se(S instanceof Error?S.message:"server was not reachable",X.ServerUnreachable))}return}this.handleWSError(m)}),this.ws.onmessage=m=>C(this,void 0,void 0,function*(){var S,p,v;let y;if(typeof m.data=="string"){const b=JSON.parse(m.data);y=ig.fromJson(b,{ignoreUnknownFields:!0})}else if(m.data instanceof ArrayBuffer)y=ig.fromBinary(new Uint8Array(m.data));else{this.log.error("could not decode websocket message: ".concat(typeof m.data),this.logContext);return}if(this.state!==ce.CONNECTED){let b=!1;if(((S=y.message)===null||S===void 0?void 0:S.case)==="join"?(this.state=ce.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=y.message.value.pingTimeout,this.pingIntervalDuration=y.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(y.message.value)):this.state===ce.RECONNECTING&&y.message.case!=="leave"?(this.state=ce.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((p=y.message)===null||p===void 0?void 0:p.case)==="reconnect"?l(y.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),b=!0)):this.isEstablishingConnection&&y.message.case==="leave"?u(new se("Received leave request while trying to (re)connect",X.LeaveRequest,void 0,y.message.value.reason)):i.reconnect||u(new se("did not receive join response, got ".concat((v=y.message)===null||v===void 0?void 0:v.case," instead"),X.InternalError)),!b)return}this.signalLatency&&(yield lt(this.signalLatency)),this.handleSignalResponse(y)}),this.ws.onclose=m=>{this.isEstablishingConnection&&u(new se("Websocket got closed during a (re)connection attempt",X.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:m.reason,code:m.code,wasClean:m.wasClean,state:this.state})),this.handleOnClose(m.reason)}}finally{d()}}))}close(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=ce.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,lt(250)])),e.ws=void 0}}finally{n&&(e.state=ce.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:vc(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:vc(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Pf({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Ef({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new Cb({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Tb({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Eb({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:fe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ib({timestamp:fe.parse(Date.now()),rtt:fe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Sb({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new tl({reason:Wt.CLIENT_INITIATED,action:Or.DISCONNECT})})}sendRequest(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!mR(n)&&i.state===ce.RECONNECTING){i.queuedRequests.push(()=>C(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield lt(i.signalLatency)),!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new UE({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=xg(r.value);this.onAnswer&&this.onAnswer(o,r.value.id)}else if(r.case==="offer"){const o=xg(r.value);this.onOffer&&this.onOffer(o,r.value.id)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return C(this,void 0,void 0,function*(){if(this.state===ce.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Be.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Be.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Be.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Be.clearInterval(this.pingInterval)}}function xg(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function vc(t,e){return new Hi({sdp:t.sdp,type:t.type,id:e})}function gR(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",un()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class Rg{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class vR{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Lt={},ru={},su={exports:{}},_g;function Nf(){if(_g)return su.exports;_g=1;var t=su.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),su.exports}var Ig;function yR(){return Ig||(Ig=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=Nf(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],f=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var g=0;g<(r[h]||[]).length;g+=1){var m=r[h][g];if(m.reg.test(f))return i(m,u,f)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(ru)),ru}var ou,Dg;function kR(){if(Dg)return ou;Dg=1;var t=Nf(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return ou=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(f){u.push(i(d,h,f))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(f){f.name in d&&d[f.name]!=null?u.push(i(h,f,d)):f.push in d&&d[f.push]!=null&&d[f.push].forEach(function(g){u.push(i(h,f,g))})})})}),u.join(`\r
`)+`\r
`},ou}var Ag;function bR(){if(Ag)return Lt;Ag=1;var t=yR(),e=kR(),n=Nf();return Lt.grammar=n,Lt.write=e,Lt.parse=t.parse,Lt.parseParams=t.parseParams,Lt.parseFmtpConfig=t.parseFmtpConfig,Lt.parsePayloads=t.parsePayloads,Lt.parseRemoteCandidates=t.parseRemoteCandidates,Lt.parseImageAttributes=t.parseImageAttributes,Lt.parseSimulcastStreamList=t.parseSimulcastStreamList,Lt}var qn=bR();function Uf(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var f=Date.now()-l;if(f+e>=c)return c-f}return e}var h=function(){var f=[].slice.call(arguments),g=this;return new Promise(function(m,S){var p=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var y=t.apply(g,f);a&&a(y),u.forEach(function(b){return(0,b.resolve)(y)}),u=[]}},d()),p){var v=t.apply(g,f);return a&&a(v),m(v)}u.push({resolve:m,reject:S})})};return h.cancel=function(f){s!==void 0&&clearTimeout(s),u.forEach(function(g){return(0,g.reject)(f)}),u=[]},h}const SR=.7,TR=20,Fr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Mg extends pn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Q,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Uf(r=>C(this,void 0,void 0,function*(){this.emit(Fr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),TR),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Nn((i=n.loggerName)!==null&&i!==void 0?i:Gt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Ye}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return C(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return C(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=CR(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=qn.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||o.mid!=a.transceiver.mid)return!1;let c=0;if(o.rtp.some(u=>u.codec.toUpperCase()===a.codec.toUpperCase()?(c=u.payload,!0):!1),c===0)return!0;let l=!1;for(const u of o.fmtp)if(u.payload===c){u.config=u.config.split(";").filter(d=>!d.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(u.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=qn.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Fr.NegotiationComplete),e.sdp&&qn.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Fr.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=qn.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Lg(a),a.type==="audio"?Og(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(nn(c.codec)&&!Ki()&&this.ensureVideoDDExtensionForSVC(a,o),c.codec!=="av1"))return!0;const u=Math.round(c.maxbr*SR);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,qn.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=qn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Lg(r),r.type==="audio"&&Og(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,qn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new De("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new De("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return C(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return C(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Fd(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===bg))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:bg})}}}function Og(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function CR(t){var e;const n=[],i=[],r=qn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function Lg(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Jd="vp8",wR={audioPreset:jd.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Af.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Jd,backupCodec:!0,preConnectBuffer:!1},gS={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},vS={deviceId:{ideal:"default"},resolution:yo.h720.resolution},PR={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new ux,disconnectOnPageLeave:!0,webAudioMix:!1},Ff={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ye;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ye||(ye={}));class ER{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Ff.peerConnectionTimeout,this.log=Q,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ye.CONNECTED:a.some(c=>c==="failed")?this.state=ye.FAILED:a.some(c=>c==="connecting")?this.state=ye.CONNECTING:a.every(c=>c==="closed")?this.state=ye.CLOSED:a.some(c=>c==="closed")?this.state=ye.CLOSING:a.every(c=>c==="new")&&(this.state=ye.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(ye[o]," to ").concat(ye[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Nn((r=i.loggerName)!==null&&r!==void 0?r:Gt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new Mg(e,i),this.subscriber=new Mg(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,$t.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,$t.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ye.NEW,this.connectionLock=new Ye,this.remoteOfferLock=new Ye}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return C(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return C(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return C(this,void 0,void 0,function*(){n===$t.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return C(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return C(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return C(this,void 0,void 0,function*(){return new Promise((n,i)=>C(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Fr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Fr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===$t.PUBLISHER?this.publisher.getConnectedAddress():e===$t.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>C(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Be.clearTimeout(d),l(new se("room connection has been cancelled",X.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Be.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(new se("could not establish pc connection",X.InternalError))},o);for(;this.state!==ye.CONNECTED;)if(yield lt(50),r!=null&&r.signal.aborted){l(new se("room connection has been cancelled",X.Cancelled));return}Be.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}class Te extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Ng(n,Te.MAX_MESSAGE_BYTES),this.data=i?Ng(i,Te.MAX_DATA_BYTES):void 0}static fromProto(e){return new Te(e.code,e.message,e.data)}toProto(){return new db({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Te(Te.ErrorCode[e],Te.ErrorMessage[e],n)}}Te.MAX_MESSAGE_BYTES=256;Te.MAX_DATA_BYTES=15360;Te.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Te.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const yS=15360;function jf(t){return new TextEncoder().encode(t).length}function Ng(t,e){if(jf(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Vf=2e3;function il(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Bf=typeof MediaRecorder<"u";class xR{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const RR=Bf?MediaRecorder:xR;class _R extends RR{constructor(e,n){if(!Bf)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>C(this,void 0,void 0,function*(){const u=yield l.data.arrayBuffer();s()||c.enqueue(new Uint8Array(u))}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function IR(){return Bf}const DR=1e3,AR=1e4;class kS extends x{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Uf(()=>C(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>C(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(U.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ye,this.pauseUpstreamLock=new Ye,this.processorLock=new Ye,this.restartLock=new Ye,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==x.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return C(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Nr(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(br(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{s()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{br(r??e,s)}))})}waitForDimensions(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DR;return function*(){var i;if(e.kind===x.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=gt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield lt(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield lt(50)}throw new En("unable to get track dimensions after timeout")}()})}setDeviceId(e){return C(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ui(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ui(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===x.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===x.Kind.Audio?"audioinput":"videoinput";return n?Ue.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return C(this,void 0,void 0,function*(){if(!this.sender)throw new En("unable to replace an unpublished track");let i,r;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return C(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=dx(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===x.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{Nr(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(U.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?U.Muted:U.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),lS()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(U.UpstreamPaused,this);const i=gt();if((i==null?void 0:i.name)==="Safari"&&dn(i.version,"12.0")<0)throw new Df("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(U.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(br(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(Nr(i._mediaStreamTrack,l),br(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(U.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(U.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!IR()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(!this.localTrackRecorder)this.localTrackRecorder=new _R(this,{mimeType:"audio/webm;codecs=opus"});else{this.log.warn("preconnect buffer already started");return}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},AR)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}}class yc extends kS{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,x.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=il(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(U.AudioTrackFeatureUpdate,this,Ne.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(U.AudioTrackFeatureUpdate,this,Ne.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ui(this._constraints.deviceId);return this.source===x.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return C(this,void 0,void 0,function*(){let n;if(e){const i=Mf({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return C(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){st()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Vf)))}setProcessor(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!un()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(U.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return C(this,void 0,void 0,function*(){const e=yield fS(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(U.AudioSilenceDetected)),e})}}function MR(t,e,n){switch(t.kind){case"audio":return new yc(t,e,!1,void 0,n);case"video":return new kc(t,e,!1,n);default:throw new En("unsupported track type: ".concat(t.kind))}}const OR=Object.values(yo),LR=Object.values(Vd),NR=Object.values(Af),UR=[yo.h180,yo.h360],FR=[Vd.h180,Vd.h360],jR=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ie(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Yd=["q","h","f"];function Xd(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=BR(t,e,n,l),Q.debug("using video encoding",o));const u=o.maxFramerate,d=new ie(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&nn(l)){const g=new bS(c),m=[];if(g.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const S=gt();if(Wd()||un()||(S==null?void 0:S.name)==="Chrome"&&dn(S==null?void 0:S.version,"113")<0){const p=g.suffix=="h"?2:3,v=$x(S);for(let y=0;y<g.spatial;y+=1)m.push({rid:Yd[2-y],maxBitrate:o.maxBitrate/Math.pow(p,y),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:v?Math.pow(2,y):void 0});m[0].scalabilityMode=c}else m.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(m[0].priority=d.encoding.priority,m[0].networkPriority=d.encoding.priority),Q.debug("using svc encoding",{encodings:m}),m}if(!a)return[o];let h=[];t?h=(r=Fg(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Ug(t,d):h=(s=Fg(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Ug(t,d);let f;if(h.length>0){const g=h[0];h.length>1&&([,f]=h);const m=Math.max(e,n);if(m>=960&&f)return au(e,n,[g,f,d],u);if(m>=480)return au(e,n,[g,d],u)}return au(e,n,[d])}function VR(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Q.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===x.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Xd(t.source===x.Source.ScreenShare,c,l,n)}function BR(t,e,n,i){const r=zR(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function zR(t,e,n){if(t)return NR;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?OR:LR}function Ug(t,e){if(t)return jR(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?UR:FR}function au(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=Yd.length)return;const a=Math.min(t,e),l={rid:Yd[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=Qr()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),un()&&dS()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,Q.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Q.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Fg(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class bS{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function $R(t){return t.source===x.Source.ScreenShare||t.constraints.height&&ui(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const WR=5e3;class kc extends kS{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,x.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(U.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=il(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Ye}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!st())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Vf))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Pn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Pn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=pt.LOW;i<=pt.HIGH;i+=1)n.push(new Rf({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(nn(this.codec),n)}restartTrack(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=Mf({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=Pn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return C(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,f=Pn(r.simulcastCodecs.values()),g;g=yield f.next(),o=g.done,!o;h=!0)l=g.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(m){a={error:m}}finally{try{!h&&!o&&(c=f.return)&&(yield c.call(f))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return C(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},WR))}setPublishingCodecs(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(nn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=Pn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(nn(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield jg(d.sender,d.encodings,u.qualities,this.senderLock,nn(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return C(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield jg(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return C(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&nn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),lS()&&this.isInBackground&&this.source===x.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function jg(t,e,n,i,r,s,o){return C(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),l.forEach((h,f)=>{var g;let m=(g=h.rid)!==null&&g!==void 0?g:"";m===""&&(m="q");const S=SS(m),p=n.find(v=>v.quality===S);p&&h.active!==p.enabled&&(u=!0,h.active=p.enabled,s.debug("setting layer ".concat(p.quality," to ").concat(h.active?"enabled":"disabled"),o),Qr()&&(p.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function SS(t){switch(t){case"f":return pt.HIGH;case"h":return pt.MEDIUM;case"q":return pt.LOW;default:return pt.HIGH}}function Vg(t,e,n,i){if(!n)return[new Li({quality:pt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new bS(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Li({quality:Math.min(pt.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=SS((o=r.rid)!==null&&o!==void 0?o:"");return new Li({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Bg="_lossy",zg="_reliable",qR=2*1e3,cu="leave-reconnect",HR=3e4;var Nt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Nt||(Nt={}));class KR extends pn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Ff.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Nt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Q,this.reliableDataSequence=1,this.reliableMessageBuffer=new Rg,this.reliableReceivedState=new vR(HR),this.handleDataChannel=i=>C(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===zg)s.reliableDCSub=o;else if(o.label===Bg)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>C(this,void 0,void 0,function*(){var r,s;const o=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=tt.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(j.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&QR(c,c.value.value),this.emit(j.DataPacketReceived,c))}finally{o()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?q.LOSSY:q.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(j.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===cu&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Be.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Nt.Connected&&i();const s=()=>{this.off(j.Disconnected,o),i()},o=()=>{this.off(j.Restarted,s),r()};this.once(j.Restarted,s),this.once(j.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(j.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===q.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===ce.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(sr.RR_SIGNAL_DISCONNECTED))},this.log=Nn((n=e.loggerName)!==null&&n!==void 0?n:Gt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Lf(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ye,this.dataProcessLock=new Ye,this.dcBufferStatus=new Map([[q.LOSSY,!0],[q.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(j.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(j.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(j.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(j.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(j.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(j.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(j.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(j.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return C(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,this.emit(j.SignalConnected,s),s}catch(s){if(s instanceof se&&s.reason===X.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return C(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(j.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return C(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Rg,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return C(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new En("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new se("publication of local track timed out, no response from server",X.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return C(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return C(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ye.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new ER(r,e.subscriberPrimary,this.loggerOptions),this.emit(j.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>C(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ye.CONNECTED){const u=this.pcState===Nt.New;this.pcState=Nt.Connected,u&&this.emit(j.Connected,e)}else s===ye.FAILED&&this.pcState===Nt.Connected&&(this.pcState=Nt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?sr.RR_SUBSCRIBER_FAILED:sr.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===ce.RECONNECTING,l=[ye.FAILED,ye.CLOSING,ye.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(j.Offline)}),this.pcManager.onTrack=s=>{this.emit(j.MediaTrackAdded,s.track,s.streams[0],s.receiver)},GR((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>C(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>C(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(j.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(j.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(j.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(j.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(j.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",sr.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Or.DISCONNECT:this.emit(j.Disconnected,e==null?void 0:e.reason),this.close();break;case Or.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(cu);break;case Or.RESUME:this.handleDisconnect(cu)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===vo.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Bg,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(zg,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return C(this,void 0,void 0,function*(){if(Bd())return yield this.createTransceiverRTCRtpSender(e,n,i);if(zd())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new De("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(Bd())return this.createSimulcastTransceiverSender(e,n,i,r);if(zd())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new De("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new De("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Zi(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new De("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new De("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return C(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Q.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===vo.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ye.NEW)===ye.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof De?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof or||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",sr.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(j.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return C(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new De("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(j.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new or;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof se&&o.reason===X.NotAllowed?new De("could not reconnect, token might be expired"):new or}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(j.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==ce.CONNECTED)throw new or("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(j.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return C(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new De("could not reconnect, url or token not saved");if(!this.pcManager)throw new De("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(j.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof se&&r.reason===X.NotAllowed?new De("could not reconnect, token might be expired"):r instanceof se&&r.reason===X.LeaveRequest?r:new or(s)}if(this.emit(j.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ce.CONNECTED)throw new or("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(j.Resumed)})}waitForPCInitialConnection(e,n){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new De("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return C(this,void 0,void 0,function*(){this.pcState=Nt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield lt(qR),!this.pcManager)throw new De("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Nt.Connected}catch(e){throw this.pcState=Nt.Disconnected,new se("could not establish PC connection, ".concat(e.message),X.InternalError)}})}publishRpcResponse(e,n,i,r){return C(this,void 0,void 0,function*(){const s=new tt({destinationIdentities:[e],kind:q.RELIABLE,value:{case:"rpcResponse",value:new ub({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,q.RELIABLE)})}publishRpcAck(e,n){return C(this,void 0,void 0,function*(){const i=new tt({destinationIdentities:[e],kind:q.RELIABLE,value:{case:"rpcAck",value:new lb({requestId:n})}});yield this.sendDataPacket(i,q.RELIABLE)})}sendDataPacket(e,n){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===q.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===q.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(q.RELIABLE);const n=this.dataChannelForKind(q.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(q.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>C(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(j.Closing,r);!this.dcBufferStatus.get(e);)yield lt(10);this.off(j.Closing,r),n()}}))}ensureDataTransportConnected(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new De("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new se("".concat(a," connection not set"),X.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield lt(50)}throw new se("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),X.InternalError)}()})}ensurePublisherConnected(e){return C(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ye.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return C(this,void 0,void 0,function*(){return new Promise((e,n)=>C(this,void 0,void 0,function*(){if(!this.pcManager){n(new Fd("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(j.Closing,r),this.pcManager.publisher.once(Fr.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();Qx(c)&&o.set(a.payload,c)}),this.emit(j.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof Fd&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",sr.RR_UNKNOWN),n(s)}finally{this.off(j.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===q.LOSSY)return this.lossyDCSub;if(e===q.RELIABLE)return this.reliableDCSub}else{if(e===q.LOSSY)return this.lossyDC;if(e===q.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new xb({answer:s?vc({sdp:s.sdp,type:s.type}):void 0,offer:o?vc({sdp:o.sdp,type:o.type}):void 0,subscription:new el({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:rR(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((u,d)=>new Rb({publisherSid:d,lastSeq:u}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new _b({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(q.LOSSY),$t.PUBLISHER),n(this.dataChannelForKind(q.RELIABLE),$t.PUBLISHER),n(this.dataChannelForKind(q.LOSSY,!0),$t.SUBSCRIBER),n(this.dataChannelForKind(q.RELIABLE,!0),$t.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Be.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){st()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){st()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class or extends Error{}function GR(t){return t!==void 0&&t>13}function QR(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Zd{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return qd(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return C(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),Q.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return C(this,void 0,void 0,function*(){const n=yield fetch("".concat(JR(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new se("Could not fetch region settings: ".concat(n.statusText),n.status===401?X.NotAllowed:X.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function JR(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class TS{get info(){return this._info}constructor(e,n,i){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class YR extends TS{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>C(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return C(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return C(this,void 0,void 0,function*(){var e,n,i,r;let s=new Set;try{for(var o=!0,a=Pn(this),c;c=yield a.next(),e=c.done,!e;o=!0){r=c.value,o=!1;const l=r;s.add(l)}}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return Array.from(s)})}}class XR extends TS{constructor(e,n,i){super(e,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Ua(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>C(this,void 0,void 0,function*(){try{const{done:i,value:r}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:n.decode(r.content)})}catch{return{done:!0,value:void 0}}}),return(){return C(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return C(this,void 0,void 0,function*(){var e,n,i,r;let s="";try{for(var o=!0,a=Pn(this),c;c=yield a.next(),e=c.done,!e;o=!0)r=c.value,o=!1,s+=r}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}}class CS{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return C(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class ZR extends CS{}class e_ extends CS{}class wS extends x{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?U.Muted:U.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(U.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Vf)),sR()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(U.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class PS extends wS{constructor(e,n,i,r,s,o){super(e,n,x.Kind.Audio,i,o),this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=il(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;un()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(un())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return C(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if($d(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&$d(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(U.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(U.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const lu=100;class t_ extends wS{constructor(e,n,i,r,s){super(e,n,x.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=il(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Uf(()=>{this.updateDimensions()},lu),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Nr(this._mediaStreamTrack,n):br(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new n_(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!r||s;if(this.lastVisible!==o){if(!o&&Date.now()-i<lu){Be.setTimeout(()=>{this.updateVisibility()},lu);return}this.lastVisible=o,this.emit(U.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(U.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Sg():n||(Sg()>2?2:1)}}class n_{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=ws(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=ws(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=ws(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??eh(e),this.isPiP=st()&&ws(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=eh(this.element),this.isPiP=ws(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Cg().observe(this.element),Tg().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Cg())===null||e===void 0||e.unobserve(this.element),(n=Tg())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function ws(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?eh(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function eh(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class Tn extends pn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=ht.NONE,this.log=Q,this.handleMuted=()=>{this.emit(U.Muted)},this.handleUnmuted=()=>{this.emit(U.Unmuted)},this.log=Nn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Gt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=x.Source.Unknown}setTrack(e){this.track&&(this.track.off(U.Muted,this.handleMuted),this.track.off(U.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(U.Muted,this.handleMuted),e.on(U.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),K(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ht.NONE}get audioTrack(){if(on(this.track))return this.track}get videoTrack(){if(Zi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=x.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===x.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Tn||(Tn={}));class th extends Tn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(U.Ended)},this.handleCpuConstrained=()=>{this.track&&Zi(this.track)&&this.emit(U.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(U.Ended,this.handleTrackEnded),this.track.off(U.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(U.Ended,this.handleTrackEnded),e.on(U.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(on(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Ne.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Ne.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Ne.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Ne.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Ne.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Ne.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function rl(t,e){return C(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=pS(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=hS(s,gS,vS),l=Mf(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(Ue.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Ue.userMediaPromiseMap.delete("audioinput"))),s.video&&(Ue.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Ue.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>C(this,void 0,void 0,function*(){const f=h.kind==="audio";let g=f?c.audio:c.video;(typeof g=="boolean"||!g)&&(g={});let m;const S=f?l.audio:l.video;typeof S!="boolean"&&(m=S);const p=h.getSettings().deviceId;m!=null&&m.deviceId&&ui(m.deviceId)!==p?m.deviceId=p:m||(m={deviceId:p});const v=MR(h,m,e);return v.kind===x.Kind.Video?v.source=x.Source.Camera:v.kind===x.Kind.Audio&&(v.source=x.Source.Microphone),v.mediaStream=d,on(v)&&i?yield v.setProcessor(i):Zi(v)&&r&&(yield v.setProcessor(r)),v})))}catch(d){if(!n)throw d;return rl(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function i_(t){return C(this,void 0,void 0,function*(){return(yield rl({audio:!1,video:t??!0}))[0]})}function r_(t){return C(this,void 0,void 0,function*(){return(yield rl({audio:t??!0,video:!1}))[0]})}var Yn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Yn||(Yn={}));function s_(t){switch(t){case Ds.EXCELLENT:return Yn.Excellent;case Ds.GOOD:return Yn.Good;case Ds.POOR:return Yn.Poor;case Ds.LOST:return Yn.Lost;default:return Yn.Unknown}}class ES extends pn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===qi.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Mr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:qi.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Yn.Unknown,this.log=Q,this.log=Nn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Gt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Sr,this.once(A.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(x.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(x.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(x.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Mr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Mr.ACTIVE&&this.emit(A.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(A.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(A.ParticipantNameChanged,e)}_setAttributes(e){const n=oR(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(A.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(A.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(A.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=s_(e),n!==this._connectionQuality&&this.emit(A.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>on(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(U.Muted,()=>{this.emit(A.TrackMuted,e)}),e.on(U.Unmuted,()=>{this.emit(A.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case x.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case x.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function o_(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Pb({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}const $g=15e3;class a_ extends ES{constructor(e,n,i,r,s){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ht.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Sr)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a,c,l,u,d;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((l=(c=this.signalConnectedFuture).reject)===null||l===void 0||l.call(c,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(d=(u=this.activeAgentFuture)===null||u===void 0?void 0:u.reject)===null||d===void 0||d.call(u,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var a,c;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Sr),(c=(a=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(a)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:c,message:l}=o,u=this.pendingSignalRequests.get(a);u&&(c!==_f.OK&&u.reject(new vg(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=Te.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>o_(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),K(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),K(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),K(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.onTrackCpuConstrained=(o,a)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),K(a))),this.emit(A.LocalTrackCpuConstrained,o,a)},this.handleSubscribedQualityUpdate=o=>C(this,void 0,void 0,function*(){var a,c,l,u,d;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const h=this.videoTrackPublications.get(o.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!h.videoTrack)return;const f=yield h.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var g=!0,m=Pn(f),S;S=yield m.next(),a=S.done,!a;g=!0){u=S.value,g=!1;const p=u;Nx(p)&&(this.log.debug("publish ".concat(p," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),K(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,p,h.options))}}catch(p){c={error:p}}finally{try{!g&&!a&&(l=m.return)&&(yield l.call(m))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>C(this,void 0,void 0,function*(){if(o.source===x.Source.ScreenShare||o.source===x.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),K(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(kn(o)||Wn(o))try{if(st())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===x.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),K(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),K(o))),kn(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),K(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ht.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(j.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(j.Connected,this.handleReconnected).on(j.SignalConnected,this.handleSignalConnected).on(j.SignalRestarted,this.handleReconnected).on(j.SignalResumed,this.handleReconnected).on(j.Restarting,this.handleReconnecting).on(j.Resuming,this.handleReconnecting).on(j.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(j.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(j.Disconnected,this.handleDisconnected).on(j.SignalRequestResponse,this.handleSignalRequestResponse).on(j.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return C(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>C(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:g=>{c(g),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-f<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(g=>{let[m,S]=g;return this.attributes[m]===S||S===""&&!this.attributes[m]}))){this.pendingSignalRequests.delete(h),a();return}yield lt(50)}c(new vg("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(x.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(x.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(x.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(A.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){this.encryptionType=e?ht.GCM:ht.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return C(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case x.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case x.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case x.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new En(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(A.MediaDevicesError,l,Qd(e)),this.pendingPublishing.delete(e),l}for(const l of c)e===x.Source.Microphone&&on(l)&&(r!=null&&r.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer());try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),K(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===x.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(x.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return C(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(x.Source.Camera)||this.pendingPublishing.has(x.Source.Microphone))){this.pendingPublishing.add(x.Source.Camera),this.pendingPublishing.add(x.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(x.Source.Camera),this.pendingPublishing.delete(x.Source.Microphone)}}})}createTracks(e){return C(this,void 0,void 0,function*(){var n,i;e??(e={});const r=hS(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield rl(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(on(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=x.Source.Microphone,this.emit(A.AudioStreamAcquired)),Zi(a)&&(this.cameraError=void 0,a.source=x.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return C(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Df("getDisplayMedia not supported");e.resolution===void 0&&!zx()&&(e.resolution=Af.h1080fps30.resolution);const n=iR(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new En("no video track found");const s=new kc(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=x.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(A.AudioStreamAcquired);const a=new yc(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=x.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return C(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;kn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Ur(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let p;switch(i.source){case x.Source.Microphone:p="audioinput";break;case x.Source.Camera:p="videoinput"}p&&s.activeDeviceMap.has(p)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(p)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new yc(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new kc(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new En("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(p=>{p.track&&p.track===i&&(h=p)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),K(h))),h;const f="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:f;g&&(r||(r={}),r.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),K(i))),r.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(u=r.red)!==null&&u!==void 0||(r.red=!1));const m=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r);!Wx()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const S=new Promise((p,v)=>C(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==ce.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:K(i)}));const y=setTimeout(()=>{v(new gg("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(y);const b=yield this.publish(i,m,g);p(b)}else try{const y=yield this.publish(i,m,g);p(y)}catch(y){v(y)}}catch(y){v(y)}}));s.pendingPublishPromises.set(i,S);try{return yield S}catch(p){throw p}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Sr),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),K(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>aR(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),K(e))),!1)}publish(e,n,i){return C(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,f;if(!this.hasPermissionsToPublish(e))throw new gg("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(D=>Ur(e)&&D.source===e.source)&&e.source!==x.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),K(e))),n.stopMicTrackOnMute&&on(e)&&(e.stopOnMute=!0),e.source===x.Source.ScreenShare&&Qr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!jx()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!Vx()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Jd),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(D=>n.videoCodec===Fa(D.mime))||(n.videoCodec=Fa(this.enabledPublishVideoCodecs[0].mime)));const m=n.videoCodec;e.on(U.Muted,this.onTrackMuted),e.on(U.Unmuted,this.onTrackUnmuted),e.on(U.Ended,this.handleTrackEnded),e.on(U.UpstreamPaused,this.onTrackUpstreamPaused),e.on(U.UpstreamResumed,this.onTrackUpstreamResumed),e.on(U.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const S=[],p=!(!((r=n.dtx)!==null&&r!==void 0)||r),v=e.getSourceTrackSettings();v.autoGainControl&&S.push(Ne.TF_AUTO_GAIN_CONTROL),v.echoCancellation&&S.push(Ne.TF_ECHO_CANCELLATION),v.noiseSuppression&&S.push(Ne.TF_NOISE_SUPPRESSION),v.channelCount&&v.channelCount>1&&S.push(Ne.TF_STEREO),p&&S.push(Ne.TF_NO_DTX),kn(e)&&e.hasPreConnectBuffer&&S.push(Ne.TF_PRECONNECT_BUFFER);const y=new _d({cid:e.mediaStreamTrack.id,name:n.name,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),disableDtx:p,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:S});let b;if(e.kind===x.Kind.Video){let D={width:0,height:0};try{D=yield e.waitForDimensions()}catch{const O=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:yo.h720.resolution;D={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{dims:D}))}y.width=D.width,y.height=D.height,Wn(e)&&(nn(m)&&(e.source===x.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),K(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),y.simulcastCodecs=[new Rd({codec:m,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Jd}),n.backupCodec&&m!==n.backupCodec.codec&&y.encryption===ht.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),y.simulcastCodecs.push(new Rd({codec:n.backupCodec.codec,cid:""})))),b=Xd(e.source===x.Source.ScreenShare,y.width,y.height,n),y.layers=Vg(y.width,y.height,b,nn(n.videoCodec))}else e.kind===x.Kind.Audio&&(b=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new De("cannot publish track when not connected");const k=()=>C(this,void 0,void 0,function*(){var D,I,O;if(!this.engine.pcManager)throw new De("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,b),this.emit(A.LocalSenderCreated,e.sender,e),Wn(e)&&((D=n.degradationPreference)!==null&&D!==void 0||(n.degradationPreference=$R(e)),e.setDegradationPreference(n.degradationPreference)),b)if(Qr()&&e.kind===x.Kind.Audio){let V;for(const H of this.engine.pcManager.publisher.getTransceivers())if(H.sender===e.sender){V=H;break}V&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:V,codec:"opus",maxbr:!((I=b[0])===null||I===void 0)&&I.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&nn(e.codec)&&(!((O=b[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:y.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let w;const E=new Promise((D,I)=>C(this,void 0,void 0,function*(){var O;try{w=yield this.engine.addTrack(y),D(w)}catch(V){e.sender&&(!((O=this.engine.pcManager)===null||O===void 0)&&O.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(H=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{error:H}))})),I(V)}}));if(this.enabledPublishVideoCodecs.length>0)w=(yield Promise.all([E,k()]))[0];else{w=yield E;let D;if(w.codecs.forEach(I=>{D===void 0&&(D=I.mimeType)}),D&&e.kind===x.Kind.Video){const I=Fa(D);I!==m&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{codec:I})),n.videoCodec=I,b=Xd(e.source===x.Source.ScreenShare,y.width,y.height,n))}yield k()}const P=new th(e.kind,w,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(P.on(U.CpuConstrained,D=>this.onTrackCpuConstrained(D,P)),P.options=n,e.sid=w.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:w})),Wn(e)?e.startMonitor(this.engine.client):kn(e)&&e.startMonitor(),this.addTrackPublication(P),this.emit(A.LocalTrackPublished,P),kn(e)&&w.audioFeatures.includes(Ne.TF_PRECONNECT_BUFFER)){const D=e.getPreConnectBuffer();this.on(A.LocalTrackSubscribed,I=>{if(I.trackSid===w.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),K(e))),e.stopPreConnectBuffer()}}),D&&new Promise((O,V)=>C(this,void 0,void 0,function*(){var H,ee,ut,Ie,J,N;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),K(e)));const re=setTimeout(()=>{V(new Error("agent not active within 10 seconds"))},1e4),vn=yield this.waitUntilActiveAgentPresent();clearTimeout(re),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),K(e)));const wt=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[vn.identity],attributes:{trackId:P.trackSid,sampleRate:String((J=v.sampleRate)!==null&&J!==void 0?J:"48000"),channels:String((N=v.channelCount)!==null&&N!==void 0?N:"1")}});try{for(var z=!0,$=Pn(D),ne;ne=yield $.next(),H=ne.done,!H;z=!0){Ie=ne.value,z=!1;const yn=Ie;yield wt.write(yn)}}catch(yn){ee={error:yn}}finally{try{!z&&!H&&(ut=$.return)&&(yield ut.call($))}finally{if(ee)throw ee.error}}yield wt.close(),O()}catch(re){V(re)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),K(e)))}).catch(O=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{error:O}))})}return P})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return C(this,void 0,void 0,function*(){var r;if(this.encryptionType!==ht.NONE)return;let s;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(s=f)}),!s)throw new En("track is not published");if(!Wn(e))throw new En("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=VR(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),K(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new _d({cid:c.mediaStreamTrack.id,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Vg(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new De("cannot publish track when not connected");const u=()=>C(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return C(this,void 0,void 0,function*(){var i,r;if(Ur(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),K(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?K(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(U.Muted,this.onTrackMuted),e.off(U.Unmuted,this.onTrackUnmuted),e.off(U.Ended,this.handleTrackEnded),e.off(U.UpstreamPaused,this.onTrackUpstreamPaused),e.off(U.UpstreamResumed,this.onTrackUpstreamResumed),e.off(U.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ye.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Wn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case x.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case x.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(A.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return C(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>C(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>C(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==x.Source.ScreenShare&&l.source!==x.Source.ScreenShareAudio&&(kn(l)||Wn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?q.RELIABLE:q.LOSSY,o=r.destinationIdentities,a=r.topic,c=new tt({kind:s,value:{case:"user",value:new ob({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a})}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return C(this,void 0,void 0,function*(){const i=new tt({kind:q.RELIABLE,value:{case:"sipDtmf",value:new ab({code:e,digit:n})}});yield this.engine.sendDataPacket(i,q.RELIABLE)})}sendChatMessage(e,n){return C(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new tt({value:{case:"chatMessage",value:new Td(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,q.RELIABLE),this.emit(A.ChatMessage,i),i})}editChatMessage(e,n){return C(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new tt({value:{case:"chatMessage",value:new Td(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp),editTimestamp:fe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,q.RELIABLE),this.emit(A.ChatMessage,i),i})}sendText(e,n){return C(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var f;c[h]=d;const g=c.reduce((m,S)=>m+S,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,g)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>C(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:f=>{l(f,h+1)}})})))),u.info})}streamText(e){return C(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new wd({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:Ei(s.timestamp),totalLength:Ei(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new yb({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Cd.UPDATE:Cd.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new tt({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,q.RELIABLE);let l=0;const u=this,d=new WritableStream({write(g){return C(this,void 0,void 0,function*(){for(const m of tR(g,$g)){yield u.engine.waitForBufferStatusLow(q.RELIABLE);const S=new Pd({content:m,streamId:r,chunkIndex:Ei(l)}),p=new tt({destinationIdentities:a,value:{case:"streamChunk",value:S}});yield u.engine.sendDataPacket(p,q.RELIABLE),l+=1}})},close(){return C(this,void 0,void 0,function*(){const g=new Ed({streamId:r}),m=new tt({destinationIdentities:a,value:{case:"streamTrailer",value:g}});yield u.engine.sendDataPacket(m,q.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let h=()=>C(this,void 0,void 0,function*(){yield f.close()});u.engine.once(j.Closing,h);const f=new ZR(d,s,()=>this.engine.off(j.Closing,h));return f})}sendFile(e,n){return C(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return C(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},u=new wd({totalLength:Ei((o=l.size)!==null&&o!==void 0?o:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:Ei(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new kb({name:l.name})}}),d=new tt({destinationIdentities:c,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(d,q.RELIABLE);let h=0;const f=new Ye,g=this.engine,m=this.log,S=new WritableStream({write(v){return C(this,void 0,void 0,function*(){const y=yield f.lock();let b=0;try{for(;b<v.byteLength;){const k=v.slice(b,b+$g);yield g.waitForBufferStatusLow(q.RELIABLE);const w=new tt({destinationIdentities:c,value:{case:"streamChunk",value:new Pd({content:k,streamId:a,chunkIndex:Ei(h)})}});yield g.sendDataPacket(w,q.RELIABLE),h+=1,b+=k.byteLength}}finally{y()}})},close(){return C(this,void 0,void 0,function*(){const v=new Ed({streamId:a}),y=new tt({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield g.sendDataPacket(y,q.RELIABLE)})},abort(v){m.error("Sink error:",v)}});return new e_(S,l)})}performRpc(e){return C(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,u)=>C(i,void 0,void 0,function*(){var d,h,f,g;if(jf(o)>yS){u(Te.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&dn((g=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){u(Te.builtIn("UNSUPPORTED_SERVER"));return}const m=crypto.randomUUID();yield this.publishRpcRequest(r,m,s,o,a-2e3);const S=setTimeout(()=>{this.pendingAcks.delete(m),u(Te.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(m),clearTimeout(p)},2e3);this.pendingAcks.set(m,{resolve:()=>{clearTimeout(S)},participantIdentity:r});const p=setTimeout(()=>{this.pendingResponses.delete(m),u(Te.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(m,{resolve:(v,y)=>{clearTimeout(p),this.pendingAcks.has(m)&&(console.warn("RPC response received before ack",m),this.pendingAcks.delete(m),clearTimeout(S)),y?u(y):l(v??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return C(this,void 0,void 0,function*(){const o=new tt({destinationIdentities:[e],kind:q.RELIABLE,value:{case:"rpcRequest",value:new cb({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,q.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Te.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),K(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Sr),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(kn(r)||Wn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return C(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield lt(20)}})}}class bc extends Tn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(U.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new el({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new hb({participantSid:"",trackSids:[this.trackSid]})]});this.emit(U.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Tn.SubscriptionStatus.Unsubscribed:super.isSubscribed?Tn.SubscriptionStatus.Subscribed:Tn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Tn.PermissionStatus.Allowed:Tn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(nu(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&nu(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:pt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(U.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(U.VisibilityChanged,this.handleVisibilityChange),r.off(U.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(U.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(U.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(U.VisibilityChanged,this.handleVisibilityChange),e.on(U.Ended,this.handleEnded),this.emit(U.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(U.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?U.Muted:U.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(U.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(U.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return nu(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new bb({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===x.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Eg(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=cR(this.trackInfo,this.requestedMaxQuality);i&&Eg(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:pt.HIGH})),e.quality=pt.HIGH)}this.emit(U.UpdateSettings,e)}}class Sc extends ES{static fromParticipantInfo(e,n,i){return new Sc(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:qi.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(U.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(U.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(U.SubscriptionPermissionChanged,n=>{this.emit(A.TrackSubscriptionPermissionChanged,e,n)}),e.on(U.SubscriptionStatusChanged,n=>{this.emit(A.TrackSubscriptionStatusChanged,e,n)}),e.on(U.Subscribed,n=>{this.emit(A.TrackSubscribed,n,e)}),e.on(U.Unsubscribed,n=>{this.emit(A.TrackUnsubscribed,n,e)}),e.on(U.SubscriptionFailed,n=>{this.emit(A.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(A.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),K(a))),this.emit(A.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new t_(e,n,r,s):l=new PS(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&Kd(l)&&on(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=x.kindFromProto(r.type);if(!c)return;a=new bc(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==x.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:K(l),newTrack:K(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),K(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(A.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case x.Kind.Audio:this.audioTrackPublications.delete(e);break;case x.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(A.TrackUnpublished,i)}setAudioOutput(e){return C(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;on(i.track)&&Kd(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Y;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Y||(Y={}));const c_=4*1e3;class Un extends pn.EventEmitter{constructor(e){var n,i,r,s;if(super(),n=this,this.state=Y.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Q,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,c)=>C(this,void 0,void 0,function*(){var l;if(!Bx())throw un()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Y.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Y.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),qd(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Zd(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(f=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const d=(f,g,m)=>C(this,void 0,void 0,function*(){var S,p;this.abortController&&this.abortController.abort();const v=new AbortController;this.abortController=v,u==null||u();try{yield this.attemptConnection(m??o,a,c,v),this.abortController=void 0,f()}catch(y){if(this.regionUrlProvider&&y instanceof se&&y.reason!==X.Cancelled&&y.reason!==X.NotAllowed){let b=null;try{b=yield this.regionUrlProvider.getNextBestRegionUrl((S=this.abortController)===null||S===void 0?void 0:S.signal)}catch(k){if(k instanceof se&&(k.status===401||k.reason===X.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(k);return}}b&&!(!((p=this.abortController)===null||p===void 0)&&p.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(y.message,". Retrying with another region: ").concat(b),this.logContext),this.recreateEngine(),yield d(f,g,b)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Pg(y)),g(y))}else{let b=Wt.UNKNOWN_REASON;y instanceof se&&(b=Pg(y)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,b),g(y)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Sr((f,g)=>{d(f,g,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>C(this,void 0,void 0,function*(){var h,f,g;const m=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let S=m.serverInfo;if(S||(S={version:m.serverVersion,region:m.serverRegion}),this.serverInfo=S,this.log.debug("connected to Livekit Server ".concat(Object.entries(S).map(p=>{let[v,y]=p;return"".concat(v,": ").concat(y)}).join(", ")),{room:(h=m.room)===null||h===void 0?void 0:h.name,roomSid:(f=m.room)===null||f===void 0?void 0:f.sid,identity:(g=m.participant)===null||g===void 0?void 0:g.identity}),!S.version)throw new Ex("unknown server version");return S.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),m}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>C(this,void 0,void 0,function*(){var u,d;this.state===Y.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Ff),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(_.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new se("could not establish signal connection",X.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof se&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new se("Connection attempt aborted",X.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}st()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),st()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Y.Connected),this.emit(_.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return C(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,f,g;const m=yield l.disconnectLock.lock();try{if(l.state===Y.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===Y.Connecting||l.state===Y.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(f=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new se("Client initiated disconnect",X.Cancelled)),l.connectFuture=void 0),!((g=l.engine)===null||g===void 0)&&g.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Wt.CLIENT_INITIATED),l.engine=void 0}finally{m()}}()})},this.onPageLeave=()=>C(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>C(this,void 0,void 0,function*(){const o=[],a=gt();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=tu();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(_.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>C(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Y.Reconnecting)&&this.emit(_.Reconnecting)},this.handleSignalRestarted=o=>C(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Y.Connected),this.emit(_.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===Mr.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(_.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(_.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=x.streamStateFromProto(a.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(A.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(_.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(_.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(A.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(_.SipDTMFReceived,a,o),o==null||o.emit(A.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=Yx(a,this.transcriptionReceivedTimes);l==null||l.emit(U.TranscriptionReceived,u),c==null||c.emit(A.TranscriptionReceived,u,l),this.emit(_.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=Xx(a);this.emit(_.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(_.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(_.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(_.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(_.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(_.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>C(this,void 0,void 0,function*(){var o;((o=gt())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(_.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(_.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(_.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(_.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(_.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(_.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(_.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(_.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>C(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(U.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(U.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(_.LocalTrackPublished,o,this.localParticipant),kn(o.track)&&(yield o.track.checkForSilence())&&this.emit(_.LocalAudioSilenceDetected,o);const f=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),g=Qd(o.source);g&&f&&f!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,f),this.emit(_.ActiveDeviceChanged,g,f))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(U.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(U.Restarted,this.onLocalTrackRestarted),this.emit(_.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>C(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=Qd(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(_.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(_.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(_.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(_.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(_.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},PR),e),this.log=Nn((i=this.options.loggerName)!==null&&i!==void 0?i:Gt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},gS),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},vS),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},wR),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ye,this.localParticipant=new a_("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ui(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ui(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ui(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),st()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Un.cleanupRegistry&&Un.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,i,r,s,o){return C(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Te.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Te.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});jf(u)>yS?(c=Te.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof Te?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=Te.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new lR(this.options.e2ee),this.e2eeManager.on(ei.ParticipantEncryptionStatusChanged,(n,i)=>{eR(i)&&(this.isE2EEEnabled=n),this.emit(_.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(ei.EncryptionError,n=>this.emit(_.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return C(this,void 0,void 0,function*(){return this.state===Y.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(j.RoomUpdate,i),e(r.sid))};this.engine.on(j.RoomUpdate,i),this.once(_.Disconnected,()=>{this.engine.off(j.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new KR(this.options),this.engine.on(j.ParticipantUpdate,this.handleParticipantUpdates).on(j.RoomUpdate,this.handleRoomUpdate).on(j.SpeakersChanged,this.handleSpeakersChanged).on(j.StreamStateChanged,this.handleStreamStateUpdate).on(j.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(j.SubscriptionError,this.handleSubscriptionError).on(j.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(j.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(j.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(j.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(j.DataPacketReceived,this.handleDataPacket).on(j.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Y.SignalReconnecting)&&this.emit(_.SignalReconnecting)}).on(j.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Y.Connected)&&this.emit(_.Reconnected)}).on(j.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Y.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(j.Restarting,this.handleRestarting).on(j.SignalRestarted,this.handleSignalRestarted).on(j.Offline,()=>{this.setAndEmitConnectionState(Y.Reconnecting)&&this.emit(_.Reconnecting)}).on(j.DCBufferStatusChanged,(e,n)=>{this.emit(_.DCBufferStatusChanged,e,n)}).on(j.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(A.LocalTrackSubscribed,n),this.emitWhenConnected(_.LocalTrackSubscribed,n,this.localParticipant)}).on(j.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(_.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ue.getInstance().getDevices(e,n)}prepareConnection(e,n){return C(this,void 0,void 0,function*(){if(this.state===Y.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(qd(new URL(e))&&n){this.regionUrlProvider=new Zd(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Y.Disconnected&&(this.regionUrl=i,yield fetch(Hd(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Hd(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return C(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Xt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Xt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Xt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Xt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Xt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Xt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Xt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>C(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new tl({reason:Wt.CLIENT_INITIATED,action:Or.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Xt({scenario:{case:"subscriberBandwidth",value:Ei(n)}});break;case"leave-full-reconnect":r=new Xt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,f;let g=!0,m=!1;const S=o?{exact:r}:r;if(i==="audioinput"){m=s.localParticipant.audioTrackPublications.size===0;const p=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=S;const v=Array.from(s.localParticipant.audioTrackPublications.values()).filter(b=>b.source===x.Source.Microphone);try{g=(yield Promise.all(v.map(b=>{var k;return(k=b.audioTrack)===null||k===void 0?void 0:k.setDeviceId(S)}))).every(b=>b===!0)}catch(b){throw s.options.audioCaptureDefaults.deviceId=p,b}const y=v.some(b=>{var k,w;return(w=(k=b.track)===null||k===void 0?void 0:k.isMuted)!==null&&w!==void 0?w:!1});g&&y&&(m=!0)}else if(i==="videoinput"){m=s.localParticipant.videoTrackPublications.size===0;const p=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=S;const v=Array.from(s.localParticipant.videoTrackPublications.values()).filter(b=>b.source===x.Source.Camera);try{g=(yield Promise.all(v.map(b=>{var k;return(k=b.videoTrack)===null||k===void 0?void 0:k.setDeviceId(S)}))).every(b=>b===!0)}catch(b){throw s.options.videoCaptureDefaults.deviceId=p,b}const y=v.some(b=>{var k,w;return(w=(k=b.track)===null||k===void 0?void 0:k.isMuted)!==null&&w!==void 0?w:!1});g&&y&&(m=!0)}else if(i==="audiooutput"){if(m=!0,!$d()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(r=(l=yield Ue.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(f=s.options).audioOutput)!==null&&u!==void 0||(f.audioOutput={});const p=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(v=>v.setAudioOutput({deviceId:r})))}catch(v){throw s.options.audioOutput.deviceId=p,v}}return m&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(_.ActiveDeviceChanged,i,r)),g}()})}setupLocalParticipantEvents(){this.localParticipant.on(A.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(A.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(A.AttributesChanged,this.onLocalAttributesChanged).on(A.TrackMuted,this.onLocalTrackMuted).on(A.TrackUnmuted,this.onLocalTrackUnmuted).on(A.LocalTrackPublished,this.onLocalTrackPublished).on(A.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(A.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(A.MediaDevicesError,this.onMediaDevicesError).on(A.AudioStreamAcquired,this.startAudio).on(A.ChatMessage,this.onLocalChatMessageSent).on(A.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Y.Connecting||this.state===Y.Reconnecting){const u=()=>{this.onTrackAdded(e,n,i),d()},d=()=>{this.off(_.Reconnected,u),this.off(_.Connected,u),this.off(_.Disconnected,d)};this.once(_.Reconnected,u),this.once(_.Connected,u),this.once(_.Disconnected,d);return}if(this.state===Y.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=Fx(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Y.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(A.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(A.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(A.AttributesChanged,this.onLocalAttributesChanged).off(A.TrackMuted,this.onLocalTrackMuted).off(A.TrackUnmuted,this.onLocalTrackUnmuted).off(A.LocalTrackPublished,this.onLocalTrackPublished).off(A.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(A.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(A.MediaDevicesError,this.onMediaDevicesError).off(A.AudioStreamAcquired,this.startAudio).off(A.ChatMessage,this.onLocalChatMessageSent).off(A.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),st()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Y.Disconnected),this.emit(_.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(_.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return C(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ua(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new YR(o,a,Ua(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new XR(o,a,Ua(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return C(this,void 0,void 0,function*(){var e,n,i;const r=Ue.getInstance().previousDevices,s=yield Ue.getInstance().getDevices(void 0,!1),o=gt();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(_.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=nR(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(f=>f.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(f=>f.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!Wd()||c==="videoinput"||d.length>0&&!d.find(f=>f.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Wd())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return C(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Of())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),lt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(_.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Sc.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Sc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(_.ParticipantConnected,i),i.on(A.TrackPublished,r=>{this.emitWhenConnected(_.TrackPublished,r,i)}).on(A.TrackSubscribed,(r,s)=>{r.kind===x.Kind.Audio?(r.on(U.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(U.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===x.Kind.Video&&(r.on(U.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(U.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(_.TrackSubscribed,r,s,i)}).on(A.TrackUnpublished,r=>{this.emit(_.TrackUnpublished,r,i)}).on(A.TrackUnsubscribed,(r,s)=>{this.emit(_.TrackUnsubscribed,r,s,i)}).on(A.TrackMuted,r=>{this.emitWhenConnected(_.TrackMuted,r,i)}).on(A.TrackUnmuted,r=>{this.emitWhenConnected(_.TrackUnmuted,r,i)}).on(A.ParticipantMetadataChanged,r=>{this.emitWhenConnected(_.ParticipantMetadataChanged,r,i)}).on(A.ParticipantNameChanged,r=>{this.emitWhenConnected(_.ParticipantNameChanged,r,i)}).on(A.AttributesChanged,r=>{this.emitWhenConnected(_.ParticipantAttributesChanged,r,i)}).on(A.ConnectionQualityChanged,r=>{this.emitWhenConnected(_.ConnectionQualityChanged,r,i)}).on(A.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(_.ParticipantPermissionsChanged,r,i)}).on(A.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(_.TrackSubscriptionStatusChanged,r,s,i)}).on(A.TrackSubscriptionFailed,(r,s)=>{this.emit(_.TrackSubscriptionFailed,r,i,s)}).on(A.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(_.TrackSubscriptionPermissionChanged,r,s,i)}).on(A.Active,()=>{this.emitWhenConnected(_.ParticipantActive,i),i.kind===qi.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&Zx(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Be.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Wt.STATE_MISMATCH))):e=0},c_)}clearConnectionReconcile(){this.connectionReconcileInterval&&Be.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(_.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Y.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Y.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return C(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Zc({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:fe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Wi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(_.SignalConnected),this.emit(_.Connected),this.setAndEmitConnectionState(Y.Connected),r.video){const o=new th(x.Kind.Video,new kr({source:xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO,name:"video-dummy"}),new kc(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:wg(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(A.LocalTrackPublished,o)}if(r.audio){const o=new th(x.Kind.Audio,new kr({source:xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO}),new yc(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:tu(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(A.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Wi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Mr.ACTIVE,tracks:[],joinedAt:fe.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=wg(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new kr({source:xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=tu(),u=new kr({source:xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==_.ActiveSpeakersChanged&&e!==_.TranscriptionReceived){const s=xS(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Un.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function xS(t){return t.map(e=>{if(e)return Array.isArray(e)?xS(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Vt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Vt||(Vt={}));class Si extends pn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Vt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Un(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return C(this,void 0,void 0,function*(){if(this.status!==Vt.IDLE)throw Error("check is running already");this.setStatus(Vt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Vt.SKIPPED&&this.setStatus(this.isSuccess()?Vt.SUCCESS:Vt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return C(this,void 0,void 0,function*(){return this.room.state===Y.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return C(this,void 0,void 0,function*(){this.room&&this.room.state!==Y.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Vt.SKIPPED)}switchProtocol(e){return C(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(_.Reconnecting,()=>{n=!0}),this.room.once(_.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield lt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class l_ extends Si{get description(){return"Cloud regions"}perform(){return C(this,void 0,void 0,function*(){const e=new Zd(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return C(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let g=0;g<c;g++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(g=>{g.type==="candidate-pair"&&g.nominated&&(f.rtt=g.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const uu=1e4;class u_ extends Si{get description(){return"Connection via UDP vs TCP"}perform(){return C(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(uu/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(uu/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return C(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>C(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(u.packetsSent=f.packetsSent,u.qualityLimitationDurations=f.qualityLimitationDurations,u.bitrateTotal+=f.targetBitrate,u.count++):f.type==="remote-inbound-rtp"&&(u.packetsLost=f.packetsLost,u.rttTotal+=f.roundTripTime,u.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,uu)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class d_ extends Si{get description(){return"Can publish audio"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield r_();if(yield fS(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class h_ extends Si{get description(){return"Can publish video"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield i_();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return C(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const f=l.getContext("2d");f.drawImage(i,0,0);const m=f.getImageData(0,0,l.width,l.height).data;let S=!0;for(let p=0;p<m.length;p+=4)if(m[p]!==0||m[p+1]!==0||m[p+2]!==0){S=!1;break}S?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class f_ extends Si{get description(){return"Resuming connection after interruption"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(_.SignalReconnecting,a).on(_.Reconnecting,a).on(_.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==Y.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class p_ extends Si{get description(){return"Can connect via TURN"}perform(){return C(this,void 0,void 0,function*(){var e,n;const i=new Lf,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class m_ extends Si{get description(){return"Establishing WebRTC connection"}perform(){return C(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(_.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(g_(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),Q.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function g_(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class v_ extends Si{get description(){return"Connecting to signal connection via WebSocket"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Lf;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===pb.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class d2 extends pn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Vt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Vt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return C(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(v_)})}checkWebRTC(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(m_)})}checkTURN(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(p_)})}checkReconnect(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(f_)})}checkPublishAudio(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(d_)})}checkPublishVideo(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(h_)})}checkConnectionProtocol(){return C(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(u_);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(l_)})}}const Tc=Math.min,Ni=Math.max,Cc=Math.round,oa=Math.floor,an=t=>({x:t,y:t}),y_={left:"right",right:"left",bottom:"top",top:"bottom"},k_={start:"end",end:"start"};function Wg(t,e,n){return Ni(t,Tc(e,n))}function sl(t,e){return typeof t=="function"?t(e):t}function Gi(t){return t.split("-")[0]}function ol(t){return t.split("-")[1]}function RS(t){return t==="x"?"y":"x"}function _S(t){return t==="y"?"height":"width"}function Jr(t){return["top","bottom"].includes(Gi(t))?"y":"x"}function IS(t){return RS(Jr(t))}function b_(t,e,n){n===void 0&&(n=!1);const i=ol(t),r=IS(t),s=_S(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=wc(o)),[o,wc(o)]}function S_(t){const e=wc(t);return[nh(t),e,nh(e)]}function nh(t){return t.replace(/start|end/g,e=>k_[e])}function T_(t,e,n){const i=["left","right"],r=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:i:e?i:r;case"left":case"right":return e?s:o;default:return[]}}function C_(t,e,n,i){const r=ol(t);let s=T_(Gi(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(nh)))),s}function wc(t){return t.replace(/left|right|bottom|top/g,e=>y_[e])}function w_(t){return{top:0,right:0,bottom:0,left:0,...t}}function P_(t){return typeof t!="number"?w_(t):{top:t,right:t,bottom:t,left:t}}function Pc(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function qg(t,e,n){let{reference:i,floating:r}=t;const s=Jr(e),o=IS(e),a=_S(o),c=Gi(e),l=s==="y",u=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,h=i[a]/2-r[a]/2;let f;switch(c){case"top":f={x:u,y:i.y-r.height};break;case"bottom":f={x:u,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:d};break;case"left":f={x:i.x-r.width,y:d};break;default:f={x:i.x,y:i.y}}switch(ol(e)){case"start":f[o]-=h*(n&&l?-1:1);break;case"end":f[o]+=h*(n&&l?-1:1);break}return f}const E_=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:u,y:d}=qg(l,i,c),h=i,f={},g=0;for(let m=0;m<a.length;m++){const{name:S,fn:p}=a[m],{x:v,y,data:b,reset:k}=await p({x:u,y:d,initialPlacement:i,placement:h,strategy:r,middlewareData:f,rects:l,platform:o,elements:{reference:t,floating:e}});u=v??u,d=y??d,f={...f,[S]:{...f[S],...b}},k&&g<=50&&(g++,typeof k=="object"&&(k.placement&&(h=k.placement),k.rects&&(l=k.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):k.rects),{x:u,y:d}=qg(l,h,c)),m=-1)}return{x:u,y:d,placement:h,strategy:r,middlewareData:f}};async function DS(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=sl(e,t),g=P_(f),m=a[h?d==="floating"?"reference":"floating":d],S=Pc(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(m)))==null||n?m:m.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),p=d==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,v=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),y=await(s.isElement==null?void 0:s.isElement(v))?await(s.getScale==null?void 0:s.getScale(v))||{x:1,y:1}:{x:1,y:1},b=Pc(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:p,offsetParent:v,strategy:c}):p);return{top:(S.top-b.top+g.top)/y.y,bottom:(b.bottom-S.bottom+g.bottom)/y.y,left:(S.left-b.left+g.left)/y.x,right:(b.right-S.right+g.right)/y.x}}const x_=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...S}=sl(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const p=Gi(r),v=Jr(a),y=Gi(a)===a,b=await(c.isRTL==null?void 0:c.isRTL(l.floating)),k=h||(y||!m?[wc(a)]:S_(a)),w=g!=="none";!h&&w&&k.push(...C_(a,m,g,b));const E=[a,...k],P=await DS(e,S),D=[];let I=((i=s.flip)==null?void 0:i.overflows)||[];if(u&&D.push(P[p]),d){const ee=b_(r,o,b);D.push(P[ee[0]],P[ee[1]])}if(I=[...I,{placement:r,overflows:D}],!D.every(ee=>ee<=0)){var O,V;const ee=(((O=s.flip)==null?void 0:O.index)||0)+1,ut=E[ee];if(ut)return{data:{index:ee,overflows:I},reset:{placement:ut}};let Ie=(V=I.filter(J=>J.overflows[0]<=0).sort((J,N)=>J.overflows[1]-N.overflows[1])[0])==null?void 0:V.placement;if(!Ie)switch(f){case"bestFit":{var H;const J=(H=I.filter(N=>{if(w){const z=Jr(N.placement);return z===v||z==="y"}return!0}).map(N=>[N.placement,N.overflows.filter(z=>z>0).reduce((z,$)=>z+$,0)]).sort((N,z)=>N[1]-z[1])[0])==null?void 0:H[0];J&&(Ie=J);break}case"initialPlacement":Ie=a;break}if(r!==Ie)return{reset:{placement:Ie}}}return{}}}};async function R_(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=Gi(n),a=ol(n),c=Jr(n)==="y",l=["left","top"].includes(o)?-1:1,u=s&&c?-1:1,d=sl(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(f=a==="end"?g*-1:g),c?{x:f*u,y:h*l}:{x:h*l,y:f*u}}const __=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,c=await R_(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+c.x,y:s+c.y,data:{...c,placement:o}}}}},I_=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:p,y:v}=S;return{x:p,y:v}}},...c}=sl(t,e),l={x:n,y:i},u=await DS(e,c),d=Jr(Gi(r)),h=RS(d);let f=l[h],g=l[d];if(s){const S=h==="y"?"top":"left",p=h==="y"?"bottom":"right",v=f+u[S],y=f-u[p];f=Wg(v,f,y)}if(o){const S=d==="y"?"top":"left",p=d==="y"?"bottom":"right",v=g+u[S],y=g-u[p];g=Wg(v,g,y)}const m=a.fn({...e,[h]:f,[d]:g});return{...m,data:{x:m.x-n,y:m.y-i,enabled:{[h]:s,[d]:o}}}}}};function al(){return typeof window<"u"}function ss(t){return AS(t)?(t.nodeName||"").toLowerCase():"#document"}function vt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function mn(t){var e;return(e=(AS(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function AS(t){return al()?t instanceof Node||t instanceof vt(t).Node:!1}function Qt(t){return al()?t instanceof Element||t instanceof vt(t).Element:!1}function hn(t){return al()?t instanceof HTMLElement||t instanceof vt(t).HTMLElement:!1}function Hg(t){return!al()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof vt(t).ShadowRoot}function Ao(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=Jt(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(r)}function D_(t){return["table","td","th"].includes(ss(t))}function cl(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function zf(t){const e=$f(),n=Qt(t)?Jt(t):t;return["transform","translate","scale","rotate","perspective"].some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function A_(t){let e=pi(t);for(;hn(e)&&!Yr(e);){if(zf(e))return e;if(cl(e))return null;e=pi(e)}return null}function $f(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Yr(t){return["html","body","#document"].includes(ss(t))}function Jt(t){return vt(t).getComputedStyle(t)}function ll(t){return Qt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function pi(t){if(ss(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Hg(t)&&t.host||mn(t);return Hg(e)?e.host:e}function MS(t){const e=pi(t);return Yr(e)?t.ownerDocument?t.ownerDocument.body:t.body:hn(e)&&Ao(e)?e:MS(e)}function ko(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=MS(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=vt(r);if(s){const a=ih(o);return e.concat(o,o.visualViewport||[],Ao(r)?r:[],a&&n?ko(a):[])}return e.concat(r,ko(r,[],n))}function ih(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function OS(t){const e=Jt(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=hn(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=Cc(n)!==s||Cc(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function Wf(t){return Qt(t)?t:t.contextElement}function jr(t){const e=Wf(t);if(!hn(e))return an(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=OS(e);let o=(s?Cc(n.width):n.width)/i,a=(s?Cc(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const M_=an(0);function LS(t){const e=vt(t);return!$f()||!e.visualViewport?M_:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function O_(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==vt(t)?!1:e}function Qi(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=Wf(t);let o=an(1);e&&(i?Qt(i)&&(o=jr(i)):o=jr(t));const a=O_(s,n,i)?LS(s):an(0);let c=(r.left+a.x)/o.x,l=(r.top+a.y)/o.y,u=r.width/o.x,d=r.height/o.y;if(s){const h=vt(s),f=i&&Qt(i)?vt(i):i;let g=h,m=ih(g);for(;m&&i&&f!==g;){const S=jr(m),p=m.getBoundingClientRect(),v=Jt(m),y=p.left+(m.clientLeft+parseFloat(v.paddingLeft))*S.x,b=p.top+(m.clientTop+parseFloat(v.paddingTop))*S.y;c*=S.x,l*=S.y,u*=S.x,d*=S.y,c+=y,l+=b,g=vt(m),m=ih(g)}}return Pc({width:u,height:d,x:c,y:l})}function qf(t,e){const n=ll(t).scrollLeft;return e?e.left+n:Qi(mn(t)).left+n}function NS(t,e,n){n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=i.left+e.scrollLeft-(n?0:qf(t,i)),s=i.top+e.scrollTop;return{x:r,y:s}}function L_(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=mn(i),a=e?cl(e.floating):!1;if(i===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=an(1);const u=an(0),d=hn(i);if((d||!d&&!s)&&((ss(i)!=="body"||Ao(o))&&(c=ll(i)),hn(i))){const f=Qi(i);l=jr(i),u.x=f.x+i.clientLeft,u.y=f.y+i.clientTop}const h=o&&!d&&!s?NS(o,c,!0):an(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+h.x,y:n.y*l.y-c.scrollTop*l.y+u.y+h.y}}function N_(t){return Array.from(t.getClientRects())}function U_(t){const e=mn(t),n=ll(t),i=t.ownerDocument.body,r=Ni(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Ni(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+qf(t);const a=-n.scrollTop;return Jt(i).direction==="rtl"&&(o+=Ni(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}function F_(t,e){const n=vt(t),i=mn(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,c=0;if(r){s=r.width,o=r.height;const l=$f();(!l||l&&e==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}return{width:s,height:o,x:a,y:c}}function j_(t,e){const n=Qi(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=hn(t)?jr(t):an(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=r*s.x,l=i*s.y;return{width:o,height:a,x:c,y:l}}function Kg(t,e,n){let i;if(e==="viewport")i=F_(t,n);else if(e==="document")i=U_(mn(t));else if(Qt(e))i=j_(e,n);else{const r=LS(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Pc(i)}function US(t,e){const n=pi(t);return n===e||!Qt(n)||Yr(n)?!1:Jt(n).position==="fixed"||US(n,e)}function V_(t,e){const n=e.get(t);if(n)return n;let i=ko(t,[],!1).filter(a=>Qt(a)&&ss(a)!=="body"),r=null;const s=Jt(t).position==="fixed";let o=s?pi(t):t;for(;Qt(o)&&!Yr(o);){const a=Jt(o),c=zf(o);!c&&a.position==="fixed"&&(r=null),(s?!c&&!r:!c&&a.position==="static"&&r&&["absolute","fixed"].includes(r.position)||Ao(o)&&!c&&US(t,o))?i=i.filter(l=>l!==o):r=a,o=pi(o)}return e.set(t,i),i}function B_(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const s=[...n==="clippingAncestors"?cl(e)?[]:V_(e,this._c):[].concat(n),i],o=s[0],a=s.reduce((c,l)=>{const u=Kg(e,l,r);return c.top=Ni(u.top,c.top),c.right=Tc(u.right,c.right),c.bottom=Tc(u.bottom,c.bottom),c.left=Ni(u.left,c.left),c},Kg(e,o,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function z_(t){const{width:e,height:n}=OS(t);return{width:e,height:n}}function $_(t,e,n){const i=hn(e),r=mn(e),s=n==="fixed",o=Qi(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=an(0);if(i||!i&&!s)if((ss(e)!=="body"||Ao(r))&&(a=ll(e)),i){const h=Qi(e,!0,s,e);c.x=h.x+e.clientLeft,c.y=h.y+e.clientTop}else r&&(c.x=qf(r));const l=r&&!i&&!s?NS(r,a):an(0),u=o.left+a.scrollLeft-c.x-l.x,d=o.top+a.scrollTop-c.y-l.y;return{x:u,y:d,width:o.width,height:o.height}}function du(t){return Jt(t).position==="static"}function Gg(t,e){if(!hn(t)||Jt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return mn(t)===n&&(n=n.ownerDocument.body),n}function FS(t,e){const n=vt(t);if(cl(t))return n;if(!hn(t)){let r=pi(t);for(;r&&!Yr(r);){if(Qt(r)&&!du(r))return r;r=pi(r)}return n}let i=Gg(t,e);for(;i&&D_(i)&&du(i);)i=Gg(i,e);return i&&Yr(i)&&du(i)&&!zf(i)?n:i||A_(t)||n}const W_=async function(t){const e=this.getOffsetParent||FS,n=this.getDimensions,i=await n(t.floating);return{reference:$_(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function q_(t){return Jt(t).direction==="rtl"}const H_={convertOffsetParentRelativeRectToViewportRelativeRect:L_,getDocumentElement:mn,getClippingRect:B_,getOffsetParent:FS,getElementRects:W_,getClientRects:N_,getDimensions:z_,getScale:jr,isElement:Qt,isRTL:q_};function jS(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function K_(t,e){let n=null,i;const r=mn(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const l=t.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=l;if(a||e(),!h||!f)return;const g=oa(d),m=oa(r.clientWidth-(u+h)),S=oa(r.clientHeight-(d+f)),p=oa(u),v={rootMargin:-g+"px "+-m+"px "+-S+"px "+-p+"px",threshold:Ni(0,Tc(1,c))||1};let y=!0;function b(k){const w=k[0].intersectionRatio;if(w!==c){if(!y)return o();w?o(!1,w):i=setTimeout(()=>{o(!1,1e-7)},1e3)}w===1&&!jS(l,t.getBoundingClientRect())&&o(),y=!1}try{n=new IntersectionObserver(b,{...v,root:r.ownerDocument})}catch{n=new IntersectionObserver(b,v)}n.observe(t)}return o(!0),s}function G_(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=i,l=Wf(t),u=r||s?[...l?ko(l):[],...ko(e)]:[];u.forEach(p=>{r&&p.addEventListener("scroll",n,{passive:!0}),s&&p.addEventListener("resize",n)});const d=l&&a?K_(l,n):null;let h=-1,f=null;o&&(f=new ResizeObserver(p=>{let[v]=p;v&&v.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let g,m=c?Qi(t):null;c&&S();function S(){const p=Qi(t);m&&!jS(m,p)&&n(),m=p,g=requestAnimationFrame(S)}return n(),()=>{var p;u.forEach(v=>{r&&v.removeEventListener("scroll",n),s&&v.removeEventListener("resize",n)}),d==null||d(),(p=f)==null||p.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const Q_=__,J_=I_,Y_=x_,X_=(t,e,n)=>{const i=new Map,r={platform:H_,...n},s={...r.platform,_c:i};return E_(t,e,{...r,platform:s})};var aa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rh={exports:{}},Z_=rh.exports,Qg;function eI(){return Qg||(Qg=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Z_,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(m,S){var p=m[S];if(typeof p.bind=="function")return p.bind(m);try{return Function.prototype.bind.call(p,m)}catch{return function(){return Function.prototype.apply.apply(p,[m,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&i?c:console[m]!==void 0?a(console,m):console.log!==void 0?a(console,"log"):e}function u(){for(var m=this.getLevel(),S=0;S<r.length;S++){var p=r[S];this[p]=S<m?e:this.methodFactory(p,m,this.name)}if(this.log=this.debug,typeof console===n&&m<this.levels.SILENT)return"No console available for logging"}function d(m){return function(){typeof console!==n&&(u.call(this),this[m].apply(this,arguments))}}function h(m,S,p){return l(m)||d.apply(this,arguments)}function f(m,S){var p=this,v,y,b,k="loglevel";typeof m=="string"?k+=":"+m:typeof m=="symbol"&&(k=void 0);function w(O){var V=(r[O]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=V;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+V+";"}catch{}}}function E(){var O;if(!(typeof window===n||!k)){try{O=window.localStorage[k]}catch{}if(typeof O===n)try{var V=window.document.cookie,H=encodeURIComponent(k),ee=V.indexOf(H+"=");ee!==-1&&(O=/^([^;]+)/.exec(V.slice(ee+H.length+1))[1])}catch{}return p.levels[O]===void 0&&(O=void 0),O}}function P(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(O){var V=O;if(typeof V=="string"&&p.levels[V.toUpperCase()]!==void 0&&(V=p.levels[V.toUpperCase()]),typeof V=="number"&&V>=0&&V<=p.levels.SILENT)return V;throw new TypeError("log.setLevel() called with invalid level: "+O)}p.name=m,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=S||h,p.getLevel=function(){return b??y??v},p.setLevel=function(O,V){return b=D(O),V!==!1&&w(b),u.call(p)},p.setDefaultLevel=function(O){y=D(O),E()||p.setLevel(O,!1)},p.resetLevel=function(){b=null,P(),u.call(p)},p.enableAll=function(O){p.setLevel(p.levels.TRACE,O)},p.disableAll=function(O){p.setLevel(p.levels.SILENT,O)},p.rebuild=function(){if(o!==p&&(v=D(o.getLevel())),u.call(p),o===p)for(var O in s)s[O].rebuild()},v=D(o?o.getLevel():"WARN");var I=E();I!=null&&(b=D(I)),u.call(p)}o=new f,o.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[m];return S||(S=s[m]=new f(m,o.methodFactory)),S};var g=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=g),o},o.getLoggers=function(){return s},o.default=o,o})}(rh)),rh.exports}var tI=eI();const nI=VS(tI);var sh=function(t,e){return sh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},sh(t,e)};function Vn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");sh(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function iI(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function BS(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Xr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ec(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function xc(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function Vr(t){return this instanceof Vr?(this.v=t,this):new Vr(t)}function rI(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(f){return function(g){return Promise.resolve(g).then(f,d)}}function a(f,g){i[f]&&(r[f]=function(m){return new Promise(function(S,p){s.push([f,m,S,p])>1||c(f,m)})},g&&(r[f]=g(r[f])))}function c(f,g){try{l(i[f](g))}catch(m){h(s[0][3],m)}}function l(f){f.value instanceof Vr?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,g){f(g),s.shift(),s.length&&c(s[0][0],s[0][1])}}function sI(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Xr=="function"?Xr(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Oe(t){return typeof t=="function"}function Hf(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var hu=Hf(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Rc(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Mo=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Xr(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(m){e={error:m}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Oe(u))try{u()}catch(m){s=m instanceof hu?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Xr(d),f=h.next();!f.done;f=h.next()){var g=f.value;try{Jg(g)}catch(m){s=s??[],m instanceof hu?s=xc(xc([],Ec(s)),Ec(m.errors)):s.push(m)}}}catch(m){i={error:m}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}}if(s)throw new hu(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Jg(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Rc(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Rc(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),zS=Mo.EMPTY;function $S(t){return t instanceof Mo||t&&"closed"in t&&Oe(t.remove)&&Oe(t.add)&&Oe(t.unsubscribe)}function Jg(t){Oe(t)?t():t.unsubscribe()}var oI={Promise:void 0},aI={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,xc([t,e],Ec(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function WS(t){aI.setTimeout(function(){throw t})}function Yg(){}function ja(t){t()}var Kf=function(t){Vn(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,$S(n)&&n.add(i)):i.destination=uI,i}return e.create=function(n,i,r){return new oh(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Mo),cI=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){ca(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){ca(i)}else ca(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){ca(n)}},t}(),oh=function(t){Vn(e,t);function e(n,i,r){var s=t.call(this)||this,o;return Oe(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new cI(o),s}return e}(Kf);function ca(t){WS(t)}function lI(t){throw t}var uI={closed:!0,next:Yg,error:lI,complete:Yg},Gf=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function qS(t){return t}function dI(t){return t.length===0?qS:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var _e=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=fI(e)?e:new oh(e,n,i);return ja(function(){var o=r,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=Xg(n),new n(function(r,s){var o=new oh({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Gf]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return dI(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Xg(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function Xg(t){var e;return(e=t??oI.Promise)!==null&&e!==void 0?e:Promise}function hI(t){return t&&Oe(t.next)&&Oe(t.error)&&Oe(t.complete)}function fI(t){return t&&t instanceof Kf||hI(t)&&$S(t)}function pI(t){return Oe(t==null?void 0:t.lift)}function os(t){return function(e){if(pI(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function bo(t,e,n,i,r){return new mI(t,e,n,i,r)}var mI=function(t){Vn(e,t);function e(n,i,r,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=i?function(l){try{i(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Kf),gI=Hf(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),So=function(t){Vn(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new Zg(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new gI},e.prototype.next=function(n){var i=this;ja(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=Xr(i.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;ja(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;ja(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?zS:(this.currentObservers=null,a.push(n),new Mo(function(){i.currentObservers=null,Rc(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new _e;return n.source=this,n},e.create=function(n,i){return new Zg(n,i)},e}(_e),Zg=function(t){Vn(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:zS},e}(So),vI=function(t){Vn(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(So),yI={now:function(){return Date.now()}},kI=function(t){Vn(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Mo),ev={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,xc([t,e],Ec(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},bI=function(t){Vn(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),ev.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&ev.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Rc(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(kI),tv=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=yI.now,t}(),SI=function(t){Vn(e,t);function e(n,i){i===void 0&&(i=tv.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}(tv);new SI(bI);function TI(t){return t&&Oe(t.schedule)}function CI(t){return t[t.length-1]}function HS(t){return TI(CI(t))?t.pop():void 0}var KS=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function GS(t){return Oe(t==null?void 0:t.then)}function QS(t){return Oe(t[Gf])}function JS(t){return Symbol.asyncIterator&&Oe(t==null?void 0:t[Symbol.asyncIterator])}function YS(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function wI(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var XS=wI();function ZS(t){return Oe(t==null?void 0:t[XS])}function eT(t){return rI(this,arguments,function(){var e,n,i,r;return BS(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Vr(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,Vr(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Vr(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function tT(t){return Oe(t==null?void 0:t.getReader)}function Oo(t){if(t instanceof _e)return t;if(t!=null){if(QS(t))return PI(t);if(KS(t))return EI(t);if(GS(t))return xI(t);if(JS(t))return nT(t);if(ZS(t))return RI(t);if(tT(t))return _I(t)}throw YS(t)}function PI(t){return new _e(function(e){var n=t[Gf]();if(Oe(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function EI(t){return new _e(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function xI(t){return new _e(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,WS)})}function RI(t){return new _e(function(e){var n,i;try{for(var r=Xr(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function nT(t){return new _e(function(e){II(t,e).catch(function(n){return e.error(n)})})}function _I(t){return nT(eT(t))}function II(t,e){var n,i,r,s;return iI(this,void 0,void 0,function(){var o,a;return BS(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=sI(t),c.label=1;case 1:return[4,n.next()];case 2:if(i=c.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Ui(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function iT(t,e){return e===void 0&&(e=0),os(function(n,i){n.subscribe(bo(i,function(r){return Ui(i,t,function(){return i.next(r)},e)},function(){return Ui(i,t,function(){return i.complete()},e)},function(r){return Ui(i,t,function(){return i.error(r)},e)}))})}function rT(t,e){return e===void 0&&(e=0),os(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function DI(t,e){return Oo(t).pipe(rT(e),iT(e))}function AI(t,e){return Oo(t).pipe(rT(e),iT(e))}function MI(t,e){return new _e(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function OI(t,e){return new _e(function(n){var i;return Ui(n,e,function(){i=t[XS](),Ui(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Oe(i==null?void 0:i.return)&&i.return()}})}function sT(t,e){if(!t)throw new Error("Iterable cannot be null");return new _e(function(n){Ui(n,e,function(){var i=t[Symbol.asyncIterator]();Ui(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function LI(t,e){return sT(eT(t),e)}function NI(t,e){if(t!=null){if(QS(t))return DI(t,e);if(KS(t))return MI(t,e);if(GS(t))return AI(t,e);if(JS(t))return sT(t,e);if(ZS(t))return OI(t,e);if(tT(t))return LI(t,e)}throw YS(t)}function UI(t,e){return e?NI(t,e):Oo(t)}Hf(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Ct(t,e){return os(function(n,i){var r=0;n.subscribe(bo(i,function(s){i.next(t.call(e,s,r++))}))})}function FI(t,e,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,h=function(){d&&!c.length&&!l&&e.complete()},f=function(m){return l<i?g(m):c.push(m)},g=function(m){l++;var S=!1;Oo(n(m,u++)).subscribe(bo(e,function(p){e.next(p)},function(){S=!0},void 0,function(){if(S)try{l--;for(var p=function(){var v=c.shift();o||g(v)};c.length&&l<i;)p();h()}catch(v){e.error(v)}}))};return t.subscribe(bo(e,f,function(){d=!0,h()})),function(){}}function oT(t,e,n){return n===void 0&&(n=1/0),Oe(e)?oT(function(i,r){return Ct(function(s,o){return e(i,s,r,o)})(Oo(t(i,r)))},n):(typeof e=="number"&&(n=e),os(function(i,r){return FI(i,r,t,n)}))}function jI(t){return oT(qS,t)}function VI(){return jI(1)}function ah(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return VI()(UI(t,HS(t)))}function BI(t,e){return os(function(n,i){var r=0;n.subscribe(bo(i,function(s){return t.call(e,s,r++)&&i.next(s)}))})}function gn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=HS(t);return os(function(i,r){(n?ah(t,i,n):ah(t,i)).subscribe(r)})}var zI=Object.defineProperty,$I=Object.defineProperties,WI=Object.getOwnPropertyDescriptors,nv=Object.getOwnPropertySymbols,qI=Object.prototype.hasOwnProperty,HI=Object.prototype.propertyIsEnumerable,iv=(t,e,n)=>e in t?zI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ch=(t,e)=>{for(var n in e||(e={}))qI.call(e,n)&&iv(t,n,e[n]);if(nv)for(var n of nv(e))HI.call(e,n)&&iv(t,n,e[n]);return t},KI=(t,e)=>$I(t,WI(e)),er=(t,e,n)=>new Promise((i,r)=>{var s=c=>{try{a(n.next(c))}catch(l){r(l)}},o=c=>{try{a(n.throw(c))}catch(l){r(l)}},a=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,o);a((n=n.apply(t,e)).next())}),aT="lk";function Qf(t){return typeof t>"u"?!1:GI(t)||QI(t)}function GI(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function QI(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function JI(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function cT(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(JI(t))return`${t.participant.identity}_${t.source}_placeholder`;if(Qf(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}function YI(t,e,n){return G_(t,e,()=>er(this,null,function*(){const{x:i,y:r}=yield X_(t,e,{placement:"top",middleware:[Q_(6),Y_(),J_({padding:5})]});n==null||n(i,r)}))}function XI(t,e){return!t.contains(e.target)}var ZI=[_.ConnectionStateChanged,_.RoomMetadataChanged,_.ActiveSpeakersChanged,_.ConnectionQualityChanged,_.ParticipantConnected,_.ParticipantDisconnected,_.ParticipantPermissionsChanged,_.ParticipantMetadataChanged,_.ParticipantNameChanged,_.ParticipantAttributesChanged,_.TrackMuted,_.TrackUnmuted,_.TrackPublished,_.TrackUnpublished,_.TrackStreamStateChanged,_.TrackSubscriptionFailed,_.TrackSubscriptionPermissionChanged,_.TrackSubscriptionStatusChanged],lT=[...ZI,_.LocalTrackPublished,_.LocalTrackUnpublished],eD=[A.TrackPublished,A.TrackUnpublished,A.TrackMuted,A.TrackUnmuted,A.TrackStreamStateChanged,A.TrackSubscribed,A.TrackUnsubscribed,A.TrackSubscriptionPermissionChanged,A.TrackSubscriptionFailed,A.LocalTrackPublished,A.LocalTrackUnpublished],tD=[A.ConnectionQualityChanged,A.IsSpeakingChanged,A.ParticipantMetadataChanged,A.ParticipantPermissionsChanged,A.TrackMuted,A.TrackUnmuted,A.TrackPublished,A.TrackUnpublished,A.TrackStreamStateChanged,A.TrackSubscriptionFailed,A.TrackSubscriptionPermissionChanged,A.TrackSubscriptionStatusChanged];[...tD,A.LocalTrackPublished,A.LocalTrackUnpublished];var Ee=nI.getLogger("lk-components-js");Ee.setDefaultLevel("WARN");function nD(t,e){var n;return KI(ch({},t),{receivedAtMediaTimestamp:(n=e.rtpTimestamp)!=null?n:0,receivedAt:e.timestamp})}function iD(t,e,n){return[...t,...e].reduceRight((i,r)=>(i.find(s=>s.id===r.id)||i.unshift(r),i),[]).slice(0-n)}function uT(t){return typeof t=="object"}function dT(t){return Array.isArray(t)&&t.filter(uT).length>0}function tr(t){return`${aT}-${t}`}function rD(t){const e=lh(t),n=Jf(t.participant).pipe(Ct(()=>lh(t)),gn(e));return{className:tr(t.source===x.Source.Camera||t.source===x.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function lh(t){if(Qf(t))return t.publication;{const{source:e,name:n,participant:i}=t;if(e&&n)return i.getTrackPublications().find(r=>r.source===e&&r.trackName===n);if(n)return i.getTrackPublicationByName(n);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function ul(t,...e){return new _e(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(gn(t))}function hT(t,e){return new _e(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function sD(t){return hT(t,_.ConnectionStateChanged).pipe(Ct(([e])=>e),gn(t.state))}function oD(t,e,n=!0){const i=new _e(s=>{Un.getLocalDevices(t,n).then(o=>{s.next(o),s.complete()}).catch(o=>{e==null||e(o),s.next([]),s.complete()})}),r=new _e(s=>{var o;const a=()=>er(this,null,function*(){try{const c=yield Un.getLocalDevices(t,n);s.next(c)}catch(c){e==null||e(c)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(o=navigator==null?void 0:navigator.mediaDevices)==null||o.addEventListener("devicechange",a)}return()=>{var c;(c=navigator==null?void 0:navigator.mediaDevices)==null||c.removeEventListener("devicechange",a)}});return ah(i,r)}function aD(t){return ul(t,_.AudioPlaybackStatusChanged).pipe(Ct(e=>({canPlayAudio:e.canPlaybackAudio})))}function cD(t){return ul(t,_.VideoPlaybackStatusChanged).pipe(Ct(e=>({canPlayVideo:e.canPlaybackVideo})))}function lD(t,e){return hT(t,_.ActiveDeviceChanged).pipe(BI(([n])=>n===e),Ct(([n,i])=>(Ee.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:n,deviceId:i}),i)))}function fT(t,...e){return new _e(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(gn(t))}function Jf(t){return fT(t,A.TrackMuted,A.TrackUnmuted,A.ParticipantPermissionsChanged,A.TrackPublished,A.TrackUnpublished,A.LocalTrackPublished,A.LocalTrackUnpublished,A.MediaDevicesError,A.TrackSubscriptionStatusChanged).pipe(Ct(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(x.Source.Microphone),o=e.getTrackPublication(x.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function pT(t,e){return new _e(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function uD(t,e={}){var n;let i;const r=new _e(c=>(i=c,()=>a.unsubscribe())).pipe(gn(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:lT,o=Array.from(new Set([_.ParticipantConnected,_.ParticipantDisconnected,_.ConnectionStateChanged,...s])),a=ul(t,...o).subscribe(c=>i==null?void 0:i.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&(i==null||i.next(Array.from(t.remoteParticipants.values()))),r}function dD(t){return pT(t,A.ParticipantPermissionsChanged).pipe(Ct(()=>t.permissions),gn(t.permissions))}function rv(t){return typeof t>"u"?new _e:pT(t,A.AttributesChanged).pipe(Ct(([e])=>({changed:e,attributes:t.attributes})),gn({changed:t.attributes,attributes:t.attributes}))}function hD(t,e,n,i,r){const{localParticipant:s}=e,o=(u,d)=>{let h=!1;switch(u){case x.Source.Camera:h=d.isCameraEnabled;break;case x.Source.Microphone:h=d.isMicrophoneEnabled;break;case x.Source.ScreenShare:h=d.isScreenShareEnabled;break}return h},a=Jf(s).pipe(Ct(u=>o(t,u.participant)),gn(o(t,s))),c=new So,l=(u,d)=>er(this,null,function*(){try{switch(d??(d=n),c.next(!0),t){case x.Source.Camera:return yield s.setCameraEnabled(u??!s.isCameraEnabled,d,i),s.isCameraEnabled;case x.Source.Microphone:return yield s.setMicrophoneEnabled(u??!s.isMicrophoneEnabled,d,i),s.isMicrophoneEnabled;case x.Source.ScreenShare:return yield s.setScreenShareEnabled(u??!s.isScreenShareEnabled,d,i),s.isScreenShareEnabled;default:throw new TypeError("Tried to toggle unsupported source")}}catch(h){if(r&&h instanceof Error){r==null||r(h);return}else throw h}finally{c.next(!1)}});return{className:tr("button"),toggle:l,enabledObserver:a,pendingObserver:c.asObservable()}}function fD(){let t=!1;const e=new So,n=new So,i=r=>er(this,null,function*(){n.next(!0),t=r??!t,e.next(t),n.next(!1)});return{className:tr("button"),toggle:i,enabledObserver:e.asObservable(),pendingObserver:n.asObservable()}}function pD(t,e,n){const i=new vI(void 0),r=lD(e,t),s=(o,...a)=>er(this,[o,...a],function*(c,l={}){var u,d,h;if(e){Ee.debug(`Switching active device of kind "${t}" with id ${c}.`),yield e.switchActiveDevice(t,c,l.exact);const f=(u=e.getActiveDevice(t))!=null?u:c;f!==c&&c!=="default"&&Ee.info(`We tried to select the device with id (${c}), but the browser decided to select the device with id (${f}) instead.`);let g;t==="audioinput"?g=(d=e.localParticipant.getTrackPublication(x.Source.Microphone))==null?void 0:d.track:t==="videoinput"&&(g=(h=e.localParticipant.getTrackPublication(x.Source.Camera))==null?void 0:h.track);const m=c==="default"&&!g||c==="default"&&(g==null?void 0:g.mediaStreamTrack.label.startsWith("Default"));i.next(m?c:f)}});return{className:tr("media-device-select"),activeDeviceObservable:r,setActiveMediaDevice:s}}function mD(t){const e=n=>{t.disconnect(n)};return{className:tr("disconnect-button"),disconnect:e}}function gD(){const t=e=>er(this,null,function*(){Ee.info("Start Audio for room: ",e),yield e.startAudio()});return{className:tr("start-audio-button"),roomAudioPlaybackAllowedObservable:aD,handleStartAudioPlayback:t}}function vD(){const t=e=>er(this,null,function*(){Ee.info("Start Video for room: ",e),yield e.startVideo()});return{className:tr("start-audio-button"),roomVideoPlaybackAllowedObservable:cD,handleStartVideoPlayback:t}}function sv(t,e,n=!0){const i=[t.localParticipant,...Array.from(t.remoteParticipants.values())],r=[];return i.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));r.push(...a)})}),{trackReferences:r,participants:i}}function ov(t,e,n=!1){const{sources:i,kind:r,name:s}=e;return Array.from(t.trackPublications.values()).filter(o=>(!i||i.includes(o.source))&&(!r||o.kind===r)&&(!s||o.trackName===s)&&(!n||o.track)).map(o=>({participant:t,publication:o,source:o.source}))}function yD(t,e,n){var i,r;const s=(i=n.additionalRoomEvents)!=null?i:lT,o=(r=n.onlySubscribed)!=null?r:!0,a=Array.from(new Set([_.ParticipantConnected,_.ParticipantDisconnected,_.ConnectionStateChanged,_.LocalTrackPublished,_.LocalTrackUnpublished,_.TrackPublished,_.TrackUnpublished,_.TrackSubscriptionStatusChanged,...s]).values());return ul(t,...a).pipe(Ct(c=>{const l=sv(c,e,o);return Ee.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),gn(sv(t,e,o)))}function kD(t,e){return fT(t,...eD).pipe(Ct(n=>{const i=ov(n,e);return Ee.debug(`TrackReference[] was updated. (length ${i.length})`,i),i}),gn(ov(t,e)))}function mT(t,e){return new _e(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function bD(t){return mT(t,U.TranscriptionReceived)}function SD(t){return mT(t,U.TimeSyncUpdate).pipe(Ct(([e])=>e))}function TD(t,e){if(typeof localStorage>"u"){Ee.error("Local storage is not available.");return}try{if(e){const n=Object.fromEntries(Object.entries(e).filter(([,i])=>i!==""));localStorage.setItem(t,JSON.stringify(n))}}catch(n){Ee.error(`Error setting item to local storage: ${n}`)}}function CD(t){if(typeof localStorage>"u"){Ee.error("Local storage is not available.");return}try{const e=localStorage.getItem(t);if(!e){Ee.warn(`Item with key ${t} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){Ee.error(`Error getting item from local storage: ${e}`);return}}function wD(t){return{load:()=>CD(t),save:e=>TD(t,e)}}var PD=`${aT}-user-choices`,Ps={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"default",audioDeviceId:"default",username:""},{load:ED,save:xD}=wD(PD);function RD(t,e=!1){e!==!0&&xD(t)}function _D(t,e=!1){var n,i,r,s,o;const a={videoEnabled:(n=t==null?void 0:t.videoEnabled)!=null?n:Ps.videoEnabled,audioEnabled:(i=t==null?void 0:t.audioEnabled)!=null?i:Ps.audioEnabled,videoDeviceId:(r=t==null?void 0:t.videoDeviceId)!=null?r:Ps.videoDeviceId,audioDeviceId:(s=t==null?void 0:t.audioDeviceId)!=null?s:Ps.audioDeviceId,username:(o=t==null?void 0:t.username)!=null?o:Ps.username};if(e)return a;{const c=ED();return ch(ch({},a),c??{})}}T.createContext(void 0);const ID=T.createContext(void 0);function gT(){return T.useContext(ID)}function vT(t){const e=gT(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}const DD=T.createContext(void 0);function yT(){return T.useContext(DD)}const dl=T.createContext(void 0);function Yf(){const t=T.useContext(dl);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function hl(){return T.useContext(dl)}function as(t){const e=hl(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}T.createContext(void 0);function kT(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=kT(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function bT(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=kT(t))&&(i&&(i+=" "),i+=e);return i}function AD(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(i){console.error(i)}}}function Lo(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const i=t[n];for(const r in i){const s=e[r],o=i[r];typeof s=="function"&&typeof o=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=AD(s,o):(r==="className"||r==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[r]=bT(s,o):e[r]=o!==void 0?o:s}}return e}function MD(t){return t!==void 0}function fl(...t){return Lo(...t.filter(MD))}function OD(t,e,n){return T.Children.map(t,i=>T.isValidElement(i)&&T.Children.only(t)?(i.props.className&&(e??(e={}),e.className=bT(i.props.className,e.className),e.style={...i.props.style,...e.style}),T.cloneElement(i,{...e,key:n})):i)}function fn(t,e,n=!0){const[i,r]=T.useState(e);return T.useEffect(()=>{if(n&&r(e),typeof window>"u"||!t)return;const s=t.subscribe(r);return()=>s.unsubscribe()},[t,n]),i}function ST(t){const e=as(t),n=T.useMemo(()=>sD(e),[e]);return fn(n,e.state)}function LD(t){const e=Yf(),n=ST(e);return{buttonProps:T.useMemo(()=>{const{className:i,disconnect:r}=mD(e);return Lo(t,{className:i,onClick:()=>r(t.stopTracks??!0),disabled:n===Y.Disconnected})},[e,t,n])}}function No(t={}){const e=as(t.room),[n,i]=T.useState(e.localParticipant),[r,s]=T.useState(n.isMicrophoneEnabled),[o,a]=T.useState(n.isCameraEnabled),[c,l]=T.useState(n.isScreenShareEnabled),[u,d]=T.useState(n.lastMicrophoneError),[h,f]=T.useState(n.lastCameraError),[g,m]=T.useState(void 0),[S,p]=T.useState(void 0),v=y=>{a(y.isCameraEnabled),s(y.isMicrophoneEnabled),l(y.isScreenShareEnabled),p(y.cameraTrack),m(y.microphoneTrack),d(y.participant.lastMicrophoneError),f(y.participant.lastCameraError),i(y.participant)};return T.useEffect(()=>{const y=Jf(e.localParticipant).subscribe(v);return()=>y.unsubscribe()},[e]),{isMicrophoneEnabled:r,isScreenShareEnabled:c,isCameraEnabled:o,microphoneTrack:g,cameraTrack:S,lastMicrophoneError:u,lastCameraError:h,localParticipant:n}}function ND(){const t=Yf(),e=T.useMemo(()=>dD(t.localParticipant),[t]);return fn(e,t.localParticipant.permissions)}function UD({kind:t,room:e,track:n,requestPermissions:i,onError:r}){const s=hl(),o=T.useMemo(()=>e??s??new Un,[e,s]),a=T.useMemo(()=>oD(t,r,i),[t,i,r]),c=fn(a,[]),[l,u]=T.useState((o==null?void 0:o.getActiveDevice(t))??"default"),{className:d,activeDeviceObservable:h,setActiveMediaDevice:f}=T.useMemo(()=>pD(t,o),[t,o,n]);return T.useEffect(()=>{const g=h.subscribe(m=>{m&&(Ee.info("setCurrentDeviceId",m),u(m))});return()=>{g==null||g.unsubscribe()}},[h]),{devices:c,className:d,activeDeviceId:l,setActiveMediaDevice:f}}function TT(t={}){const e=as(t.room),[n,i]=T.useState([]);return T.useEffect(()=>{const r=uD(e,{additionalRoomEvents:t.updateOnlyOn}).subscribe(i);return()=>r.unsubscribe()},[e,JSON.stringify(t.updateOnlyOn)]),n}function FD({room:t,props:e}){const n=as(t),{className:i,roomAudioPlaybackAllowedObservable:r,handleStartAudioPlayback:s}=T.useMemo(()=>gD(),[]),o=T.useMemo(()=>r(n),[n,r]),{canPlayAudio:a}=fn(o,{canPlayAudio:n.canPlaybackAudio});return{mergedProps:T.useMemo(()=>Lo(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayAudio:a}}function jD({room:t,props:e}){const n=as(t),{className:i,roomVideoPlaybackAllowedObservable:r,handleStartVideoPlayback:s}=T.useMemo(()=>vD(),[]),o=T.useMemo(()=>r(n),[n,r]),{canPlayVideo:a}=fn(o,{canPlayVideo:n.canPlaybackVideo});return{mergedProps:T.useMemo(()=>Lo(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayVideo:a}}function VD({source:t,onChange:e,initialState:n,captureOptions:i,publishOptions:r,onDeviceError:s,...o}){var a;const c=hl(),l=(a=c==null?void 0:c.localParticipant)==null?void 0:a.getTrackPublication(t),u=T.useRef(!1),{toggle:d,className:h,pendingObserver:f,enabledObserver:g}=T.useMemo(()=>c?hD(t,c,i,r,s):fD(),[c,t,JSON.stringify(i),r]),m=fn(f,!1),S=fn(g,n??!!(l!=null&&l.isEnabled));T.useEffect(()=>{e==null||e(S,u.current),u.current=!1},[S,e]),T.useEffect(()=>{n!==void 0&&(Ee.debug("forcing initial toggle state",t,n),d(n))},[]);const p=T.useMemo(()=>Lo(o,{className:h}),[o,h]),v=T.useCallback(y=>{var b;u.current=!0,d().catch(()=>u.current=!1),(b=o.onClick)==null||b.call(o,y)},[o,d]);return{toggle:d,enabled:S,pending:m,track:l,buttonProps:{...p,"aria-pressed":S,"data-lk-source":t,"data-lk-enabled":S,disabled:m,onClick:v}}}function BD(t=[x.Source.Camera,x.Source.Microphone,x.Source.ScreenShare,x.Source.ScreenShareAudio,x.Source.Unknown],e={}){const n=as(e.room),[i,r]=T.useState([]),[s,o]=T.useState([]),a=T.useMemo(()=>t.map(c=>uT(c)?c.source:c),[JSON.stringify(t)]);return T.useEffect(()=>{const c=yD(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:u})=>{Ee.debug("setting track bundles",l,u),r(l),o(u)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),T.useMemo(()=>{if(dT(t)){const c=$D(t,s),l=Array.from(i);return s.forEach(u=>{c.has(u.identity)&&(c.get(u.identity)??[]).forEach(d=>{if(i.find(({participant:f,publication:g})=>u.identity===f.identity&&g.source===d))return;Ee.debug(`Add ${d} placeholder for participant ${u.identity}.`);const h={participant:u,source:d};l.push(h)})}),l}else return i},[i,s,t])}function zD(t,e){const n=new Set(t);for(const i of e)n.delete(i);return n}function $D(t,e){const n=new Map;if(dT(t)){const i=t.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const s=r.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(zD(new Set(i),new Set(s)));o.length>0&&n.set(r.identity,o)})}return n}function WD(t={}){const[e,n]=T.useState(_D(t.defaults,t.preventLoad??!1)),i=T.useCallback(c=>{n(l=>({...l,audioEnabled:c}))},[]),r=T.useCallback(c=>{n(l=>({...l,videoEnabled:c}))},[]),s=T.useCallback(c=>{n(l=>({...l,audioDeviceId:c}))},[]),o=T.useCallback(c=>{n(l=>({...l,videoDeviceId:c}))},[]),a=T.useCallback(c=>{n(l=>({...l,username:c}))},[]);return T.useEffect(()=>{RD(e,t.preventSave??!1)},[e,t.preventSave]),{userChoices:e,saveAudioInputEnabled:i,saveVideoInputEnabled:r,saveAudioInputDeviceId:s,saveVideoInputDeviceId:o,saveUsername:a}}const qD=t=>{const e=n=>{let i=1-Math.max(-100,Math.min(-10,n))*-1/100;return i=Math.sqrt(i),i};return t.map(n=>n===-1/0?0:e(n))},HD={bands:5,loPass:100,hiPass:600,updateInterval:32,analyserOptions:{fftSize:2048}};function KD(t,e={}){var n;const i=t instanceof x?t:(n=t==null?void 0:t.publication)==null?void 0:n.track,r={...HD,...e},[s,o]=T.useState(new Array(r.bands).fill(0));return T.useEffect(()=>{if(!i||!(i!=null&&i.mediaStream))return;const{analyser:a,cleanup:c}=Gx(i,r.analyserOptions),l=a.frequencyBinCount,u=new Float32Array(l),d=setInterval(()=>{a.getFloatFrequencyData(u);let h=new Float32Array(u.length);for(let S=0;S<u.length;S++)h[S]=u[S];h=h.slice(e.loPass,e.hiPass);const f=qD(h),g=Math.ceil(f.length/r.bands),m=[];for(let S=0;S<r.bands;S++){const p=f.slice(S*g,(S+1)*g).reduce((v,y)=>v+=y,0);m.push(p/g)}o(m)},r.updateInterval);return()=>{c(),clearInterval(d)}},[i,i==null?void 0:i.mediaStream,JSON.stringify(e)]),s}function av(t,e){const n=yT(),i=TT({updateOnlyOn:[]}),r=T.useMemo(()=>e?i.find(o=>o.identity===e):n,[e,i,n]),s=T.useMemo(()=>{if(r)return kD(r,{sources:t})},[r,JSON.stringify(t)]);return fn(s,[])}function GD(t){var e,n,i;const r=T.useMemo(()=>{var s;return(s=t==null?void 0:t.publication)!=null&&s.track?SD(t==null?void 0:t.publication.track):void 0},[(e=t==null?void 0:t.publication)==null?void 0:e.track]);return fn(r,{timestamp:Date.now(),rtpTimestamp:(i=(n=t==null?void 0:t.publication)==null?void 0:n.track)==null?void 0:i.rtpTimestamp})}const QD={bufferSize:100};function CT(t,e){const n={...QD,...e},[i,r]=T.useState([]),s=GD(t),o=a=>{var c;(c=n.onTranscription)==null||c.call(n,a),r(l=>iD(l,a.map(u=>nD(u,s)),n.bufferSize))};return T.useEffect(()=>{if(!(t!=null&&t.publication))return;const a=bD(t.publication).subscribe(c=>{o(...c)});return()=>{a.unsubscribe()}},[t&&cT(t),o]),{segments:i}}function JD(t={}){const e=yT(),n=t.participant??e,i=T.useMemo(()=>rv(n),[n]);return fn(i,{attributes:n==null?void 0:n.attributes})}const cv="lk.agent.state";function pl(){const t=TT(),e=t.find(d=>d.kind===qi.AGENT&&!("lk.publish_on_behalf"in d.attributes)),n=t.find(d=>d.kind===qi.AGENT&&d.attributes["lk.publish_on_behalf"]===(e==null?void 0:e.identity)),i=av([x.Source.Microphone,x.Source.Camera],e==null?void 0:e.identity),r=av([x.Source.Microphone,x.Source.Camera],n==null?void 0:n.identity),s=i.find(d=>d.source===x.Source.Microphone)??r.find(d=>d.source===x.Source.Microphone),o=i.find(d=>d.source===x.Source.Camera)??r.find(d=>d.source===x.Source.Camera),{segments:a}=CT(s),c=ST(),{attributes:l}=JD({participant:e}),u=T.useMemo(()=>c===Y.Disconnected?"disconnected":c===Y.Connecting||!e||!(l!=null&&l[cv])?"connecting":l[cv],[l,e,c]);return{agent:e,state:u,audioTrack:s,videoTrack:o,agentTranscriptions:a,agentAttributes:l}}const wT=T.forwardRef(function(t,e){const{buttonProps:n}=LD(t);return T.createElement("button",{ref:e,...n},t.children)}),YD=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),T.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),XD=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),ZD=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),T.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),eA=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),T.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),tA=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),nA=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},T.createElement("g",{fill:"currentColor"},T.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),T.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),fu=T.forwardRef(function({kind:t,initialSelection:e,onActiveDeviceChange:n,onDeviceListChange:i,onDeviceSelectError:r,exactMatch:s,track:o,requestPermissions:a,onError:c,...l},u){const d=hl(),h=T.useRef("default"),f=T.useCallback(w=>{d&&d.emit(_.MediaDevicesError,w),c==null||c(w)},[d,c]),{devices:g,activeDeviceId:m,setActiveMediaDevice:S,className:p}=UD({kind:t,room:d,track:o,requestPermissions:a,onError:f});T.useEffect(()=>{e!==void 0&&S(e)},[S]),T.useEffect(()=>{typeof i=="function"&&i(g)},[i,g]),T.useEffect(()=>{m!==h.current&&(n==null||n(m)),h.current=m},[m]);const v=async w=>{try{await S(w,{exact:s??!0})}catch(E){if(E instanceof Error)r==null||r(E);else throw E}},y=T.useMemo(()=>fl(l,{className:p},{className:"lk-list"}),[p,l]),b=!!g.find(w=>w.label.toLowerCase().startsWith("default"));function k(w,E,P){return w===E||!b&&P===0&&E==="default"}return T.createElement("ul",{ref:u,...y},g.map((w,E)=>T.createElement("li",{key:w.deviceId,id:w.deviceId,"data-lk-active":k(w.deviceId,m,E),"aria-selected":k(w.deviceId,m,E),role:"option"},T.createElement("button",{className:"lk-button",onClick:()=>v(w.deviceId)},w.label))))}),iA=T.forwardRef(function({label:t,...e},n){const i=Yf(),{mergedProps:r,canPlayAudio:s}=FD({room:i,props:e}),{mergedProps:o,canPlayVideo:a}=jD({room:i,props:r}),{style:c,...l}=o;return c.display=s&&a?"none":"block",T.createElement("button",{ref:n,style:c,...l},t??`Start ${s?"Video":"Audio"}`)});function rA(t,e){switch(t){case x.Source.Microphone:return e?T.createElement(eA,null):T.createElement(ZD,null);case x.Source.Camera:return e?T.createElement(XD,null):T.createElement(YD,null);case x.Source.ScreenShare:return e?T.createElement(nA,null):T.createElement(tA,null);default:return}}const sA=T.forwardRef(function({showIcon:t,...e},n){const{buttonProps:i,enabled:r}=VD(e),[s,o]=T.useState(!1);return T.useEffect(()=>{o(!0)},[]),s&&T.createElement("button",{ref:n,...i},(t??!0)&&rA(e.source,r),e.children)});function PT(t,e={}){const[n,i]=T.useState(lh(t)),[r,s]=T.useState(n==null?void 0:n.isMuted),[o,a]=T.useState(n==null?void 0:n.isSubscribed),[c,l]=T.useState(n==null?void 0:n.track),[u,d]=T.useState("landscape"),h=T.useRef(),{className:f,trackObserver:g}=T.useMemo(()=>rD(t),[t.participant.sid??t.participant.identity,t.source,Qf(t)&&t.publication.trackSid]);return T.useEffect(()=>{const m=g.subscribe(S=>{Ee.debug("update track",S),i(S),s(S==null?void 0:S.isMuted),a(S==null?void 0:S.isSubscribed),l(S==null?void 0:S.track)});return()=>m==null?void 0:m.unsubscribe()},[g]),T.useEffect(()=>{var m,S;return c&&(h.current&&c.detach(h.current),(m=e.element)!=null&&m.current&&!(t.participant.isLocal&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),h.current=(S=e.element)==null?void 0:S.current,()=>{h.current&&(c==null||c.detach(h.current))}},[c,e.element]),T.useEffect(()=>{var m,S;if(typeof((m=n==null?void 0:n.dimensions)==null?void 0:m.width)=="number"&&typeof((S=n==null?void 0:n.dimensions)==null?void 0:S.height)=="number"){const p=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(p)}},[n]),{publication:n,isMuted:r,isSubscribed:o,track:c,elementProps:fl(e.props,{className:f,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var pu,lv;function oA(){if(lv)return pu;lv=1;var t="Expected a function",e=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof aa=="object"&&aa&&aa.Object===Object&&aa,l=typeof self=="object"&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype,h=d.toString,f=Math.max,g=Math.min,m=function(){return u.Date.now()};function S(k,w,E){var P,D,I,O,V,H,ee=0,ut=!1,Ie=!1,J=!0;if(typeof k!="function")throw new TypeError(t);w=b(w)||0,p(E)&&(ut=!!E.leading,Ie="maxWait"in E,I=Ie?f(b(E.maxWait)||0,w):I,J="trailing"in E?!!E.trailing:J);function N(de){var Bn=P,us=D;return P=D=void 0,ee=de,O=k.apply(us,Bn),O}function z(de){return ee=de,V=setTimeout(re,w),ut?N(de):O}function $(de){var Bn=de-H,us=de-ee,Ap=w-Bn;return Ie?g(Ap,I-us):Ap}function ne(de){var Bn=de-H,us=de-ee;return H===void 0||Bn>=w||Bn<0||Ie&&us>=I}function re(){var de=m();if(ne(de))return vn(de);V=setTimeout(re,$(de))}function vn(de){return V=void 0,J&&P?N(de):(P=D=void 0,O)}function wt(){V!==void 0&&clearTimeout(V),ee=0,P=H=D=V=void 0}function yn(){return V===void 0?O:vn(m())}function Mt(){var de=m(),Bn=ne(de);if(P=arguments,D=this,H=de,Bn){if(V===void 0)return z(H);if(Ie)return V=setTimeout(re,w),N(H)}return V===void 0&&(V=setTimeout(re,w)),O}return Mt.cancel=wt,Mt.flush=yn,Mt}function p(k){var w=typeof k;return!!k&&(w=="object"||w=="function")}function v(k){return!!k&&typeof k=="object"}function y(k){return typeof k=="symbol"||v(k)&&h.call(k)==n}function b(k){if(typeof k=="number")return k;if(y(k))return e;if(p(k)){var w=typeof k.valueOf=="function"?k.valueOf():k;k=p(w)?w+"":w}if(typeof k!="string")return k===0?k:+k;k=k.replace(i,"");var E=s.test(k);return E||o.test(k)?a(k.slice(2),E?2:8):r.test(k)?e:+k}return pu=S,pu}var aA=oA();const uv=VS(aA);function cA(t){const e=T.useRef(t);e.current=t,T.useEffect(()=>()=>{e.current()},[])}function lA(t,e=500,n){const i=T.useRef();cA(()=>{i.current&&i.current.cancel()});const r=T.useMemo(()=>{const s=uv(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!i.current,o.flush=()=>s.flush(),o},[t,e,n]);return T.useEffect(()=>{i.current=uv(t,e,n)},[t,e,n]),r}function uA(t,e,n){const i=(l,u)=>l===u,r=t instanceof Function?t():t,[s,o]=T.useState(r),a=T.useRef(r),c=lA(o,e,n);return i(a.current,r)||(c(r),a.current=r),[s,c]}function dA({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:i=!1,initialIsIntersecting:r=!1,onChange:s}={}){var o;const[a,c]=T.useState(null),[l,u]=T.useState(()=>({isIntersecting:r,entry:void 0})),d=T.useRef();d.current=s;const h=((o=l.entry)==null?void 0:o.isIntersecting)&&i;T.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||h)return;const m=new IntersectionObserver(S=>{const p=Array.isArray(m.thresholds)?m.thresholds:[m.thresholds];S.forEach(v=>{const y=v.isIntersecting&&p.some(b=>v.intersectionRatio>=b);u({isIntersecting:y,entry:v}),d.current&&d.current(y,v)})},{threshold:t,root:e,rootMargin:n});return m.observe(a),()=>{m.disconnect()}},[a,JSON.stringify(t),e,n,h,i]);const f=T.useRef(null);T.useEffect(()=>{var m;!a&&(m=l.entry)!=null&&m.target&&!i&&!h&&f.current!==l.entry.target&&(f.current=l.entry.target,u({isIntersecting:r,entry:void 0}))},[a,l.entry,i,h,r]);const g=[c,!!l.isIntersecting,l.entry];return g.ref=g[0],g.isIntersecting=g[1],g.entry=g[2],g}const ET=T.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:i,manageSubscription:r,...s},o){const a=vT(i),c=T.useRef(null);T.useImperativeHandle(o,()=>c.current);const l=dA({root:c.current}),[u]=uA(l,3e3);T.useEffect(()=>{r&&a.publication instanceof bc&&(u==null?void 0:u.isIntersecting)===!1&&(l==null?void 0:l.isIntersecting)===!1&&a.publication.setSubscribed(!1)},[u,a,r]),T.useEffect(()=>{r&&a.publication instanceof bc&&(l==null?void 0:l.isIntersecting)===!0&&a.publication.setSubscribed(!0)},[l,a,r]);const{elementProps:d,publication:h,isSubscribed:f}=PT(a,{element:c,props:s});T.useEffect(()=>{n==null||n(!!f)},[f,n]);const g=m=>{e==null||e(m),t==null||t({participant:a==null?void 0:a.participant,track:h})};return T.createElement("video",{ref:c,...d,muted:!0,onClick:g})}),hA=T.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...i},r){const s=vT(t),o=T.useRef(null);T.useImperativeHandle(r,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:u}=PT(s,{element:o,props:i});return T.useEffect(()=>{e==null||e(!!c)},[c,e]),T.useEffect(()=>{l===void 0||n===void 0||(l instanceof PS?l.setVolume(n):Ee.warn("Volume can only be set on remote audio tracks."))},[n,l]),T.useEffect(()=>{u===void 0||i.muted===void 0||(u instanceof bc?u.setEnabled(!i.muted):Ee.warn("Can only call setEnabled on remote track publications."))},[i.muted,u,l]),T.createElement("audio",{ref:o,...a})});function fA({volume:t,muted:e}){const n=BD([x.Source.Microphone,x.Source.ScreenShareAudio,x.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(i=>!i.participant.isLocal&&i.publication.kind===x.Kind.Audio);return T.createElement("div",{style:{display:"none"}},n.map(i=>T.createElement(hA,{key:cT(i),trackRef:i,volume:t,muted:e})))}const pA=t=>{const e=[];for(let n=0;n<t;n++)e.push([n,t-1-n]);return e},dv=t=>[[Math.floor(t/2)],[-1]],mA=(t,e,n)=>{const[i,r]=T.useState(0),[s,o]=T.useState([[]]);T.useEffect(()=>{if(t==="thinking")o(dv(e));else if(t==="connecting"||t==="initializing"){const c=[...pA(e)];o(c)}else o(t==="listening"?dv(e):t===void 0||t==="speaking"?[new Array(e).fill(0).map((c,l)=>l)]:[[]]);r(0)},[t,e]);const a=T.useRef(null);return T.useEffect(()=>{let c=performance.now();const l=u=>{u-c>=n&&(r(d=>d+1),c=u),a.current=requestAnimationFrame(l)};return a.current=requestAnimationFrame(l),()=>{a.current!==null&&cancelAnimationFrame(a.current)}},[n,e,t,s.length]),s[i%s.length]},gA=new Map([["connecting",2e3],["initializing",2e3],["listening",500],["thinking",150]]),vA=(t,e)=>{if(t===void 0)return 1e3;let n=gA.get(t);if(n)switch(t){case"connecting":n/=e;break}return n},xT=T.forwardRef(function({state:t,options:e,barCount:n=15,trackRef:i,children:r,...s},o){const a=fl(s,{className:"lk-audio-bar-visualizer"});let c=gT();i&&(c=i);const l=KD(c,{bands:n,loPass:100,hiPass:200}),u=(e==null?void 0:e.minHeight)??20,d=(e==null?void 0:e.maxHeight)??100,h=mA(t,n,vA(t,n)??100);return T.createElement("div",{ref:o,...a,"data-lk-va-state":t},l.map((f,g)=>r?OD(r,{"data-lk-highlighted":h.includes(g),"data-lk-bar-index":g,className:"lk-audio-bar",style:{height:`${Math.min(d,Math.max(u,f*100+5))}%`}}):T.createElement("span",{key:g,"data-lk-highlighted":h.includes(g),"data-lk-bar-index":g,className:`lk-audio-bar ${h.includes(g)&&"lk-highlighted"}`,style:{height:`${Math.min(d,Math.max(u,f*100+5))}%`}})))});function yA({kind:t,initialSelection:e,onActiveDeviceChange:n,tracks:i,requestPermissions:r=!1,...s}){const[o,a]=T.useState(!1),[c,l]=T.useState([]),[u,d]=T.useState(!0),[h,f]=T.useState(r),g=(v,y)=>{Ee.debug("handle device change"),a(!1),n==null||n(v,y)},m=T.useRef(null),S=T.useRef(null);T.useLayoutEffect(()=>{o&&f(!0)},[o]),T.useLayoutEffect(()=>{let v;return m.current&&S.current&&(c||u)&&(v=YI(m.current,S.current,(y,b)=>{S.current&&Object.assign(S.current.style,{left:`${y}px`,top:`${b}px`})})),d(!1),()=>{v==null||v()}},[m,S,c,u]);const p=T.useCallback(v=>{S.current&&v.target!==m.current&&o&&XI(S.current,v)&&a(!1)},[o,S,m]);return T.useEffect(()=>(document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}),[p]),T.createElement(T.Fragment,null,T.createElement("button",{className:"lk-button lk-button-menu","aria-pressed":o,...s,onClick:()=>a(!o),ref:m},s.children),!s.disabled&&T.createElement("div",{className:"lk-device-menu",ref:S,style:{visibility:o?"visible":"hidden"}},t?T.createElement(fu,{initialSelection:e,onActiveDeviceChange:v=>g(t,v),onDeviceListChange:l,kind:t,track:i==null?void 0:i[t],requestPermissions:h}):T.createElement(T.Fragment,null,T.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),T.createElement(fu,{kind:"audioinput",onActiveDeviceChange:v=>g("audioinput",v),onDeviceListChange:l,track:i==null?void 0:i.audioinput,requestPermissions:h}),T.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),T.createElement(fu,{kind:"videoinput",onActiveDeviceChange:v=>g("videoinput",v),onDeviceListChange:l,track:i==null?void 0:i.videoinput,requestPermissions:h}))))}function kA({controls:t,saveUserChoices:e=!0,onDeviceError:n,...i}){const r={leave:!0,microphone:!0,...t},s=ND(),{microphoneTrack:o,localParticipant:a}=No(),c=T.useMemo(()=>({participant:a,source:x.Source.Microphone,publication:o}),[a,o]);s?r.microphone??(r.microphone=s.canPublish):r.microphone=!1;const l=fl({className:"lk-agent-control-bar"},i),{saveAudioInputEnabled:u,saveAudioInputDeviceId:d}=WD({preventSave:!e}),h=T.useCallback((f,g)=>{g&&u(f)},[u]);return T.createElement("div",{...l},r.microphone&&T.createElement("div",{className:"lk-button-group"},T.createElement(sA,{source:x.Source.Microphone,showIcon:!0,onChange:h,onDeviceError:f=>n==null?void 0:n({source:x.Source.Microphone,error:f})},T.createElement(xT,{trackRef:c,barCount:7,options:{minHeight:5}})),T.createElement("div",{className:"lk-button-group-menu"},T.createElement(yA,{kind:"audioinput",onActiveDeviceChange:(f,g)=>d(g??"default")}))),r.leave&&T.createElement(wT,null,"Disconnect"),T.createElement(iA,null))}const Xf=T.createContext({});function Zf(t){const e=T.useRef(null);return e.current===null&&(e.current=t()),e.current}const ml=T.createContext(null),ep=T.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class bA extends T.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function SA({children:t,isPresent:e}){const n=T.useId(),i=T.useRef(null),r=T.useRef({width:0,height:0,top:0,left:0}),{nonce:s}=T.useContext(ep);return T.useInsertionEffect(()=>{const{width:o,height:a,top:c,left:l}=r.current;if(e||!i.current||!o||!a)return;i.current.dataset.motionPopId=n;const u=document.createElement("style");return s&&(u.nonce=s),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${a}px !important;
            top: ${c}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[e]),F.jsx(bA,{isPresent:e,childRef:i,sizeRef:r,children:T.cloneElement(t,{ref:i})})}const TA=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:s,mode:o})=>{const a=Zf(CA),c=T.useId(),l=T.useCallback(d=>{a.set(d,!0);for(const h of a.values())if(!h)return;i&&i()},[a,i]),u=T.useMemo(()=>({id:c,initial:e,isPresent:n,custom:r,onExitComplete:l,register:d=>(a.set(d,!1),()=>a.delete(d))}),s?[Math.random(),l]:[n,l]);return T.useMemo(()=>{a.forEach((d,h)=>a.set(h,!1))},[n]),T.useEffect(()=>{!n&&!a.size&&i&&i()},[n]),o==="popLayout"&&(t=F.jsx(SA,{isPresent:n,children:t})),F.jsx(ml.Provider,{value:u,children:t})};function CA(){return new Map}function RT(t=!0){const e=T.useContext(ml);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,s=T.useId();T.useEffect(()=>{t&&r(s)},[t]);const o=T.useCallback(()=>t&&i&&i(s),[s,i,t]);return!n&&i?[!1,o]:[!0]}const la=t=>t.key||"";function hv(t){const e=[];return T.Children.forEach(t,n=>{T.isValidElement(n)&&e.push(n)}),e}const tp=typeof window<"u",_T=tp?T.useLayoutEffect:T.useEffect,uh=({children:t,custom:e,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:s="sync",propagate:o=!1})=>{const[a,c]=RT(o),l=T.useMemo(()=>hv(t),[t]),u=o&&!a?[]:l.map(la),d=T.useRef(!0),h=T.useRef(l),f=Zf(()=>new Map),[g,m]=T.useState(l),[S,p]=T.useState(l);_T(()=>{d.current=!1,h.current=l;for(let b=0;b<S.length;b++){const k=la(S[b]);u.includes(k)?f.delete(k):f.get(k)!==!0&&f.set(k,!1)}},[S,u.length,u.join("-")]);const v=[];if(l!==g){let b=[...l];for(let k=0;k<S.length;k++){const w=S[k],E=la(w);u.includes(E)||(b.splice(k,0,w),v.push(w))}s==="wait"&&v.length&&(b=v),p(hv(b)),m(l);return}const{forceRender:y}=T.useContext(Xf);return F.jsx(F.Fragment,{children:S.map(b=>{const k=la(b),w=o&&!a?!1:l===S||u.includes(k),E=()=>{if(f.has(k))f.set(k,!0);else return;let P=!0;f.forEach(D=>{D||(P=!1)}),P&&(y==null||y(),p(h.current),o&&(c==null||c()),i&&i())};return F.jsx(TA,{isPresent:w,initial:!d.current||n?void 0:!1,custom:w?void 0:e,presenceAffectsLayout:r,mode:s,onExitComplete:w?void 0:E,children:b},k)})})},yt=t=>t;let IT=yt;function np(t){let e;return()=>(e===void 0&&(e=t()),e)}const Zr=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i},In=t=>t*1e3,Dn=t=>t/1e3,wA={skipAnimations:!1,useManualTiming:!1};function PA(t){let e=new Set,n=new Set,i=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(l){s.has(l)&&(c.schedule(l),t()),l(o)}const c={schedule:(l,u=!1,d=!1)=>{const f=d&&i?e:n;return u&&s.add(l),f.has(l)||f.add(l),l},cancel:l=>{n.delete(l),s.delete(l)},process:l=>{if(o=l,i){r=!0;return}i=!0,[e,n]=[n,e],e.forEach(a),e.clear(),i=!1,r&&(r=!1,c.process(l))}};return c}const ua=["read","resolveKeyframes","update","preRender","render","postRender"],EA=40;function DT(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,o=ua.reduce((p,v)=>(p[v]=PA(s),p),{}),{read:a,resolveKeyframes:c,update:l,preRender:u,render:d,postRender:h}=o,f=()=>{const p=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(p-r.timestamp,EA),1),r.timestamp=p,r.isProcessing=!0,a.process(r),c.process(r),l.process(r),u.process(r),d.process(r),h.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(f))},g=()=>{n=!0,i=!0,r.isProcessing||t(f)};return{schedule:ua.reduce((p,v)=>{const y=o[v];return p[v]=(b,k=!1,w=!1)=>(n||g(),y.schedule(b,k,w)),p},{}),cancel:p=>{for(let v=0;v<ua.length;v++)o[ua[v]].cancel(p)},state:r,steps:o}}const{schedule:ue,cancel:mi,state:Ve,steps:mu}=DT(typeof requestAnimationFrame<"u"?requestAnimationFrame:yt,!0),AT=T.createContext({strict:!1}),fv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},es={};for(const t in fv)es[t]={isEnabled:e=>fv[t].some(n=>!!e[n])};function xA(t){for(const e in t)es[e]={...es[e],...t[e]}}const RA=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function _c(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||RA.has(t)}let MT=t=>!_c(t);function _A(t){t&&(MT=e=>e.startsWith("on")?!_c(e):t(e))}try{_A(require("@emotion/is-prop-valid").default)}catch{}function IA(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(MT(r)||n===!0&&_c(r)||!e&&!_c(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}function DA(t){if(typeof Proxy>"u")return t;const e=new Map,n=(...i)=>t(...i);return new Proxy(n,{get:(i,r)=>r==="create"?t:(e.has(r)||e.set(r,t(r)),e.get(r))})}const gl=T.createContext({});function To(t){return typeof t=="string"||Array.isArray(t)}function vl(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const ip=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rp=["initial",...ip];function yl(t){return vl(t.animate)||rp.some(e=>To(t[e]))}function OT(t){return!!(yl(t)||t.variants)}function AA(t,e){if(yl(t)){const{initial:n,animate:i}=t;return{initial:n===!1||To(n)?n:void 0,animate:To(i)?i:void 0}}return t.inherit!==!1?e:{}}function MA(t){const{initial:e,animate:n}=AA(t,T.useContext(gl));return T.useMemo(()=>({initial:e,animate:n}),[pv(e),pv(n)])}function pv(t){return Array.isArray(t)?t.join(" "):t}const OA=Symbol.for("motionComponentSymbol");function Tr(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function LA(t,e,n){return T.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):Tr(n)&&(n.current=i))},[e])}const sp=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),NA="framerAppearId",LT="data-"+sp(NA),{schedule:op,cancel:h2}=DT(queueMicrotask,!1),NT=T.createContext({});function UA(t,e,n,i,r){var s,o;const{visualElement:a}=T.useContext(gl),c=T.useContext(AT),l=T.useContext(ml),u=T.useContext(ep).reducedMotion,d=T.useRef(null);i=i||c.renderer,!d.current&&i&&(d.current=i(t,{visualState:e,parent:a,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:u}));const h=d.current,f=T.useContext(NT);h&&!h.projection&&r&&(h.type==="html"||h.type==="svg")&&FA(d.current,n,r,f);const g=T.useRef(!1);T.useInsertionEffect(()=>{h&&g.current&&h.update(n,l)});const m=n[LT],S=T.useRef(!!m&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,m))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,m)));return _T(()=>{h&&(g.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),op.render(h.render),S.current&&h.animationState&&h.animationState.animateChanges())}),T.useEffect(()=>{h&&(!S.current&&h.animationState&&h.animationState.animateChanges(),S.current&&(queueMicrotask(()=>{var p;(p=window.MotionHandoffMarkAsComplete)===null||p===void 0||p.call(window,m)}),S.current=!1))}),h}function FA(t,e,n,i){const{layoutId:r,layout:s,drag:o,dragConstraints:a,layoutScroll:c,layoutRoot:l}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:UT(t.parent)),t.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!o||a&&Tr(a),visualElement:t,animationType:typeof s=="string"?s:"both",initialPromotionConfig:i,layoutScroll:c,layoutRoot:l})}function UT(t){if(t)return t.options.allowProjection!==!1?t.projection:UT(t.parent)}function jA({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:i,Component:r}){var s,o;t&&xA(t);function a(l,u){let d;const h={...T.useContext(ep),...l,layoutId:VA(l)},{isStatic:f}=h,g=MA(l),m=i(l,f);if(!f&&tp){BA();const S=zA(h);d=S.MeasureLayout,g.visualElement=UA(r,m,h,e,S.ProjectionNode)}return F.jsxs(gl.Provider,{value:g,children:[d&&g.visualElement?F.jsx(d,{visualElement:g.visualElement,...h}):null,n(r,l,LA(m,g.visualElement,u),m,f,g.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(s=r.displayName)!==null&&s!==void 0?s:r.name)!==null&&o!==void 0?o:""})`}`;const c=T.forwardRef(a);return c[OA]=r,c}function VA({layoutId:t}){const e=T.useContext(Xf).id;return e&&t!==void 0?e+"-"+t:t}function BA(t,e){T.useContext(AT).strict}function zA(t){const{drag:e,layout:n}=es;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const $A=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ap(t){return typeof t!="string"||t.includes("-")?!1:!!($A.indexOf(t)>-1||/[A-Z]/u.test(t))}function mv(t){const e=[{},{}];return t==null||t.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function cp(t,e,n,i){if(typeof e=="function"){const[r,s]=mv(i);e=e(n!==void 0?n:t.custom,r,s)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,s]=mv(i);e=e(n!==void 0?n:t.custom,r,s)}return e}const dh=t=>Array.isArray(t),WA=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),qA=t=>dh(t)?t[t.length-1]||0:t,Ge=t=>!!(t&&t.getVelocity);function Va(t){const e=Ge(t)?t.get():t;return WA(e)?e.toValue():e}function HA({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:n},i,r,s){const o={latestValues:KA(i,r,s,t),renderState:e()};return n&&(o.onMount=a=>n({props:i,current:a,...o}),o.onUpdate=a=>n(a)),o}const FT=t=>(e,n)=>{const i=T.useContext(gl),r=T.useContext(ml),s=()=>HA(t,e,i,r);return n?s():Zf(s)};function KA(t,e,n,i){const r={},s=i(t,{});for(const h in s)r[h]=Va(s[h]);let{initial:o,animate:a}=t;const c=yl(t),l=OT(t);e&&l&&!c&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!vl(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const g=cp(t,h[f]);if(g){const{transitionEnd:m,transition:S,...p}=g;for(const v in p){let y=p[v];if(Array.isArray(y)){const b=u?y.length-1:0;y=y[b]}y!==null&&(r[v]=y)}for(const v in m)r[v]=m[v]}}}return r}const cs=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],nr=new Set(cs),jT=t=>e=>typeof e=="string"&&e.startsWith(t),VT=jT("--"),GA=jT("var(--"),lp=t=>GA(t)?QA.test(t.split("/*")[0].trim()):!1,QA=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,BT=(t,e)=>e&&typeof t=="number"?e.transform(t):t,Fn=(t,e,n)=>n>e?e:n<t?t:n,ls={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Co={...ls,transform:t=>Fn(0,1,t)},da={...ls,default:1},Uo=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Hn=Uo("deg"),cn=Uo("%"),W=Uo("px"),JA=Uo("vh"),YA=Uo("vw"),gv={...cn,parse:t=>cn.parse(t)/100,transform:t=>cn.transform(t*100)},XA={borderWidth:W,borderTopWidth:W,borderRightWidth:W,borderBottomWidth:W,borderLeftWidth:W,borderRadius:W,radius:W,borderTopLeftRadius:W,borderTopRightRadius:W,borderBottomRightRadius:W,borderBottomLeftRadius:W,width:W,maxWidth:W,height:W,maxHeight:W,top:W,right:W,bottom:W,left:W,padding:W,paddingTop:W,paddingRight:W,paddingBottom:W,paddingLeft:W,margin:W,marginTop:W,marginRight:W,marginBottom:W,marginLeft:W,backgroundPositionX:W,backgroundPositionY:W},ZA={rotate:Hn,rotateX:Hn,rotateY:Hn,rotateZ:Hn,scale:da,scaleX:da,scaleY:da,scaleZ:da,skew:Hn,skewX:Hn,skewY:Hn,distance:W,translateX:W,translateY:W,translateZ:W,x:W,y:W,z:W,perspective:W,transformPerspective:W,opacity:Co,originX:gv,originY:gv,originZ:W},vv={...ls,transform:Math.round},up={...XA,...ZA,zIndex:vv,size:W,fillOpacity:Co,strokeOpacity:Co,numOctaves:vv},eM={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},tM=cs.length;function nM(t,e,n){let i="",r=!0;for(let s=0;s<tM;s++){const o=cs[s],a=t[o];if(a===void 0)continue;let c=!0;if(typeof a=="number"?c=a===(o.startsWith("scale")?1:0):c=parseFloat(a)===0,!c||n){const l=BT(a,up[o]);if(!c){r=!1;const u=eM[o]||o;i+=`${u}(${l}) `}n&&(e[o]=l)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function dp(t,e,n){const{style:i,vars:r,transformOrigin:s}=t;let o=!1,a=!1;for(const c in e){const l=e[c];if(nr.has(c)){o=!0;continue}else if(VT(c)){r[c]=l;continue}else{const u=BT(l,up[c]);c.startsWith("origin")?(a=!0,s[c]=u):i[c]=u}}if(e.transform||(o||n?i.transform=nM(e,t.transform,n):i.transform&&(i.transform="none")),a){const{originX:c="50%",originY:l="50%",originZ:u=0}=s;i.transformOrigin=`${c} ${l} ${u}`}}const iM={offset:"stroke-dashoffset",array:"stroke-dasharray"},rM={offset:"strokeDashoffset",array:"strokeDasharray"};function sM(t,e,n=1,i=0,r=!0){t.pathLength=1;const s=r?iM:rM;t[s.offset]=W.transform(-i);const o=W.transform(e),a=W.transform(n);t[s.array]=`${o} ${a}`}function yv(t,e,n){return typeof t=="string"?t:W.transform(e+n*t)}function oM(t,e,n){const i=yv(e,t.x,t.width),r=yv(n,t.y,t.height);return`${i} ${r}`}function hp(t,{attrX:e,attrY:n,attrScale:i,originX:r,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:c=0,...l},u,d){if(dp(t,l,d),u){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:f,dimensions:g}=t;h.transform&&(g&&(f.transform=h.transform),delete h.transform),g&&(r!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=oM(g,r!==void 0?r:.5,s!==void 0?s:.5)),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),i!==void 0&&(h.scale=i),o!==void 0&&sM(h,o,a,c,!1)}const fp=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),zT=()=>({...fp(),attrs:{}}),pp=t=>typeof t=="string"&&t.toLowerCase()==="svg";function $T(t,{style:e,vars:n},i,r){Object.assign(t.style,e,r&&r.getProjectionStyles(i));for(const s in n)t.style.setProperty(s,n[s])}const WT=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function qT(t,e,n,i){$T(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(WT.has(r)?r:sp(r),e.attrs[r])}const Ic={};function aM(t){Object.assign(Ic,t)}function HT(t,{layout:e,layoutId:n}){return nr.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!Ic[t]||t==="opacity")}function mp(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(Ge(r[o])||e.style&&Ge(e.style[o])||HT(o,t)||((i=n==null?void 0:n.getValue(o))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}function KT(t,e,n){const i=mp(t,e,n);for(const r in t)if(Ge(t[r])||Ge(e[r])){const s=cs.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[s]=t[r]}return i}function cM(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const kv=["x","y","width","height","cx","cy","r"],lM={useVisualState:FT({scrapeMotionValuesFromProps:KT,createRenderState:zT,onUpdate:({props:t,prevProps:e,current:n,renderState:i,latestValues:r})=>{if(!n)return;let s=!!t.drag;if(!s){for(const a in r)if(nr.has(a)){s=!0;break}}if(!s)return;let o=!e;if(e)for(let a=0;a<kv.length;a++){const c=kv[a];t[c]!==e[c]&&(o=!0)}o&&ue.read(()=>{cM(n,i),ue.render(()=>{hp(i,r,pp(n.tagName),t.transformTemplate),qT(n,i)})})}})},uM={useVisualState:FT({scrapeMotionValuesFromProps:mp,createRenderState:fp})};function GT(t,e,n){for(const i in e)!Ge(e[i])&&!HT(i,n)&&(t[i]=e[i])}function dM({transformTemplate:t},e){return T.useMemo(()=>{const n=fp();return dp(n,e,t),Object.assign({},n.vars,n.style)},[e])}function hM(t,e){const n=t.style||{},i={};return GT(i,n,t),Object.assign(i,dM(t,e)),i}function fM(t,e){const n={},i=hM(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}function pM(t,e,n,i){const r=T.useMemo(()=>{const s=zT();return hp(s,e,pp(i),t.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(t.style){const s={};GT(s,t.style,t),r.style={...s,...r.style}}return r}function mM(t=!1){return(n,i,r,{latestValues:s},o)=>{const c=(ap(n)?pM:fM)(i,s,o,n),l=IA(i,typeof n=="string",t),u=n!==T.Fragment?{...l,...c,ref:r}:{},{children:d}=i,h=T.useMemo(()=>Ge(d)?d.get():d,[d]);return T.createElement(n,{...u,children:h})}}function gM(t,e){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...ap(i)?lM:uM,preloadedFeatures:t,useRender:mM(r),createVisualElement:e,Component:i};return jA(o)}}function QT(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function kl(t,e,n){const i=t.getProps();return cp(i,e,n!==void 0?n:i.custom,t)}const vM=np(()=>window.ScrollTimeline!==void 0);class yM{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=n}attachTimeline(e,n){const i=this.animations.map(r=>{if(vM()&&r.attachTimeline)return r.attachTimeline(e);if(typeof n=="function")return n(r)});return()=>{i.forEach((r,s)=>{r&&r(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class kM extends yM{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}function gp(t,e){return t?t[e]||t.default||t:void 0}const hh=2e4;function JT(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<hh;)e+=n,i=t.next(e);return e>=hh?1/0:e}function vp(t){return typeof t=="function"}function bv(t,e){t.timeline=e,t.onfinish=null}const yp=t=>Array.isArray(t)&&typeof t[0]=="number",bM={linearEasing:void 0};function SM(t,e){const n=np(t);return()=>{var i;return(i=bM[e])!==null&&i!==void 0?i:n()}}const Dc=SM(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),YT=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let s=0;s<r;s++)i+=t(Zr(0,r-1,s))+", ";return`linear(${i.substring(0,i.length-2)})`};function XT(t){return!!(typeof t=="function"&&Dc()||!t||typeof t=="string"&&(t in fh||Dc())||yp(t)||Array.isArray(t)&&t.every(XT))}const Ms=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,fh={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ms([0,.65,.55,1]),circOut:Ms([.55,0,1,.45]),backIn:Ms([.31,.01,.66,-.59]),backOut:Ms([.33,1.53,.69,.99])};function ZT(t,e){if(t)return typeof t=="function"&&Dc()?YT(t,e):yp(t)?Ms(t):Array.isArray(t)?t.map(n=>ZT(n,e)||fh.easeOut):fh[t]}const Ut={x:!1,y:!1};function eC(){return Ut.x||Ut.y}function TM(t,e,n){var i;if(t instanceof Element)return[t];if(typeof t=="string"){let r=document;e&&(r=e.current);const s=(i=n==null?void 0:n[t])!==null&&i!==void 0?i:r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}function tC(t,e){const n=TM(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function Sv(t){return e=>{e.pointerType==="touch"||eC()||t(e)}}function CM(t,e,n={}){const[i,r,s]=tC(t,n),o=Sv(a=>{const{target:c}=a,l=e(a);if(typeof l!="function"||!c)return;const u=Sv(d=>{l(d),c.removeEventListener("pointerleave",u)});c.addEventListener("pointerleave",u,r)});return i.forEach(a=>{a.addEventListener("pointerenter",o,r)}),s}const nC=(t,e)=>e?t===e?!0:nC(t,e.parentElement):!1,kp=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,wM=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function PM(t){return wM.has(t.tagName)||t.tabIndex!==-1}const Os=new WeakSet;function Tv(t){return e=>{e.key==="Enter"&&t(e)}}function gu(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const EM=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=Tv(()=>{if(Os.has(n))return;gu(n,"down");const r=Tv(()=>{gu(n,"up")}),s=()=>gu(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",s,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function Cv(t){return kp(t)&&!eC()}function xM(t,e,n={}){const[i,r,s]=tC(t,n),o=a=>{const c=a.currentTarget;if(!Cv(a)||Os.has(c))return;Os.add(c);const l=e(a),u=(f,g)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),!(!Cv(f)||!Os.has(c))&&(Os.delete(c),typeof l=="function"&&l(f,{success:g}))},d=f=>{u(f,n.useGlobalTarget||nC(c,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",d,r),window.addEventListener("pointercancel",h,r)};return i.forEach(a=>{!PM(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",l=>EM(l,r),r)}),s}function RM(t){return t==="x"||t==="y"?Ut[t]?null:(Ut[t]=!0,()=>{Ut[t]=!1}):Ut.x||Ut.y?null:(Ut.x=Ut.y=!0,()=>{Ut.x=Ut.y=!1})}const iC=new Set(["width","height","top","left","right","bottom",...cs]);let Ba;function _M(){Ba=void 0}const ln={now:()=>(Ba===void 0&&ln.set(Ve.isProcessing||wA.useManualTiming?Ve.timestamp:performance.now()),Ba),set:t=>{Ba=t,queueMicrotask(_M)}};function bp(t,e){t.indexOf(e)===-1&&t.push(e)}function Sp(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Tp{constructor(){this.subscriptions=[]}add(e){return bp(this.subscriptions,e),()=>Sp(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let s=0;s<r;s++){const o=this.subscriptions[s];o&&o(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function rC(t,e){return e?t*(1e3/e):0}const wv=30,IM=t=>!isNaN(parseFloat(t));class DM{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const s=ln.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=ln.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=IM(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Tp);const i=this.events[e].add(n);return e==="change"?()=>{i(),ue.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=ln.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>wv)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,wv);return rC(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wo(t,e){return new DM(t,e)}function AM(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,wo(n))}function MM(t,e){const n=kl(t,e);let{transitionEnd:i={},transition:r={},...s}=n||{};s={...s,...i};for(const o in s){const a=qA(s[o]);AM(t,o,a)}}function OM(t){return!!(Ge(t)&&t.add)}function ph(t,e){const n=t.getValue("willChange");if(OM(n))return n.add(e)}function sC(t){return t.props[LT]}const oC=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,LM=1e-7,NM=12;function UM(t,e,n,i,r){let s,o,a=0;do o=e+(n-e)/2,s=oC(o,i,r)-t,s>0?n=o:e=o;while(Math.abs(s)>LM&&++a<NM);return o}function Fo(t,e,n,i){if(t===e&&n===i)return yt;const r=s=>UM(s,0,1,t,n);return s=>s===0||s===1?s:oC(r(s),e,i)}const aC=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,cC=t=>e=>1-t(1-e),lC=Fo(.33,1.53,.69,.99),Cp=cC(lC),uC=aC(Cp),dC=t=>(t*=2)<1?.5*Cp(t):.5*(2-Math.pow(2,-10*(t-1))),wp=t=>1-Math.sin(Math.acos(t)),hC=cC(wp),fC=aC(wp),pC=t=>/^0[^.\s]+$/u.test(t);function FM(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||pC(t):!0}const Gs=t=>Math.round(t*1e5)/1e5,Pp=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function jM(t){return t==null}const VM=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ep=(t,e)=>n=>!!(typeof n=="string"&&VM.test(n)&&n.startsWith(t)||e&&!jM(n)&&Object.prototype.hasOwnProperty.call(n,e)),mC=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,s,o,a]=i.match(Pp);return{[t]:parseFloat(r),[e]:parseFloat(s),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},BM=t=>Fn(0,255,t),vu={...ls,transform:t=>Math.round(BM(t))},Ai={test:Ep("rgb","red"),parse:mC("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+vu.transform(t)+", "+vu.transform(e)+", "+vu.transform(n)+", "+Gs(Co.transform(i))+")"};function zM(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const mh={test:Ep("#"),parse:zM,transform:Ai.transform},Cr={test:Ep("hsl","hue"),parse:mC("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+cn.transform(Gs(e))+", "+cn.transform(Gs(n))+", "+Gs(Co.transform(i))+")"},He={test:t=>Ai.test(t)||mh.test(t)||Cr.test(t),parse:t=>Ai.test(t)?Ai.parse(t):Cr.test(t)?Cr.parse(t):mh.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Ai.transform(t):Cr.transform(t)},$M=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function WM(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Pp))===null||e===void 0?void 0:e.length)||0)+(((n=t.match($M))===null||n===void 0?void 0:n.length)||0)>0}const gC="number",vC="color",qM="var",HM="var(",Pv="${}",KM=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Po(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let s=0;const a=e.replace(KM,c=>(He.test(c)?(i.color.push(s),r.push(vC),n.push(He.parse(c))):c.startsWith(HM)?(i.var.push(s),r.push(qM),n.push(c)):(i.number.push(s),r.push(gC),n.push(parseFloat(c))),++s,Pv)).split(Pv);return{values:n,split:a,indexes:i,types:r}}function yC(t){return Po(t).values}function kC(t){const{split:e,types:n}=Po(t),i=e.length;return r=>{let s="";for(let o=0;o<i;o++)if(s+=e[o],r[o]!==void 0){const a=n[o];a===gC?s+=Gs(r[o]):a===vC?s+=He.transform(r[o]):s+=r[o]}return s}}const GM=t=>typeof t=="number"?0:t;function QM(t){const e=yC(t);return kC(t)(e.map(GM))}const gi={test:WM,parse:yC,createTransformer:kC,getAnimatableNone:QM},JM=new Set(["brightness","contrast","saturate","opacity"]);function YM(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(Pp)||[];if(!i)return t;const r=n.replace(i,"");let s=JM.has(e)?1:0;return i!==n&&(s*=100),e+"("+s+r+")"}const XM=/\b([a-z-]*)\(.*?\)/gu,gh={...gi,getAnimatableNone:t=>{const e=t.match(XM);return e?e.map(YM).join(" "):t}},ZM={...up,color:He,backgroundColor:He,outlineColor:He,fill:He,stroke:He,borderColor:He,borderTopColor:He,borderRightColor:He,borderBottomColor:He,borderLeftColor:He,filter:gh,WebkitFilter:gh},xp=t=>ZM[t];function bC(t,e){let n=xp(t);return n!==gh&&(n=gi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const eO=new Set(["auto","none","0"]);function tO(t,e,n){let i=0,r;for(;i<t.length&&!r;){const s=t[i];typeof s=="string"&&!eO.has(s)&&Po(s).values.length&&(r=t[i]),i++}if(r&&n)for(const s of e)t[s]=bC(n,r)}const Ev=t=>t===ls||t===W,xv=(t,e)=>parseFloat(t.split(", ")[e]),Rv=(t,e)=>(n,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return xv(r[1],e);{const s=i.match(/^matrix\((.+)\)$/u);return s?xv(s[1],t):0}},nO=new Set(["x","y","z"]),iO=cs.filter(t=>!nO.has(t));function rO(t){const e=[];return iO.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const ts={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:Rv(4,13),y:Rv(5,14)};ts.translateX=ts.x;ts.translateY=ts.y;const Fi=new Set;let vh=!1,yh=!1;function SC(){if(yh){const t=Array.from(Fi).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=rO(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([s,o])=>{var a;(a=i.getValue(s))===null||a===void 0||a.set(o)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}yh=!1,vh=!1,Fi.forEach(t=>t.complete()),Fi.clear()}function TC(){Fi.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(yh=!0)})}function sO(){TC(),SC()}class Rp{constructor(e,n,i,r,s,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=s,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Fi.add(this),vh||(vh=!0,ue.read(TC),ue.resolveKeyframes(SC))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;for(let s=0;s<e.length;s++)if(e[s]===null)if(s===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&n){const c=i.readValue(n,a);c!=null&&(e[0]=c)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Fi.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Fi.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const CC=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),oO=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function aO(t){const e=oO.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function wC(t,e,n=1){const[i,r]=aO(t);if(!i)return;const s=window.getComputedStyle(e).getPropertyValue(i);if(s){const o=s.trim();return CC(o)?parseFloat(o):o}return lp(r)?wC(r,e,n+1):r}const PC=t=>e=>e.test(t),cO={test:t=>t==="auto",parse:t=>t},EC=[ls,W,cn,Hn,YA,JA,cO],_v=t=>EC.find(PC(t));class xC extends Rp{constructor(e,n,i,r,s){super(e,n,i,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let l=e[c];if(typeof l=="string"&&(l=l.trim(),lp(l))){const u=wC(l,n.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=l)}}if(this.resolveNoneKeyframes(),!iC.has(i)||e.length!==2)return;const[r,s]=e,o=_v(r),a=_v(s);if(o!==a)if(Ev(o)&&Ev(a))for(let c=0;c<e.length;c++){const l=e[c];typeof l=="string"&&(e[c]=parseFloat(l))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)FM(e[r])&&i.push(r);i.length&&tO(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ts[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:i,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const s=n.getValue(i);s&&s.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=ts[i](n.measureViewportBox(),window.getComputedStyle(n.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([c,l])=>{n.getValue(c).set(l)}),this.resolveNoneKeyframes()}}const Iv=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(gi.test(t)||t==="0")&&!t.startsWith("url("));function lO(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function uO(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=t[t.length-1],o=Iv(r,e),a=Iv(s,e);return!o||!a?!1:lO(t)||(n==="spring"||vp(n))&&i}const dO=t=>t!==null;function bl(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(dO),s=e&&n!=="loop"&&e%2===1?0:r.length-1;return!s||i===void 0?r[s]:i}const hO=40;class RC{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ln.now(),this.options={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:s,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>hO?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&sO(),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=ln.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:s,delay:o,onComplete:a,onUpdate:c,isGenerator:l}=this.options;if(!l&&!uO(e,i,r,s))if(o)this.options.duration=0;else{c&&c(bl(e,this.options,n)),a&&a(),this.resolveFinishedPromise();return}const u=this.initPlayback(e,n);u!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...u},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const me=(t,e,n)=>t+(e-t)*n;function yu(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function fO({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,s=0,o=0;if(!e)r=s=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,c=2*n-a;r=yu(c,a,t+1/3),s=yu(c,a,t),o=yu(c,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:i}}function Ac(t,e){return n=>n>0?e:t}const ku=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},pO=[mh,Ai,Cr],mO=t=>pO.find(e=>e.test(t));function Dv(t){const e=mO(t);if(!e)return!1;let n=e.parse(t);return e===Cr&&(n=fO(n)),n}const Av=(t,e)=>{const n=Dv(t),i=Dv(e);if(!n||!i)return Ac(t,e);const r={...n};return s=>(r.red=ku(n.red,i.red,s),r.green=ku(n.green,i.green,s),r.blue=ku(n.blue,i.blue,s),r.alpha=me(n.alpha,i.alpha,s),Ai.transform(r))},gO=(t,e)=>n=>e(t(n)),jo=(...t)=>t.reduce(gO),kh=new Set(["none","hidden"]);function vO(t,e){return kh.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function yO(t,e){return n=>me(t,e,n)}function _p(t){return typeof t=="number"?yO:typeof t=="string"?lp(t)?Ac:He.test(t)?Av:SO:Array.isArray(t)?_C:typeof t=="object"?He.test(t)?Av:kO:Ac}function _C(t,e){const n=[...t],i=n.length,r=t.map((s,o)=>_p(s)(s,e[o]));return s=>{for(let o=0;o<i;o++)n[o]=r[o](s);return n}}function kO(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=_p(t[r])(t[r],e[r]));return r=>{for(const s in i)n[s]=i[s](r);return n}}function bO(t,e){var n;const i=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const o=e.types[s],a=t.indexes[o][r[o]],c=(n=t.values[a])!==null&&n!==void 0?n:0;i[s]=c,r[o]++}return i}const SO=(t,e)=>{const n=gi.createTransformer(e),i=Po(t),r=Po(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?kh.has(t)&&!r.values.length||kh.has(e)&&!i.values.length?vO(t,e):jo(_C(bO(i,r),r.values),n):Ac(t,e)};function IC(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?me(t,e,n):_p(t)(t,e)}const TO=5;function DC(t,e,n){const i=Math.max(e-TO,0);return rC(n-t(i),e-i)}const ke={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},bu=.001;function CO({duration:t=ke.duration,bounce:e=ke.bounce,velocity:n=ke.velocity,mass:i=ke.mass}){let r,s,o=1-e;o=Fn(ke.minDamping,ke.maxDamping,o),t=Fn(ke.minDuration,ke.maxDuration,Dn(t)),o<1?(r=l=>{const u=l*o,d=u*t,h=u-n,f=bh(l,o),g=Math.exp(-d);return bu-h/f*g},s=l=>{const d=l*o*t,h=d*n+n,f=Math.pow(o,2)*Math.pow(l,2)*t,g=Math.exp(-d),m=bh(Math.pow(l,2),o);return(-r(l)+bu>0?-1:1)*((h-f)*g)/m}):(r=l=>{const u=Math.exp(-l*t),d=(l-n)*t+1;return-bu+u*d},s=l=>{const u=Math.exp(-l*t),d=(n-l)*(t*t);return u*d});const a=5/t,c=PO(r,s,a);if(t=In(t),isNaN(c))return{stiffness:ke.stiffness,damping:ke.damping,duration:t};{const l=Math.pow(c,2)*i;return{stiffness:l,damping:o*2*Math.sqrt(i*l),duration:t}}}const wO=12;function PO(t,e,n){let i=n;for(let r=1;r<wO;r++)i=i-t(i)/e(i);return i}function bh(t,e){return t*Math.sqrt(1-e*e)}const EO=["duration","bounce"],xO=["stiffness","damping","mass"];function Mv(t,e){return e.some(n=>t[n]!==void 0)}function RO(t){let e={velocity:ke.velocity,stiffness:ke.stiffness,damping:ke.damping,mass:ke.mass,isResolvedFromDuration:!1,...t};if(!Mv(t,xO)&&Mv(t,EO))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,s=2*Fn(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:ke.mass,stiffness:r,damping:s}}else{const n=CO(t);e={...e,...n,mass:ke.mass},e.isResolvedFromDuration=!0}return e}function AC(t=ke.visualDuration,e=ke.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const s=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:s},{stiffness:c,damping:l,mass:u,duration:d,velocity:h,isResolvedFromDuration:f}=RO({...n,velocity:-Dn(n.velocity||0)}),g=h||0,m=l/(2*Math.sqrt(c*u)),S=o-s,p=Dn(Math.sqrt(c/u)),v=Math.abs(S)<5;i||(i=v?ke.restSpeed.granular:ke.restSpeed.default),r||(r=v?ke.restDelta.granular:ke.restDelta.default);let y;if(m<1){const k=bh(p,m);y=w=>{const E=Math.exp(-m*p*w);return o-E*((g+m*p*S)/k*Math.sin(k*w)+S*Math.cos(k*w))}}else if(m===1)y=k=>o-Math.exp(-p*k)*(S+(g+p*S)*k);else{const k=p*Math.sqrt(m*m-1);y=w=>{const E=Math.exp(-m*p*w),P=Math.min(k*w,300);return o-E*((g+m*p*S)*Math.sinh(P)+k*S*Math.cosh(P))/k}}const b={calculatedDuration:f&&d||null,next:k=>{const w=y(k);if(f)a.done=k>=d;else{let E=0;m<1&&(E=k===0?In(g):DC(y,k,w));const P=Math.abs(E)<=i,D=Math.abs(o-w)<=r;a.done=P&&D}return a.value=a.done?o:w,a},toString:()=>{const k=Math.min(JT(b),hh),w=YT(E=>b.next(k*E).value,k,30);return k+"ms "+w}};return b}function Ov({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:c,restDelta:l=.5,restSpeed:u}){const d=t[0],h={done:!1,value:d},f=P=>a!==void 0&&P<a||c!==void 0&&P>c,g=P=>a===void 0?c:c===void 0||Math.abs(a-P)<Math.abs(c-P)?a:c;let m=n*e;const S=d+m,p=o===void 0?S:o(S);p!==S&&(m=p-d);const v=P=>-m*Math.exp(-P/i),y=P=>p+v(P),b=P=>{const D=v(P),I=y(P);h.done=Math.abs(D)<=l,h.value=h.done?p:I};let k,w;const E=P=>{f(h.value)&&(k=P,w=AC({keyframes:[h.value,g(h.value)],velocity:DC(y,P,h.value),damping:r,stiffness:s,restDelta:l,restSpeed:u}))};return E(0),{calculatedDuration:null,next:P=>{let D=!1;return!w&&k===void 0&&(D=!0,b(P),E(P)),k!==void 0&&P>=k?w.next(P-k):(!D&&b(P),h)}}}const _O=Fo(.42,0,1,1),IO=Fo(0,0,.58,1),MC=Fo(.42,0,.58,1),DO=t=>Array.isArray(t)&&typeof t[0]!="number",AO={linear:yt,easeIn:_O,easeInOut:MC,easeOut:IO,circIn:wp,circInOut:fC,circOut:hC,backIn:Cp,backInOut:uC,backOut:lC,anticipate:dC},Lv=t=>{if(yp(t)){IT(t.length===4);const[e,n,i,r]=t;return Fo(e,n,i,r)}else if(typeof t=="string")return AO[t];return t};function MO(t,e,n){const i=[],r=n||IC,s=t.length-1;for(let o=0;o<s;o++){let a=r(t[o],t[o+1]);if(e){const c=Array.isArray(e)?e[o]||yt:e;a=jo(c,a)}i.push(a)}return i}function OO(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const s=t.length;if(IT(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=MO(e,i,r),c=a.length,l=u=>{if(o&&u<t[0])return e[0];let d=0;if(c>1)for(;d<t.length-2&&!(u<t[d+1]);d++);const h=Zr(t[d],t[d+1],u);return a[d](h)};return n?u=>l(Fn(t[0],t[s-1],u)):l}function LO(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=Zr(0,e,i);t.push(me(n,1,r))}}function NO(t){const e=[0];return LO(e,t.length-1),e}function UO(t,e){return t.map(n=>n*e)}function FO(t,e){return t.map(()=>e||MC).splice(0,t.length-1)}function Mc({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=DO(i)?i.map(Lv):Lv(i),s={done:!1,value:e[0]},o=UO(n&&n.length===e.length?n:NO(e),t),a=OO(o,e,{ease:Array.isArray(r)?r:FO(e,r)});return{calculatedDuration:t,next:c=>(s.value=a(c),s.done=c>=t,s)}}const jO=t=>{const e=({timestamp:n})=>t(n);return{start:()=>ue.update(e,!0),stop:()=>mi(e),now:()=>Ve.isProcessing?Ve.timestamp:ln.now()}},VO={decay:Ov,inertia:Ov,tween:Mc,keyframes:Mc,spring:AC},BO=t=>t/100;class Ip extends RC{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:n,motionValue:i,element:r,keyframes:s}=this.options,o=(r==null?void 0:r.KeyframeResolver)||Rp,a=(c,l)=>this.onKeyframesResolved(c,l);this.resolver=new o(s,a,n,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:s,velocity:o=0}=this.options,a=vp(n)?n:VO[n]||Mc;let c,l;a!==Mc&&typeof e[0]!="number"&&(c=jo(BO,IC(e[0],e[1])),e=[0,100]);const u=a({...this.options,keyframes:e});s==="mirror"&&(l=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=JT(u));const{calculatedDuration:d}=u,h=d+r,f=h*(i+1)-r;return{generator:u,mirroredGenerator:l,mapPercentToKeyframes:c,calculatedDuration:d,resolvedDuration:h,totalDuration:f}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:i}=this;if(!i){const{keyframes:P}=this.options;return{done:!0,value:P[P.length-1]}}const{finalKeyframe:r,generator:s,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:c,calculatedDuration:l,totalDuration:u,resolvedDuration:d}=i;if(this.startTime===null)return s.next(0);const{delay:h,repeat:f,repeatType:g,repeatDelay:m,onUpdate:S}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const p=this.currentTime-h*(this.speed>=0?1:-1),v=this.speed>=0?p<0:p>u;this.currentTime=Math.max(p,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let y=this.currentTime,b=s;if(f){const P=Math.min(this.currentTime,u)/d;let D=Math.floor(P),I=P%1;!I&&P>=1&&(I=1),I===1&&D--,D=Math.min(D,f+1),!!(D%2)&&(g==="reverse"?(I=1-I,m&&(I-=m/d)):g==="mirror"&&(b=o)),y=Fn(0,1,I)*d}const k=v?{done:!1,value:c[0]}:b.next(y);a&&(k.value=a(k.value));let{done:w}=k;!v&&l!==null&&(w=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const E=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&w);return E&&r!==void 0&&(k.value=bl(c,this.options,r)),S&&S(k.value),E&&this.finish(),k}get duration(){const{resolved:e}=this;return e?Dn(e.calculatedDuration):0}get time(){return Dn(this.currentTime)}set time(e){e=In(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Dn(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=jO,onPlay:n,startTime:i}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),n&&n();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const zO=new Set(["opacity","clipPath","filter","transform"]);function $O(t,e,n,{delay:i=0,duration:r=300,repeat:s=0,repeatType:o="loop",ease:a="easeInOut",times:c}={}){const l={[e]:n};c&&(l.offset=c);const u=ZT(a,r);return Array.isArray(u)&&(l.easing=u),t.animate(l,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"})}const WO=np(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Oc=10,qO=2e4;function HO(t){return vp(t.type)||t.type==="spring"||!XT(t.ease)}function KO(t,e){const n=new Ip({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:t[0]};const r=[];let s=0;for(;!i.done&&s<qO;)i=n.sample(s),r.push(i.value),s+=Oc;return{times:void 0,keyframes:r,duration:s-Oc,ease:"linear"}}const OC={anticipate:dC,backInOut:uC,circInOut:fC};function GO(t){return t in OC}class Nv extends RC{constructor(e){super(e);const{name:n,motionValue:i,element:r,keyframes:s}=this.options;this.resolver=new xC(s,(o,a)=>this.onKeyframesResolved(o,a),n,i,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:i=300,times:r,ease:s,type:o,motionValue:a,name:c,startTime:l}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof s=="string"&&Dc()&&GO(s)&&(s=OC[s]),HO(this.options)){const{onComplete:d,onUpdate:h,motionValue:f,element:g,...m}=this.options,S=KO(e,m);e=S.keyframes,e.length===1&&(e[1]=e[0]),i=S.duration,r=S.times,s=S.ease,o="keyframes"}const u=$O(a.owner.current,c,e,{...this.options,duration:i,times:r,ease:s});return u.startTime=l??this.calcStartTime(),this.pendingTimeline?(bv(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:d}=this.options;a.set(bl(e,this.options,n)),d&&d(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:o,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return Dn(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return Dn(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.currentTime=In(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return yt;const{animation:i}=n;bv(i,e)}return yt}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:i,duration:r,type:s,ease:o,times:a}=e;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:l,onUpdate:u,onComplete:d,element:h,...f}=this.options,g=new Ip({...f,keyframes:i,duration:r,type:s,ease:o,times:a,isGenerator:!0}),m=In(this.time);l.setWithVelocity(g.sample(m-Oc).value,g.sample(m).value,Oc)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:i,repeatDelay:r,repeatType:s,damping:o,type:a}=e;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:l}=n.owner.getProps();return WO()&&i&&zO.has(i)&&!c&&!l&&!r&&s!=="mirror"&&o!==0&&a!=="inertia"}}const QO={type:"spring",stiffness:500,damping:25,restSpeed:10},JO=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),YO={type:"keyframes",duration:.8},XO={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ZO=(t,{keyframes:e})=>e.length>2?YO:nr.has(t)?t.startsWith("scale")?JO(e[1]):QO:XO;function eL({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:c,elapsed:l,...u}){return!!Object.keys(u).length}const Dp=(t,e,n,i={},r,s)=>o=>{const a=gp(i,t)||{},c=a.delay||i.delay||0;let{elapsed:l=0}=i;l=l-In(c);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-l,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:s?void 0:r};eL(a)||(u={...u,...ZO(t,u)}),u.duration&&(u.duration=In(u.duration)),u.repeatDelay&&(u.repeatDelay=In(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(d=!0)),d&&!s&&e.get()!==void 0){const h=bl(u.keyframes,a);if(h!==void 0)return ue.update(()=>{u.onUpdate(h),u.onComplete()}),new kM([])}return!s&&Nv.supports(u)?new Nv(u):new Ip(u)};function tL({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function LC(t,e,{delay:n=0,transitionOverride:i,type:r}={}){var s;let{transition:o=t.getDefaultTransition(),transitionEnd:a,...c}=e;i&&(o=i);const l=[],u=r&&t.animationState&&t.animationState.getState()[r];for(const d in c){const h=t.getValue(d,(s=t.latestValues[d])!==null&&s!==void 0?s:null),f=c[d];if(f===void 0||u&&tL(u,d))continue;const g={delay:n,...gp(o||{},d)};let m=!1;if(window.MotionHandoffAnimation){const p=sC(t);if(p){const v=window.MotionHandoffAnimation(p,d,ue);v!==null&&(g.startTime=v,m=!0)}}ph(t,d),h.start(Dp(d,h,f,t.shouldReduceMotion&&iC.has(d)?{type:!1}:g,t,m));const S=h.animation;S&&l.push(S)}return a&&Promise.all(l).then(()=>{ue.update(()=>{a&&MM(t,a)})}),l}function Sh(t,e,n={}){var i;const r=kl(t,e,n.type==="exit"?(i=t.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const o=r?()=>Promise.all(LC(t,r,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(l=0)=>{const{delayChildren:u=0,staggerChildren:d,staggerDirection:h}=s;return nL(t,e,u+l,d,h,n)}:()=>Promise.resolve(),{when:c}=s;if(c){const[l,u]=c==="beforeChildren"?[o,a]:[a,o];return l().then(()=>u())}else return Promise.all([o(),a(n.delay)])}function nL(t,e,n=0,i=0,r=1,s){const o=[],a=(t.variantChildren.size-1)*i,c=r===1?(l=0)=>l*i:(l=0)=>a-l*i;return Array.from(t.variantChildren).sort(iL).forEach((l,u)=>{l.notify("AnimationStart",e),o.push(Sh(l,e,{...s,delay:n+c(u)}).then(()=>l.notify("AnimationComplete",e)))}),Promise.all(o)}function iL(t,e){return t.sortNodePosition(e)}function rL(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(s=>Sh(t,s,n));i=Promise.all(r)}else if(typeof e=="string")i=Sh(t,e,n);else{const r=typeof e=="function"?kl(t,e,n.custom):e;i=Promise.all(LC(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}const sL=rp.length;function NC(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?NC(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<sL;n++){const i=rp[n],r=t.props[i];(To(r)||r===!1)&&(e[i]=r)}return e}const oL=[...ip].reverse(),aL=ip.length;function cL(t){return e=>Promise.all(e.map(({animation:n,options:i})=>rL(t,n,i)))}function lL(t){let e=cL(t),n=Uv(),i=!0;const r=c=>(l,u)=>{var d;const h=kl(t,u,c==="exit"?(d=t.presenceContext)===null||d===void 0?void 0:d.custom:void 0);if(h){const{transition:f,transitionEnd:g,...m}=h;l={...l,...m,...g}}return l};function s(c){e=c(t)}function o(c){const{props:l}=t,u=NC(t.parent)||{},d=[],h=new Set;let f={},g=1/0;for(let S=0;S<aL;S++){const p=oL[S],v=n[p],y=l[p]!==void 0?l[p]:u[p],b=To(y),k=p===c?v.isActive:null;k===!1&&(g=S);let w=y===u[p]&&y!==l[p]&&b;if(w&&i&&t.manuallyAnimateOnMount&&(w=!1),v.protectedKeys={...f},!v.isActive&&k===null||!y&&!v.prevProp||vl(y)||typeof y=="boolean")continue;const E=uL(v.prevProp,y);let P=E||p===c&&v.isActive&&!w&&b||S>g&&b,D=!1;const I=Array.isArray(y)?y:[y];let O=I.reduce(r(p),{});k===!1&&(O={});const{prevResolvedValues:V={}}=v,H={...V,...O},ee=J=>{P=!0,h.has(J)&&(D=!0,h.delete(J)),v.needsAnimating[J]=!0;const N=t.getValue(J);N&&(N.liveStyle=!1)};for(const J in H){const N=O[J],z=V[J];if(f.hasOwnProperty(J))continue;let $=!1;dh(N)&&dh(z)?$=!QT(N,z):$=N!==z,$?N!=null?ee(J):h.add(J):N!==void 0&&h.has(J)?ee(J):v.protectedKeys[J]=!0}v.prevProp=y,v.prevResolvedValues=O,v.isActive&&(f={...f,...O}),i&&t.blockInitialAnimation&&(P=!1),P&&(!(w&&E)||D)&&d.push(...I.map(J=>({animation:J,options:{type:p}})))}if(h.size){const S={};h.forEach(p=>{const v=t.getBaseTarget(p),y=t.getValue(p);y&&(y.liveStyle=!0),S[p]=v??null}),d.push({animation:S})}let m=!!d.length;return i&&(l.initial===!1||l.initial===l.animate)&&!t.manuallyAnimateOnMount&&(m=!1),i=!1,m?e(d):Promise.resolve()}function a(c,l){var u;if(n[c].isActive===l)return Promise.resolve();(u=t.variantChildren)===null||u===void 0||u.forEach(h=>{var f;return(f=h.animationState)===null||f===void 0?void 0:f.setActive(c,l)}),n[c].isActive=l;const d=o(c);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>n,reset:()=>{n=Uv(),i=!0}}}function uL(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!QT(e,t):!1}function Ci(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Uv(){return{animate:Ci(!0),whileInView:Ci(),whileHover:Ci(),whileTap:Ci(),whileDrag:Ci(),whileFocus:Ci(),exit:Ci()}}class Ti{constructor(e){this.isMounted=!1,this.node=e}update(){}}class dL extends Ti{constructor(e){super(e),e.animationState||(e.animationState=lL(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();vl(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let hL=0;class fL extends Ti{constructor(){super(...arguments),this.id=hL++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const pL={animation:{Feature:dL},exit:{Feature:fL}};function Eo(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function Vo(t){return{point:{x:t.pageX,y:t.pageY}}}const mL=t=>e=>kp(e)&&t(e,Vo(e));function Qs(t,e,n,i){return Eo(t,e,mL(n),i)}const Fv=(t,e)=>Math.abs(t-e);function gL(t,e){const n=Fv(t.x,e.x),i=Fv(t.y,e.y);return Math.sqrt(n**2+i**2)}class UC{constructor(e,n,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=Tu(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,f=gL(d.offset,{x:0,y:0})>=3;if(!h&&!f)return;const{point:g}=d,{timestamp:m}=Ve;this.history.push({...g,timestamp:m});const{onStart:S,onMove:p}=this.handlers;h||(S&&S(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),p&&p(this.lastMoveEvent,d)},this.handlePointerMove=(d,h)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=Su(h,this.transformPagePoint),ue.update(this.updatePoint,!0)},this.handlePointerUp=(d,h)=>{this.end();const{onEnd:f,onSessionEnd:g,resumeAnimation:m}=this.handlers;if(this.dragSnapToOrigin&&m&&m(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=Tu(d.type==="pointercancel"?this.lastMoveEventInfo:Su(h,this.transformPagePoint),this.history);this.startEvent&&f&&f(d,S),g&&g(d,S)},!kp(e))return;this.dragSnapToOrigin=s,this.handlers=n,this.transformPagePoint=i,this.contextWindow=r||window;const o=Vo(e),a=Su(o,this.transformPagePoint),{point:c}=a,{timestamp:l}=Ve;this.history=[{...c,timestamp:l}];const{onSessionStart:u}=n;u&&u(e,Tu(a,this.history)),this.removeListeners=jo(Qs(this.contextWindow,"pointermove",this.handlePointerMove),Qs(this.contextWindow,"pointerup",this.handlePointerUp),Qs(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),mi(this.updatePoint)}}function Su(t,e){return e?{point:e(t.point)}:t}function jv(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Tu({point:t},e){return{point:t,delta:jv(t,FC(e)),offset:jv(t,vL(e)),velocity:yL(e,.1)}}function vL(t){return t[0]}function FC(t){return t[t.length-1]}function yL(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=FC(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>In(e)));)n--;if(!i)return{x:0,y:0};const s=Dn(r.timestamp-i.timestamp);if(s===0)return{x:0,y:0};const o={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const jC=1e-4,kL=1-jC,bL=1+jC,VC=.01,SL=0-VC,TL=0+VC;function bt(t){return t.max-t.min}function CL(t,e,n){return Math.abs(t-e)<=n}function Vv(t,e,n,i=.5){t.origin=i,t.originPoint=me(e.min,e.max,t.origin),t.scale=bt(n)/bt(e),t.translate=me(n.min,n.max,t.origin)-t.originPoint,(t.scale>=kL&&t.scale<=bL||isNaN(t.scale))&&(t.scale=1),(t.translate>=SL&&t.translate<=TL||isNaN(t.translate))&&(t.translate=0)}function Js(t,e,n,i){Vv(t.x,e.x,n.x,i?i.originX:void 0),Vv(t.y,e.y,n.y,i?i.originY:void 0)}function Bv(t,e,n){t.min=n.min+e.min,t.max=t.min+bt(e)}function wL(t,e,n){Bv(t.x,e.x,n.x),Bv(t.y,e.y,n.y)}function zv(t,e,n){t.min=e.min-n.min,t.max=t.min+bt(e)}function Ys(t,e,n){zv(t.x,e.x,n.x),zv(t.y,e.y,n.y)}function PL(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?me(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?me(n,t,i.max):Math.min(t,n)),t}function $v(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function EL(t,{top:e,left:n,bottom:i,right:r}){return{x:$v(t.x,n,r),y:$v(t.y,e,i)}}function Wv(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function xL(t,e){return{x:Wv(t.x,e.x),y:Wv(t.y,e.y)}}function RL(t,e){let n=.5;const i=bt(t),r=bt(e);return r>i?n=Zr(e.min,e.max-i,t.min):i>r&&(n=Zr(t.min,t.max-r,e.min)),Fn(0,1,n)}function _L(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Th=.35;function IL(t=Th){return t===!1?t=0:t===!0&&(t=Th),{x:qv(t,"left","right"),y:qv(t,"top","bottom")}}function qv(t,e,n){return{min:Hv(t,e),max:Hv(t,n)}}function Hv(t,e){return typeof t=="number"?t:t[e]||0}const Kv=()=>({translate:0,scale:1,origin:0,originPoint:0}),wr=()=>({x:Kv(),y:Kv()}),Gv=()=>({min:0,max:0}),Ce=()=>({x:Gv(),y:Gv()});function Et(t){return[t("x"),t("y")]}function BC({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function DL({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function AL(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Cu(t){return t===void 0||t===1}function Ch({scale:t,scaleX:e,scaleY:n}){return!Cu(t)||!Cu(e)||!Cu(n)}function xi(t){return Ch(t)||zC(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function zC(t){return Qv(t.x)||Qv(t.y)}function Qv(t){return t&&t!=="0%"}function Lc(t,e,n){const i=t-n,r=e*i;return n+r}function Jv(t,e,n,i,r){return r!==void 0&&(t=Lc(t,r,i)),Lc(t,n,i)+e}function wh(t,e=0,n=1,i,r){t.min=Jv(t.min,e,n,i,r),t.max=Jv(t.max,e,n,i,r)}function $C(t,{x:e,y:n}){wh(t.x,e.translate,e.scale,e.originPoint),wh(t.y,n.translate,n.scale,n.originPoint)}const Yv=.999999999999,Xv=1.0000000000001;function ML(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let s,o;for(let a=0;a<r;a++){s=n[a],o=s.projectionDelta;const{visualElement:c}=s.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Er(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,$C(t,o)),i&&xi(s.latestValues)&&Er(t,s.latestValues))}e.x<Xv&&e.x>Yv&&(e.x=1),e.y<Xv&&e.y>Yv&&(e.y=1)}function Pr(t,e){t.min=t.min+e,t.max=t.max+e}function Zv(t,e,n,i,r=.5){const s=me(t.min,t.max,r);wh(t,e,n,s,i)}function Er(t,e){Zv(t.x,e.x,e.scaleX,e.scale,e.originX),Zv(t.y,e.y,e.scaleY,e.scale,e.originY)}function WC(t,e){return BC(AL(t.getBoundingClientRect(),e))}function OL(t,e,n){const i=WC(t,n),{scroll:r}=e;return r&&(Pr(i.x,r.offset.x),Pr(i.y,r.offset.y)),i}const qC=({current:t})=>t?t.ownerDocument.defaultView:null,LL=new WeakMap;class NL{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ce(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Vo(u).point)},s=(u,d)=>{const{drag:h,dragPropagation:f,onDragStart:g}=this.getProps();if(h&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=RM(h),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Et(S=>{let p=this.getAxisMotionValue(S).get()||0;if(cn.test(p)){const{projection:v}=this.visualElement;if(v&&v.layout){const y=v.layout.layoutBox[S];y&&(p=bt(y)*(parseFloat(p)/100))}}this.originPoint[S]=p}),g&&ue.postRender(()=>g(u,d)),ph(this.visualElement,"transform");const{animationState:m}=this.visualElement;m&&m.setActive("whileDrag",!0)},o=(u,d)=>{const{dragPropagation:h,dragDirectionLock:f,onDirectionLock:g,onDrag:m}=this.getProps();if(!h&&!this.openDragLock)return;const{offset:S}=d;if(f&&this.currentDirection===null){this.currentDirection=UL(S),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",d.point,S),this.updateAxis("y",d.point,S),this.visualElement.render(),m&&m(u,d)},a=(u,d)=>this.stop(u,d),c=()=>Et(u=>{var d;return this.getAnimationState(u)==="paused"&&((d=this.getAxisMotionValue(u).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:l}=this.getProps();this.panSession=new UC(e,{onSessionStart:r,onStart:s,onMove:o,onSessionEnd:a,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:l,contextWindow:qC(this.visualElement)})}stop(e,n){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&ue.postRender(()=>s(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!ha(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(o=PL(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;n&&Tr(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=EL(r.layoutBox,n):this.constraints=!1,this.elastic=IL(i),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Et(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=_L(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Tr(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=OL(i,r.root,this.visualElement.getTransformPagePoint());let o=xL(r.layout.layoutBox,s);if(n){const a=n(DL(o));this.hasMutatedConstraints=!!a,a&&(o=BC(a))}return o}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),c=this.constraints||{},l=Et(u=>{if(!ha(u,n,this.currentDirection))return;let d=c&&c[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,f=r?40:1e7,g={type:"inertia",velocity:i?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(u,g)});return Promise.all(l).then(a)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return ph(this.visualElement,e),i.start(Dp(e,i,0,n,this.visualElement,!1))}stopAnimation(){Et(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Et(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){Et(n=>{const{drag:i}=this.getProps();if(!ha(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];s.set(e[n]-me(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!Tr(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Et(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const c=a.get();r[o]=RL({min:c,max:c},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Et(o=>{if(!ha(o,e,null))return;const a=this.getAxisMotionValue(o),{min:c,max:l}=this.constraints[o];a.set(me(c,l,r[o]))})}addListeners(){if(!this.visualElement.current)return;LL.set(this.visualElement,this);const e=this.visualElement.current,n=Qs(e,"pointerdown",c=>{const{drag:l,dragListener:u=!0}=this.getProps();l&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();Tr(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),ue.read(i);const o=Eo(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:c,hasLayoutChanged:l})=>{this.isDragging&&l&&(Et(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=c[u].translate,d.set(d.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),n(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:o=Th,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function ha(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function UL(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class FL extends Ti{constructor(e){super(e),this.removeGroupControls=yt,this.removeListeners=yt,this.controls=new NL(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||yt}unmount(){this.removeGroupControls(),this.removeListeners()}}const ey=t=>(e,n)=>{t&&ue.postRender(()=>t(e,n))};class jL extends Ti{constructor(){super(...arguments),this.removePointerDownListener=yt}onPointerDown(e){this.session=new UC(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:qC(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:ey(e),onStart:ey(n),onMove:i,onEnd:(s,o)=>{delete this.session,r&&ue.postRender(()=>r(s,o))}}}mount(){this.removePointerDownListener=Qs(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const za={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ty(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Es={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(W.test(t))t=parseFloat(t);else return t;const n=ty(t,e.target.x),i=ty(t,e.target.y);return`${n}% ${i}%`}},VL={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=gi.parse(t);if(r.length>5)return i;const s=gi.createTransformer(t),o=typeof r[0]!="number"?1:0,a=n.x.scale*e.x,c=n.y.scale*e.y;r[0+o]/=a,r[1+o]/=c;const l=me(a,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=l),typeof r[3+o]=="number"&&(r[3+o]/=l),s(r)}};class BL extends T.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:s}=e;aM(zL),s&&(n.group&&n.group.add(s),i&&i.register&&r&&i.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),za.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:s}=this.props,o=i.projection;return o&&(o.isPresent=s,r||e.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||ue.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),op.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function HC(t){const[e,n]=RT(),i=T.useContext(Xf);return F.jsx(BL,{...t,layoutGroup:i,switchLayoutGroup:T.useContext(NT),isPresent:e,safeToRemove:n})}const zL={borderRadius:{...Es,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Es,borderTopRightRadius:Es,borderBottomLeftRadius:Es,borderBottomRightRadius:Es,boxShadow:VL};function $L(t,e,n){const i=Ge(t)?t:wo(t);return i.start(Dp("",i,e,n)),i.animation}function WL(t){return t instanceof SVGElement&&t.tagName!=="svg"}const qL=(t,e)=>t.depth-e.depth;class HL{constructor(){this.children=[],this.isDirty=!1}add(e){bp(this.children,e),this.isDirty=!0}remove(e){Sp(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(qL),this.isDirty=!1,this.children.forEach(e)}}function KL(t,e){const n=ln.now(),i=({timestamp:r})=>{const s=r-n;s>=e&&(mi(i),t(s-e))};return ue.read(i,!0),()=>mi(i)}const KC=["TopLeft","TopRight","BottomLeft","BottomRight"],GL=KC.length,ny=t=>typeof t=="string"?parseFloat(t):t,iy=t=>typeof t=="number"||W.test(t);function QL(t,e,n,i,r,s){r?(t.opacity=me(0,n.opacity!==void 0?n.opacity:1,JL(i)),t.opacityExit=me(e.opacity!==void 0?e.opacity:1,0,YL(i))):s&&(t.opacity=me(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,i));for(let o=0;o<GL;o++){const a=`border${KC[o]}Radius`;let c=ry(e,a),l=ry(n,a);if(c===void 0&&l===void 0)continue;c||(c=0),l||(l=0),c===0||l===0||iy(c)===iy(l)?(t[a]=Math.max(me(ny(c),ny(l),i),0),(cn.test(l)||cn.test(c))&&(t[a]+="%")):t[a]=l}(e.rotate||n.rotate)&&(t.rotate=me(e.rotate||0,n.rotate||0,i))}function ry(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const JL=GC(0,.5,hC),YL=GC(.5,.95,yt);function GC(t,e,n){return i=>i<t?0:i>e?1:n(Zr(t,e,i))}function sy(t,e){t.min=e.min,t.max=e.max}function Pt(t,e){sy(t.x,e.x),sy(t.y,e.y)}function oy(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function ay(t,e,n,i,r){return t-=e,t=Lc(t,1/n,i),r!==void 0&&(t=Lc(t,1/r,i)),t}function XL(t,e=0,n=1,i=.5,r,s=t,o=t){if(cn.test(e)&&(e=parseFloat(e),e=me(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=me(s.min,s.max,i);t===s&&(a-=e),t.min=ay(t.min,e,n,a,r),t.max=ay(t.max,e,n,a,r)}function cy(t,e,[n,i,r],s,o){XL(t,e[n],e[i],e[r],e.scale,s,o)}const ZL=["x","scaleX","originX"],eN=["y","scaleY","originY"];function ly(t,e,n,i){cy(t.x,e,ZL,n?n.x:void 0,i?i.x:void 0),cy(t.y,e,eN,n?n.y:void 0,i?i.y:void 0)}function uy(t){return t.translate===0&&t.scale===1}function QC(t){return uy(t.x)&&uy(t.y)}function dy(t,e){return t.min===e.min&&t.max===e.max}function tN(t,e){return dy(t.x,e.x)&&dy(t.y,e.y)}function hy(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function JC(t,e){return hy(t.x,e.x)&&hy(t.y,e.y)}function fy(t){return bt(t.x)/bt(t.y)}function py(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class nN{constructor(){this.members=[]}add(e){bp(this.members,e),e.scheduleRender()}remove(e){if(Sp(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){i=s;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function iN(t,e,n){let i="";const r=t.x.translate/e.x,s=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((r||s||o)&&(i=`translate3d(${r}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:l,rotate:u,rotateX:d,rotateY:h,skewX:f,skewY:g}=n;l&&(i=`perspective(${l}px) ${i}`),u&&(i+=`rotate(${u}deg) `),d&&(i+=`rotateX(${d}deg) `),h&&(i+=`rotateY(${h}deg) `),f&&(i+=`skewX(${f}deg) `),g&&(i+=`skewY(${g}deg) `)}const a=t.x.scale*e.x,c=t.y.scale*e.y;return(a!==1||c!==1)&&(i+=`scale(${a}, ${c})`),i||"none"}const Ri={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Ls=typeof window<"u"&&window.MotionDebug!==void 0,wu=["","X","Y","Z"],rN={visibility:"hidden"},my=1e3;let sN=0;function Pu(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function YC(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=sC(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:s}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",ue,!(r||s))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&YC(i)}function XC({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=sN++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ls&&(Ri.totalNodes=Ri.resolvedTargetDeltas=Ri.recalculatedProjection=0),this.nodes.forEach(cN),this.nodes.forEach(fN),this.nodes.forEach(pN),this.nodes.forEach(lN),Ls&&window.MotionDebug.record(Ri)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new HL)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Tp),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const c=this.eventHandlers.get(o);c&&c.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=WL(o),this.instance=o;const{layoutId:c,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(l||c)&&(this.isLayoutDirty=!0),t){let d;const h=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=KL(h,250),za.hasAnimatedSinceResize&&(za.hasAnimatedSinceResize=!1,this.nodes.forEach(vy))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeTargetChanged:f,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||kN,{onLayoutAnimationStart:S,onLayoutAnimationComplete:p}=u.getProps(),v=!this.targetLayout||!JC(this.targetLayout,g)||f,y=!h&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||y||h&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,y);const b={...gp(m,"layout"),onPlay:S,onComplete:p};(u.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b)}else h||vy(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,mi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(mN),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&YC(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:c}=this.options;if(a===void 0&&!c)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(gy);return}this.isUpdating||this.nodes.forEach(dN),this.isUpdating=!1,this.nodes.forEach(hN),this.nodes.forEach(oN),this.nodes.forEach(aN),this.clearAllSnapshots();const a=ln.now();Ve.delta=Fn(0,1e3/60,a-Ve.timestamp),Ve.timestamp=a,Ve.isProcessing=!0,mu.update.process(Ve),mu.preRender.process(Ve),mu.render.process(Ve),Ve.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,op.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(uN),this.sharedNodes.forEach(gN)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ue.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ue.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ce(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!QC(this.projectionDelta),c=this.getTransformTemplate(),l=c?c(this.latestValues,""):void 0,u=l!==this.prevTransformTemplateValue;o&&(a||xi(this.latestValues)||u)&&(r(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let c=this.removeElementScroll(a);return o&&(c=this.removeTransform(c)),bN(c),{animationId:this.root.animationId,measuredBox:a,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Ce();const c=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(SN))){const{scroll:u}=this.root;u&&(Pr(c.x,u.offset.x),Pr(c.y,u.offset.y))}return c}removeElementScroll(o){var a;const c=Ce();if(Pt(c,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return c;for(let l=0;l<this.path.length;l++){const u=this.path[l],{scroll:d,options:h}=u;u!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&Pt(c,o),Pr(c.x,d.offset.x),Pr(c.y,d.offset.y))}return c}applyTransform(o,a=!1){const c=Ce();Pt(c,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Er(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),xi(u.latestValues)&&Er(c,u.latestValues)}return xi(this.latestValues)&&Er(c,this.latestValues),c}removeTransform(o){const a=Ce();Pt(a,o);for(let c=0;c<this.path.length;c++){const l=this.path[c];if(!l.instance||!xi(l.latestValues))continue;Ch(l.latestValues)&&l.updateSnapshot();const u=Ce(),d=l.measurePageBox();Pt(u,d),ly(a,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,u)}return xi(this.latestValues)&&ly(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ve.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==c;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=Ve.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ce(),this.relativeTargetOrigin=Ce(),Ys(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Pt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ce(),this.targetWithTransforms=Ce()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),wL(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pt(this.target,this.layout.layoutBox),$C(this.target,this.targetDelta)):Pt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ce(),this.relativeTargetOrigin=Ce(),Ys(this.relativeTargetOrigin,this.target,f.target),Pt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ls&&Ri.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Ch(this.parent.latestValues)||zC(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),c=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(l=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Ve.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Pt(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;ML(this.layoutCorrected,this.treeScale,this.path,c),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Ce());const{target:g}=a;if(!g){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(oy(this.prevProjectionDelta.x,this.projectionDelta.x),oy(this.prevProjectionDelta.y,this.projectionDelta.y)),Js(this.projectionDelta,this.layoutCorrected,g,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!py(this.projectionDelta.x,this.prevProjectionDelta.x)||!py(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),Ls&&Ri.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=wr(),this.projectionDelta=wr(),this.projectionDeltaWithTransform=wr()}setAnimationOrigin(o,a=!1){const c=this.snapshot,l=c?c.latestValues:{},u={...this.latestValues},d=wr();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ce(),f=c?c.source:void 0,g=this.layout?this.layout.source:void 0,m=f!==g,S=this.getStack(),p=!S||S.members.length<=1,v=!!(m&&!p&&this.options.crossfade===!0&&!this.path.some(yN));this.animationProgress=0;let y;this.mixTargetDelta=b=>{const k=b/1e3;yy(d.x,o.x,k),yy(d.y,o.y,k),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ys(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),vN(this.relativeTarget,this.relativeTargetOrigin,h,k),y&&tN(this.relativeTarget,y)&&(this.isProjectionDirty=!1),y||(y=Ce()),Pt(y,this.relativeTarget)),m&&(this.animationValues=u,QL(u,l,this.latestValues,k,v,p)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(mi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ue.update(()=>{za.hasAnimatedSinceResize=!0,this.currentAnimation=$L(0,my,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(my),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:c,layout:l,latestValues:u}=o;if(!(!a||!c||!l)){if(this!==o&&this.layout&&l&&ZC(this.options.animationType,this.layout.layoutBox,l.layoutBox)){c=this.target||Ce();const d=bt(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+d;const h=bt(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}Pt(a,c),Er(a,u),Js(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new nN),this.sharedNodes.get(o).add(a);const l=a.options.initialPromotionConfig;a.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:c}={}){const l=this.getStack();l&&l.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(a=!0),!a)return;const l={};c.z&&Pu("z",o,l,this.animationValues);for(let u=0;u<wu.length;u++)Pu(`rotate${wu[u]}`,o,l,this.animationValues),Pu(`skew${wu[u]}`,o,l,this.animationValues);o.render();for(const u in l)o.setStaticValue(u,l[u]),this.animationValues&&(this.animationValues[u]=l[u]);o.scheduleRender()}getProjectionStyles(o){var a,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return rN;const l={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,l.opacity="",l.pointerEvents=Va(o==null?void 0:o.pointerEvents)||"",l.transform=u?u(this.latestValues,""):"none",l;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const m={};return this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=Va(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!xi(this.latestValues)&&(m.transform=u?u({},""):"none",this.hasProjected=!1),m}const h=d.animationValues||d.latestValues;this.applyTransformsToTarget(),l.transform=iN(this.projectionDeltaWithTransform,this.treeScale,h),u&&(l.transform=u(h,l.transform));const{x:f,y:g}=this.projectionDelta;l.transformOrigin=`${f.origin*100}% ${g.origin*100}% 0`,d.animationValues?l.opacity=d===this?(c=(a=h.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:l.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const m in Ic){if(h[m]===void 0)continue;const{correct:S,applyTo:p}=Ic[m],v=l.transform==="none"?h[m]:S(h[m],d);if(p){const y=p.length;for(let b=0;b<y;b++)l[p[b]]=v}else l[m]=v}return this.options.layoutId&&(l.pointerEvents=d===this?Va(o==null?void 0:o.pointerEvents)||"":"none"),l}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(gy),this.root.sharedNodes.clear()}}}function oN(t){t.updateLayout()}function aN(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=t.layout,{animationType:s}=t.options,o=n.source!==t.layout.source;s==="size"?Et(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=bt(h);h.min=i[d].min,h.max=h.min+f}):ZC(s,n.layoutBox,i)&&Et(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=bt(i[d]);h.max=h.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+f)});const a=wr();Js(a,i,n.layoutBox);const c=wr();o?Js(c,t.applyTransform(r,!0),n.measuredBox):Js(c,i,n.layoutBox);const l=!QC(a);let u=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const g=Ce();Ys(g,n.layoutBox,h.layoutBox);const m=Ce();Ys(m,i,f.layoutBox),JC(g,m)||(u=!0),d.options.layoutRoot&&(t.relativeTarget=m,t.relativeTargetOrigin=g,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:n,delta:c,layoutDelta:a,hasLayoutChanged:l,hasRelativeTargetChanged:u})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function cN(t){Ls&&Ri.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function lN(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function uN(t){t.clearSnapshot()}function gy(t){t.clearMeasurements()}function dN(t){t.isLayoutDirty=!1}function hN(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function vy(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function fN(t){t.resolveTargetDelta()}function pN(t){t.calcProjection()}function mN(t){t.resetSkewAndRotation()}function gN(t){t.removeLeadSnapshot()}function yy(t,e,n){t.translate=me(e.translate,0,n),t.scale=me(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function ky(t,e,n,i){t.min=me(e.min,n.min,i),t.max=me(e.max,n.max,i)}function vN(t,e,n,i){ky(t.x,e.x,n.x,i),ky(t.y,e.y,n.y,i)}function yN(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const kN={duration:.45,ease:[.4,0,.1,1]},by=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Sy=by("applewebkit/")&&!by("chrome/")?Math.round:yt;function Ty(t){t.min=Sy(t.min),t.max=Sy(t.max)}function bN(t){Ty(t.x),Ty(t.y)}function ZC(t,e,n){return t==="position"||t==="preserve-aspect"&&!CL(fy(e),fy(n),.2)}function SN(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const TN=XC({attachResizeListener:(t,e)=>Eo(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Eu={current:void 0},e1=XC({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Eu.current){const t=new TN({});t.mount(window),t.setOptions({layoutScroll:!0}),Eu.current=t}return Eu.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),CN={pan:{Feature:jL},drag:{Feature:FL,ProjectionNode:e1,MeasureLayout:HC}};function Cy(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,s=i[r];s&&ue.postRender(()=>s(e,Vo(e)))}class wN extends Ti{mount(){const{current:e}=this.node;e&&(this.unmount=CM(e,n=>(Cy(this.node,n,"Start"),i=>Cy(this.node,i,"End"))))}unmount(){}}class PN extends Ti{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=jo(Eo(this.node.current,"focus",()=>this.onFocus()),Eo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function wy(t,e,n){const{props:i}=t;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),s=i[r];s&&ue.postRender(()=>s(e,Vo(e)))}class EN extends Ti{mount(){const{current:e}=this.node;e&&(this.unmount=xM(e,n=>(wy(this.node,n,"Start"),(i,{success:r})=>wy(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ph=new WeakMap,xu=new WeakMap,xN=t=>{const e=Ph.get(t.target);e&&e(t)},RN=t=>{t.forEach(xN)};function _N({root:t,...e}){const n=t||document;xu.has(n)||xu.set(n,{});const i=xu.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(RN,{root:t,...e})),i[r]}function IN(t,e,n){const i=_N(e);return Ph.set(t,n),i.observe(t),()=>{Ph.delete(t),i.unobserve(t)}}const DN={some:0,all:1};class AN extends Ti{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:s}=e,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:DN[r]},a=c=>{const{isIntersecting:l}=c;if(this.isInView===l||(this.isInView=l,s&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=l?u:d;h&&h(c)};return IN(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(MN(e,n))&&this.startObserver()}unmount(){}}function MN({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const ON={inView:{Feature:AN},tap:{Feature:EN},focus:{Feature:PN},hover:{Feature:wN}},LN={layout:{ProjectionNode:e1,MeasureLayout:HC}},Eh={current:null},t1={current:!1};function NN(){if(t1.current=!0,!!tp)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Eh.current=t.matches;t.addListener(e),e()}else Eh.current=!1}const UN=[...EC,He,gi],FN=t=>UN.find(PC(t)),Py=new WeakMap;function jN(t,e,n){for(const i in e){const r=e[i],s=n[i];if(Ge(r))t.addValue(i,r);else if(Ge(s))t.addValue(i,wo(r,{owner:t}));else if(s!==r)if(t.hasValue(i)){const o=t.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(i);t.addValue(i,wo(o!==void 0?o:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const Ey=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VN{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Rp,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=ln.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,ue.render(this.render,!1,!0))};const{latestValues:c,renderState:l,onUpdate:u}=o;this.onUpdate=u,this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=yl(n),this.isVariantNode=OT(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in h){const g=h[f];c[f]!==void 0&&Ge(g)&&g.set(c[f],!1)}}mount(e){this.current=e,Py.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),t1.current||NN(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Eh.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Py.delete(this.current),this.projection&&this.projection.unmount(),mi(this.notifyUpdate),mi(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=nr.has(e),r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&ue.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),s=n.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),s(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in es){const n=es[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ce()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Ey.length;i++){const r=Ey[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,o=e[s];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=jN(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=wo(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){var i;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(i=this.getBaseTargetFromProps(this.props,e))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(CC(r)||pC(r))?r=parseFloat(r):!FN(r)&&gi.test(n)&&(r=bC(e,n)),this.setBaseTarget(e,Ge(r)?r.get():r)),Ge(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const o=cp(this.props,i,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);o&&(r=o[e])}if(i&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!Ge(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Tp),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class n1 extends VN{constructor(){super(...arguments),this.KeyframeResolver=xC}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ge(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function BN(t){return window.getComputedStyle(t)}class zN extends n1{constructor(){super(...arguments),this.type="html",this.renderInstance=$T}readValueFromInstance(e,n){if(nr.has(n)){const i=xp(n);return i&&i.default||0}else{const i=BN(e),r=(VT(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return WC(e,n)}build(e,n,i){dp(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return mp(e,n,i)}}class $N extends n1{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ce}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(nr.has(n)){const i=xp(n);return i&&i.default||0}return n=WT.has(n)?n:sp(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return KT(e,n,i)}build(e,n,i){hp(e,n,this.isSVGTag,i.transformTemplate)}renderInstance(e,n,i,r){qT(e,n,i,r)}mount(e){this.isSVGTag=pp(e.tagName),super.mount(e)}}const WN=(t,e)=>ap(t)?new $N(e):new zN(e,{allowProjection:t!==T.Fragment}),qN=gM({...pL,...ON,...CN,...LN},WN),Xs=DA(qN);function HN(){const{localParticipant:t}=No(),e=T.useCallback(async r=>{if(!t)throw new Error("Local participant is not available");if(!r.trigger_name&&!r.trigger_message)throw new Error("Either trigger_name or trigger_message must be provided");const s={type:"trigger-message",data:r},a=new TextEncoder().encode(JSON.stringify(s));await t.publishData(a),console.log("RTVI trigger message sent:",s)},[t]),n=T.useCallback(async r=>{await e({trigger_name:r})},[e]),i=T.useCallback(async r=>{await e({trigger_message:r})},[e]);return{sendTriggerMessage:e,sendTriggerByName:n,sendTriggerByMessage:i,isConnected:t!==null}}function KN(){const{microphoneTrack:t,localParticipant:e}=No();return T.useMemo(()=>({participant:e,source:x.Source.Microphone,publication:t}),[e,t])}function GN(){const{agentTranscriptions:t}=pl(),e=KN(),{segments:n}=CT(e);return T.useMemo(()=>[...t.map(r=>({...r,role:"assistant"})),...n.map(r=>({...r,role:"user"}))].sort((r,s)=>r.firstReceivedTime-s.firstReceivedTime),[t,n])}function QN(){const{cameraTrack:t,localParticipant:e}=No();return T.useMemo(()=>({participant:e,source:x.Source.Camera,publication:t}),[e,t])}function JN(){const t=T.useContext(dl);return T.useEffect(()=>{if(!t)return;const e=(n,i)=>{try{const s=new TextDecoder().decode(n),o=JSON.parse(s);console.group(" WebRTC Data Message Received"),console.log("From:",(i==null?void 0:i.identity)||"Unknown participant"),console.log("Participant SID:",(i==null?void 0:i.sid)||"Unknown"),console.log("Message Type:",o.type||"No type specified"),console.log("Timestamp:",new Date().toISOString()),console.log("Raw bytes length:",n.length),console.log("Parsed Data:",o),console.groupEnd(),o.type&&o.type.includes("rtvi")&&console.log(" RTVI Message:",o),o.type==="trigger-message"&&console.log(" Trigger Message Response:",o)}catch(r){console.group(" Failed to parse incoming data message"),console.error("Parse Error:",r),console.log("Raw bytes length:",n.length);try{const o=new TextDecoder().decode(n);console.log("Raw string content:",o)}catch(s){console.error("Failed to decode as string:",s),console.log("Raw bytes (first 100):",Array.from(n.slice(0,100)))}console.groupEnd()}};return t.on(_.DataReceived,e),console.log(" Data message listener initialized"),()=>{t.off(_.DataReceived,e),console.log(" Data message listener cleaned up")}},[t]),{isListening:t!==null}}const YN=({className:t=""})=>{const{sendTriggerByName:e,sendTriggerByMessage:n,isConnected:i}=HN(),[r,s]=T.useState(""),[o,a]=T.useState(""),[c,l]=T.useState(!1),u=async()=>{if(r.trim()){l(!0);try{await e(r),s("")}catch(g){console.error("Failed to send trigger by name:",g)}finally{l(!1)}}},d=async()=>{if(o.trim()){l(!0);try{await n(o),a("")}catch(g){console.error("Failed to send trigger by message:",g)}finally{l(!1)}}},h=[{name:"ENTER_SPACESHIP",label:"Enter Spaceship"},{name:"COMBAT_START",label:"Start Combat"},{name:"EXPLORE_PLANET",label:"Explore Planet"}],f=async g=>{l(!0);try{await e(g)}catch(m){console.error("Failed to send quick trigger:",m)}finally{l(!1)}};return i?F.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 space-y-4 ${t}`,children:[F.jsx("h3",{className:"text-white font-semibold",children:"RTVI Trigger Controls"}),F.jsxs("div",{className:"space-y-2",children:[F.jsx("p",{className:"text-gray-300 text-sm",children:"Quick Triggers:"}),F.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(g=>F.jsx("button",{onClick:()=>f(g.name),disabled:c,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white text-sm rounded transition-colors",children:g.label},g.name))})]}),F.jsxs("div",{className:"space-y-2",children:[F.jsx("label",{className:"text-gray-300 text-sm",children:"Send Trigger by Name:"}),F.jsxs("div",{className:"flex gap-2",children:[F.jsx("input",{type:"text",value:r,onChange:g=>s(g.target.value),placeholder:"Enter trigger name...",className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500 focus:outline-none",onKeyPress:g=>g.key==="Enter"&&u()}),F.jsx("button",{onClick:u,disabled:!r.trim()||c,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white rounded transition-colors",children:"Send"})]})]}),F.jsxs("div",{className:"space-y-2",children:[F.jsx("label",{className:"text-gray-300 text-sm",children:"Send Trigger by Message:"}),F.jsxs("div",{className:"flex gap-2",children:[F.jsx("input",{type:"text",value:o,onChange:g=>a(g.target.value),placeholder:"Enter trigger message...",className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500 focus:outline-none",onKeyPress:g=>g.key==="Enter"&&d()}),F.jsx("button",{onClick:d,disabled:!o.trim()||c,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded transition-colors",children:"Send"})]})]})]}):F.jsx("div",{className:`bg-gray-800 rounded-lg p-4 opacity-50 ${t}`,children:F.jsx("p",{className:"text-gray-400 text-sm",children:"Connect to start sending triggers"})})},XN=({className:t="",maxHeight:e="200px",maxWidth:n="512px"})=>{const i=GN(),r=T.useRef(null);return T.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[i]),F.jsxs("div",{className:`relative mx-auto ${t}`,style:{height:e,width:n,maxWidth:"90vw"},children:[F.jsx("div",{className:"absolute top-0 left-0 right-0 h-8 bg-gradient-to-b from-gray-900 to-transparent z-10 pointer-events-none"}),F.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-gray-900 to-transparent z-10 pointer-events-none"}),F.jsx("div",{ref:r,className:"h-full flex flex-col gap-2 overflow-y-auto px-4 py-8",children:i.map(s=>F.jsx("div",{id:s.id,className:s.role==="assistant"?"p-2 self-start fit-content":"bg-gray-800 rounded-md p-2 self-end fit-content",children:s.text},s.id))})]})};function ZN(){var e;const t=QN();return(e=t.publication)!=null&&e.isSubscribed?F.jsxs("div",{className:"w-48 h-36 rounded-lg overflow-hidden border-2 border-gray-600 relative",children:[F.jsx(ET,{trackRef:t}),F.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"You"})]}):F.jsx("div",{className:"w-48 h-36 bg-gray-800 rounded-lg flex items-center justify-center border-2 border-gray-600",children:F.jsx("span",{className:"text-gray-400 text-sm",children:"Camera Off"})})}function e2(){const{localParticipant:t}=No(),[e,n]=T.useState(!1);T.useEffect(()=>{t&&n(t.isCameraEnabled)},[t]);const i=async()=>{if(t)try{await t.setCameraEnabled(!e),n(!e)}catch(r){console.error("Failed to toggle camera:",r)}};return F.jsx("button",{onClick:i,className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${e?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 hover:bg-gray-700 text-white"}`,children:e?F.jsx("span",{className:"flex items-center gap-1",children:" Camera On"}):F.jsx("span",{className:"flex items-center gap-1",children:" Camera Off"})})}function t2(){return F.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:F.jsx("path",{d:"M3.16602 3.16666L12.8327 12.8333M12.8327 3.16666L3.16602 12.8333",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square"})})}function n2(t){const n=T.useRef(null),[i,r]=T.useState(!1),s=T.useRef(!1);return["listening","thinking","speaking"].includes(t.state)&&s.current==!1&&(s.current=!0),T.useEffect(()=>(t.state==="connecting"?n.current=window.setTimeout(()=>{t.state==="connecting"&&s.current===!1&&r(!0)},1e4):(n.current&&window.clearTimeout(n.current),r(!1)),()=>{n.current&&window.clearTimeout(n.current)}),[t.state]),F.jsx(F.Fragment,{children:i?F.jsxs("div",{className:"fixed text-sm left-1/2 max-w-[90vw] -translate-x-1/2 flex top-6 items-center gap-4 bg-[#1F1F1F] px-4 py-3 rounded-lg",children:[F.jsx("div",{children:F.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:F.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.85068 3.63564C10.8197 2.00589 13.1793 2.00589 14.1484 3.63564L21.6323 16.2223C22.6232 17.8888 21.4223 20 19.4835 20H4.51555C2.57676 20 1.37584 17.8888 2.36671 16.2223L9.85068 3.63564ZM12 8.5C12.2761 8.5 12.5 8.72386 12.5 9V13.5C12.5 13.7761 12.2761 14 12 14C11.7239 14 11.5 13.7761 11.5 13.5V9C11.5 8.72386 11.7239 8.5 12 8.5ZM12.75 16C12.75 16.4142 12.4142 16.75 12 16.75C11.5858 16.75 11.25 16.4142 11.25 16C11.25 15.5858 11.5858 15.25 12 15.25C12.4142 15.25 12.75 15.5858 12.75 16Z",fill:"#666666"})})}),F.jsx("p",{className:"text-pretty w-max",children:"It's quiet... too quiet. Is your agent lost? Ensure your agent is properly configured and running on your machine."}),F.jsx("a",{href:"https://docs.livekit.io/agents/quickstarts/s2s/",target:"_blank",className:"underline whitespace-nowrap",children:"View guide"}),F.jsx("button",{onClick:()=>r(!1),children:F.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:F.jsx("path",{d:"M3.16602 3.16666L12.8327 12.8333M12.8327 3.16666L3.16602 12.8333",stroke:"#999999",strokeWidth:"1.5",strokeLinecap:"square"})})})]}):null})}const i2="https://realtime-api.convai.com";function r2(){const[t]=T.useState(new Un),e=T.useCallback(async()=>{try{const n=await fetch(`${i2}/connect`,{method:"POST",headers:{"x-api-key":"ea401720eb28daa6810bab6508b4188f","Content-Type":"application/json"},body:JSON.stringify({character_id:"6bae239c-11ab-11ef-9870-42010a7be00e",transport:"livekit",connection_type:"audio",llm_provider:"gemini-baml",action_config:{actions:["Wave","Flip your hair","Touch user's hair"],characters:[{name:"Ty",bio:"Ty is an AI powered virtual hair stylist trained on 60+ decades of TRESemm expert hair knowledge. She gives personalized, on-demand hair styling advice that people can relate to, as well as answering questions about TRESemm and TRESemm products."},{name:"Player",bio:""}],objects:[{name:"Tresseme shampoo",description:"A shampoo bottle"},{name:"Tresseme conditioner",description:"A conditioner bottle"},{name:"Tresseme hairspray",description:"A hairspray bottle"}],current_attention_object:"Tresseme shampoo"}})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();console.log("Connection data received:",i),await t.connect(i.room_url,i.token,{rtcConfig:{iceTransportPolicy:"relay"}}),await t.localParticipant.setMicrophoneEnabled(!0),await t.localParticipant.setCameraEnabled(!0),console.log("Connected to room:",i.room_name),console.log("Session ID:",i.session_id)}catch(n){console.error("Connection failed:",n)}},[t]);return T.useEffect(()=>(t.on(_.MediaDevicesError,xy),()=>{t.off(_.MediaDevicesError,xy)}),[t]),F.jsx("main",{"data-lk-theme":"default",className:"h-full grid content-center bg-[var(--lk-bg)]",children:F.jsx(dl.Provider,{value:t,children:F.jsxs("div",{className:"lk-room-container max-w-[1024px] w-[90vw] mx-auto max-h-[90vh]",children:[F.jsx(s2,{onConnectButtonClicked:e}),F.jsx(c2,{})]})})})}function s2(t){const{state:e}=pl();return F.jsx(F.Fragment,{children:F.jsx(uh,{mode:"wait",children:e==="disconnected"?F.jsx(Xs.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,ease:[.09,1.04,.245,1.055]},className:"grid items-center justify-center h-full",children:F.jsx(Xs.button,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:.1},className:"uppercase px-4 py-2 bg-white text-black rounded-md",onClick:()=>t.onConnectButtonClicked(),children:"Start a conversation"})},"disconnected"):F.jsxs(Xs.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:[.09,1.04,.245,1.055]},className:"flex flex-col items-center gap-4 h-full relative",children:[F.jsx("div",{className:"absolute top-4 right-4 z-10",children:F.jsx(ZN,{})}),F.jsx(o2,{}),F.jsx("div",{className:"flex-1 w-full",children:F.jsx(XN,{})}),F.jsx("div",{className:"w-full max-w-[512px]",children:F.jsx(YN,{})}),F.jsx("div",{className:"w-full",children:F.jsx(a2,{onConnectButtonClicked:t.onConnectButtonClicked})}),F.jsx(fA,{}),F.jsx(n2,{state:e})]},"connected")})})}function o2(){const{state:t,videoTrack:e,audioTrack:n}=pl();return e?F.jsx("div",{className:"h-[512px] w-[512px] rounded-lg overflow-hidden",children:F.jsx(ET,{trackRef:e})}):F.jsx("div",{className:"h-[300px] w-full",children:F.jsx(xT,{state:t,barCount:5,trackRef:n,className:"agent-visualizer",options:{minHeight:24}})})}function a2(t){const{state:e}=pl();return F.jsxs("div",{className:"relative h-[60px]",children:[F.jsx(uh,{children:e==="disconnected"&&F.jsx(Xs.button,{initial:{opacity:0,top:0},animate:{opacity:1},exit:{opacity:0,top:"-10px"},transition:{duration:1,ease:[.09,1.04,.245,1.055]},className:"uppercase absolute left-1/2 -translate-x-1/2 px-4 py-2 bg-white text-black rounded-md",onClick:()=>t.onConnectButtonClicked(),children:"Start a conversation"})}),F.jsx(uh,{children:e!=="disconnected"&&e!=="connecting"&&F.jsxs(Xs.div,{initial:{opacity:0,top:"10px"},animate:{opacity:1,top:0},exit:{opacity:0,top:"-10px"},transition:{duration:.4,ease:[.09,1.04,.245,1.055]},className:"flex h-8 absolute left-1/2 -translate-x-1/2 justify-center items-center gap-2",children:[F.jsx(kA,{controls:{leave:!1}}),F.jsx(e2,{}),F.jsx(wT,{children:F.jsx(t2,{})})]})})]})}function xy(t){console.error(t),alert("Error acquiring camera or microphone permissions. Please make sure you grant the necessary permissions in your browser and reload the tab")}function c2(){return JN(),null}Ru.createRoot(document.getElementById("root")).render(F.jsx(k1.StrictMode,{children:F.jsx(r2,{})}));
